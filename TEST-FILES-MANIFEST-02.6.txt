STORY 02.6 - BOM Alternatives + Clone
RED PHASE - TEST FILES MANIFEST
Generated: 2025-12-28
Status: Complete - Ready for DEV Handoff

=== TEST FILES CREATED ===

1. SERVICE UNIT TESTS (2 files)
   Location: apps/frontend/lib/services/__tests__/

   File: bom-clone-service.test.ts
   - Tests: 18 scenarios
   - Coverage: 80%+ target
   - Focus: Clone operations, version management, date validation
   - Status: All tests DESIGNED TO FAIL (no implementation)

   File: bom-alternatives-service.test.ts
   - Tests: 22 scenarios
   - Coverage: 80%+ target
   - Focus: CRUD operations, validation rules, constraints
   - Status: All tests DESIGNED TO FAIL (no implementation)

2. API INTEGRATION TESTS (2 files)
   Location: apps/frontend/app/api/v1/technical/boms/

   File: [id]/clone/__tests__/route.test.ts
   - Tests: 18 scenarios
   - Coverage: 90%+ target
   - Focus: POST /api/v1/technical/boms/:id/clone endpoint
   - Status: All tests DESIGNED TO FAIL (no implementation)

   File: [id]/items/[itemId]/alternatives/__tests__/route.test.ts
   - Tests: 28 scenarios
   - Coverage: 90%+ target
   - Focus: GET/POST/PUT/DELETE alternatives endpoints
   - Status: All tests DESIGNED TO FAIL (no implementation)

3. VALIDATION TESTS (2 files)
   Location: apps/frontend/lib/validation/__tests__/

   File: bom-clone.test.ts
   - Tests: 20 scenarios
   - Coverage: 100% target (validation schemas)
   - Focus: cloneBOMSchema validation
   - Status: All tests DESIGNED TO FAIL (no implementation)

   File: bom-alternative.test.ts
   - Tests: 30 scenarios
   - Coverage: 100% target (validation schemas)
   - Focus: createAlternativeSchema, updateAlternativeSchema validation
   - Status: All tests DESIGNED TO FAIL (no implementation)

4. DATABASE RLS TESTS (1 file)
   Location: supabase/tests/

   File: bom_alternatives_rls.test.sql
   - Tests: 30 scenarios
   - Coverage: RLS policy isolation verification
   - Focus: Multi-tenant isolation, constraints, cascade behavior
   - Status: All tests DESIGNED TO FAIL (no policies implemented)

=== TOTAL TEST COUNT ===

Service Tests:        40 scenarios
API Tests:            46 scenarios
Validation Tests:     50 scenarios
Database Tests:       30 scenarios
─────────────────────────────────
TOTAL:               166 test scenarios

=== ACCEPTANCE CRITERIA COVERAGE ===

Clone Functionality:        AC-01 to AC-10 (10 criteria)
Alternatives Functionality: AC-11 to AC-21 (11 criteria)
Total ACs:                 21 (100% coverage)

=== ERROR CODE COVERAGE ===

Clone Errors:         8 error codes tested
Alternatives Errors: 11 error codes tested
Total Errors:        19 error codes covered

=== KEY TEST PATTERNS ===

Multi-tenant isolation (ADR-013) - All files
RLS enforcement - API tests + database tests
Permission checks - All API tests
Date validation - Clone tests
Quantity/preference validation - Alternative tests
Type matching - Alternative service + API tests
Circular reference prevention - Alternative tests
Duplicate prevention - Alternative tests + RLS tests
Cascade behavior - Database tests
Edge cases - All test files

=== VERIFICATION CHECKLIST ===

RED Phase Criteria:
✓ All tests written
✓ Tests designed to FAIL (no implementation)
✓ Each test has clear name/description
✓ All scenarios from test spec included
✓ NO implementation code written
✓ Edge cases included
✓ Error scenarios covered
✓ Multi-tenant isolation verified
✓ Test coverage targets defined
✓ Follows existing codebase patterns

=== HOW TO RUN TESTS ===

All failing tests (expected):
npm test -- --testPathPattern="bom-clone|bom-alternative"

Service tests only:
npm test -- --testPathPattern="bom-clone-service|bom-alternatives-service"

API integration tests only:
npm test -- --testPathPattern="technical/boms.*route.test"

Validation tests only:
npm test -- --testPathPattern="validation.*bom"

Expected result: ALL TESTS FAIL (RED phase)

=== NEXT STEPS ===

1. This is RED phase - Tests are designed to FAIL
2. Hand off to DEV agent to implement code
3. Code must make all 166 tests PASS
4. SENIOR-DEV reviews and refactors
5. Component tests in future story phase

=== FILES TO CREATE (BY DEV) ===

Types:
- apps/frontend/lib/types/bom-clone.ts
- apps/frontend/lib/types/bom-alternative.ts

Validation:
- apps/frontend/lib/validation/bom-clone.ts
- apps/frontend/lib/validation/bom-alternative.ts

Services:
- apps/frontend/lib/services/bom-clone-service.ts
- apps/frontend/lib/services/bom-alternatives-service.ts

API Routes:
- apps/frontend/app/api/v1/technical/boms/[id]/clone/route.ts
- apps/frontend/app/api/v1/technical/boms/[id]/items/[itemId]/alternatives/route.ts
- apps/frontend/app/api/v1/technical/boms/[id]/items/[itemId]/alternatives/[altId]/route.ts

Database:
- supabase/migrations/XXX_bom_alternatives_constraints.sql

Hooks (optional):
- apps/frontend/lib/hooks/use-bom-clone.ts
- apps/frontend/lib/hooks/use-bom-alternatives.ts

=== DOCUMENTATION ===

Story Context:
docs/2-MANAGEMENT/epics/current/02-technical/context/02.6/
- _index.yaml - Story metadata
- database.yaml - Table schema
- api.yaml - Endpoint specifications
- frontend.yaml - Component specifications
- tests.yaml - Test specifications (this test suite implements)

Test Summary:
RED-PHASE-STORY-02.6.md
- Complete overview of all 166 tests
- Acceptance criteria coverage
- Error handling verification
- Quality gates checklist
- DEV handoff instructions

=== RED PHASE COMPLETE ===

Status: READY FOR DEV HANDOFF
Date: 2025-12-28
Model: Haiku 4.5
Agent: TEST-WRITER

All tests are failing as expected for RED phase.
DEV agent will implement code to make tests PASS.
