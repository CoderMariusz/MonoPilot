# Story 3.3: Bulk PO Creation

**Epic:** 3 - Planning Operations
**Batch:** 03A-1
**Story ID:** 3.3
**Priority:** P2 (Post-MVP)
**Effort:** 8 points
**Status:** Deferred - Coming Soon feature added to UI

---

## User Story

**As a** Purchasing user,
**I want to** bulk create POs from an Excel/CSV file,
**So that** I can quickly order from multiple suppliers without manual entry.

---

## Acceptance Criteria

### AC-3.1: Bulk PO Upload Interface

**When** clicking "Bulk Create POs" button
**Then** Bulk PO modal opens with:
- **Option 1**: Upload Excel/CSV file
  - File dropzone (drag & drop or click to browse)
  - Accepted formats: `.xlsx`, `.csv`
  - Max file size: 5MB
  - Max rows: 1000
- **Option 2**: Download template button
  - Template Excel file with columns: `Product Code`, `Quantity`, `Warehouse Code (optional)`, `Expected Date (optional)`

### AC-3.2: Excel/CSV Template Format

**Template Columns:**
1. `Product Code` (required) - Product code to order
2. `Quantity` (required) - Quantity to order
3. `Warehouse Code` (optional) - Defaults to org default warehouse
4. `Expected Date` (optional) - Defaults to today + 7 days

### AC-3.3: File Parsing and Validation

**When** user uploads file
**Then** system:
1. Parses Excel/CSV rows
2. For each row:
   - Lookup product by `product_code`
   - Lookup default supplier from `supplier_products WHERE is_default = true`
3. Group valid items by `supplier_id`
4. Show results in Review Screen

**Error Handling:**
- "Product not found"
- "No default supplier configured for this product"
- "Invalid quantity (must be > 0)"
- "Invalid warehouse code"
- "Invalid date format"

### AC-3.4: Review Draft POs Screen

**After** parsing completes
**Then** show Review Screen with:
- Draft POs Table (one row per supplier)
- Errors Table (if any)
- Actions: Edit, Remove, "Create All POs", Cancel

### AC-3.5: Confirm and Create POs

**When** clicking "Create All POs"
**Then** system creates all draft POs in single transaction
**And** if any creation fails â†’ Rollback all (atomic operation)

---

## Technical Tasks

1. Excel parsing service (`bulk-po-parser.ts`)
2. API routes (POST /bulk, PUT /bulk/confirm)
3. Frontend components (Upload modal, Review screen)
4. Template download functionality

---

## Definition of Done

- [ ] Excel parsing service implemented
- [ ] API routes implemented
- [ ] Frontend components created
- [ ] Transaction atomicity tested
- [ ] Template download working

---

## Dependencies

- Story 3.1 (PO CRUD)
- Story 3.2 (PO Lines)
- Story 3.17 (Suppliers)

---

## Notes

- **DEFERRED to Phase 2** - Coming Soon UI added
- File size limit: 5MB, 1000 rows
- Atomic transaction: all POs created or none
