# Story 3.6: Transfer Order CRUD

**Epic:** 3 - Planning Operations
**Batch:** 03B-1
**Story ID:** 3.6
**Priority:** P0
**Effort:** 5 points
**Status:** Ready for Development

---

## User Story

**As a** Warehouse user,
**I want to** create, edit, and view transfer orders,
**So that** I can manage inventory transfers between warehouses efficiently.

---

## Acceptance Criteria

### AC-3.6.1: TO List Page

**Given** user has Warehouse role or higher
**When** navigating to `/planning/transfer-orders`
**Then** see table with columns:
- TO Number, From Warehouse, To Warehouse, Status, Planned Ship Date, Planned Receive Date, Actions

**And** filterable by Status, From/To Warehouse, Date Range
**And** searchable by TO Number
**And** paginated (50 per page)
**And** status badges color-coded

### AC-3.6.2: Create TO Modal

**When** clicking "Add Transfer Order"
**Then** modal opens with:
- From Warehouse (required dropdown)
- To Warehouse (required dropdown, excludes selected From)
- Planned Ship Date (required)
- Planned Receive Date (required, >= ship date)
- Notes (optional, max 500 chars)

### AC-3.6.3: Save TO

**When** saving valid TO data
**Then** TO created with:
- Auto-generated `to_number` (TO-YYYY-NNN)
- Status = 'draft'
- created_by = current user

**And** redirect to TO detail page

### AC-3.6.4: View TO Detail

**When** clicking on TO row
**Then** navigate to `/planning/transfer-orders/:id` showing:
- Header: TO Number, Status, From/To Warehouse, Dates
- Actions: Edit, Delete (if draft), Change Status
- TO Lines section (Story 3.7)

### AC-3.6.5: Edit TO

**When** editing draft TO
**Then** drawer opens with:
- From/To Warehouse (read-only)
- Planned Ship/Receive Date (editable)
- Notes (editable)

**Blocked** if status ≠ 'draft'

### AC-3.6.6: Delete TO

**When** deleting draft TO
**Then** confirmation dialog shown
**And** TO hard deleted (cascades to lines)
**And** redirect to TO list

**Blocked** if status ≠ 'draft'

### AC-3.6.7: Change Status to 'Planned'

**When** clicking "Plan TO" on draft TO with ≥1 line
**Then** status changes to 'planned'
**And** Edit/Delete buttons hidden

**Blocked** if TO has 0 lines

### AC-3.6.8: TO Number Generation

**Format:** TO-YYYY-NNN (e.g., TO-2025-001)
- Sequential per org per year
- Resets each year
- Thread-safe (no duplicates)

---

## Technical Tasks

1. Database migration (transfer_orders table)
2. TO number generator utility
3. API routes (GET, POST, PUT, DELETE, status)
4. Validation schemas
5. TO list page with filters
6. TO create modal
7. TO detail page
8. TO edit drawer

---

## Definition of Done

- [ ] Database migration applied
- [ ] RLS policy enabled
- [ ] API endpoints implemented
- [ ] Validation schemas created
- [ ] UI components implemented
- [ ] TO number generation working
- [ ] All tests passing

---

## Dependencies

- Epic 1: Warehouses
- Blocks: Story 3.7, 3.8, 3.9
