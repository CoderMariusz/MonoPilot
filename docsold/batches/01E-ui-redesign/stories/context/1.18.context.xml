<?xml version="1.0" encoding="UTF-8"?>
<story-context>
  <metadata>
    <story-id>1.18</story-id>
    <story-name>Settings Tables Consistency</story-name>
    <epic-id>1</epic-id>
    <batch-id>01E-ui-redesign</batch-id>
    <status>ready-for-dev</status>
    <priority>P1</priority>
    <story-points>3</story-points>
    <effort-estimate>1 day</effort-estimate>
    <created>2025-11-27</created>
  </metadata>

  <story-content>
    <goal>
      Standardize all settings tables with consistent styling, filters, search, and actions matching Planning module design.
    </goal>

    <user-story>
      <role>Administrator</role>
      <want>consistent table layouts across all settings pages</want>
      <so-that>I can efficiently manage configuration data</so-that>
    </user-story>

    <problem-statement>
      Settings tables have inconsistent implementations:
      - Different column layouts
      - Inconsistent action buttons
      - No unified filter/search patterns
      - Missing pagination on some pages
      - Color inconsistency in status badges
    </problem-statement>
  </story-content>

  <acceptance-criteria>
    <criterion id="AC-1.18.1">
      <title>Standardized Table Component</title>
      <given>I view any settings table (Users, Warehouses, Locations, Machines, etc.)</given>
      <when>the page loads</when>
      <then>
        I see consistent:
        - Column headers with sort icons
        - Search input (top-right)
        - Filter dropdowns (by status, type, etc.)
        - Pagination (20 items per page default)
        - Row hover highlighting
      </then>
    </criterion>

    <criterion id="AC-1.18.2">
      <title>Action Buttons Consistency</title>
      <given>I view table rows</given>
      <when>checking action buttons</when>
      <then>
        - View button: gray-600 (eye icon)
        - Edit button: gray-600 (pencil icon)
        - Delete button: red-600 (trash icon)
        - Actions in consistent order: View | Edit | Delete
        - Tooltip on hover
      </then>
    </criterion>

    <criterion id="AC-1.18.3">
      <title>Status Badge Colors</title>
      <given>I view status columns</given>
      <when>checking badge colors</when>
      <then>
        colors match app-colors.ts:
        - Active/Enabled: green-600
        - Inactive/Disabled: gray-400
        - Pending: yellow-500
        - Error/Deleted: red-600
      </then>
    </criterion>

    <criterion id="AC-1.18.4">
      <title>Create Button Consistency</title>
      <given>I'm on a settings list page</given>
      <when>checking Create button</when>
      <then>
        - Button color: green-600 (matching Planning)
        - Position: top-right, below header
        - Icon: Plus icon
        - Text: "Create [Resource]" or "Add [Resource]"
      </then>
    </criterion>

    <criterion id="AC-1.18.5">
      <title>Empty State</title>
      <given>a table has no data</given>
      <when>the page loads</when>
      <then>
        - Friendly empty state message
        - Icon illustration
        - "Create first [resource]" CTA button
      </then>
    </criterion>
  </acceptance-criteria>

  <implementation-tasks>
    <task id="1" status="pending">Create SettingsTable base component with standard props</task>
    <task id="2" status="pending">Create SettingsTableActions component for row actions</task>
    <task id="3" status="pending">Update Users table (/settings/users)</task>
    <task id="4" status="pending">Update Warehouses table (/settings/warehouses)</task>
    <task id="5" status="pending">Update Locations table (/settings/locations)</task>
    <task id="6" status="pending">Update Machines table (/settings/machines)</task>
    <task id="7" status="pending">Update Production Lines table (/settings/production-lines)</task>
    <task id="8" status="pending">Update Allergens table (/settings/allergens)</task>
    <task id="9" status="pending">Update Tax Codes table (/settings/tax-codes)</task>
    <task id="10" status="pending">Add search/filter to all tables</task>
    <task id="11" status="pending">Use shared app-colors.ts (refactor planning-colors.ts â†’ app-colors.ts)</task>
  </implementation-tasks>

  <ui-components>
    <component name="SettingsTable">
      <file-path>apps/frontend/components/settings/SettingsTable.tsx</file-path>
      <description>Generic base component for all settings tables with sort/filter/search/pagination</description>
      <props>
        <prop name="data" type="T[]">Array of rows</prop>
        <prop name="columns" type="ColumnDef&lt;T&gt;[]">Column definitions</prop>
        <prop name="actions" type="ActionDef&lt;T&gt;[]" optional="true">Row actions (View, Edit, Delete)</prop>
        <prop name="filters" type="FilterDef[]" optional="true">Filter definitions</prop>
        <prop name="searchable" type="boolean" default="true">Show search input</prop>
        <prop name="pageSize" type="number" default="20">Items per page</prop>
        <prop name="emptyMessage" type="string" optional="true">Custom empty state message</prop>
        <prop name="onCreate" type="() => void" optional="true">"Create" button callback</prop>
        <prop name="createLabel" type="string" optional="true">"Create" button label</prop>
      </props>
      <features>
        - Sortable headers (click to sort ascending/descending)
        - Search input (fuzzy search on primary columns)
        - Filter dropdowns (by status, type, etc.)
        - Pagination: 20 items per page
        - Row hover: subtle gray background
        - Action buttons: View (gray-600), Edit (gray-600), Delete (red-600)
        - Alternating row colors
      </features>
    </component>

    <component name="SettingsTableActions">
      <file-path>apps/frontend/components/settings/SettingsTableActions.tsx</file-path>
      <description>Standardized row action buttons for tables</description>
      <props>
        <prop name="row" type="T">Row data</prop>
        <prop name="onView" type="(row: T) => void" optional="true">View callback</prop>
        <prop name="onEdit" type="(row: T) => void" optional="true">Edit callback</prop>
        <prop name="onDelete" type="(row: T) => void" optional="true">Delete callback</prop>
      </props>
      <button-pattern>
        - View: gray-600, Eye icon
        - Edit: gray-600, Pencil icon
        - Delete: red-600, Trash icon
        - Order: View | Edit | Delete
        - Tooltip on hover
      </button-pattern>
    </component>

    <component name="StatusBadge">
      <file-path>apps/frontend/components/shared/StatusBadge.tsx</file-path>
      <description>Consistent status badge using app-colors.ts</description>
      <status-colors>
        - Active/Enabled: green-600 bg + green-800 text
        - Inactive/Disabled: gray-400 bg + gray-800 text
        - Pending: yellow-500 bg + yellow-800 text
        - Error/Deleted: red-600 bg + red-800 text
      </status-colors>
    </component>
  </ui-components>

  <table-structure>
    <standard-layout>
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ [Search: ğŸ” Search users...]  [Filter: Status â–¼]  [+ Create User]      â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ Name â†•     â”‚ Email              â”‚ Role      â”‚ Status   â”‚ Actions       â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ John Doe   â”‚ john@example.com   â”‚ Admin     â”‚ ğŸŸ¢Active â”‚ ğŸ‘ï¸ âœï¸ ğŸ—‘ï¸      â”‚
      â”‚ Jane Smith â”‚ jane@example.com   â”‚ Planner   â”‚ ğŸŸ¡Pendingâ”‚ ğŸ‘ï¸ âœï¸ ğŸ—‘ï¸      â”‚
      â”‚ Bob Wilson â”‚ bob@example.com    â”‚ Operator  â”‚ âš«Inactiveâ”‚ ğŸ‘ï¸ âœï¸ ğŸ—‘ï¸      â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                    &lt; 1 2 3 ... 10 &gt;  (20 per page)                     â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    </standard-layout>

    <tables-to-update>
      <table name="Users" path="/settings/users">
        <columns>Name, Email, Role, Status, Created, Actions</columns>
        <filters>Status (Active, Inactive, Pending), Role (Admin, Manager, Planner, Operator)</filters>
        <search>Name, Email</search>
      </table>
      <table name="Warehouses" path="/settings/warehouses">
        <columns>Name, Code, Location, Type, Status, Actions</columns>
        <filters>Status, Type</filters>
        <search>Name, Code</search>
      </table>
      <table name="Locations" path="/settings/locations">
        <columns>Code, Name, Warehouse, Type, Zone, Status, Actions</columns>
        <filters>Status, Type, Warehouse</filters>
        <search>Code, Name</search>
      </table>
      <table name="Machines" path="/settings/machines">
        <columns>Name, Code, Line, Type, Status, Actions</columns>
        <filters>Status, Type, Production Line</filters>
        <search>Name, Code</search>
      </table>
      <table name="Production Lines" path="/settings/production-lines">
        <columns>Name, Code, Warehouse, Machines, Status, Actions</columns>
        <filters>Status, Warehouse</filters>
        <search>Name, Code</search>
      </table>
      <table name="Allergens" path="/settings/allergens">
        <columns>Name, Code, Regulation, Status, Actions</columns>
        <filters>Status, Regulation</filters>
        <search>Name, Code</search>
      </table>
      <table name="Tax Codes" path="/settings/tax-codes">
        <columns>Code, Description, Rate (%), Country, Status, Actions</columns>
        <filters>Status, Country</filters>
        <search>Code, Description</search>
      </table>
    </tables-to-update>
  </table-structure>

  <color-system-refactor>
    <from-file>apps/frontend/lib/constants/planning-colors.ts</from-file>
    <to-file>apps/frontend/lib/constants/app-colors.ts</to-file>
    <shared-colors>
      <color name="CREATE_BUTTON">green-600</color>
      <color name="PRIMARY_CTA">green-600</color>
      <color name="VIEW_BUTTON">gray-600</color>
      <color name="EDIT_BUTTON">gray-600</color>
      <color name="CANCEL_BUTTON">gray-400</color>
      <color name="DELETE_BUTTON">red-600</color>
      <color name="DANGER_CTA">red-600</color>
      <color name="STATUS_ACTIVE">green-600</color>
      <color name="STATUS_INACTIVE">gray-400</color>
      <color name="STATUS_PENDING">yellow-500</color>
      <color name="STATUS_ERROR">red-600</color>
      <color name="STATUS_SUCCESS">green-500</color>
      <color name="STATUS_WARNING">amber-500</color>
    </shared-colors>
    <migration-steps>
      1. Create app-colors.ts with all shared colors
      2. Update Planning components to use app-colors.ts
      3. Update Settings tables to use app-colors.ts
      4. Update Technical module to use app-colors.ts
      5. Delete planning-colors.ts
    </migration-steps>
  </color-system-refactor>

  <testing-strategy>
    <e2e-tests>
      <test-file>tests/e2e/settings-tables.spec.ts</test-file>
      <scenarios>
        <scenario name="Sort users table by name">
          - Navigate to /settings/users
          - Click Name column header to sort ascending
          - Verify first row name
          - Click again to sort descending
          - Verify first row name changed
        </scenario>
        <scenario name="Filter users by status">
          - Navigate to /settings/users
          - Select "Active" from status filter
          - Verify all rows show Active status badge
        </scenario>
        <scenario name="Search users">
          - Navigate to /settings/users
          - Type "John" in search input
          - Verify only matching users shown
        </scenario>
        <scenario name="Paginate users table">
          - Navigate to /settings/users
          - Check pagination controls visible
          - Click page 2
          - Verify active page is 2
        </scenario>
        <scenario name="Action buttons consistency">
          - Navigate to /settings/users
          - Verify View button is gray-600 with eye icon
          - Verify Edit button is gray-600 with pencil icon
          - Verify Delete button is red-600 with trash icon
          - Verify buttons in order: View | Edit | Delete
        </scenario>
        <scenario name="Status badge colors">
          - Navigate to /settings/users
          - Verify Active badge is green-600
          - Verify Inactive badge is gray-400
          - Verify Pending badge is yellow-500
        </scenario>
        <scenario name="Empty state">
          - Navigate to /settings/allergens (empty)
          - Verify empty state message shown
          - Verify "Create first allergen" CTA button visible
          - Click CTA button
          - Verify navigates to create page
        </scenario>
        <scenario name="Create button consistency">
          - Check all settings tables
          - Verify Create button is green-600
          - Verify position is top-right, below header
          - Verify icon is Plus icon
        </scenario>
      </scenarios>
    </e2e-tests>

    <unit-tests>
      <test-file>apps/frontend/__tests__/components/SettingsTable.test.tsx</test-file>
      <scenarios>
        - Renders table with correct columns
        - Sorts data when column header clicked
        - Filters data when filter applied
        - Searches data when search query entered
        - Paginates data correctly (20 items per page)
        - Shows empty state when no data
        - Renders action buttons in correct order
        - Uses correct colors from app-colors.ts
      </scenarios>
    </unit-tests>
  </testing-strategy>

  <dependencies>
    <dependency type="story" id="1.16">SettingsHeader must be implemented first</dependency>
    <dependency type="component" path="apps/frontend/components/planning/PurchaseOrdersTable.tsx">Reference for table pattern</dependency>
    <dependency type="component" path="apps/frontend/lib/constants/planning-colors.ts">Will be refactored to app-colors.ts</dependency>
    <dependency type="design-doc" path="docs/ux-design/ux-design-shared-system.md">Shared UI design system</dependency>
    <dependency type="tech-spec" path="docs/batches/01E-ui-redesign/tech-spec.md">Epic technical specification</dependency>
  </dependencies>

  <files-to-modify>
    <new-files>
      <file>apps/frontend/components/settings/SettingsTable.tsx</file>
      <file>apps/frontend/components/settings/SettingsTableActions.tsx</file>
      <file>apps/frontend/lib/constants/app-colors.ts</file>
    </new-files>
    <updated-files>
      <file>apps/frontend/app/(authenticated)/settings/users/page.tsx</file>
      <file>apps/frontend/app/(authenticated)/settings/warehouses/page.tsx</file>
      <file>apps/frontend/app/(authenticated)/settings/locations/page.tsx</file>
      <file>apps/frontend/app/(authenticated)/settings/machines/page.tsx</file>
      <file>apps/frontend/app/(authenticated)/settings/production-lines/page.tsx</file>
      <file>apps/frontend/app/(authenticated)/settings/allergens/page.tsx</file>
      <file>apps/frontend/app/(authenticated)/settings/tax-codes/page.tsx</file>
      <file>apps/frontend/components/planning/PlanningHeader.tsx</file>
      <file>apps/frontend/components/planning/PlanningStatsCard.tsx</file>
      <file>apps/frontend/components/planning/PurchaseOrdersTable.tsx</file>
    </updated-files>
    <deleted-files>
      <file>apps/frontend/lib/constants/planning-colors.ts</file>
    </deleted-files>
  </files-to-modify>

  <design-reference>
    <shared-system-doc>docs/ux-design/ux-design-shared-system.md</shared-system-doc>
    <table-pattern>
      - Standard columns: [Checkbox] [Primary Columnâ†•] [Status] [Date] [Details] [Action Buttons]
      - Sortable headers: Click to sort ascending/descending
      - Filters: Inline filter buttons (Status, Type, Date Range, etc.)
      - Search: Fuzzy search on primary columns
      - Pagination: 20 items per page
      - Row actions: View (gray-600), Edit (gray-600), Delete (red-600)
      - Alternating rows: Subtle background color alternation
      - Hover: Row highlight on hover
    </table-pattern>
    <reference-components>
      - PlanningHeader.tsx â†’ SettingsHeader.tsx pattern
      - PurchaseOrdersTable.tsx â†’ SettingsTable.tsx pattern
      - planning-colors.ts â†’ app-colors.ts refactor
    </reference-components>
  </design-reference>

  <success-criteria>
    <criteria>
      - SettingsTable base component created and reusable
      - app-colors.ts created and used across all modules
      - All settings tables use SettingsTable component
      - Sortable headers work on all tables
      - Search/filter/pagination work on all tables
      - Action buttons consistent: View (gray-600), Edit (gray-600), Delete (red-600)
      - Status badges use app-colors.ts (Active green-600, Inactive gray-400, etc.)
      - Empty states show friendly message + "Create first [resource]" CTA
      - All E2E tests passing
      - No horizontal scroll on any table
      - Planning module still works after planning-colors.ts refactor
    </criteria>
  </success-criteria>

  <next-story>
    <story-id>1.19</story-id>
    <story-name>Settings Mobile Responsive</story-name>
    <dependency-reason>Mobile responsive design builds on standardized tables (1.18) and header (1.16)</dependency-reason>
  </next-story>
</story-context>
