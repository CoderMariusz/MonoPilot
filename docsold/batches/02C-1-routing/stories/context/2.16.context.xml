<?xml version="1.0" encoding="UTF-8"?>
<story>
  <metadata>
    <id>2.16</id>
    <title>Routing Operations</title>
    <batch>02C-1</batch>
    <points>5</points>
    <effort_hours>6-8</effort_hours>
    <status>pending</status>
  </metadata>

  <description>Add, edit, delete, and reorder routing operations with machine/line assignment, duration, and yield.</description>

  <dependencies>
    <requires>
      <story id="2.15">Routing CRUD</story>
      <epic id="1">Machines, Production Lines</epic>
    </requires>
  </dependencies>

  <technical_context>
    <tables>
      <table>
        <name>routing_operations</name>
        <columns>
          <column name="id" type="UUID" pk="true"/>
          <column name="routing_id" type="UUID" fk="routings.id" cascade="true"/>
          <column name="sequence" type="INTEGER" required="true">Unique within routing</column>
          <column name="operation_name" type="VARCHAR(100)" required="true"/>
          <column name="machine_id" type="UUID" fk="machines.id" on_delete="SET NULL"/>
          <column name="line_id" type="UUID" fk="production_lines.id" on_delete="SET NULL"/>
          <column name="expected_duration_minutes" type="INTEGER" required="true"/>
          <column name="expected_yield_percent" type="DECIMAL(5,2)" default="100.00"/>
          <column name="setup_time_minutes" type="INTEGER" default="0"/>
          <column name="labor_cost" type="DECIMAL(10,2)"/>
        </columns>
        <constraints>
          <unique>routing_id, sequence</unique>
        </constraints>
      </table>
    </tables>

    <api_endpoints>
      <endpoint method="GET" path="/api/technical/routings/:id/operations">List sorted by sequence</endpoint>
      <endpoint method="POST" path="/api/technical/routings/:id/operations">Add operation</endpoint>
      <endpoint method="PUT" path="/api/technical/routings/:routingId/operations/:operationId">Update</endpoint>
      <endpoint method="DELETE" path="/api/technical/routings/:routingId/operations/:operationId">Delete</endpoint>
      <endpoint method="POST" path="/api/technical/routings/:id/operations/reorder">Batch update sequences</endpoint>
    </api_endpoints>
  </technical_context>

  <acceptance_criteria>
    <ac id="2.16.1">Add operation with sequence, name, machine, line, duration, yield, setup, cost</ac>
    <ac id="2.16.2">Operations displayed in sequence order</ac>
    <ac id="2.16.3">Drag-drop reorder updates sequences</ac>
    <ac id="2.16.4">Edit/delete individual operations</ac>
    <ac id="2.16.5">Machine/line dropdowns filtered by org</ac>
  </acceptance_criteria>
</story>
