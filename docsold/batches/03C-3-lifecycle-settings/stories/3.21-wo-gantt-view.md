# Story 3.21: WO Gantt View

**ID:** 3.21
**Batch:** 03C-3
**Story Points:** 5
**Effort:** 4-6 hours
**Status:** Todo

## User Story

> As a **Planner**,
> I want to see WO schedule as Gantt chart,
> So that I can visualize production timeline.

## Acceptance Criteria

### AC 1: Schedule View Toggle

**Given** user navigates to /planning/work-orders
**When** selecting "Schedule View" toggle
**Then** Gantt chart displayed instead of table

### AC 2: Gantt Layout (Grouped by Production Lines)

**Then** Gantt chart shows:
- X-axis: dates (day/week view)
- Y-axis: **production_lines** (FK: work_orders.line_id → production_lines)
- Bars: WOs with product name, qty, status color
- Each row = one production line with its WOs

### AC 3: WO Bar Details

**When** hovering over WO bar
**Then** tooltip shows: WO#, Product, Qty, Status, Scheduled Date

### AC 4: Click to Detail

**And** can click bar to view WO detail modal/page

### AC 5: Drag to Reschedule (Optional)

**When** dragging WO bar to different date
**Then** scheduled_date updated (if allowed by settings)

### AC 6: Zoom Controls

**And** can zoom in/out (day, week, month view)

## Technical Tasks

### Backend
- [ ] API: `GET /api/planning/work-orders/schedule`
- [ ] Return WOs with line_id, scheduled_date, duration (estimated)
- [ ] Support date range filtering

### Frontend
- [ ] Install Gantt chart library (e.g., react-gantt-timeline, frappe-gantt, or recharts)
- [ ] Create GanttView component
- [ ] View toggle (Table/Gantt)
- [ ] Date range selector
- [ ] Zoom controls (day/week/month)
- [ ] Drag-to-reschedule (optional)

### API Response

```typescript
interface WOScheduleItem {
  id: string;
  wo_number: string;
  product_name: string;
  quantity: number;
  scheduled_date: string;
  estimated_end_date: string;
  line_id: string;
  line_name: string;
  status: string;
  status_color: string;
  priority: string;
}

// GET /api/planning/work-orders/schedule?from=2025-01-01&to=2025-01-31
```

## Testing

### Unit Tests
- [ ] Schedule data transformation
- [ ] Date range filtering

### Integration Tests
- [ ] API returns correct schedule data
- [ ] Line grouping works

### E2E Tests
- [ ] Toggle between Table and Gantt view
- [ ] Click WO bar → opens detail
- [ ] Zoom controls work

## Dependencies

- **Requires:** Story 3.10 (WO CRUD)
- **Blocks:** None (enhancement feature)

## Notes

- **Grouped by production_lines** (NOT machines)
- work_orders.line_id → production_lines.id (FK)
- Machines are per-operation (wo_operations.machine_id), NOT per-WO
- Consider using lightweight library (frappe-gantt or similar)
- Drag-to-reschedule can be Phase 2 if complex
- Line grouping important for factory floor visualization
- Setting: `planning_settings.wo_gantt_group_by` defaults to 'production_line'
