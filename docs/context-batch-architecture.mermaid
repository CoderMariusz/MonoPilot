graph TB
    subgraph "LEVEL 0: CORE CONTEXT (ZAWSZE ÅADOWANY)"
        CORE["ğŸ—ï¸ Batch 0: Core Architecture<br/>ğŸ“„ CODE_ARCHITECTURE_DOCUMENTATION.md<br/>ğŸ“Š 1,556 lines (~31K tokens)<br/><br/>âœ“ Service Layer Pattern<br/>âœ“ Component Architecture<br/>âœ“ Validation Strategy<br/>âœ“ Auth & RLS<br/>âœ“ Caching Strategy"]
    end

    subgraph "LEVEL 1: EPIC CONTEXT (JEDEN NA RAZ)"
        EPIC1["ğŸ“¦ Epic 1: Settings<br/>633 lines (~12.6K tokens)<br/>14 stories"]
        EPIC2["ğŸ“¦ Epic 2: Technical<br/>736 lines (~14.7K tokens)<br/>24 stories"]
        EPIC3["ğŸ“¦ Epic 3: Planning<br/>846 lines (~16.9K tokens)<br/>22 stories"]
        EPIC4["ğŸ“¦ Epic 4: Production<br/>~800 lines (~16K tokens)<br/>~20 stories"]
        EPIC5["ğŸ“¦ Epic 5: Warehouse<br/>~1000 lines (~20K tokens)<br/>~35 stories"]
        EPIC6["ğŸ“¦ Epic 6: Quality<br/>~700 lines (~14K tokens)<br/>~28 stories"]
        EPIC7["ğŸ“¦ Epic 7: Shipping<br/>~700 lines (~14K tokens)<br/>~28 stories"]
        EPIC8["ğŸ“¦ Epic 8: NPD<br/>~1000 lines (~20K tokens)<br/>~68 stories"]
    end

    subgraph "LEVEL 2: STORY CONTEXT (JEDNA NA RAZ)"
        STORY_EXAMPLE["ğŸ“ Story 2.6: BOM CRUD<br/>500 lines (~10K tokens)<br/><br/>âœ“ Detailed AC<br/>âœ“ Technical notes<br/>âœ“ Prerequisites<br/>âœ“ Templates Required"]
    end

    subgraph "LEVEL 3: TEMPLATES (AUTO-DETECTED)"
        TMPL_A["ğŸ“‹ Template A: CRUD Pattern<br/>200 lines (~4K tokens)<br/><br/>âœ“ API Route Pattern<br/>âœ“ Service Layer<br/>âœ“ Component (Modal)<br/>âœ“ Validation Schema"]
        TMPL_B["ğŸ“‹ Template B: Line Items<br/>150 lines (~3K tokens)<br/><br/>âœ“ Parent-Child Pattern<br/>âœ“ Nested API Routes<br/>âœ“ Table Component"]
        TMPL_C["ğŸ“‹ Template C: Settings<br/>100 lines (~2K tokens)<br/><br/>âœ“ JSONB Config<br/>âœ“ Accordion UI<br/>âœ“ Toggle Fields"]
        TMPL_D["ğŸ“‹ Template D: Versioning<br/>120 lines (~2.4K tokens)<br/><br/>âœ“ Auto-increment<br/>âœ“ History Tracking<br/>âœ“ Comparison View"]
        TMPL_E["ğŸ“‹ Template E: Traceability<br/>180 lines (~3.6K tokens)<br/><br/>âœ“ Recursive Queries<br/>âœ“ Tree Visualization<br/>âœ“ React Flow"]
    end

    subgraph "FINAL CONTEXT (Example: Story 2.6)"
        FINAL["ğŸ¯ Combined Context<br/>3,142 lines (~62.8K tokens)<br/><br/>88.6% REDUCTION vs. full load<br/>âœ… Fits in 200K token limit<br/>âœ… 137K tokens for code generation"]
    end

    CORE --> EPIC2
    EPIC2 --> STORY_EXAMPLE
    STORY_EXAMPLE --> TMPL_A
    STORY_EXAMPLE --> TMPL_B
    TMPL_A --> FINAL
    TMPL_B --> FINAL
    CORE --> FINAL
    EPIC2 --> FINAL

    style CORE fill:#4CAF50,stroke:#2E7D32,color:#fff
    style EPIC2 fill:#2196F3,stroke:#1565C0,color:#fff
    style STORY_EXAMPLE fill:#FF9800,stroke:#E65100,color:#fff
    style TMPL_A fill:#9C27B0,stroke:#4A148C,color:#fff
    style TMPL_B fill:#9C27B0,stroke:#4A148C,color:#fff
    style FINAL fill:#F44336,stroke:#B71C1C,color:#fff

    classDef epicClass fill:#2196F3,stroke:#1565C0,color:#fff,stroke-width:2px
    classDef tmplClass fill:#9C27B0,stroke:#4A148C,color:#fff,stroke-width:2px

    class EPIC1,EPIC3,EPIC4,EPIC5,EPIC6,EPIC7,EPIC8 epicClass
    class TMPL_C,TMPL_D,TMPL_E tmplClass
