<story-context id="bmad/bmm/workflows/4-implementation/story-context/1-13-main-dashboard" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>13</storyId>
    <title>Main Dashboard</title>
    <status>backlog</status>
    <generatedAt>2025-11-20</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/1-13-main-dashboard.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>User</asA>
    <iWant>to see a main dashboard after login</iWant>
    <soThat>I can quickly access key information and navigate to different modules</soThat>
    <tasks>
      <task id="1" ac="012.3">Database Schema for Activity Feed - activity_logs table with org_id, user_id, activity_type, entity_type, entity_id, entity_code, description, metadata, created_at. RLS policy for org isolation</task>
      <task id="2" ac="012.5">Database Schema for User Preferences (OPTIONAL) - user_preferences table with dashboard_config JSONB (module_order, pinned_modules, show_activity_feed)</task>
      <task id="3" ac="012.2,012.3,012.4">API Endpoints - GET /api/dashboard/overview (module stats), GET /api/dashboard/activity (last 10 activities), GET /api/dashboard/search (global search), PUT /api/dashboard/preferences (optional)</task>
      <task id="4" ac="012.3">Activity Logging Utility - lib/activity/log-activity.ts utility, integration into Planning/Production/Warehouse/Quality modules</task>
      <task id="5" ac="012.1,012.2,012.6">Frontend Dashboard Page - /app/dashboard/page.tsx with SWR data fetching, DashboardLayout, top nav, sidebar, module cards grid, loading/empty states, responsive design</task>
      <task id="6" ac="012.2,012.6">Module Overview Cards Component - ModuleCard.tsx with hover effects, color-coded icons (8 modules), stats, primary action button, view details link</task>
      <task id="7" ac="012.3,012.6">Activity Feed Component - ActivityFeed.tsx with activity list, icons, relative time (date-fns), click navigation, optional Supabase Realtime</task>
      <task id="8" ac="012.4,012.6">Quick Actions Toolbar Component - QuickActions.tsx with Create dropdown (filtered by enabled modules), global search bar (debounced 300ms), notifications bell placeholder</task>
      <task id="9" ac="012.1,012.6">Dashboard Layout Component - DashboardLayout.tsx, TopNav.tsx (logo, module links, user menu), Sidebar.tsx (collapsible, module icons, tooltips, active state)</task>
      <task id="10" ac="012.6">Welcome Banner for New Users - WelcomeBanner.tsx (show if setup_completed=false), Start Setup Wizard button, Skip button, add setup_completed column to organizations</task>
      <task id="11" ac="012.5">Personalization (OPTIONAL) - Drag-and-drop module cards (@dnd-kit/core), pin modules, hide activity feed, save to user_preferences</task>
      <task id="12" ac="ALL">Integration & Testing - Unit tests (module card, activity feed, search), integration tests (API endpoints, activity logging), E2E tests (login flow, create actions, search, activity navigation)</task>
      <task id="13">UX Design & Documentation - Mockups for desktop/mobile layouts, module cards, activity feed, global search, design specifications document</task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="AC-012.1">Dashboard layout and navigation: main dashboard at /dashboard (landing page after login), top nav bar (logo, module links, user menu), sidebar navigation (collapsible with module icons), active modules only (Story 1.11 Module Activation), responsive (desktop: sidebar + content, mobile: bottom nav)</criterion>
    <criterion id="AC-012.2">Module overview cards: grid 2-4 columns (viewport responsive), each enabled module shows icon + name, quick stats (e.g., "5 Active WOs"), primary action button (e.g., "Create WO"), view details link. 8 modules: Settings, Technical, Planning, Production, Warehouse, Quality, Shipping, NPD. Disabled modules hidden</criterion>
    <criterion id="AC-012.3">Recent activity feed: right sidebar or bottom on mobile, shows last 10 activities across all modules (e.g., "WO-2024-001 started by John Doe 2 minutes ago"), activity types (WO status change, PO approval, LP received, NCR created), click activity to navigate to entity, optional real-time updates via Supabase Realtime</criterion>
    <criterion id="AC-012.4">Quick actions toolbar: Create dropdown button (Create PO/WO/NCR/TO based on enabled modules), global search bar (search WO/PO/LP/Product by code/name, results grouped by entity type, click to navigate), notifications bell icon placeholder (future: alerts for overdue WOs, low stock)</criterion>
    <criterion id="AC-012.5">Personalization (OPTIONAL): drag-and-drop reorder module cards, pin favorite modules to top, hide/show activity feed, preferences saved per user in user_preferences table</criterion>
    <criterion id="AC-012.6">UX/UI requirements: clean modern design with whitespace, module cards with hover effects (elevation), color-coded module icons (Settings: gray, Planning: blue, Production: green, Warehouse: orange, Quality: red, Shipping: purple, NPD: pink), loading states (skeleton cards), empty state if no modules enabled ("Enable modules in Settings"), responsive grid (4 cols xl, 3 cols lg, 2 cols md, 1 col sm)</criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/ux-design-auth-and-dashboard.md</path>
        <title>UX Design: Authentication & Main Dashboard</title>
        <section>Main Dashboard Design - Layout & Navigation</section>
        <snippet>Desktop layout: top nav (64px height) with logo, module links, global search (w-64), notifications bell, user menu. Sidebar (w-64 expanded, w-16 collapsed) with module icons, collapse toggle, hover state. Main content area with module cards grid. Mobile layout: top nav minimal (logo + search + user), bottom nav (Home, Modules, Create, Profile), cards 1 column. Responsive breakpoints: sm 640px, md 768px, lg 1024px, xl 1280px.</snippet>
      </doc>
      <doc>
        <path>docs/ux-design-auth-and-dashboard.md</path>
        <title>UX Design: Authentication & Main Dashboard</title>
        <section>Main Dashboard Design - Module Overview Cards</section>
        <snippet>ModuleCard layout: card container (Shadcn/UI Card, border border-gray-200, rounded-lg, shadow-sm hover:shadow-md transition). Icon 48px with color-coded background (bg-{color}-100, text-{color}-600). Module name (text-xl font-semibold). Stats (text-sm text-gray-600, leading-relaxed). Primary action button (Shadcn/UI Button variant=default size=sm, w-full). View Details link (text-sm text-blue-600, ArrowRight icon, bottom-right). Grid: grid-cols-4 (xl), grid-cols-3 (lg), grid-cols-2 (md), grid-cols-1 (sm), gap-6.</snippet>
      </doc>
      <doc>
        <path>docs/ux-design-auth-and-dashboard.md</path>
        <title>UX Design: Authentication & Main Dashboard</title>
        <section>Main Dashboard Design - Activity Feed</section>
        <snippet>ActivityFeed layout: container (w-80 desktop, full width mobile, bg-white, border border-gray-200, rounded-lg, p-4). Heading "Recent Activity" (text-lg font-semibold, 16px margin bottom). Activity item (min-h-[72px], p-3, hover:bg-gray-50, border-b except last, cursor-pointer). Activity icon (32px circle, color-coded by type: WO green, PO blue, LP orange, NCR red). Description (text-sm font-medium, line 1 bold, line 2 "by {User}" lighter, line 3 relative time lightest). Relative time using date-fns formatDistanceToNow(). View All link at bottom.</snippet>
      </doc>
      <doc>
        <path>docs/ux-design-auth-and-dashboard.md</path>
        <title>UX Design: Authentication & Main Dashboard</title>
        <section>Main Dashboard Design - Quick Actions Toolbar</section>
        <snippet>QuickActions layout: container (h-14, px-6 py-3, bg-gray-50, border-b). Create dropdown (Shadcn/UI DropdownMenu, Button variant=default with Plus icon left, ChevronDown right). Dropdown items conditional on enabled modules: Create PO â†’ /planning/purchase-orders/new, Create WO â†’ /production/work-orders/new, Create NCR â†’ /quality/ncr/new, Create TO â†’ /warehouse/transfers/new. Global search bar (w-96 desktop, flex-1 mobile, Search icon left, debounced 300ms). Notifications bell (Bell icon 20px, red badge with count).</snippet>
      </doc>
      <doc>
        <path>docs/ux-design-auth-and-dashboard.md</path>
        <title>UX Design: Authentication & Main Dashboard</title>
        <section>Main Dashboard Design - Welcome Banner</section>
        <snippet>WelcomeBanner layout: gradient background (bg-gradient-to-r from-blue-500 to-indigo-600), text-white, p-6, rounded-lg, 24px margin bottom. Heading "ðŸ‘‹ Welcome to MonoPilot!" (text-2xl font-bold). Subtext "Let's set up your organization." (text-base opacity-90, 8px margin top). Buttons: "Start Setup Wizard" (white button blue text), "Skip for now" (transparent white outline), 16px spacing. Show only if organizations.setup_completed = false.</snippet>
      </doc>
      <doc>
        <path>docs/ux-design-auth-and-dashboard.md</path>
        <title>UX Design: Authentication & Main Dashboard</title>
        <section>Main Dashboard Design - Empty State</section>
        <snippet>Empty state layout: centered vertically and horizontally, max-w-md. Icon (Lucide PackageOpen 96px, text-gray-300). Heading "No modules are enabled" (text-xl font-semibold text-gray-700, 16px margin top). Subtext "Enable modules in Settings to get started" (text-sm text-gray-500, 8px margin top). CTA button "Go to Settings" (Shadcn/UI Button variant=default, link to /settings/modules, 24px margin top).</snippet>
      </doc>
      <doc>
        <path>docs/ux-design-auth-and-dashboard.md</path>
        <title>UX Design: Authentication & Main Dashboard</title>
        <section>Design Tokens</section>
        <snippet>Module colors: Settings gray-600 #4b5563, Technical blue-600 #2563eb, Planning indigo-600 #4f46e5, Production green-600 #16a34a, Warehouse orange-600 #ea580c, Quality red-600 #dc2626, Shipping purple-600 #9333ea, NPD pink-600 #db2777. Typography: Inter font family, sizes xs 12px to 3xl 30px, weights 400-700. Spacing base unit 4px. Shadows: sm to 2xl for card elevation.</snippet>
      </doc>
      <doc>
        <path>docs/architecture/patterns/frontend.md</path>
        <title>Frontend Architecture</title>
        <section>Component Architecture - Server vs Client Components</section>
        <snippet>Next.js 15 App Router: default server components for data fetching, SEO, static content. Client components ('use client' directive) for interactivity, state, events (forms, tables, modals). Mixed composition: page with server component wrapping client interactive components. Component strategy: server for page layouts and lists, client for forms/tables/modals.</snippet>
      </doc>
      <doc>
        <path>docs/architecture/patterns/frontend.md</path>
        <title>Frontend Architecture</title>
        <section>State Management - SWR for Data Fetching</section>
        <snippet>SWR library for data fetching and caching. Custom hooks pattern: useWorkOrders(filters) returns { workOrders, isLoading, isError, mutate }. Key construction with query params. Fetcher function for API calls. Automatic revalidation on focus, interval, manual mutate() for optimistic updates.</snippet>
      </doc>
      <doc>
        <path>docs/architecture/patterns/database.md</path>
        <title>Database Architecture</title>
        <section>Multi-Tenancy Pattern - Organization Isolation</section>
        <snippet>Every business table includes org_id with RLS policy: CREATE POLICY "Tenant isolation" ON {table} FOR ALL USING (org_id = auth.jwt() ->> 'org_id'). UUID for org_id. Flat structure, no parent_org_id. Each organization independent.</snippet>
      </doc>
      <doc>
        <path>docs/architecture/patterns/database.md</path>
        <title>Database Architecture</title>
        <section>Audit Trail Pattern - Standard Audit Columns</section>
        <snippet>Standard audit columns on business tables: created_at TIMESTAMPTZ DEFAULT now(), updated_at TIMESTAMPTZ DEFAULT now(), created_by UUID REFERENCES users(id), updated_by UUID REFERENCES users(id), deleted_at TIMESTAMPTZ (soft delete per-table decision), org_id UUID NOT NULL REFERENCES organizations(id). Auto-update timestamp trigger: update_updated_at() function.</snippet>
      </doc>
      <doc>
        <path>docs/epics/epic-1-settings.md</path>
        <title>Epic 1: Foundation & Settings</title>
        <section>Story 1.13: Main Dashboard</section>
        <snippet>Complete main dashboard story with landing page after login, module overview cards grid, activity feed, quick actions toolbar, welcome banner for new users. Prerequisites: Story 1.0 (Auth UI), Story 1.11 (Module Activation). Technical notes: API endpoints for overview/activity/search, activity_logs table, SWR data fetching, Shadcn/UI components, responsive design (desktop sidebar + cards + feed, mobile bottom nav + cards).</snippet>
      </doc>
    </docs>

    <code>
      <artifact>
        <path>app/dashboard</path>
        <kind>directory</kind>
        <symbol>Dashboard page location</symbol>
        <reason>Story requires creating page.tsx for main dashboard at /dashboard route</reason>
      </artifact>
      <artifact>
        <path>app/api/dashboard/overview</path>
        <kind>directory</kind>
        <symbol>Dashboard overview API</symbol>
        <reason>Story requires creating route.ts for GET /api/dashboard/overview (module stats)</reason>
      </artifact>
      <artifact>
        <path>app/api/dashboard/activity</path>
        <kind>directory</kind>
        <symbol>Dashboard activity API</symbol>
        <reason>Story requires creating route.ts for GET /api/dashboard/activity (last 10 activities)</reason>
      </artifact>
      <artifact>
        <path>app/api/dashboard/search</path>
        <kind>directory</kind>
        <symbol>Dashboard search API</symbol>
        <reason>Story requires creating route.ts for GET /api/dashboard/search (global search)</reason>
      </artifact>
      <artifact>
        <path>app/api/dashboard/preferences</path>
        <kind>directory</kind>
        <symbol>Dashboard preferences API</symbol>
        <reason>Story requires creating route.ts for PUT /api/dashboard/preferences (optional personalization)</reason>
      </artifact>
      <artifact>
        <path>lib/activity/log-activity.ts</path>
        <kind>file</kind>
        <symbol>Activity logging utility</symbol>
        <reason>Story requires creating centralized logActivity() function to insert into activity_logs table</reason>
      </artifact>
      <artifact>
        <path>lib/dashboard/get-module-stats.ts</path>
        <kind>file</kind>
        <symbol>Module stats utility</symbol>
        <reason>Story requires creating function to calculate stats for each module (active WOs, pending POs, etc.)</reason>
      </artifact>
      <artifact>
        <path>components/dashboard/DashboardLayout.tsx</path>
        <kind>component</kind>
        <symbol>DashboardLayout</symbol>
        <reason>Story requires creating main layout wrapper with top nav, sidebar, content area</reason>
      </artifact>
      <artifact>
        <path>components/dashboard/ModuleCard.tsx</path>
        <kind>component</kind>
        <symbol>ModuleCard</symbol>
        <reason>Story requires creating module overview card component with icon, stats, buttons</reason>
      </artifact>
      <artifact>
        <path>components/dashboard/ActivityFeed.tsx</path>
        <kind>component</kind>
        <symbol>ActivityFeed</symbol>
        <reason>Story requires creating activity feed component with list, icons, relative time</reason>
      </artifact>
      <artifact>
        <path>components/dashboard/QuickActions.tsx</path>
        <kind>component</kind>
        <symbol>QuickActions</symbol>
        <reason>Story requires creating quick actions toolbar with Create dropdown, search bar, notifications</reason>
      </artifact>
      <artifact>
        <path>components/dashboard/WelcomeBanner.tsx</path>
        <kind>component</kind>
        <symbol>WelcomeBanner</symbol>
        <reason>Story requires creating welcome banner for new users with wizard button</reason>
      </artifact>
      <artifact>
        <path>components/navigation/TopNav.tsx</path>
        <kind>component</kind>
        <symbol>TopNav</symbol>
        <reason>Story requires creating top navigation bar with logo, module links, user menu</reason>
      </artifact>
      <artifact>
        <path>components/navigation/Sidebar.tsx</path>
        <kind>component</kind>
        <symbol>Sidebar</symbol>
        <reason>Story requires creating collapsible sidebar with module icons, tooltips, active state</reason>
      </artifact>
      <artifact>
        <path>supabase/migrations/20XX_create_activity_logs.sql</path>
        <kind>migration</kind>
        <symbol>Activity logs table migration</symbol>
        <reason>Story requires creating activity_logs table for tracking user actions across modules</reason>
      </artifact>
      <artifact>
        <path>supabase/migrations/20XX_add_setup_completed.sql</path>
        <kind>migration</kind>
        <symbol>Setup completed column migration</symbol>
        <reason>Story requires adding setup_completed BOOLEAN column to organizations table</reason>
      </artifact>
      <artifact>
        <path>supabase/migrations/20XX_create_user_preferences.sql</path>
        <kind>migration</kind>
        <symbol>User preferences table migration (optional)</symbol>
        <reason>Story optionally requires creating user_preferences table for dashboard personalization</reason>
      </artifact>
    </code>

    <dependencies>
      <node>
        <package name="next" version="^15.x" usage="Next.js framework with App Router for dashboard page and API routes" />
        <package name="react" version="^19.x" usage="React 19 for UI components" />
        <package name="swr" version="^2.x" usage="Data fetching and caching for dashboard overview and activity feed" />
        <package name="@supabase/supabase-js" version="^2.x" usage="Supabase client for database queries (activity logs, module stats)" />
        <package name="@supabase/realtime-js" version="^2.x" usage="Optional: real-time updates for activity feed via Supabase Realtime" />
        <package name="shadcn/ui" version="latest" usage="UI components (Card, Button, DropdownMenu, Input, Badge, Skeleton)" />
        <package name="lucide-react" version="latest" usage="Icons for modules, activities, navigation, search, notifications" />
        <package name="tailwindcss" version="^3.4" usage="Utility-first CSS framework for styling and responsive design" />
        <package name="date-fns" version="^3.x" usage="Date formatting for relative time in activity feed (formatDistanceToNow)" />
        <package name="@dnd-kit/core" version="^6.x" usage="Optional: drag-and-drop library for module card reordering personalization" />
        <package name="zod" version="^3.x" usage="Validation schemas for API routes (dashboard preferences, search queries)" />
      </node>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint type="architecture">Next.js 15 App Router - /dashboard page as default landing after login, server components for initial data fetch, client components for interactive cards/feed</constraint>
    <constraint type="architecture">SWR data fetching - use SWR hooks for /api/dashboard/overview and /api/dashboard/activity with automatic revalidation, caching, loading states</constraint>
    <constraint type="database">Multi-tenancy - activity_logs table MUST include org_id with RLS policy for tenant isolation, all queries filtered by auth.jwt() org_id</constraint>
    <constraint type="database">Activity logging - centralized logActivity() utility called from all modules (Planning, Production, Warehouse, Quality) on key events, requires integration in other stories</constraint>
    <constraint type="caching">Module stats caching - cache GET /api/dashboard/overview results in Redis with 5 min TTL for performance, avoid real-time queries on every page load</constraint>
    <constraint type="search">Global search strategy - MVP uses PostgreSQL ILIKE for simplicity (e.g., WHERE code ILIKE '%{query}%'), Phase 2 upgrades to full-text search with tsvector indexes</constraint>
    <constraint type="ux">Shadcn/UI components - use design system for consistency (Card, Button, DropdownMenu, Input, Badge, Skeleton for loading states)</constraint>
    <constraint type="ux">Responsive design - mobile-first approach, desktop (sidebar + cards grid + activity feed), tablet (collapsed sidebar icon-only), mobile (bottom nav + single column cards)</constraint>
    <constraint type="ux">Color-coded modules - consistent module colors across all UI (Settings gray, Technical blue, Planning indigo, Production green, Warehouse orange, Quality red, Shipping purple, NPD pink)</constraint>
    <constraint type="security">Activity logs RLS - users can ONLY see activities from their org_id, prevent cross-tenant data leakage in activity feed</constraint>
    <constraint type="security">Module stats filtering - only show stats for modules enabled in organizations.modules_enabled, prevent data exposure from disabled modules</constraint>
    <constraint type="testing">Test pyramid - unit tests for ModuleCard/ActivityFeed components (95% coverage), integration tests for API endpoints (70% coverage), E2E tests for complete dashboard flow (100% user journeys)</constraint>
    <constraint type="decision">Dashboard vs Module Dashboards - Main Dashboard (Story 1.13) = overview of all modules with quick access, Module Dashboards (Stories 4.1, 7.28) = deep dive into specific module with detailed data</constraint>
    <constraint type="decision">Real-time activity feed - Optional for MVP (polling every 30s with SWR revalidateOnInterval), Phase 2 adds Supabase Realtime for instant updates</constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>GET /api/dashboard/overview</name>
      <kind>REST endpoint</kind>
      <signature>GET /api/dashboard/overview â†’ Response: { modules: Array&lt;{ name: string; icon: string; stats: string[]; primaryAction: { label: string; href: string }; detailsLink: string }&gt; } (200), Error (401/500)</signature>
      <path>app/api/dashboard/overview/route.ts</path>
    </interface>
    <interface>
      <name>GET /api/dashboard/activity</name>
      <kind>REST endpoint</kind>
      <signature>GET /api/dashboard/activity â†’ Response: Array&lt;{ id: string; type: string; description: string; user: string; createdAt: string; entityLink: string }&gt; (200), Error (401/500)</signature>
      <path>app/api/dashboard/activity/route.ts</path>
    </interface>
    <interface>
      <name>GET /api/dashboard/search</name>
      <kind>REST endpoint</kind>
      <signature>GET /api/dashboard/search?q={query} â†’ Response: { workOrders: Array&lt;WO&gt;; purchaseOrders: Array&lt;PO&gt;; licensePlates: Array&lt;LP&gt;; products: Array&lt;Product&gt; } (200), Error (400/401/500)</signature>
      <path>app/api/dashboard/search/route.ts</path>
    </interface>
    <interface>
      <name>PUT /api/dashboard/preferences</name>
      <kind>REST endpoint</kind>
      <signature>PUT /api/dashboard/preferences, Body: { dashboard_config: { module_order?: string[]; pinned_modules?: string[]; show_activity_feed?: boolean } } â†’ Response: UserPreferences (200), ValidationError (400), Error (401/500)</signature>
      <path>app/api/dashboard/preferences/route.ts</path>
    </interface>
    <interface>
      <name>logActivity</name>
      <kind>function</kind>
      <signature>async function logActivity(userId: string, type: ActivityType, entityType: EntityType, entityId: string, entityCode: string, description: string, metadata?: Record&lt;string, unknown&gt;): Promise&lt;void&gt; - Inserts row into activity_logs table</signature>
      <path>lib/activity/log-activity.ts</path>
    </interface>
    <interface>
      <name>getModuleStats</name>
      <kind>function</kind>
      <signature>async function getModuleStats(orgId: string, enabledModules: string[]): Promise&lt;ModuleStat[]&gt; - Queries each module's table for counts (active WOs, pending POs, stock alerts, etc.), filters by enabled modules, returns array of stats</signature>
      <path>lib/dashboard/get-module-stats.ts</path>
    </interface>
    <interface>
      <name>DashboardLayout</name>
      <kind>React component</kind>
      <signature>DashboardLayout: FC&lt;{ children: ReactNode }&gt; - Main layout wrapper with TopNav, Sidebar, content area, footer (optional)</signature>
      <path>components/dashboard/DashboardLayout.tsx</path>
    </interface>
    <interface>
      <name>ModuleCard</name>
      <kind>React component</kind>
      <signature>ModuleCard: FC&lt;{ name: string; icon: string; stats: string[]; primaryAction: { label: string; href: string }; detailsLink: string }&gt; - Module overview card with hover effect, color-coded icon, stats, action button</signature>
      <path>components/dashboard/ModuleCard.tsx</path>
    </interface>
    <interface>
      <name>ActivityFeed</name>
      <kind>React component</kind>
      <signature>ActivityFeed: FC - Fetches activities from /api/dashboard/activity, displays list with icons, descriptions, relative time (date-fns), click navigation, optional Supabase Realtime subscription</signature>
      <path>components/dashboard/ActivityFeed.tsx</path>
    </interface>
    <interface>
      <name>QuickActions</name>
      <kind>React component</kind>
      <signature>QuickActions: FC - Toolbar with Create dropdown (filtered by enabled modules), global search bar (debounced 300ms, calls /api/dashboard/search), notifications bell icon</signature>
      <path>components/dashboard/QuickActions.tsx</path>
    </interface>
    <interface>
      <name>WelcomeBanner</name>
      <kind>React component</kind>
      <signature>WelcomeBanner: FC - Shows welcome message if setup_completed=false, Start Setup Wizard button (launches Story 1.12), Skip button (sets setup_completed=true)</signature>
      <path>components/dashboard/WelcomeBanner.tsx</path>
    </interface>
    <interface>
      <name>TopNav</name>
      <kind>React component</kind>
      <signature>TopNav: FC - Top navigation bar with MonoPilot logo (links to /dashboard), module links (Settings, Planning, Production, etc.), UserMenu (from Story 1.0)</signature>
      <path>components/navigation/TopNav.tsx</path>
    </interface>
    <interface>
      <name>Sidebar</name>
      <kind>React component</kind>
      <signature>Sidebar: FC - Collapsible sidebar with module icons, tooltips, collapse/expand toggle, active state highlighting (border-l-4 border-blue-600)</signature>
      <path>components/navigation/Sidebar.tsx</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
      Testing strategy follows Test Pyramid: unit tests for dashboard components (95% coverage, ModuleCard/ActivityFeed/QuickActions rendering and props, Vitest), integration tests for API endpoints (70% coverage, GET overview/activity/search with mocked database, Vitest + Supabase Test Client), E2E tests for complete dashboard flows (100% user journeys, Playwright). All tests in __tests__ directories colocated with source. Test files: ComponentName.spec.tsx (unit), api-route.test.ts (integration), dashboard-flow.e2e.ts (E2E). Fixtures in __fixtures__. Mock SWR hooks and Supabase in unit tests.
    </standards>
    <locations>
      <location>app/api/dashboard/__tests__/overview.test.ts (Dashboard overview API integration tests)</location>
      <location>app/api/dashboard/__tests__/activity.test.ts (Activity feed API integration tests)</location>
      <location>app/api/dashboard/__tests__/search.test.ts (Global search API integration tests)</location>
      <location>lib/activity/__tests__/log-activity.spec.ts (Activity logging utility unit tests)</location>
      <location>lib/dashboard/__tests__/get-module-stats.spec.ts (Module stats calculation unit tests)</location>
      <location>components/dashboard/__tests__/ModuleCard.spec.tsx (ModuleCard component unit tests)</location>
      <location>components/dashboard/__tests__/ActivityFeed.spec.tsx (ActivityFeed component unit tests)</location>
      <location>components/dashboard/__tests__/QuickActions.spec.tsx (QuickActions component unit tests)</location>
      <location>e2e/dashboard/main-dashboard.e2e.ts (Complete dashboard flow E2E tests)</location>
      <location>e2e/dashboard/quick-actions.e2e.ts (Quick actions and search E2E tests)</location>
    </locations>
    <ideas>
      <idea ac="AC-012.2">Unit test: ModuleCard renders with correct props (name, icon, stats array, primary action button, details link), hover effect applied (shadow-sm hover:shadow-md)</idea>
      <idea ac="AC-012.3">Unit test: ActivityFeed displays activities with correct format (icon, description, relative time using date-fns formatDistanceToNow), handles click navigation</idea>
      <idea ac="AC-012.4">Unit test: QuickActions Create dropdown filters items by enabled modules (if Planning disabled, no "Create PO"), search bar debounces input 300ms before API call</idea>
      <idea ac="AC-012.1">Integration test: GET /api/dashboard/overview returns module stats for enabled modules only, excludes disabled modules, caches results (verify Redis TTL)</idea>
      <idea ac="AC-012.3">Integration test: GET /api/dashboard/activity returns last 10 activities filtered by org_id, includes user name via JOIN, ordered by created_at DESC</idea>
      <idea ac="AC-012.4">Integration test: GET /api/dashboard/search?q=WO-001 searches work_orders table with ILIKE, returns grouped results (workOrders, purchaseOrders, etc.), limits 20 total</idea>
      <idea ac="AC-012.3">Integration test: logActivity() inserts row into activity_logs table with correct fields (org_id, user_id, type, entity_type, entity_id, description), RLS policy enforced</idea>
      <idea ac="AC-012.1">E2E test: Login â†’ land on /dashboard, see module cards grid (Settings, Planning, Production), sidebar with module icons, activity feed on right</idea>
      <idea ac="AC-012.2">E2E test: Click "Create WO" button on Production module card â†’ navigate to /production/work-orders/new</idea>
      <idea ac="AC-012.4">E2E test: Enter "WO-2024-001" in global search bar â†’ dropdown shows results â†’ click result â†’ navigate to work order detail page</idea>
      <idea ac="AC-012.3">E2E test: View activity feed, click activity "PO-2024-042 approved" â†’ navigate to purchase order detail page</idea>
      <idea ac="AC-012.6">E2E test: New user (setup_completed=false) logs in â†’ see welcome banner with "Start Setup Wizard" button â†’ click button â†’ wizard launches (Story 1.12)</idea>
      <idea ac="AC-012.6">E2E test: Admin user with no modules enabled â†’ see empty state "Enable modules in Settings" with CTA â†’ click CTA â†’ navigate to /settings/modules</idea>
      <idea ac="AC-012.1">E2E test: Responsive design - desktop view shows sidebar + cards + activity feed, mobile view shows bottom nav + single column cards, activity feed below</idea>
    </ideas>
  </tests>
</story-context>
