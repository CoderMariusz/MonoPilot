<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1.5</epicId>
    <storyId>1</storyId>
    <title>WO Kanban Board Variant B</title>
    <status>drafted</status>
    <generatedAt>2025-11-16</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/1-5-1-wo-kanban-board-variant-b.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>Production Supervisor / Shift Manager</asA>
    <iWant>Real-time Kanban dashboard with 10 KPIs and drag-drop WO status changes</iWant>
    <soThat>morning production review takes 5 minutes instead of 30 minutes (83% faster)</soThat>
    <tasks>11 tasks: Kanban board component, 4 columns (Planned/In Progress/QC/Completed), drag-drop status, 10 KPI widgets (OEE, throughput, quality rate, downtime, etc.), WO Details Modal (6 tabs), WebSocket real-time, filters, E2E tests, performance, documentation. Total: 68h (~8-9 days)</tasks>
  </story>

  <acceptanceCriteria>9 ACs covering: (1) 4-column Kanban (Planned/In Progress/QC/Completed), (2) Drag-drop status change with validation, (3) 10 KPI widgets (OEE, throughput, quality rate, downtime, schedule adherence, material availability, yield %, scrap %, line utilization, completion rate), (4) WO Details Modal (6 tabs: Overview, Materials, Operations, Output, QA, History), (5) Real-time updates via WebSocket, (6) Filters (line, shift, date range, status), (7) Mobile responsive, (8) Performance (&lt;500ms render for 50 WOs), (9) Documentation</acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/ux-design-production-module.md" title="Production Module UX" section="Variant B: Real-Time Production Board">
        Kanban dashboard with 10 KPIs. Features: Drag-drop WO status, real-time updates, WO detail modal. Time savings: 83% (5min vs 30min morning review). ROI: Real-time visibility eliminates manual status checks.
      </doc>
      <doc path="docs/architecture.md" title="Architecture" section="Real-Time Updates">
        Decision #15: Supabase Realtime (WebSocket) for critical tables (WO status, LP availability, QA alerts). Better than 30s polling.
      </doc>
    </docs>
    <code>
      <artifact path="apps/frontend/lib/api/workOrders.ts" kind="API Class" symbol="WorkOrdersAPI.update()">
        Update WO status via drag-drop
      </artifact>
    </code>
    <dependencies>
      <framework>React DnD or dnd-kit for drag-drop</framework>
      <framework>Supabase Realtime for WebSocket</framework>
      <framework>Recharts for KPI visualizations</framework>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint type="performance">Render &lt;500ms for 50 WOs. Use virtualization if needed</constraint>
    <constraint type="real-time">WebSocket subscription on work_orders table for status changes</constraint>
    <constraint type="validation">Validate status transitions (e.g., cannot move from Planned directly to Completed)</constraint>
    <constraint type="ux">Show loading state during drag. Revert on error. Show toast on success</constraint>
  </constraints>

  <interfaces>
    <interface name="KanbanBoard component" kind="React Component">
      <signature>&lt;KanbanBoard filters={{line, shift, dateRange}} onWOStatusChange={handleChange} /&gt;</signature>
    </interface>
    <interface name="OEE calculation" kind="Business Logic">
      <signature>OEE = Availability × Performance × Quality (result: 0-100%)</signature>
    </interface>
  </interfaces>

  <tests>
    <standards>E2E required for: Drag-drop status change, WebSocket real-time updates, KPI calculations, modal interactions</standards>
    <locations>
      <e2e>apps/frontend/e2e/kanban-board.spec.ts</e2e>
    </locations>
    <ideas>
      <test ac="AC-2" risk="HIGH">E2E: Drag WO from Planned → In Progress → status updated + real-time</test>
      <test ac="AC-3" risk="MEDIUM">E2E: OEE widget shows correct calculation based on shift data</test>
      <test ac="AC-4" risk="COMPLEX">E2E: Click WO card → detail modal opens with 6 tabs</test>
      <test ac="AC-5" risk="HIGH">E2E: Another user updates WO → board updates in real-time via WebSocket</test>
    </ideas>
  </tests>
</story-context>
