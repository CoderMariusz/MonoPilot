<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1.5</epicId>
    <storyId>2</storyId>
    <title>Production Templates Variant C</title>
    <status>drafted</status>
    <generatedAt>2025-11-16</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/1-5-2-production-templates-variant-c.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>Production Planner</asA>
    <iWant>Save and reuse WO configurations as templates (product + BOM + line + shift + notes)</iWant>
    <soThat>repeat WO creation is 60% faster (2min vs 5min) and eliminates configuration errors</soThat>
    <tasks>7 tasks: Templates table, save template modal, template library UI, apply template logic, default templates (popular products), usage analytics, E2E tests, documentation. Total: 20h (~2-3 days)</tasks>
  </story>

  <acceptanceCriteria>6 ACs covering: (1) Save template from existing WO, (2) Template library UI (grid view with cards), (3) Apply template (one-click WO creation), (4) Default templates (most used products auto-suggested), (5) Template analytics (usage count, last used), (6) Documentation</acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/ux-design-production-module.md" title="Production Module UX" section="Variant C: Production Templates">
        Save/reuse WO templates. Features: Template library, one-click apply, default templates. Time savings: 60% (2min vs 5min for repeat WOs). ROI: Reduces configuration errors.
      </doc>
    </docs>
    <code>
      <artifact path="apps/frontend/lib/api/workOrders.ts" kind="API Class">
        Extend with createFromTemplate(template_id) method
      </artifact>
    </code>
    <dependencies>
      <framework>PostgreSQL JSONB for template storage</framework>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint type="storage">Store template as JSONB: {product_id, bom_id, line_id, shift, notes, operations}</constraint>
    <constraint type="defaults">Auto-suggest templates for products with &gt;10 WO creations</constraint>
    <constraint type="org-isolation">Templates are org-specific (RLS on wo_templates table)</constraint>
  </constraints>

  <interfaces>
    <interface name="wo_templates table" kind="Database Table">
      <signature>Columns: id, org_id, name, description, template_data (JSONB), usage_count, last_used, created_by</signature>
    </interface>
    <interface name="WorkOrdersAPI.createFromTemplate()" kind="Method">
      <signature>static async createFromTemplate(templateId: number, overrides?: Partial&lt;WOInput&gt;): Promise&lt;WorkOrder&gt;</signature>
    </interface>
  </interfaces>

  <tests>
    <standards>E2E required for: Save template, apply template, default template suggestion</standards>
    <locations>
      <e2e>apps/frontend/e2e/production-templates.spec.ts</e2e>
    </locations>
    <ideas>
      <test ac="AC-1" risk="MEDIUM">E2E: Create WO → Save as template → verify template in library</test>
      <test ac="AC-3" risk="HIGH">E2E: Apply template → WO created with pre-filled data</test>
      <test ac="AC-4" risk="MEDIUM">E2E: Product with &gt;10 WOs → template auto-suggested on WO creation</test>
    </ideas>
  </tests>
</story-context>
