# Story 3.15: Configurable WO Statuses

**ID:** 3.15
**Batch:** 03C-2
**Story Points:** 3
**Effort:** 3-4 hours
**Status:** Todo

## User Story

> As an **Admin**,
> I want to configure WO status lifecycle,
> So that it matches our process.

## Acceptance Criteria

### AC 1: Status Configuration UI

**Given** Admin navigates to /settings/planning
**When** viewing WO Statuses section
**Then** can add/remove/rename statuses
**And** set status order (sequence)
**And** set default status for new WOs

### AC 2: Default Statuses

**Default statuses preloaded:**
- Draft (default)
- Planned
- Released
- In Progress
- Completed
- Closed
- Cancelled

### AC 3: Optional Statuses

**Optional statuses (can add):**
- On Hold
- Quality Hold
- Rework

### AC 4: Status Expiry

**And** can set status expiry (auto-close after X days)
**Then** WOs auto-transition after expiry period

### AC 5: Delete Protection

**Cannot** remove status if WOs exist with that status
**Then** shows error with count of affected WOs

## Technical Tasks

### Backend
- [ ] Store in `planning_settings.wo_statuses` (JSONB array)
- [ ] Store expiry in `planning_settings.wo_status_expiry_days`
- [ ] Validate: At least one default status
- [ ] Validate: Cannot delete status with existing WOs
- [ ] API: GET/PUT /api/planning/settings (WO section)

### Frontend
- [ ] Status configuration section in Planning Settings
- [ ] Drag-drop reorder for sequence
- [ ] Color picker per status
- [ ] Default status toggle (only one)
- [ ] Expiry days input

### Database

```sql
-- In planning_settings table
wo_statuses JSONB DEFAULT '[
  {"code": "draft", "label": "Draft", "color": "gray", "is_default": true, "sequence": 1},
  {"code": "planned", "label": "Planned", "color": "blue", "is_default": false, "sequence": 2},
  {"code": "released", "label": "Released", "color": "indigo", "is_default": false, "sequence": 3},
  {"code": "in_progress", "label": "In Progress", "color": "yellow", "is_default": false, "sequence": 4},
  {"code": "completed", "label": "Completed", "color": "green", "is_default": false, "sequence": 5},
  {"code": "closed", "label": "Closed", "color": "purple", "is_default": false, "sequence": 6},
  {"code": "cancelled", "label": "Cancelled", "color": "red", "is_default": false, "sequence": 7}
]',
wo_status_expiry_days INTEGER DEFAULT NULL,
wo_default_status VARCHAR(50) DEFAULT 'draft'
```

## Testing

### Unit Tests
- [ ] Status validation (unique codes)
- [ ] Default status enforcement (exactly one)
- [ ] Delete protection logic

### Integration Tests
- [ ] Settings saved correctly
- [ ] Default status applied to new WO
- [ ] Cannot delete in-use status

### E2E Tests
- [ ] Add custom status
- [ ] Reorder statuses
- [ ] Set expiry days
- [ ] Attempt delete with WOs â†’ error shown

## Dependencies

- **Requires:** Epic 1 (Settings infrastructure)
- **Blocks:** Story 3.10 (uses statuses)

## Notes

- Status expiry useful for auto-closing old WOs
- Colors should match PO status colors for consistency
- Consider status transition rules (future enhancement)
