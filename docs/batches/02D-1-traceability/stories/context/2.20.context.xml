<?xml version="1.0" encoding="UTF-8"?>
<story>
  <metadata>
    <id>2.20</id>
    <title>Recall Simulation</title>
    <batch>02D-1</batch>
    <points>5</points>
    <effort_hours>6-8</effort_hours>
    <status>pending</status>
  </metadata>

  <description>Combine forward and backward traces with summary of affected LPs, quantities, locations, and FDA-compliant exports.</description>

  <dependencies>
    <requires>
      <story id="2.18">Forward Traceability</story>
      <story id="2.19">Backward Traceability</story>
    </requires>
  </dependencies>

  <technical_context>
    <api_endpoints>
      <endpoint method="POST" path="/api/technical/tracing/recall">
        <body>lp_id?, batch_number?, include_shipped?</body>
        <response>
          forward_trace, backward_trace,
          summary: { total_affected_lps, total_quantity, total_value, locations, shipped_qty, customers_affected },
          export_formats: { pdf_url, fda_json_url, fda_xml_url }
        </response>
      </endpoint>
      <endpoint method="GET" path="/api/technical/tracing/recall/:id/export">
        <query>format=pdf|fda_json|fda_xml</query>
        <response>File download</response>
      </endpoint>
    </api_endpoints>

    <export_formats>
      <format name="PDF">Human-readable report</format>
      <format name="FDA JSON">FSMA-compliant JSON</format>
      <format name="FDA XML">Alternative XML format</format>
    </export_formats>
  </technical_context>

  <acceptance_criteria>
    <ac id="2.20.1">Enter Batch/LP ID and run simulation</ac>
    <ac id="2.20.2">Performs both forward and backward trace</ac>
    <ac id="2.20.3">Summary shows affected LPs, qty, locations, shipped, cost</ac>
    <ac id="2.20.4">Export to PDF, FDA JSON, FDA XML</ac>
    <ac id="2.20.5">Performance &lt; 30 seconds</ac>
  </acceptance_criteria>
</story>
