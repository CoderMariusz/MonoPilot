<?xml version="1.0" encoding="UTF-8"?>
<story>
  <metadata>
    <id>6.9</id>
    <title>Hold Investigation Tracking</title>
    <batch>06A-2</batch>
    <status>drafted</status>
  </metadata>

  <description>Track investigation and resolution for quality holds</description>

  <dependencies>
    <requires>
      <story id="6.6">Quality Hold Creation</story>
    </requires>
  </dependencies>

  <technical_context>
    <tables>
      <table>
        <name>hold_investigation_notes</name>
        <columns>
          <column>id uuid PRIMARY KEY</column>
          <column>hold_id uuid NOT NULL REFERENCES quality_holds(id) ON DELETE CASCADE</column>
          <column>note_type text NOT NULL</column>
          <column>content text NOT NULL</column>
          <column>attachments jsonb</column>
          <column>created_by uuid NOT NULL REFERENCES profiles(id)</column>
          <column>created_at timestamptz DEFAULT now()</column>
        </columns>
      </table>
    </tables>

    <api_endpoints>
      <endpoint method="POST" path="/api/quality/holds/:id/notes">
        <description>Add investigation note</description>
        <request>{ note_type, content, attachments? }</request>
      </endpoint>
    </api_endpoints>

    <components_to_create>
      <component>HoldDetailView - shows investigation fields and timeline</component>
      <component>InvestigationTimeline - chronological list of updates</component>
    </components_to_create>
  </technical_context>

  <acceptance_criteria>
    <ac id="1">Hold detail shows investigation fields: root_cause, corrective_action, preventive_action</ac>
    <ac id="2">investigation_by, attachments visible</ac>
    <ac id="3">Timeline shows all updates</ac>
  </acceptance_criteria>

  <functional_requirements>
    <fr id="QC-FR-10">System shall track hold investigation and resolution</fr>
  </functional_requirements>
</story>
