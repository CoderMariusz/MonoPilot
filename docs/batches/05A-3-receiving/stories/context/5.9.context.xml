<?xml version="1.0" encoding="UTF-8"?>
<story>
  <metadata><id>5.9</id><title>ASN Item Management</title><batch>5A-3</batch><points>3</points><effort_hours>3-4</effort_hours><status>todo</status></metadata>
  <description>Edit ASN items: batch numbers, manufacture/expiry dates, quantities for partial shipments</description>
  <dependencies><requires><story id="5.8">ASN Creation</story></requires><enables><story id="5.11">GRN Creation</story></enables></dependencies>
  <technical_context>
    <api_endpoints>
      <endpoint method="PUT" path="/api/warehouse/asns/:id/items">
        <request>asn_items array with updates (supplier_batch_number, manufacture_date, expiry_date, quantity)</request>
        <response>Updated ASN with items</response>
      </endpoint>
    </api_endpoints>
    <validation_rules>
      <rule>quantity > 0</rule>
      <rule>if manufacture_date AND expiry_date: manufacture_date < expiry_date</rule>
      <rule>fields required per product type (perishables need expiry)</rule>
    </validation_rules>
  </technical_context>
  <acceptance_criteria>
    <ac id="1">ASN items editable inline (batch, dates, qty)</ac>
    <ac id="2">Batch and expiry dates stored from supplier</ac>
    <ac id="3">Quantity adjustable for partial shipments</ac>
    <ac id="4">Pre-fill from supplier metadata if available</ac>
    <ac id="5">Validation: manufacture < expiry date</ac>
  </acceptance_criteria>
  <test_plan>
    <unit_tests>Date validation, qty validation</unit_tests>
    <integration_tests>PUT /api/warehouse/asns/:id/items with updates</integration_tests>
    <e2e_tests>Open ASN, edit item details, save, verify persisted</e2e_tests>
  </test_plan>
</story>
