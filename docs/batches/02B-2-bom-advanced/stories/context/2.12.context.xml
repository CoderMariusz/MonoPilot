<?xml version="1.0" encoding="UTF-8"?>
<story>
  <metadata>
    <id>2.12</id>
    <title>Conditional BOM Items</title>
    <batch>02B-2</batch>
    <points>3</points>
    <effort_hours>4-5</effort_hours>
    <status>pending</status>
  </metadata>

  <description>Flag-based conditions for BOM items (organic, vegan, kosher, etc.) with AND/OR logic.</description>

  <dependencies>
    <requires>
      <story id="2.7">BOM Items</story>
      <story id="2.22">Technical Settings (conditional_flags_enabled)</story>
    </requires>
  </dependencies>

  <technical_context>
    <bom_item_fields>
      <field name="condition_flags" type="TEXT[]">Array of flag codes</field>
      <field name="condition_logic" type="TEXT">AND | OR</field>
    </bom_item_fields>

    <default_flags>
      organic, gluten_free, vegan, kosher, halal, dairy_free, nut_free, soy_free
    </default_flags>

    <settings_dependency>
      Only show conditions if technical_settings.use_conditional_flags = true
    </settings_dependency>
  </technical_context>

  <acceptance_criteria>
    <ac id="2.12.1">Condition fields shown only if use_conditional_flags enabled</ac>
    <ac id="2.12.2">Multi-select for condition_flags</ac>
    <ac id="2.12.3">Logic selector: AND | OR</ac>
    <ac id="2.12.4">Flag badges displayed in items table</ac>
  </acceptance_criteria>
</story>
