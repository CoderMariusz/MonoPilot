<?xml version="1.0" encoding="UTF-8"?>
<story-context>
  <story-header>
    <id>04-8</id>
    <title>Material Reservation (Scanner)</title>
    <epic>4 - Production Execution</epic>
    <status>drafted</status>
    <priority>P0</priority>
    <story-points>2</story-points>
    <effort>1 day</effort>
  </story-header>

  <story-content>
    <user-story>
      As an Operator
      I want to reserve materials via scanner
      So that I can allocate them efficiently on the floor (actual consumption happens when output is registered)
    </user-story>

    <acceptance-criteria>
      <criterion id="AC-4.8.1">
        <title>Scanner Workflow</title>
        <given>user navigates to /scanner/reserve</given>
        <when>scanning WO barcode</when>
        <then>system shows materials that need to be reserved for production</then>
      </criterion>

      <criterion id="AC-4.8.2">
        <title>LP Barcode Scanning</title>
        <when>scanning LP barcode</when>
        <then>system validates: LP exists, product matches, UoM matches, qty available for reservation</then>
      </criterion>

      <criterion id="AC-4.8.3">
        <title>Quantity Entry (Story 4.9 Integration)</title>
        <when>entering qty (or "Full LP" button if consume_whole_lp=true)</when>
        <conditions>
          - If consume_whole_lp=false: qty input enabled, operator enters qty
          - If consume_whole_lp=true: qty field disabled, shows full LP qty, only "Reserve Full LP" button
        </conditions>
        <then>reservation confirmed, moves to next material</then>
      </criterion>

      <criterion id="AC-4.8.4">
        <title>Touch Optimization</title>
        <then>Large buttons (>44px), no keyboard if possible, voice feedback optional</then>
      </criterion>

      <criterion id="AC-4.8.5">
        <title>Offline Support</title>
        <then>Queue operations in offline queue if network unavailable (Story 5.36)</then>
      </criterion>

      <criterion id="AC-4.8.6">
        <title>Same API as Desktop</title>
        <then>Uses same POST /api/production/work-orders/:id/materials/reserve endpoint (Story 4.7)</then>
      </criterion>

      <criterion id="AC-4.8.7">
        <title>Material Complete Indicator</title>
        <when>all materials reserved</when>
        <then>Green checkmark, option to proceed to production floor</then>
      </criterion>

      <criterion id="AC-4.8.8">
        <title>Error Handling</title>
        <then>Invalid LP, insufficient qty, wrong product show large red error messages</then>
      </criterion>
    </acceptance-criteria>

    <dependencies>
      <story-dependency>
        <story-id>4.7</story-id>
        <title>Material Reservation (Desktop)</title>
        <reason>Shares same API endpoint POST /api/production/work-orders/:id/materials/reserve</reason>
      </story-dependency>
      <story-dependency>
        <story-id>4.9</story-id>
        <title>consume_whole_lp Flag</title>
        <reason>Conditional qty input based on consume_whole_lp value</reason>
      </story-dependency>
      <story-dependency>
        <story-id>5.36</story-id>
        <title>Offline Queue</title>
        <reason>Scanner must support offline mode for floor operations</reason>
      </story-dependency>
    </dependencies>
  </story-content>

  <ux-design>
    <scanner-module>
      <source>docs/ux-design/ux-design-scanner-module-OLD.md</source>
      <note>Scanner module UX design exists but marked as OLD - principles still applicable</note>

      <scanner-hub>
        <location>/scanner/page.tsx</location>
        <workflows>
          <workflow>
            <name>Receive</name>
            <route>/scanner/receive</route>
            <description>ASN receiving, GRN creation, LP creation</description>
          </workflow>
          <workflow>
            <name>Process</name>
            <route>/scanner/process</route>
            <description>WO execution, material consumption, staging</description>
          </workflow>
          <workflow>
            <name>Pack</name>
            <route>/scanner/pack</route>
            <description>Finish goods creation</description>
          </workflow>
          <workflow>
            <name>Pallet</name>
            <route>/scanner/pallet</route>
            <description>Pallet management, shipping</description>
          </workflow>
        </workflows>
        <note>Story 4.8 adds NEW workflow: Reserve (/scanner/reserve)</note>
      </scanner-hub>

      <scanner-ux-principles>
        <principle>All-in-one scanner interface - scan, confirm, next. Zero navigation between steps</principle>
        <principle>Auto-focus on scanner input after each action</principle>
        <principle>Large buttons (≥48px tap targets) for touch optimization</principle>
        <principle>Haptic feedback (50ms vibrate on success, 100ms 2 pulses on error)</principle>
        <principle>Visual feedback (green flash on success, red flash on error)</principle>
        <principle>Camera-based barcode scanning with overlay guide (ZXing library)</principle>
        <principle>Minimal typing - 100% barcode scanning workflow preferred</principle>
        <principle>Offline mode support with queue sync when online</principle>
      </scanner-ux-principles>

      <barcode-scanning>
        <technology>Browser Camera API + ZXing barcode library</technology>
        <overlay-guide>White box with corners for barcode alignment</overlay-guide>
        <feedback>
          <success>Haptic buzz (50ms), green flash, auto-match to expected item</success>
          <error>Red flash, haptic vibrate (100ms 2 pulses), toast error message</error>
          <low-confidence>Popup "Could not read barcode. Retry or enter manually?" with [Retry] [Manual Entry] buttons</low-confidence>
        </feedback>
        <auto-refocus>Camera refocuses immediately after successful scan for next item</auto-refocus>
      </barcode-scanning>

      <error-patterns>
        <error type="wrong-barcode">
          <trigger>Scanned product not in expected list</trigger>
          <feedback>Red flash overlay + haptic vibrate (100ms, 2 pulses) + toast "❌ Item not found"</feedback>
          <action>Camera refocuses for retry</action>
        </error>
        <error type="low-confidence">
          <trigger>Barcode blurry or damaged</trigger>
          <feedback>Popup with [Retry] and [Manual Entry] options</feedback>
        </error>
        <error type="network-offline">
          <trigger>Network unavailable during operation</trigger>
          <feedback>Queue operation locally, show "Queued for sync" toast</feedback>
        </error>
      </error-patterns>
    </scanner-module>

    <mobile-optimization>
      <source>docs/ux-design/ux-design-shared-system.md</source>
      <breakpoints>
        <mobile>&lt;640px - Single column layout, full-width buttons</mobile>
        <tablet>640-768px - 2 column layout where applicable</tablet>
        <desktop>768px+ - Full desktop layout (fallback for scanner stations)</desktop>
      </breakpoints>
      <touch-targets>
        <minimum-size>48px × 48px</minimum-size>
        <spacing>8px minimum between targets</spacing>
        <no-hover>Avoid hover-only content (not available on touch devices)</no-hover>
      </touch-targets>
      <typography>
        <large-text>Ensure readability on handheld devices (16px minimum body text)</large-text>
        <labels>14px for labels, 12px for hints</labels>
        <values>18px for important values (quantities, LP numbers)</values>
      </typography>
    </mobile-optimization>
  </ux-design>

  <database-schema>
    <table name="work_orders">
      <description>Work Orders - stores production orders</description>
      <columns>
        <column>id UUID PRIMARY KEY</column>
        <column>org_id UUID FK → organizations</column>
        <column>wo_number VARCHAR UNIQUE (e.g., WO-2024-001)</column>
        <column>product_id UUID FK → products</column>
        <column>planned_quantity NUMERIC > 0</column>
        <column>produced_quantity NUMERIC >= 0 DEFAULT 0</column>
        <column>uom VARCHAR (unit of measure)</column>
        <column>status VARCHAR (draft, released, in_progress, completed, closed, cancelled)</column>
        <column>planned_start_date DATE</column>
        <column>planned_end_date DATE</column>
        <column>actual_start_date DATE</column>
        <column>actual_end_date DATE</column>
        <column>production_line_id UUID FK → machines</column>
        <column>routing_id UUID FK → routings</column>
        <column>created_by UUID FK → users</column>
        <column>created_at TIMESTAMPTZ DEFAULT now()</column>
        <column>updated_at TIMESTAMPTZ DEFAULT now()</column>
      </columns>
      <constraints>
        <check>planned_quantity > 0</check>
        <check>produced_quantity >= 0</check>
        <check>status IN ('draft', 'released', 'in_progress', 'completed', 'closed', 'cancelled')</check>
        <unique>(org_id, wo_number)</unique>
      </constraints>
      <rls>Enabled</rls>
    </table>

    <table name="license_plates">
      <description>License Plates (LP) - physical inventory units</description>
      <columns>
        <column>id UUID PRIMARY KEY</column>
        <column>org_id UUID FK → organizations</column>
        <column>lp_number VARCHAR UNIQUE (e.g., LP-2024-001)</column>
        <column>batch_number VARCHAR (for traceability)</column>
        <column>product_id UUID FK → products</column>
        <column>quantity NUMERIC > 0</column>
        <column>uom VARCHAR (unit of measure)</column>
        <column>status VARCHAR (available, reserved, consumed, shipped, quarantine, recalled) DEFAULT 'available'</column>
        <column>location_id UUID FK → locations</column>
        <column>manufacturing_date DATE</column>
        <column>expiry_date DATE</column>
        <column>received_date DATE</column>
        <column>created_by UUID FK → users</column>
        <column>created_at TIMESTAMPTZ DEFAULT now()</column>
        <column>updated_at TIMESTAMPTZ DEFAULT now()</column>
      </columns>
      <constraints>
        <check>quantity > 0</check>
        <check>status IN ('available', 'reserved', 'consumed', 'shipped', 'quarantine', 'recalled')</check>
        <unique>lp_number (global)</unique>
      </constraints>
      <rls>Enabled</rls>
      <note>Status changes to 'reserved' when reserved for WO (Story 4.7)</note>
    </table>

    <table name="wo_material_reservations">
      <description>Material reservations for work orders - TO BE CREATED in Story 4.7</description>
      <note>Table does not exist yet in database schema - will be created in Story 4.7 (desktop reservation)</note>
      <expected-columns>
        <column>id UUID PRIMARY KEY</column>
        <column>org_id UUID FK → organizations</column>
        <column>wo_id UUID FK → work_orders</column>
        <column>material_id UUID FK → bom_items (or products)</column>
        <column>lp_id UUID FK → license_plates</column>
        <column>reserved_qty NUMERIC > 0</column>
        <column>sequence_number INTEGER (order of consumption: 1, 2, 3...)</column>
        <column>status VARCHAR (reserved, consumed, cancelled)</column>
        <column>notes TEXT</column>
        <column>created_by UUID FK → users</column>
        <column>created_at TIMESTAMPTZ DEFAULT now()</column>
        <column>updated_at TIMESTAMPTZ DEFAULT now()</column>
      </expected-columns>
      <reference>Story 4.7 AC-4.7.3 defines reservation recording logic</reference>
    </table>

    <table name="lp_genealogy">
      <description>LP genealogy for traceability (Story 2.18-2.21, integration in 4.19)</description>
      <columns>
        <column>id UUID PRIMARY KEY</column>
        <column>parent_lp_id UUID FK → license_plates (source LP)</column>
        <column>child_lp_id UUID FK → license_plates (output LP) - NULL until output registration</column>
        <column>work_order_id UUID FK → work_orders</column>
        <column>transfer_order_id UUID FK → transfer_orders</column>
        <column>relationship_type VARCHAR (consumption, production, split, merge)</column>
        <column>quantity_consumed NUMERIC (calculated during output registration)</column>
        <column>created_by UUID FK → users</column>
        <column>created_at TIMESTAMPTZ DEFAULT now()</column>
      </columns>
      <constraints>
        <check>relationship_type IN ('consumption', 'production', 'split', 'merge')</check>
      </constraints>
      <rls>Enabled</rls>
      <note>Entry created with parent_lp_id during reservation, child_lp_id filled during output registration (Story 4.12)</note>
    </table>
  </database-schema>

  <api-patterns>
    <endpoint>
      <method>POST</method>
      <path>/api/production/work-orders/:id/materials/reserve</path>
      <description>Reserve material LP for work order (Story 4.7 - shared with Story 4.8)</description>
      <request-body>
        <field name="lp_id" type="UUID" required="true">License plate ID to reserve</field>
        <field name="material_id" type="UUID" required="true">Material/BOM item ID</field>
        <field name="reserved_qty" type="number" required="true">Quantity to reserve from LP</field>
        <field name="notes" type="string" required="false">Optional notes</field>
      </request-body>
      <response-success status="200">
        <field name="reservation">Created wo_material_reservations record</field>
        <field name="lp_status">Updated license_plates.status = 'reserved'</field>
        <field name="genealogy">Created lp_genealogy record with parent_lp_id, child_lp_id=NULL</field>
        <field name="message">Confirmation message</field>
      </response-success>
      <response-errors>
        <error status="400" code="INSUFFICIENT_QTY">LP has Xkg, requested Ykg for reservation</error>
        <error status="400" code="ALREADY_RESERVED">LP already reserved for this WO</error>
        <error status="400" code="WO_NOT_IN_PROGRESS">WO not in progress</error>
        <error status="400" code="CONSUME_WHOLE_LP_VIOLATION">Material must use entire LP. Cannot reserve partial. (Story 4.9)</error>
        <error status="404" code="NOT_FOUND">WO, LP, or material not found</error>
        <error status="401" code="UNAUTHORIZED">User not authenticated</error>
        <error status="500" code="INTERNAL_ERROR">Database or server error</error>
      </response-errors>
      <validation>
        <rule>LP exists and belongs to org</rule>
        <rule>WO exists and status = 'in_progress'</rule>
        <rule>Product matches between LP and material</rule>
        <rule>UoM matches between LP and material</rule>
        <rule>reserved_qty &lt;= LP.quantity (available)</rule>
        <rule>If consume_whole_lp=true (Story 4.9): reserved_qty MUST equal LP.quantity</rule>
        <rule>LP status = 'available' (not already reserved/consumed)</rule>
      </validation>
      <authentication>
        <required>true</required>
        <roles>Operator, Production Manager</roles>
      </authentication>
    </endpoint>

    <endpoint>
      <method>GET</method>
      <path>/api/production/work-orders/:id</path>
      <description>Get work order details including materials needed</description>
      <reference>apps/frontend/app/api/planning/work-orders/[id]/route.ts</reference>
      <response-success status="200">
        <field name="work_order">Full WO object with BOM snapshot (materials needed)</field>
      </response-success>
      <pattern-example>
        <![CDATA[
// Pattern from existing WO detail endpoint
export async function GET(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const { id } = await params
    const supabase = await createServerSupabase()

    const { data: { session }, error: authError } = await supabase.auth.getSession()
    if (authError || !session) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
    }

    const result = await getWorkOrder(id)
    if (!result.success) {
      if (result.code === 'NOT_FOUND') {
        return NextResponse.json({ error: 'Work Order not found' }, { status: 404 })
      }
      return NextResponse.json({ error: 'Failed to fetch work order' }, { status: 500 })
    }

    return NextResponse.json({ work_order: result.data }, { status: 200 })
  } catch (error) {
    console.error('Error:', error)
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })
  }
}
        ]]>
      </pattern-example>
    </endpoint>

    <service-layer-pattern>
      <description>Service layer handles business logic, route handlers call service functions</description>
      <example-service>lib/services/work-order-service.ts</example-service>
      <pattern>
        <![CDATA[
// Service function pattern
export async function reserveMaterial(
  woId: string,
  data: { lp_id: string; material_id: string; reserved_qty: number; notes?: string }
): Promise<ServiceResult<ReservationResult>> {
  try {
    const supabase = await createServerSupabase()

    // Validation logic
    // Database transaction
    // Return success/error

    return { success: true, data: result }
  } catch (error) {
    return { success: false, error: error.message, code: 'INTERNAL_ERROR' }
  }
}
        ]]>
      </pattern>
    </service-layer-pattern>
  </api-patterns>

  <testing-strategy>
    <test-framework>
      <e2e>Playwright (tests/e2e/**/*.spec.ts)</e2e>
      <unit>Vitest (not yet implemented for this story)</unit>
    </test-framework>

    <test-setup>
      <fixtures>tests/e2e/fixtures/test-setup.ts</fixtures>
      <helpers>
        <function>createTestOrganization() → orgId</function>
        <function>createTestUser(orgId) → userId, email, password, token</function>
        <function>createTestWarehouses(orgId) → warehouse IDs</function>
        <function>createTestProducts(orgId, count) → product IDs</function>
        <function>cleanupTestData(orgId) → cleanup after tests</function>
      </helpers>
      <authentication>
        <method>JWT token via Supabase auth</method>
        <pattern>
          <![CDATA[
// Set auth cookie for Playwright context
await context.addCookies([{
  name: 'sb-auth',
  value: token,
  domain: new URL(baseURL!).hostname,
  path: '/',
}])
          ]]>
        </pattern>
      </authentication>
    </test-setup>

    <test-scenarios>
      <scenario id="1">
        <title>Scanner reservation workflow - happy path</title>
        <steps>
          1. Create test WO with status 'in_progress'
          2. Create test LP with product matching WO material
          3. Navigate to /scanner/reserve
          4. Scan WO barcode → materials list displayed
          5. Scan LP barcode → validation passes
          6. Enter quantity (or tap "Reserve Full LP" if consume_whole_lp=true)
          7. Confirm reservation → success toast, moves to next material
        </steps>
        <assertions>
          - wo_material_reservations record created
          - LP status changed to 'reserved'
          - lp_genealogy record created with parent_lp_id, child_lp_id=NULL
          - Success feedback displayed (green checkmark, toast)
        </assertions>
      </scenario>

      <scenario id="2">
        <title>Scanner validation - wrong product scanned</title>
        <steps>
          1. Scan WO barcode
          2. Scan LP with different product than expected material
        </steps>
        <assertions>
          - Red flash overlay
          - Haptic vibrate (100ms, 2 pulses)
          - Error toast "Product does not match required material"
          - Camera refocuses for retry
        </assertions>
      </scenario>

      <scenario id="3">
        <title>Scanner validation - insufficient quantity</title>
        <steps>
          1. Scan WO barcode
          2. Scan LP with 10kg quantity
          3. Enter 15kg reservation quantity
        </steps>
        <assertions>
          - Error message "LP has 10kg, requested 15kg for reservation"
          - Reservation not created
          - LP status unchanged
        </assertions>
      </scenario>

      <scenario id="4">
        <title>consume_whole_lp enforcement (Story 4.9 integration)</title>
        <steps>
          1. Create material with consume_whole_lp=true
          2. Scan WO barcode
          3. Scan LP with 50kg
        </steps>
        <assertions>
          - Quantity input field disabled/read-only
          - Displays "Entire LP: 50kg"
          - Only "Reserve Full LP" button enabled
          - Attempting partial reservation shows error
        </assertions>
      </scenario>

      <scenario id="5">
        <title>Offline mode support (Story 5.36 integration)</title>
        <steps>
          1. Disconnect network
          2. Scan WO barcode
          3. Scan LP barcode
          4. Confirm reservation
        </steps>
        <assertions>
          - Operation queued locally
          - Toast "Queued for sync"
          - When network restored: operation synced to server
        </assertions>
      </scenario>

      <scenario id="6">
        <title>Material completion indicator</title>
        <steps>
          1. WO has 3 materials required
          2. Reserve all 3 materials via scanner
        </steps>
        <assertions>
          - Green checkmark displayed
          - "All materials reserved" message
          - Option to proceed to production floor enabled
        </assertions>
      </scenario>
    </test-scenarios>

    <test-config>
      <playwright-config>playwright.config.ts</playwright-config>
      <browsers>chromium, firefox, webkit (mobile viewports)</browsers>
      <timeout>60s test, 15s expect, 15s action, 30s navigation</timeout>
      <base-url>env NEXT_PUBLIC_APP_URL or http://localhost:5000</base-url>
      <retries>0 (fail fast)</retries>
      <screenshots>only-on-failure</screenshots>
      <trace>retain-on-failure</trace>
    </test-config>

    <env-requirements>
      <env-file>.env.test</env-file>
      <required-vars>
        <var>NEXT_PUBLIC_SUPABASE_URL</var>
        <var>NEXT_PUBLIC_SUPABASE_ANON_KEY</var>
        <var>SUPABASE_SERVICE_ROLE_KEY</var>
        <var>TEST_ORG_ID</var>
        <var>NEXT_PUBLIC_APP_URL</var>
        <var>BASE_URL</var>
      </required-vars>
    </env-requirements>
  </testing-strategy>

  <implementation-notes>
    <file-structure>
      <scanner-route>apps/frontend/app/scanner/reserve/page.tsx (NEW - to be created)</scanner-route>
      <components>
        <component>apps/frontend/components/scanner/ScannerLayout.tsx (shared layout)</component>
        <component>apps/frontend/components/scanner/BarcodeScanner.tsx (camera + ZXing)</component>
        <component>apps/frontend/components/scanner/MaterialReservationList.tsx (NEW)</component>
        <component>apps/frontend/components/scanner/ReservationConfirmModal.tsx (NEW)</component>
      </components>
      <api-route>apps/frontend/app/api/production/work-orders/[id]/materials/reserve/route.ts (NEW - Story 4.7)</api-route>
      <service>apps/frontend/lib/services/material-reservation-service.ts (NEW - Story 4.7)</service>
      <validation>apps/frontend/lib/validation/material-reservation-schemas.ts (NEW - Story 4.7)</validation>
    </file-structure>

    <shared-with-desktop>
      <api-endpoint>POST /api/production/work-orders/:id/materials/reserve (Story 4.7)</api-endpoint>
      <service-layer>material-reservation-service.ts (Story 4.7)</service-layer>
      <validation-schemas>material-reservation-schemas.ts (Story 4.7)</validation-schemas>
      <note>Scanner UI is different but backend logic is 100% shared</note>
    </shared-with-desktop>

    <mobile-pwa-considerations>
      <camera-permissions>Request camera permission for barcode scanning</camera-permissions>
      <vibration-api>Use navigator.vibrate() for haptic feedback</vibration-api>
      <offline-storage>IndexedDB or localStorage for offline queue (Story 5.36)</offline-storage>
      <service-worker>PWA service worker for offline capability</service-worker>
    </mobile-pwa-considerations>

    <accessibility>
      <aria-labels>All scanner actions have clear aria-labels for screen readers</aria-labels>
      <keyboard-navigation>Fallback keyboard input if camera unavailable</keyboard-navigation>
      <contrast>WCAG AA compliant (4.5:1 minimum) for error/success messages</contrast>
      <focus-management>Auto-focus management for scanner input flow</focus-management>
    </accessibility>
  </implementation-notes>

  <tasks>
    <task id="1">
      <title>Scanner UI layout (touch-optimized)</title>
      <description>Create /scanner/reserve route with large buttons, camera view, material list</description>
      <files>
        <file>apps/frontend/app/scanner/reserve/page.tsx</file>
        <file>apps/frontend/components/scanner/MaterialReservationList.tsx</file>
      </files>
    </task>

    <task id="2">
      <title>Barcode scanning integration</title>
      <description>Integrate camera + ZXing library, WO/LP barcode scanning, haptic/visual feedback</description>
      <files>
        <file>apps/frontend/components/scanner/BarcodeScanner.tsx</file>
      </files>
    </task>

    <task id="3">
      <title>Quantity input (manual or full LP)</title>
      <description>Conditional qty input based on consume_whole_lp flag (Story 4.9 integration)</description>
      <files>
        <file>apps/frontend/components/scanner/ReservationConfirmModal.tsx</file>
      </files>
    </task>

    <task id="4">
      <title>Material progress tracking</title>
      <description>Track reserved vs required materials, show completion indicator</description>
      <files>
        <file>apps/frontend/components/scanner/MaterialProgressIndicator.tsx</file>
      </files>
    </task>

    <task id="5">
      <title>Offline queue integration</title>
      <description>Queue reservations when offline, sync when online (Story 5.36 integration)</description>
      <files>
        <file>apps/frontend/lib/offline/reservation-queue.ts</file>
      </files>
    </task>

    <task id="6">
      <title>Tests</title>
      <description>E2E tests for scanner workflow, validation, offline mode</description>
      <files>
        <file>tests/e2e/scanner-reservation.spec.ts</file>
      </files>
    </task>
  </tasks>

  <related-documentation>
    <doc>docs/stories/04-7-material-reservation-desktop.md (desktop version, shared API)</doc>
    <doc>docs/stories/04-9-consume-whole-lp-flag.md (qty input conditional logic)</doc>
    <doc>docs/stories/04-12-output-registration-desktop.md (consumption happens here)</doc>
    <doc>docs/stories/04-19-lp-genealogy-integration.md (traceability integration)</doc>
    <doc>docs/stories/05-36-offline-support.md (offline queue)</doc>
    <doc>docs/ux-design/ux-design-scanner-module-OLD.md (scanner UX patterns)</doc>
    <doc>docs/ux-design/ux-design-shared-system.md (mobile responsive patterns)</doc>
    <doc>docs/reference/database-schema.md (work_orders, license_plates, lp_genealogy)</doc>
  </related-documentation>
</story-context>
