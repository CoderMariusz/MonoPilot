<?xml version="1.0" encoding="UTF-8"?>
<story>
  <metadata>
    <id>6.12</id>
    <title>Record Test Results Against LPs</title>
    <batch>06B-1</batch>
    <status>drafted</status>
  </metadata>

  <description>Record test results against LPs for quality tracking</description>

  <dependencies>
    <requires>
      <story id="6.10">Product Specification Management</story>
    </requires>
    <blocks>
      <story id="6.13">Test History Per LP</story>
      <story id="6.14">Compare Results to Specifications</story>
    </blocks>
  </dependencies>

  <technical_context>
    <tables>
      <table>
        <name>test_results</name>
        <columns>
          <column>id uuid PRIMARY KEY</column>
          <column>organization_id uuid NOT NULL REFERENCES organizations(id)</column>
          <column>lp_id uuid NOT NULL REFERENCES license_plates(id)</column>
          <column>specification_id uuid NOT NULL REFERENCES product_specifications(id)</column>
          <column>result_value text NOT NULL</column>
          <column>numeric_value decimal</column>
          <column>test_status text NOT NULL CHECK (test_status IN ('passed', 'failed', 'overridden'))</column>
          <column>variance_percent decimal</column>
          <column>override_reason text</column>
          <column>notes text</column>
          <column>tested_by uuid NOT NULL REFERENCES profiles(id)</column>
          <column>tested_at timestamptz DEFAULT now()</column>
        </columns>
      </table>
    </tables>

    <api_endpoints>
      <endpoint method="POST" path="/api/quality/test-results">Record test result</endpoint>
    </api_endpoints>

    <frontend_routes>
      <route path="/quality/test-results">Test Results page</route>
    </frontend_routes>
  </technical_context>

  <acceptance_criteria>
    <ac id="1">/quality/test-results: select LP and product</ac>
    <ac id="2">Show spec list with input fields</ac>
    <ac id="3">Enter result_value, auto pass/fail, override option, notes</ac>
    <ac id="4">Results saved and linked to LP</ac>
  </acceptance_criteria>

  <functional_requirements>
    <fr id="QC-FR-14">System shall record test results against LPs</fr>
  </functional_requirements>
</story>
