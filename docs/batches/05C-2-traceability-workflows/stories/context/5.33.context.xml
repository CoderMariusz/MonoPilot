<?xml version="1.0" encoding="UTF-8"?>
<story>
  <metadata>
    <id>5.33</id>
    <title>Receive from TO (Desktop)</title>
    <batch>5C-2</batch>
    <points>5</points>
    <effort_hours>5-6</effort_hours>
    <status>todo</status>
  </metadata>

  <description>Desktop UI for completing transfer orders by updating LP locations to destination</description>

  <dependencies>
    <requires>
      <story id="3.6">Transfer Order</story>
      <story id="5.14">LP Location Move</story>
      <story id="5.1">License Plate</story>
    </requires>
  </dependencies>

  <technical_context>
    <api_endpoints>
      <endpoint method="GET" path="/api/warehouse/transfer-orders-for-receiving">
        <description>Get TOs in Shipped status ready for receiving</description>
        <auth>authenticated</auth>
      </endpoint>
      <endpoint method="POST" path="/api/warehouse/receiving/from-to">
        <description>Update LP locations and mark TO as received</description>
        <auth>authenticated</auth>
        <request>
          <field name="to_id" type="UUID"/>
          <field name="location_id" type="UUID"/>
        </request>
      </endpoint>
    </api_endpoints>
  </technical_context>

  <acceptance_criteria>
    <criterion id="AC1">Navigate to TO receiving shows TOs in Shipped status</criterion>
    <criterion id="AC2">Click TO expands line items</criterion>
    <criterion id="AC3">Receive all confirms destination location</criterion>
    <criterion id="AC4">Update LP locations to destination atomically</criterion>
    <criterion id="AC5">Update TO status to Received</criterion>
  </acceptance_criteria>

  <test_plan>
    <integration_tests>
      <test name="Receive TO â†’ all LPs moved to new location"/>
      <test name="stock_move records created for each LP"/>
      <test name="TO status updated to Received"/>
    </integration_tests>
  </test_plan>

  <implementation_notes>
    <note priority="high">LPs already exist (transferred from source warehouse)</note>
    <note priority="high">Only update location_id (not create new LPs)</note>
    <note priority="critical">Atomic operation: all LPs move or none</note>
  </implementation_notes>
</story>
