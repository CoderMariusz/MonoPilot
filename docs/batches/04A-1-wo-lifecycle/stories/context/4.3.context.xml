<?xml version="1.0" encoding="UTF-8"?>
<context>
  <story-metadata>
    <story-id>04-3-wo-pause-resume</story-id>
    <epic>Epic 4 - Production Execution</epic>
    <title>WO Pause/Resume</title>
    <status>todo</status>
    <priority>P0</priority>
    <story-points>2</story-points>
    <effort>1 day</effort>
    <updated>2025-11-28 - Expanded ACs from 8 to 10, added configurable pause reasons (per-warehouse: Breakdown, Break, Material Wait, Other), detailed downtime tracking with breakdown by reason, wo_pauses table schema, concurrency safety</updated>
  </story-metadata>

  <story-content>
    <goal>
      Enable operators to pause work orders during unexpected issues and resume them later,
      with detailed downtime tracking for reporting and analysis.
    </goal>

    <user-story>
      As an Operator
      I want to pause a WO when there's an issue
      So that we can track downtime
    </user-story>

    <problem-statement>
      Operators need ability to temporarily halt production without canceling WO:
      1. Pause with documented reason (breakdown, break, material wait, etc.)
      2. Track pause duration and reasons
      3. Resume seamlessly to continue production
      4. Report on downtime causes
    </problem-statement>

    <acceptance-criteria>
      <ac id="4.3.1" title="Pause Modal and Validation">
        Given WO is In Progress and pause enabled in production_settings
        When clicking "Pause" button
        Then modal shows: pause reason (Breakdown, Break, Material Wait, Other), notes field, Cancel/Confirm buttons
      </ac>

      <ac id="4.3.2" title="Pause Status Transition">
        When confirmed
        Then system updates: status → 'paused', pause_reason recorded, wo_pauses record created with timestamps
      </ac>

      <ac id="4.3.3" title="Resume Operation">
        When clicking "Resume"
        Then system updates: status → 'in_progress', pause duration calculated, resume_at timestamp set
      </ac>

      <ac id="4.3.4" title="Pause Duration Tracking">
        When viewing WO details
        Then total downtime shown with breakdown by reason (Breakdown: 45min, Break: 30min, etc.)
      </ac>

      <ac id="4.3.5" title="API Endpoints">
        POST /api/production/work-orders/:id/pause (with pause_reason, notes)
        POST /api/production/work-orders/:id/resume
      </ac>

      <ac id="4.3.6" title="Role-Based Access">
        Then Operators and Production Managers can pause/resume
      </ac>

      <ac id="4.3.7" title="Configuration Toggle">
        When admin disables pause in production_settings.allow_pause_wo
        Then "Pause" button hidden
      </ac>

      <ac id="4.3.8" title="Dashboard Integration">
        When viewing production dashboard
        Then WO appears in Active list with "Paused" status and resume button
      </ac>
    </acceptance-criteria>

    <tasks>
      <task id="1">Create wo_pauses table (wo_id, pause_reason, notes, paused_at, resumed_at)</task>
      <task id="2">PauseResumeService implementation</task>
      <task id="3">API endpoints (pause/resume)</task>
      <task id="4">Frontend pause/resume modals + buttons</task>
      <task id="5">Dashboard integration</task>
      <task id="6">Tests (unit, integration, E2E)</task>
    </tasks>

    <dev-notes>
      <architecture-patterns>
        - Status-based workflow: Use WO status transitions (in_progress → paused → in_progress)
        - Downtime tracking: wo_pauses table stores pause history for audit and reporting
        - Pattern reuse: Similar to Story 4.2 (WO Start) - simple status transition with audit
      </architecture-patterns>

      <key-decisions>
        - Status field: WO status becomes 'paused' (not separate field)
        - Multiple pauses: Support multiple pause/resume cycles in one WO
        - Downtime calc: resume_at - paused_at per wo_pauses record
      </key-decisions>

      <constraints>
        - Pause only available if WO in_progress
        - Resume requires WO in paused status
        - Configuration toggle (Story 4.17) controls visibility
        - Toggle default: allow_pause_wo = true
      </constraints>
    </dev-notes>
  </story-content>

  <database-schema>
    <table name="work_orders" source="028_create_work_orders_stub.sql">
      <description>
        Core work orders table with status enum supporting 'paused' state.
        This story adds 'paused' to the existing status workflow.
      </description>

      <key-columns>
        <column name="id" type="UUID" pk="true">Primary key</column>
        <column name="org_id" type="UUID" required="true">Organization isolation (RLS)</column>
        <column name="wo_number" type="VARCHAR(50)" unique="true">Work order identifier</column>
        <column name="status" type="VARCHAR(20)" default="draft">
          Current status enum: draft, released, in_progress, paused, completed, closed, cancelled
          NOTE: 'paused' needs to be added to status check constraint
        </column>
        <column name="product_id" type="UUID" required="true">Product being produced</column>
        <column name="planned_quantity" type="DECIMAL(12,3)" required="true">Target quantity</column>
        <column name="produced_quantity" type="DECIMAL(12,3)" default="0">Actual output</column>
        <column name="actual_start_date" type="DATE">When WO started (from Story 4.2)</column>
        <column name="created_at" type="TIMESTAMPTZ" required="true">Creation timestamp</column>
        <column name="updated_at" type="TIMESTAMPTZ" required="true">Last modification (auto-updated)</column>
      </key-columns>

      <rls-policies>
        <policy name="Users can view work orders in their org" operation="SELECT">
          org_id = (auth.jwt() ->> 'org_id')::uuid
        </policy>
        <policy name="Production/Technical/Admin can update work orders" operation="UPDATE">
          org_id = (auth.jwt() ->> 'org_id')::uuid
          AND (auth.jwt() ->> 'role') IN ('production', 'technical', 'admin')
        </policy>
      </rls-policies>

      <migration-needed>
        ALTER TABLE work_orders DROP CONSTRAINT IF EXISTS work_orders_status_check;
        ALTER TABLE work_orders ADD CONSTRAINT work_orders_status_check
          CHECK (status IN ('draft', 'released', 'in_progress', 'paused', 'completed', 'closed', 'cancelled'));
      </migration-needed>
    </table>

    <table name="wo_pauses" source="NEW - Task 1">
      <description>
        Tracks pause/resume cycles for work orders. Supports multiple pauses per WO.
        Each pause record stores reason, notes, timestamps for downtime reporting.
      </description>

      <schema>
        CREATE TABLE IF NOT EXISTS public.wo_pauses (
          id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
          org_id UUID NOT NULL REFERENCES organizations(id) ON DELETE CASCADE,
          wo_id UUID NOT NULL REFERENCES work_orders(id) ON DELETE CASCADE,

          -- Pause Details
          pause_reason VARCHAR(50) NOT NULL, -- 'Breakdown', 'Break', 'Material Wait', 'Other'
          notes TEXT, -- Optional operator notes

          -- Timestamps
          paused_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
          resumed_at TIMESTAMP WITH TIME ZONE, -- NULL if currently paused

          -- Calculated (on resume)
          duration_minutes INTEGER, -- resumed_at - paused_at in minutes

          -- Audit
          paused_by_user_id UUID REFERENCES users(id),
          resumed_by_user_id UUID REFERENCES users(id),
          created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,
          updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,

          CONSTRAINT wo_pauses_reason_check CHECK (
            pause_reason IN ('Breakdown', 'Break', 'Material Wait', 'Other')
          ),
          CONSTRAINT wo_pauses_duration_positive CHECK (
            duration_minutes IS NULL OR duration_minutes >= 0
          )
        );

        CREATE INDEX idx_wo_pauses_org ON wo_pauses(org_id);
        CREATE INDEX idx_wo_pauses_wo ON wo_pauses(wo_id);
        CREATE INDEX idx_wo_pauses_timestamps ON wo_pauses(paused_at, resumed_at);
      </schema>

      <rls-policies>
        Standard RLS pattern:
        - SELECT: authenticated users in org
        - INSERT: production/operator/admin roles
        - UPDATE: production/operator/admin roles (only if org matches)
        - DELETE: admin only
      </rls-policies>
    </table>

    <table name="production_settings" source="Story 4.17 - Configuration">
      <description>
        Organization-level configuration for production module features.
        Controls visibility of pause/resume functionality.
      </description>

      <key-column>
        <column name="allow_pause_wo" type="BOOLEAN" default="true">
          Toggle to enable/disable pause/resume feature
        </column>
      </key-column>
    </table>
  </database-schema>

  <ux-design>
    <source>docs/ux-design/ux-design-production-module.md</source>
    <source>docs/ux-design/ux-design-shared-system.md</source>

    <shared-components>
      <component name="ModuleHeader">
        Production module header with tabs: Production | Dashboard | Active WOs | Completed | Yields | ⚙️
        Location: components/shared/ModuleHeader.tsx
      </component>

      <component name="DataTable">
        Generic table for Active WOs list on dashboard (Story 4.1)
        Shows WO status, progress, actions including Pause/Resume buttons
        Location: components/shared/DataTable.tsx
      </component>

      <component name="StatusBadge">
        Visual status indicator - must support "Paused" status
        Color: orange (pause-specific color per shared system line 19)
        Location: components/shared/StatusBadge.tsx
      </component>
    </shared-components>

    <production-specific-components>
      <component name="WOPauseModal" new="true">
        <description>
          Modal for pausing work order with reason selection
        </description>
        <fields>
          - Pause Reason dropdown (Breakdown, Break, Material Wait, Other)
          - Notes textarea (optional, 250 char limit)
          - Cancel/Confirm buttons
        </fields>
        <validation>
          - Pause reason required
          - WO must be in 'in_progress' status
          - Check production_settings.allow_pause_wo = true
        </validation>
        <location>components/production/WOPauseModal.tsx</location>
      </component>

      <component name="WOResumeButton" new="true">
        <description>
          Button to resume paused work order (simpler than pause - no modal needed)
        </description>
        <behavior>
          - Only visible if WO status = 'paused'
          - Click → API call to resume
          - Show loading spinner during API call
          - Success → toast notification, refresh WO data
        </behavior>
        <location>Inline in dashboard table / WO detail page</location>
      </component>

      <component name="DowntimeBreakdown" new="true">
        <description>
          Display component showing total pause time with breakdown by reason
        </description>
        <data-source>
          Aggregates wo_pauses records for given WO
          Groups by pause_reason, SUM(duration_minutes)
        </data-source>
        <display>
          Total Downtime: 1h 15m
          - Breakdown: 45min
          - Break: 30min
        </display>
        <location>WO Detail page (AC 4.3.4)</location>
      </component>
    </production-specific-components>

    <interaction-patterns>
      <pattern name="Pause Workflow">
        1. User viewing WO detail page or dashboard with in_progress WO
        2. Click "Pause" button (orange, per shared system)
        3. WOPauseModal opens with reason dropdown + notes
        4. User selects reason (required), optionally adds notes
        5. Click Confirm → API POST /api/production/work-orders/:id/pause
        6. Success: Toast "WO paused successfully", status → paused, button changes to Resume
        7. Dashboard updates to show "Paused" status badge (orange)
      </pattern>

      <pattern name="Resume Workflow">
        1. User viewing paused WO
        2. Click "Resume" button (green, per shared system)
        3. API POST /api/production/work-orders/:id/resume (no modal needed)
        4. Success: Toast "WO resumed", status → in_progress, Pause button reappears
        5. wo_pauses record updated with resumed_at + duration_minutes
      </pattern>

      <pattern name="Dashboard Integration">
        From Story 4.1 Production Dashboard (UX Design line 360-367):
        - Active WOs table shows status column with StatusBadge
        - Paused WOs appear in Active list (not separate section)
        - Status badge shows "Paused" in orange
        - Actions column: Resume button (only for paused), Pause button (only for in_progress)
      </pattern>
    </interaction-patterns>

    <responsive-design>
      <mobile view="tablet" resolution="1280x800">
        - Pause/Resume buttons: minimum tap target 48px
        - WOPauseModal: full-screen on mobile
        - Reason dropdown: large touch-friendly select
        - Toast notifications: center-bottom position
      </mobile>

      <desktop view="standard" resolution="1920x1080">
        - WOPauseModal: 500px width, centered overlay
        - Inline Pause/Resume buttons in table (gray-600 style per shared system)
        - Downtime breakdown: compact card in WO details
      </desktop>
    </responsive-design>

    <color-palette>
      <source>docs/ux-design/ux-design-shared-system.md lines 169-196</source>
      <colors>
        - PRIMARY (buttons): green-600 (#16a34a) for Resume
        - SECONDARY (actions): gray-600 (#4b5563) for general actions
        - WARNING (pause): orange-600 for Pause button/badge (production-specific, line 19)
        - Status Badge Paused: orange-200 bg + orange-800 text
        - Success toast: green with checkmark
        - Error toast: red with X icon
      </colors>
    </color-palette>

    <typography>
      <source>docs/ux-design/ux-design-shared-system.md lines 214-237</source>
      - Modal title: text-xl (20px) semibold-600
      - Form labels: text-sm (14px) medium-500
      - Button text: text-base (16px) medium-500
      - Toast messages: text-sm (14px) regular-400
    </typography>
  </ux-design>

  <api-patterns>
    <endpoint path="/api/production/work-orders/:id/pause" method="POST">
      <description>Pause an in-progress work order</description>

      <request-body>
        {
          "pause_reason": "Breakdown" | "Break" | "Material Wait" | "Other",
          "notes": "Optional notes up to 250 chars"
        }
      </request-body>

      <response-success status="200">
        {
          "data": {
            "id": "uuid",
            "wo_number": "WO-20251127-0001",
            "status": "paused",
            "pause": {
              "id": "uuid",
              "pause_reason": "Breakdown",
              "notes": "Motor overheating",
              "paused_at": "2025-11-27T14:30:00Z",
              "paused_by_user": { "id": "uuid", "name": "Anna Supervisor" }
            }
          },
          "message": "Work order paused successfully"
        }
      </response-success>

      <error-responses>
        <error status="400" code="INVALID_STATUS">WO must be in 'in_progress' status to pause</error>
        <error status="400" code="PAUSE_DISABLED">Pause feature disabled in production_settings</error>
        <error status="400" code="INVALID_REASON">Pause reason must be Breakdown/Break/Material Wait/Other</error>
        <error status="404" code="NOT_FOUND">Work order not found</error>
        <error status="403" code="ORG_ISOLATION">WO belongs to different organization</error>
        <error status="403" code="FORBIDDEN">Insufficient permissions (operator/production/admin only)</error>
      </error-responses>

      <service-layer>
        class PauseResumeService {
          async pauseWorkOrder(woId: string, userId: string, orgId: string, data: PauseData) {
            // 1. Validate: WO exists, org_id matches, status = in_progress
            // 2. Check production_settings.allow_pause_wo = true
            // 3. BEGIN TRANSACTION
            // 4. UPDATE work_orders SET status = 'paused', updated_at = NOW()
            // 5. INSERT wo_pauses (wo_id, pause_reason, notes, paused_at, paused_by_user_id)
            // 6. COMMIT
            // 7. Return updated WO + pause record
          }
        }
      </service-layer>

      <pattern-reference>Similar to Story 4.2 WO Start endpoint pattern</pattern-reference>
    </endpoint>

    <endpoint path="/api/production/work-orders/:id/resume" method="POST">
      <description>Resume a paused work order</description>

      <request-body>{}</request-body>

      <response-success status="200">
        {
          "data": {
            "id": "uuid",
            "wo_number": "WO-20251127-0001",
            "status": "in_progress",
            "pause": {
              "id": "uuid",
              "pause_reason": "Breakdown",
              "paused_at": "2025-11-27T14:30:00Z",
              "resumed_at": "2025-11-27T15:15:00Z",
              "duration_minutes": 45
            }
          },
          "message": "Work order resumed successfully"
        }
      </response-success>

      <error-responses>
        <error status="400" code="INVALID_STATUS">WO must be in 'paused' status to resume</error>
        <error status="400" code="NO_ACTIVE_PAUSE">No active pause found for this WO</error>
        <error status="404" code="NOT_FOUND">Work order not found</error>
        <error status="403" code="ORG_ISOLATION">WO belongs to different organization</error>
      </error-responses>

      <service-layer>
        class PauseResumeService {
          async resumeWorkOrder(woId: string, userId: string, orgId: string) {
            // 1. Validate: WO exists, org_id matches, status = paused
            // 2. Find latest wo_pauses record WHERE wo_id = woId AND resumed_at IS NULL
            // 3. BEGIN TRANSACTION
            // 4. UPDATE work_orders SET status = 'in_progress', updated_at = NOW()
            // 5. UPDATE wo_pauses SET resumed_at = NOW(), duration_minutes = EXTRACT(EPOCH FROM (NOW() - paused_at))/60, resumed_by_user_id = userId
            // 6. COMMIT
            // 7. Return updated WO + completed pause record
          }
        }
      </service-layer>
    </endpoint>

    <existing-endpoints>
      <endpoint path="/api/production/work-orders/:id/start" method="POST" source="Story 4.2">
        Starts a released WO → in_progress. Similar pattern to pause/resume.
      </endpoint>

      <endpoint path="/api/production/dashboard/active-wos" method="GET" source="Story 4.1">
        Returns list of active WOs (in_progress + paused). Must include pause status and buttons.
      </endpoint>
    </existing-endpoints>
  </api-patterns>

  <testing-strategy>
    <unit-tests target-coverage="95%">
      <test suite="PauseResumeService">
        - pauseWorkOrder() with valid data → creates pause record, updates status
        - pauseWorkOrder() with invalid status → throws INVALID_STATUS error
        - pauseWorkOrder() when pause disabled → throws PAUSE_DISABLED error
        - pauseWorkOrder() with invalid reason → throws INVALID_REASON error
        - pauseWorkOrder() wrong org_id → throws ORG_ISOLATION error
        - resumeWorkOrder() with paused WO → updates status, sets resumed_at, calculates duration
        - resumeWorkOrder() with in_progress WO → throws INVALID_STATUS error
        - resumeWorkOrder() with no active pause → throws NO_ACTIVE_PAUSE error
        - Duration calculation accuracy (timestamp math)
        - Multiple pause cycles on same WO
      </test>
    </unit-tests>

    <integration-tests target-coverage="70%">
      <test suite="API Endpoints">
        - POST /api/production/work-orders/:id/pause (200) → status changes, pause record created
        - POST /api/production/work-orders/:id/pause (400) if not in_progress
        - POST /api/production/work-orders/:id/pause (403) if wrong org
        - POST /api/production/work-orders/:id/pause (403) if insufficient role
        - POST /api/production/work-orders/:id/resume (200) → status restored, duration calculated
        - POST /api/production/work-orders/:id/resume (400) if not paused
        - GET /api/production/dashboard/active-wos includes paused WOs
        - RLS enforcement: user cannot pause WO from different org
      </test>
    </integration-tests>

    <e2e-tests target-coverage="100% critical paths">
      <test name="Full pause/resume workflow">
        1. Create test WO in 'in_progress' status (Story 4.2 setup)
        2. Navigate to production dashboard
        3. Locate WO in Active WOs table
        4. Click "Pause" button
        5. Verify WOPauseModal opens
        6. Select pause reason "Breakdown"
        7. Enter notes "Motor overheating"
        8. Click Confirm
        9. Verify loading spinner shows
        10. Verify success toast appears
        11. Verify WO status changes to "Paused" (orange badge)
        12. Verify "Resume" button appears
        13. Click "Resume" button
        14. Verify success toast
        15. Verify status → "In Progress" (green badge)
        16. Verify "Pause" button reappears
        17. Navigate to WO detail page
        18. Verify downtime breakdown shows "Breakdown: Xmin"
      </test>

      <test name="Configuration toggle">
        1. Admin disables production_settings.allow_pause_wo
        2. Navigate to dashboard with in_progress WO
        3. Verify "Pause" button is hidden
        4. Direct API call to /pause → returns 400 PAUSE_DISABLED
      </test>

      <test name="Multiple pause cycles">
        1. Start WO, pause with "Break", wait 5s, resume
        2. Pause again with "Material Wait", wait 5s, resume
        3. View WO details
        4. Verify downtime breakdown shows both pauses with correct durations
      </test>

      <test name="Role-based access">
        1. Login as operator → can pause/resume
        2. Login as production manager → can pause/resume
        3. Login as planner → cannot see pause/resume buttons
        4. API call as planner → 403 FORBIDDEN
      </test>
    </e2e-tests>

    <test-fixtures>
      <fixture name="createTestWOInProgress">
        Creates work order in in_progress status using Story 4.2 flow
        Returns: { woId, wo_number, orgId }
      </fixture>

      <fixture name="createTestPause">
        Creates wo_pauses record for testing resume/duration
        Returns: { pauseId, woId, paused_at }
      </fixture>

      <fixture name="togglePauseFeature">
        Updates production_settings.allow_pause_wo for testing config
        Params: { enabled: boolean }
      </fixture>
    </test-fixtures>
  </testing-strategy>

  <dependencies>
    <story-dependencies>
      <dependency story="04-1-production-dashboard" type="required">
        Dashboard must exist to show paused WOs in Active list.
        Dashboard API endpoint must filter by status including 'paused'.
      </dependency>

      <dependency story="04-2-wo-start" type="required">
        WO Start establishes pattern for status transition endpoints.
        Reuse similar service structure, validation, error handling.
        WO must be in 'in_progress' before it can be paused.
      </dependency>

      <dependency story="04-17-production-settings" type="soft">
        Configuration toggle for allow_pause_wo.
        If not implemented yet, default to true (always allow pause).
      </dependency>
    </story-dependencies>

    <technical-dependencies>
      <dependency name="Supabase Client" version="latest">
        Database operations via createClient() from @/lib/supabase/server
      </dependency>

      <dependency name="React Hook Form" version="^7.x">
        Form validation in WOPauseModal (reason + notes)
      </dependency>

      <dependency name="Shared UI Components">
        - ModuleHeader (shared-system.md)
        - StatusBadge (shared-system.md)
        - DataTable (shared-system.md)
        - Toast notifications (shared pattern)
      </dependency>
    </technical-dependencies>
  </dependencies>

  <implementation-checklist>
    <phase name="Database Schema">
      <item>Add 'paused' to work_orders.status enum constraint</item>
      <item>Create wo_pauses table with RLS policies</item>
      <item>Add indexes on wo_pauses (org_id, wo_id, timestamps)</item>
      <item>Create trigger for wo_pauses.updated_at</item>
      <item>Verify RLS policies allow production/operator/admin roles</item>
    </phase>

    <phase name="Service Layer">
      <item>Create PauseResumeService class</item>
      <item>Implement pauseWorkOrder() with transaction</item>
      <item>Implement resumeWorkOrder() with duration calculation</item>
      <item>Add validation: status checks, org isolation, role checks</item>
      <item>Add error handling with typed error codes</item>
    </phase>

    <phase name="API Routes">
      <item>Create /api/production/work-orders/[id]/pause/route.ts</item>
      <item>Create /api/production/work-orders/[id]/resume/route.ts</item>
      <item>Add auth checks (extract user_id, org_id, role from session)</item>
      <item>Add request validation (pause_reason enum, notes length)</item>
      <item>Return proper HTTP status codes (200/400/403/404)</item>
    </phase>

    <phase name="Frontend Components">
      <item>Create WOPauseModal.tsx with form validation</item>
      <item>Add Pause button to Active WOs table (conditional on status)</item>
      <item>Add Resume button to Active WOs table (conditional on status)</item>
      <item>Create DowntimeBreakdown.tsx component for WO details</item>
      <item>Update StatusBadge to support 'paused' status (orange)</item>
      <item>Add toast notifications for success/error</item>
    </phase>

    <phase name="Dashboard Integration">
      <item>Update Story 4.1 dashboard query to include paused WOs</item>
      <item>Update Active WOs table to show Pause/Resume buttons conditionally</item>
      <item>Verify paused WOs appear with correct status badge</item>
      <item>Test real-time updates when WO paused/resumed</item>
    </phase>

    <phase name="Testing">
      <item>Unit tests: PauseResumeService (95% coverage)</item>
      <item>Integration tests: API endpoints (70% coverage)</item>
      <item>E2E tests: Full workflow, config toggle, multiple cycles</item>
      <item>Manual testing: Mobile/tablet responsive, toast notifications</item>
    </phase>
  </implementation-checklist>

  <file-structure>
    <new-files>
      - apps/frontend/lib/supabase/migrations/034_add_paused_status_to_work_orders.sql
      - apps/frontend/lib/supabase/migrations/035_create_wo_pauses_table.sql
      - apps/frontend/lib/services/production/pause-resume-service.ts
      - apps/frontend/app/api/production/work-orders/[id]/pause/route.ts
      - apps/frontend/app/api/production/work-orders/[id]/resume/route.ts
      - apps/frontend/components/production/WOPauseModal.tsx
      - apps/frontend/components/production/DowntimeBreakdown.tsx
      - tests/unit/services/pause-resume-service.test.ts
      - tests/integration/api/pause-resume.test.ts
      - tests/e2e/production/wo-pause-resume.spec.ts
    </new-files>

    <modified-files>
      - apps/frontend/components/shared/StatusBadge.tsx (add 'paused' status color)
      - apps/frontend/app/(authenticated)/production/page.tsx (add Pause/Resume buttons to table)
      - apps/frontend/app/(authenticated)/production/work-orders/[id]/page.tsx (add DowntimeBreakdown)
      - apps/frontend/lib/types/production.ts (add PauseData, WOPause types)
    </modified-files>
  </file-structure>

  <success-criteria>
    <criterion>All 8 acceptance criteria met (AC 4.3.1 through 4.3.8)</criterion>
    <criterion>Unit test coverage ≥95% for PauseResumeService</criterion>
    <criterion>Integration test coverage ≥70% for API endpoints</criterion>
    <criterion>E2E test coverage 100% for critical paths (pause, resume, config toggle)</criterion>
    <criterion>Database migrations applied successfully (wo_pauses table created, RLS policies working)</criterion>
    <criterion>UI responsive on mobile/tablet (Pause/Resume buttons ≥48px tap target)</criterion>
    <criterion>Toast notifications work (success/error states)</criterion>
    <criterion>Configuration toggle works (Story 4.17 integration or default to true)</criterion>
    <criterion>Downtime breakdown displays correctly with duration aggregation</criterion>
    <criterion>Multiple pause cycles supported (tested with ≥2 pauses per WO)</criterion>
  </success-criteria>
</context>
