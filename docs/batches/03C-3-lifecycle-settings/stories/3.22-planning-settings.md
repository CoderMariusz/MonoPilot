# Story 3.22: Planning Settings Configuration

**ID:** 3.22
**Batch:** 03C-3
**Story Points:** 5
**Effort:** 4-6 hours
**Status:** Todo

## User Story

> As an **Admin**,
> I want to configure Planning module settings,
> So that PO/TO/WO behavior matches our process.

## Acceptance Criteria

### AC 1: Settings Page

**Given** Admin navigates to /settings/planning
**Then** can configure all planning settings

### AC 2: PO Settings

**Can configure:**
- PO statuses (add/remove/rename, set default)
- require_approval toggle
- approval_threshold amount
- Field visibility (payment_terms, shipping_method, notes)

### AC 3: TO Settings

**Can configure:**
- TO statuses (add/remove/rename, set default)
- allow_partial shipments toggle
- require_lp_selection toggle

### AC 4: WO Settings

**Can configure:**
- WO statuses (add/remove/rename, set default)
- status_expiry_days
- source_of_demand toggle
- material_check toggle
- copy_routing toggle

### AC 5: Save and Apply

**When** saving settings
**Then** changes applied immediately to new orders
**And** existing orders keep their current settings

### AC 6: Validation

**Cannot** remove status if orders exist with that status
**Must** have exactly one default status per type

## Technical Tasks

### Backend
- [ ] API: `GET /api/planning/settings`
- [ ] API: `PUT /api/planning/settings`
- [ ] Validate status deletion (check existing orders)
- [ ] Validate exactly one default status
- [ ] Create default settings on first org access

### Frontend
- [ ] Planning Settings page in /settings
- [ ] Tabs: PO Settings, TO Settings, WO Settings
- [ ] Status list with drag-drop reorder
- [ ] Color picker for statuses
- [ ] Toggle switches for boolean settings
- [ ] Number input for thresholds

### Components

```typescript
// PlanningSettingsPage.tsx
interface Props {}

// StatusListConfig.tsx
interface Props {
  statuses: Status[];
  onUpdate: (statuses: Status[]) => void;
  orderType: 'po' | 'to' | 'wo';
}

// SettingsSection.tsx
interface Props {
  title: string;
  children: ReactNode;
}
```

## Testing

### Unit Tests
- [ ] Settings validation logic
- [ ] Default status enforcement

### Integration Tests
- [ ] API saves settings correctly
- [ ] Cannot delete in-use status
- [ ] Settings applied to new orders

### E2E Tests
- [ ] Navigate to Planning Settings
- [ ] Update PO settings → save → verify
- [ ] Add custom status → verify in PO creation
- [ ] Toggle approval → verify in PO workflow

## Dependencies

- **Requires:** Epic 1 (Settings infrastructure)
- **Blocks:** Stories 3.5, 3.15 (use these settings)

## Notes

- Settings are per-organization (org_id)
- Create default settings row on first access
- Consider settings export/import (future)
