<?xml version="1.0" encoding="UTF-8"?>
<story>
  <metadata>
    <id>3.21</id>
    <title>WO Gantt View</title>
    <batch>03C-3</batch>
    <points>5</points>
    <effort_hours>4-6</effort_hours>
    <status>todo</status>
  </metadata>

  <description>
    Gantt chart visualization for Work Order scheduling.
    Shows WOs on timeline grouped by production line.
  </description>

  <dependencies>
    <blocks/>
    <requires>
      <story id="3.10">WO CRUD</story>
    </requires>
  </dependencies>

  <technical_context>
    <api_endpoints>
      <endpoint method="GET" path="/api/planning/work-orders/schedule">
        <query_params>
          <param name="from" type="string" format="YYYY-MM-DD"/>
          <param name="to" type="string" format="YYYY-MM-DD"/>
          <param name="line_id" type="string" optional="true"/>
        </query_params>
        <response type="array">
          <field name="id" type="string"/>
          <field name="wo_number" type="string"/>
          <field name="product_name" type="string"/>
          <field name="quantity" type="number"/>
          <field name="scheduled_date" type="string"/>
          <field name="estimated_end_date" type="string"/>
          <field name="line_id" type="string"/>
          <field name="line_name" type="string"/>
          <field name="status" type="string"/>
          <field name="status_color" type="string"/>
          <field name="priority" type="string"/>
        </response>
      </endpoint>
    </api_endpoints>

    <components_to_create>
      <component name="WOGanttView" path="components/planning/WOGanttView.tsx">
        <props>
          <prop name="dateFrom" type="Date"/>
          <prop name="dateTo" type="Date"/>
          <prop name="onWOClick" type="(woId: string) => void"/>
        </props>
      </component>
      <component name="GanttZoomControls" path="components/planning/GanttZoomControls.tsx"/>
      <component name="ViewToggle" path="components/planning/ViewToggle.tsx"/>
    </components_to_create>

    <libraries>
      <library name="frappe-gantt" purpose="Gantt chart rendering"/>
      <library name="react-gantt-timeline" purpose="Alternative Gantt library"/>
    </libraries>
  </technical_context>

  <acceptance_criteria>
    <criterion id="AC-1">
      <description>Schedule View Toggle</description>
      <given>user navigates to /planning/work-orders</given>
      <when>selecting "Schedule View"</when>
      <then>Gantt chart displayed</then>
    </criterion>
    <criterion id="AC-2">
      <description>Gantt Layout</description>
      <then>X-axis: dates, Y-axis: production lines, Bars: WOs</then>
    </criterion>
    <criterion id="AC-3">
      <description>WO Bar Details</description>
      <when>hovering over WO bar</when>
      <then>tooltip shows WO details</then>
    </criterion>
    <criterion id="AC-4">
      <description>Click to Detail</description>
      <when>clicking WO bar</when>
      <then>opens WO detail</then>
    </criterion>
    <criterion id="AC-5">
      <description>Drag to Reschedule</description>
      <when>dragging WO bar</when>
      <then>scheduled_date updated (optional)</then>
    </criterion>
    <criterion id="AC-6">
      <description>Zoom Controls</description>
      <then>can zoom day/week/month view</then>
    </criterion>
  </acceptance_criteria>

  <test_plan>
    <unit_tests>
      <test>Schedule data transformation</test>
      <test>Date range filtering</test>
    </unit_tests>
    <integration_tests>
      <test>API returns correct schedule data</test>
      <test>Line grouping works</test>
    </integration_tests>
    <e2e_tests>
      <test>Toggle between Table and Gantt view</test>
      <test>Click WO bar opens detail</test>
      <test>Zoom controls work</test>
    </e2e_tests>
  </test_plan>

  <implementation_notes>
    <note priority="medium">Use lightweight library (frappe-gantt)</note>
    <note priority="low">Drag-to-reschedule can be Phase 2</note>
    <note priority="medium">Line grouping important for factory floor</note>
  </implementation_notes>
</story>
