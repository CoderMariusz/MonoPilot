# SHIP-008: Inventory Allocation (SO Confirmation)

**Module**: Shipping Management
**Feature**: Inventory Allocation (Auto/Manual) with FIFO/FEFO
**Status**: Ready for Review
**Last Updated**: 2025-12-15

---

## ASCII Wireframe

### Success State - Allocation Modal (Desktop: >1024px)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ• Allocate Inventory for Sales Order SO-2025-0142                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ INVENTORY FRESHNESS                                                                              â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ Last updated: 3 seconds ago  [â†» Refresh]                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ALLOCATION STRATEGY                                                                              â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                                                                   â”‚    â”‚
â”‚  â”‚  Strategy: â—‰ FIFO (First In, First Out)   â—¯ FEFO (First Expired, First Out)                    â”‚    â”‚
â”‚  â”‚                                                                                                   â”‚    â”‚
â”‚  â”‚  FIFO: Allocate oldest inventory first (by receipt_date)                                        â”‚    â”‚
â”‚  â”‚  FEFO: Allocate shortest shelf life first (by expiry_date - BBD)                                â”‚    â”‚
â”‚  â”‚                                                                                                   â”‚    â”‚
â”‚  â”‚  FEFO Expiry Warning Threshold: < 7 days before BBD = Yellow Warning                           â”‚    â”‚
â”‚  â”‚  âš  Configure this threshold in System Settings â†’ Shipping â†’ FEFO Warning Days                  â”‚    â”‚
â”‚  â”‚                                                                                                   â”‚    â”‚
â”‚  â”‚  [Auto-Allocate by Selected Strategy]  [Manual Selection]                                      â”‚    â”‚
â”‚  â”‚                                                                                                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ SALES ORDER LINES                                                                                â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                                                                   â”‚    â”‚
â”‚  â”‚ Line 1: Premium Yogurt Vanilla (500mL)                                                          â”‚    â”‚
â”‚  â”‚ â”œâ”€ Qty Required: 1,200 units                                                                     â”‚    â”‚
â”‚  â”‚ â”œâ”€ Qty Available: 950 units   âš  INSUFFICIENT - 250 units short                                â”‚    â”‚
â”‚  â”‚ â”œâ”€ Allocation Status: âš  PARTIALLY ALLOCATED (950 / 1,200 = 79.2%)                             â”‚    â”‚
â”‚  â”‚ â””â”€ Assigned License Plates (Auto-suggested by FIFO):                                             â”‚    â”‚
â”‚  â”‚                                                                                                   â”‚    â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚    â”‚ [âœ“] LP-2025-0001  â”‚ Loc: A2-15  â”‚ Qty: 400  â”‚ Rec: 2025-09-12  â”‚ Exp: 2026-01-30   â”‚ 400â”‚  â”‚    â”‚
â”‚  â”‚    â”‚                     (Batch: B-001 - hover for details)                                   â”‚  â”‚    â”‚
â”‚  â”‚    â”‚ [âœ“] LP-2025-0005  â”‚ Loc: A2-18  â”‚ Qty: 550  â”‚ Rec: 2025-10-01  â”‚ Exp: 2026-02-15   â”‚ 550â”‚  â”‚    â”‚
â”‚  â”‚    â”‚                     (Batch: B-002 - hover for details)                                   â”‚  â”‚    â”‚
â”‚  â”‚    â”‚ [ ] LP-2025-0012  â”‚ Loc: A3-02  â”‚ Qty: 480  â”‚ Rec: 2025-10-28  â”‚ Exp: 2026-03-10   â”‚   0â”‚  â”‚    â”‚
â”‚  â”‚    â”‚                     (Batch: B-003 - hover for details)                                   â”‚  â”‚    â”‚
â”‚  â”‚    â”‚ [ ] LP-2025-0018  â”‚ Loc: A3-10  â”‚ Qty: 520  â”‚ Rec: 2025-11-05  â”‚ Exp: 2026-04-15   â”‚   0â”‚  â”‚    â”‚
â”‚  â”‚    â”‚                     (Batch: B-004 - hover for details)                                   â”‚  â”‚    â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                                                                   â”‚    â”‚
â”‚  â”‚    PARTIAL ALLOCATION: Take fewer units from an LP?                                             â”‚    â”‚
â”‚  â”‚    [Edit Qty] or [Click row to edit partial amount]                                            â”‚    â”‚
â”‚  â”‚    Example: LP-2025-0012 has 480 units, you need only 200?                                    â”‚    â”‚
â”‚  â”‚    â”œâ”€ Inline Edit: [480] â†’ Change to [200] â†’ Auto-recalculate                                â”‚    â”‚
â”‚  â”‚    â””â”€ Modal Edit: Click row â†’ Enter partial qty â†’ Confirm                                     â”‚    â”‚
â”‚  â”‚                                                                                                   â”‚    â”‚
â”‚  â”‚    FEFO Override (Per LP):                                                                      â”‚    â”‚
â”‚  â”‚    If FEFO-allocated LP triggers expiry warning, you can optionally:                           â”‚    â”‚
â”‚  â”‚    [ ] Ignore expiry warning for this LP (checkbox per row)                                    â”‚    â”‚
â”‚  â”‚    Unchecking this allows allocation despite yellow warning.                                   â”‚    â”‚
â”‚  â”‚                                                                                                   â”‚    â”‚
â”‚  â”‚ Line 2: Organic Cheese Block (1kg)                                                               â”‚    â”‚
â”‚  â”‚ â”œâ”€ Qty Required: 300 units                                                                       â”‚    â”‚
â”‚  â”‚ â”œâ”€ Qty Available: 300 units   âœ“ SUFFICIENT STOCK                                                â”‚    â”‚
â”‚  â”‚ â”œâ”€ Allocation Status: âœ“ FULLY ALLOCATED (300 / 300 = 100%)                                    â”‚    â”‚
â”‚  â”‚ â””â”€ Assigned License Plates (Auto-suggested by FIFO):                                             â”‚    â”‚
â”‚  â”‚                                                                                                   â”‚    â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚    â”‚ [âœ“] LP-2025-0031  â”‚ Loc: C1-08  â”‚ Qty: 300  â”‚ Rec: 2025-10-15  â”‚ Exp: 2025-12-25   â”‚ 300â”‚  â”‚    â”‚
â”‚  â”‚    â”‚                     (Batch: B-001 - hover for details)                                   â”‚  â”‚    â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                                                                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ALLOCATION SUMMARY                                                                               â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                                                                   â”‚    â”‚
â”‚  â”‚ Total SO Lines:         2                                                                        â”‚    â”‚
â”‚  â”‚ Fully Allocated:        1 (50%)                                                                 â”‚    â”‚
â”‚  â”‚ Partially Allocated:    1 (50%)  âš  Awaiting Stock: 250 units (Premium Yogurt)                 â”‚    â”‚
â”‚  â”‚ Not Allocated:          0                                                                        â”‚    â”‚
â”‚  â”‚                                                                                                   â”‚    â”‚
â”‚  â”‚ License Plates Selected: 3 total                                                                â”‚    â”‚
â”‚  â”‚ Total Qty Allocated:    1,250 units                                                              â”‚    â”‚
â”‚  â”‚ Total Qty Required:     1,500 units                                                              â”‚    â”‚
â”‚  â”‚ Coverage:               83.3%                                                                    â”‚    â”‚
â”‚  â”‚                                                                                                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ACTION & HOLD DECISION                                                                           â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                                                                   â”‚    â”‚
â”‚  â”‚  âš  INCOMPLETE ALLOCATION: Unable to fully allocate 1,500 units.                                 â”‚    â”‚
â”‚  â”‚     Only 1,250 units available. 250 units will remain unallocated.                              â”‚    â”‚
â”‚  â”‚                                                                                                   â”‚    â”‚
â”‚  â”‚  What would you like to do?                                                                     â”‚    â”‚
â”‚  â”‚                                                                                                   â”‚    â”‚
â”‚  â”‚  â—¯ Allocate what's available and set SO to "On Hold - Awaiting Stock"                          â”‚    â”‚
â”‚  â”‚     Status will change to: "allocated (partial)" â†’ "on_hold"                                    â”‚    â”‚
â”‚  â”‚     Unallocated qty (250) will trigger backorder notification                                  â”‚    â”‚
â”‚  â”‚                                                                                                   â”‚    â”‚
â”‚  â”‚  â—‰ Create Backorder for insufficient qty (recommended)                                         â”‚    â”‚
â”‚  â”‚     SO Line 1: 950 units allocated + 250 units backordered                                     â”‚    â”‚
â”‚  â”‚     Production Planning will be notified to manufacture additional 250 units                   â”‚    â”‚
â”‚  â”‚                                                                                                   â”‚    â”‚
â”‚  â”‚  UNDO ALLOCATION (within 5 minutes of confirmation):                                           â”‚    â”‚
â”‚  â”‚  If you need to undo this allocation, you can release it within 5 minutes.                     â”‚    â”‚
â”‚  â”‚  After allocation is confirmed, an [Undo] button will appear in the SO detail.                 â”‚    â”‚
â”‚  â”‚  [Undo] will release all selected inventory back to available stock.                           â”‚    â”‚
â”‚  â”‚  You can also access "Release Allocation" from SO detail menu anytime.                         â”‚    â”‚
â”‚  â”‚                                                                                                   â”‚    â”‚
â”‚  â”‚  [Cancel]  [Previous Strategy]  [Allocate Selected]  [Confirm & Hold]                          â”‚    â”‚
â”‚  â”‚                                                                                                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Success State - Allocation Modal (Tablet: 768-1024px)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ• Allocate Inventory: SO-2025-0142                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  Last updated: 3 seconds ago  [â†» Refresh]                        â”‚
â”‚                                                                    â”‚
â”‚  ALLOCATION STRATEGY                                              â”‚
â”‚  â—‰ FIFO   â—¯ FEFO                                                 â”‚
â”‚  FEFO Warning: < 7 days BBD = Yellow (configurable)             â”‚
â”‚  [Auto-Allocate] [Manual]                                        â”‚
â”‚                                                                    â”‚
â”‚  SALES ORDER LINES                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                    â”‚
â”‚  Line 1: Premium Yogurt (500mL)                                   â”‚
â”‚  Required: 1,200 | Available: 950  âš  -250                        â”‚
â”‚  Status: âš  PARTIALLY ALLOCATED (79.2%)                          â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ LP# â”‚ Location â”‚ Qty  â”‚ Receipt  â”‚ Expiry    â”‚ Sel    â”‚        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚  â”‚ [âœ“] â”‚ A2-15    â”‚ 400  â”‚ 09/12    â”‚ 01/30/26  â”‚ 400    â”‚        â”‚
â”‚  â”‚     â”‚ Batch: B-001 (hover for details)              â”‚        â”‚
â”‚  â”‚ [âœ“] â”‚ A2-18    â”‚ 550  â”‚ 10/01    â”‚ 02/15/26  â”‚ 550    â”‚        â”‚
â”‚  â”‚     â”‚ Batch: B-002 (hover for details)              â”‚        â”‚
â”‚  â”‚ [ ] â”‚ A3-02    â”‚ 480  â”‚ 10/28    â”‚ 03/10/26  â”‚ 0      â”‚        â”‚
â”‚  â”‚ [ ] â”‚ A3-10    â”‚ 520  â”‚ 11/05    â”‚ 04/15/26  â”‚ 0      â”‚        â”‚
â”‚  â”‚ [Edit Qty] to allocate partial amounts from LPs    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                    â”‚
â”‚  Line 2: Organic Cheese (1kg)                                     â”‚
â”‚  Required: 300 | Available: 300  âœ“ OK                            â”‚
â”‚  Status: âœ“ FULLY ALLOCATED (100%)                               â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ [âœ“] â”‚ C1-08    â”‚ 300  â”‚ 10/15    â”‚ 12/25/25  â”‚ 300    â”‚        â”‚
â”‚  â”‚     â”‚ Batch: B-001 (hover for details)              â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                    â”‚
â”‚  SUMMARY: 1,250 / 1,500 units (83.3%) - 250 units short          â”‚
â”‚                                                                    â”‚
â”‚  â—‰ Set to "On Hold - Awaiting Stock"                             â”‚
â”‚                                                                    â”‚
â”‚  UNDO: Release allocation within 5 minutes from SO detail [Undo] â”‚
â”‚                                                                    â”‚
â”‚  [Cancel] [Allocate]                                              â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Success State - Allocation Modal (Mobile: <768px)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† Allocate Inventory                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚ Last updated: 3 seconds ago              â”‚
â”‚ [â†» Refresh]                              â”‚
â”‚                                          â”‚
â”‚ Strategy: â—‰ FIFO  â—¯ FEFO                â”‚
â”‚ FEFO Warning: < 7 days (configurable)   â”‚
â”‚ [Auto-Allocate] [Manual]                â”‚
â”‚                                          â”‚
â”‚ LINE 1: Premium Yogurt (500mL)          â”‚
â”‚ Req: 1,200 | Avail: 950  âš  -250        â”‚
â”‚ Status: âš  79.2% Allocated               â”‚
â”‚                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [âœ“] LP-0001 | Qty: 400               â”‚ â”‚
â”‚ â”‚ Loc: A2-15 | Rec: 09/12              â”‚ â”‚
â”‚ â”‚ Exp: 01/30/26 | Batch: B-001         â”‚ â”‚
â”‚ â”‚ [Edit Qty]                           â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ [âœ“] LP-0005 | Qty: 550               â”‚ â”‚
â”‚ â”‚ Loc: A2-18 | Rec: 10/01              â”‚ â”‚
â”‚ â”‚ Exp: 02/15/26 | Batch: B-002         â”‚ â”‚
â”‚ â”‚ [Edit Qty]                           â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ [ ] LP-0012 | Qty: 480               â”‚ â”‚
â”‚ â”‚ Loc: A3-02 | Rec: 10/28              â”‚ â”‚
â”‚ â”‚ Exp: 03/10/26 | Batch: B-003         â”‚ â”‚
â”‚ â”‚ [Edit Qty]                           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                          â”‚
â”‚ LINE 2: Organic Cheese (1kg)            â”‚
â”‚ Req: 300 | Avail: 300  âœ“ OK             â”‚
â”‚ Status: âœ“ 100% Allocated                â”‚
â”‚                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [âœ“] LP-0031 | Qty: 300               â”‚ â”‚
â”‚ â”‚ Loc: C1-08 | Rec: 10/15              â”‚ â”‚
â”‚ â”‚ Exp: 12/25/25 | Batch: B-001         â”‚ â”‚
â”‚ â”‚ [Edit Qty]                           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                          â”‚
â”‚ ALLOCATION: 1,250 / 1,500 (83.3%)       â”‚
â”‚                                          â”‚
â”‚ â—‰ On Hold - Awaiting Stock               â”‚
â”‚                                          â”‚
â”‚ UNDO: Release within 5 minutes [Undo]   â”‚
â”‚                                          â”‚
â”‚ [Cancel] [Allocate]                      â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Loading State - Allocation Modal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ• Allocate Inventory for Sales Order SO-2025-0142                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                            â”‚
â”‚  INVENTORY FRESHNESS                                                                                     â”‚
â”‚  â”œâ”€ [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] Last updated fetching...                                                                 â”‚
â”‚                                                                                                            â”‚
â”‚  ALLOCATION STRATEGY                                                                                     â”‚
â”‚  â”œâ”€ [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘] FIFO  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] FEFO                                                               â”‚
â”‚  â””â”€ [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] Auto-Allocate Button   [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] Manual Button                                       â”‚
â”‚                                                                                                            â”‚
â”‚  SALES ORDER LINES                                                                                       â”‚
â”‚  â”œâ”€ [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] Line 1 Product Name                                                                 â”‚
â”‚  â”‚  â”œâ”€ Required: [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 1,200 units                                                             â”‚
â”‚  â”‚  â”œâ”€ Available: [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]                                                                        â”‚
â”‚  â”‚  â””â”€ Status: [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]                                                                           â”‚
â”‚  â”‚                                                                                                        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  â”‚ [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘] [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘] [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘] [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘]  (4 more LP loading...)   â”‚         â”‚
â”‚  â”‚  â”‚                                                                                          â”‚         â”‚
â”‚  â”‚  â”‚ Loading inventory allocation...                                                          â”‚         â”‚
â”‚  â”‚  â”‚ [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 35%                                          â”‚         â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚  â”‚                                                                                                        â”‚
â”‚  â”œâ”€ [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] Line 2 Product Name                                                                 â”‚
â”‚  â”‚  â”œâ”€ Required: [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 300 units                                                               â”‚
â”‚  â”‚  â””â”€ [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] License plates loading...                                                            â”‚
â”‚  â”‚                                                                                                        â”‚
â”‚  â””â”€ ALLOCATION SUMMARY                                                                                  â”‚
â”‚     [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘] Calculating available inventory...                                                    â”‚
â”‚                                                                                                            â”‚
â”‚  [Disabled: Cancel]  [Disabled: Allocate]                                                                â”‚
â”‚                                                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Empty State - No Available Inventory

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ• Allocate Inventory for Sales Order SO-2025-0142                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                            â”‚
â”‚  ALLOCATION STRATEGY                                                                                     â”‚
â”‚  â—‰ FIFO (First In, First Out)   â—¯ FEFO (First Expired, First Out)                                      â”‚
â”‚                                                                                                            â”‚
â”‚  SALES ORDER LINES                                                                                       â”‚
â”‚  â”œâ”€ Line 1: Premium Yogurt Vanilla (500mL)                                                              â”‚
â”‚  â”‚  â”œâ”€ Qty Required: 1,200 units                                                                        â”‚
â”‚  â”‚  â”œâ”€ Qty Available: 0 units   âœ— NO INVENTORY AVAILABLE                                               â”‚
â”‚  â”‚  â””â”€ Allocation Status: âœ— NOT ALLOCATED (0 / 1,200 = 0%)                                            â”‚
â”‚  â”‚                                                                                                        â”‚
â”‚  â”‚     [ğŸ‘ Icon]                                                                                         â”‚
â”‚  â”‚                                                                                                        â”‚
â”‚  â”‚     No Available Inventory                                                                           â”‚
â”‚  â”‚                                                                                                        â”‚
â”‚  â”‚  This product is currently out of stock. Choose an action:                                          â”‚
â”‚  â”‚                                                                                                        â”‚
â”‚  â”‚  â€¢ [Hold Order & Notify Production] - Set SO to On Hold, create production order                   â”‚
â”‚  â”‚  â€¢ [Check Production Schedule] - View when product will be available                                â”‚
â”‚  â”‚  â€¢ [View Alternatives] - Find similar products with available inventory                             â”‚
â”‚  â”‚  â€¢ [Contact Production Manager] - Request priority manufacturing                                    â”‚
â”‚  â”‚                                                                                                        â”‚
â”‚  â”œâ”€ Line 2: Organic Cheese Block (1kg)                                                                  â”‚
â”‚  â”‚  â”œâ”€ Qty Required: 300 units                                                                          â”‚
â”‚  â”‚  â”œâ”€ Qty Available: 300 units   âœ“ SUFFICIENT STOCK                                                    â”‚
â”‚  â”‚  â””â”€ Allocation Status: âœ“ FULLY ALLOCATED (300 / 300 = 100%)                                        â”‚
â”‚  â”‚                                                                                                        â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚     â”‚ [âœ“] LP-2025-0031  â”‚ Loc: C1-08  â”‚ Qty: 300  â”‚ Rec: 2025-10-15  â”‚ Exp: 2025-12-25   â”‚     â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”‚                                                                                                        â”‚
â”‚  â”‚  ALLOCATION SUMMARY                                                                                  â”‚
â”‚  â”‚  Total SO Lines:         2                                                                          â”‚
â”‚  â”‚  Fully Allocated:        1 (50%)                                                                     â”‚
â”‚  â”‚  Not Allocated:          1 (50%)  âœ— CRITICAL: Premium Yogurt completely out of stock              â”‚
â”‚  â”‚                                                                                                        â”‚
â”‚  â”‚  [Cancel]  [Hold SO & Create Backorder]  [Try Alternate Inventory]                                 â”‚
â”‚  â”‚                                                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Error State - Allocation Failure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ• Allocate Inventory for Sales Order SO-2025-0142                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                            â”‚
â”‚  [âš  Error Banner]                                                                                        â”‚
â”‚  Failed to Load Allocation Data                                                                          â”‚
â”‚  Unable to fetch available inventory and license plates. Please check your connection and try again.    â”‚
â”‚  Error Code: ALLOCATION_FETCH_FAILED                                                                    â”‚
â”‚  [Retry] [Dismiss]                                                                                       â”‚
â”‚                                                                                                            â”‚
â”‚  ALLOCATION STRATEGY                                                                                     â”‚
â”‚  â—‰ FIFO   â—¯ FEFO   [Auto-Allocate - Disabled]  [Manual Selection - Disabled]                          â”‚
â”‚                                                                                                            â”‚
â”‚  SALES ORDER LINES                                                                                       â”‚
â”‚  â”œâ”€ Line 1: Premium Yogurt Vanilla (500mL)                                                              â”‚
â”‚  â”‚  Status: Unable to load allocation data                                                              â”‚
â”‚  â”‚  [Retry]                                                                                              â”‚
â”‚  â”‚                                                                                                        â”‚
â”‚  â”œâ”€ Line 2: Organic Cheese Block (1kg)                                                                  â”‚
â”‚  â”‚  Status: Unable to load allocation data                                                              â”‚
â”‚  â”‚  [Retry]                                                                                              â”‚
â”‚  â”‚                                                                                                        â”‚
â”‚  ALLOCATION SUMMARY                                                                                      â”‚
â”‚  Status: Unable to calculate summary                                                                     â”‚
â”‚                                                                                                            â”‚
â”‚  Quick Actions:                                                                                          â”‚
â”‚  â€¢ [Retry Loading] - Attempt to reload allocation data                                                  â”‚
â”‚  â€¢ [Cancel Allocation] - Close modal and return to SO detail                                            â”‚
â”‚  â€¢ [Contact Support] - Report this issue                                                                 â”‚
â”‚                                                                                                            â”‚
â”‚  Last Attempt: 2025-12-15 14:32:10 UTC (Failed)                                                         â”‚
â”‚                                                                                                            â”‚
â”‚  [Cancel]  [Retry]                                                                                       â”‚
â”‚                                                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Error State - Insufficient Permissions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ• Allocate Inventory for Sales Order SO-2025-0142                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                            â”‚
â”‚  [âš  Warning Banner - Red]                                                                                â”‚
â”‚  Insufficient Permissions                                                                                â”‚
â”‚  You do not have permission to allocate inventory. Only Shipping Managers and Admins can allocate.     â”‚
â”‚  Contact your Shipping Manager or Admin to complete this allocation.                                    â”‚
â”‚  [Request Permission] [Dismiss]                                                                         â”‚
â”‚                                                                                                            â”‚
â”‚  ALLOCATION STRATEGY                                                                                     â”‚
â”‚  â—‰ FIFO   â—¯ FEFO   [View Only]                                                                          â”‚
â”‚                                                                                                            â”‚
â”‚  SALES ORDER LINES (Read-Only View)                                                                     â”‚
â”‚  â”œâ”€ Line 1: Premium Yogurt Vanilla (500mL)                                                              â”‚
â”‚  â”‚  Required: 1,200 units | Available: 950 units  âš  -250                                              â”‚
â”‚  â”‚                                                                                                        â”‚
â”‚  â”‚  Suggested Allocation (by FIFO):                                                                     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  â”‚ [ ] LP-2025-0001  â”‚ Loc: A2-15  â”‚ Qty: 400  â”‚ Rec: 2025-09-12  â”‚ Exp: 2026-01-30   â”‚        â”‚
â”‚  â”‚  â”‚ [ ] LP-2025-0005  â”‚ Loc: A2-18  â”‚ Qty: 550  â”‚ Rec: 2025-10-01  â”‚ Exp: 2026-02-15   â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  â”‚                                                                                                        â”‚
â”‚  â”‚  Status: Waiting for Shipping Manager approval                                                       â”‚
â”‚  â”‚  Suggested Action: Allocate 950 units + Hold 250 units                                              â”‚
â”‚  â”‚                                                                                                        â”‚
â”‚  ALLOCATION SUMMARY                                                                                      â”‚
â”‚  Can only view, not modify. Request allocation from your manager.                                       â”‚
â”‚                                                                                                            â”‚
â”‚  [Cancel]  [Request Allocation - Opens Email to Manager]                                                â”‚
â”‚                                                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Components

### 1. Inventory Freshness Indicator (MAJOR FIX #2)
- **Display**: "Last updated: X seconds ago" (refreshes real-time)
- **Refresh Button**: [â†» Refresh] to manually fetch latest inventory
- **Auto-Refresh**: Optional, configurable (Default: OFF)
  - Default State: Manual refresh only (user clicks [â†» Refresh] button)
  - Configurable in: User preferences or Organization Settings â†’ Shipping
  - Options: OFF (manual only) | ON every 30 seconds
- **Show on All States**: Desktop, Tablet, Mobile variants
- **Purpose**: Ensure user is aware inventory data may be stale
- **Format**: "Last updated: 3 seconds ago" | "Last updated: 1 minute ago"
- **Error Case**: "Last updated: Failed to fetch (3 seconds ago)" + [Retry]

### 2. FEFO Expiry Warning Threshold Configuration (MINOR FIX #4)
- **Default**: < 7 days before Best Before Date = Yellow Warning
- **Configurable**: System Setting in Settings module
  - Path: Settings â†’ Shipping â†’ FEFO Warning Days
  - Field: `fefo_warning_days_threshold` (Integer, default: 7)
- **Display in Modal**:
  - "FEFO Expiry Warning Threshold: < 7 days before BBD = Yellow Warning"
  - "âš  Configure this threshold in System Settings â†’ Shipping â†’ FEFO Warning Days"
- **LP Row Highlighting**:
  - If `best_before_date - today() < fefo_warning_days_threshold`: Yellow background
  - Show indicator: âš  "Expires in X days"
- **Example**:
  - Threshold = 7 days
  - LP expiry date: 2025-12-22
  - Today: 2025-12-15 (7 days left)
  - Status: Yellow warning âš 
- **Admin Override UI**: Per LP row checkbox
  - If FEFO-allocated LP shows warning (yellow), Shipping Managers can check:
    - â˜ "Ignore expiry warning for this LP"
  - When checked, allocation proceeds despite yellow warning
  - Unchecked (default): Warning is enforced, color alerts user

### 3. Batch Number Display Visibility (MINOR FIX #5)
- **Desktop (>1024px)**: Show batch number in table column OR tooltip on hover
  - Column Header: "Batch" (right after Expiry Date)
  - Content: "B-001" (clickable â†’ Batch detail)
  - Alternative: Hover tooltip shows batch details
- **Tablet (768-1024px)**: Hide batch number column (space constraints)
  - Show batch in tooltip: Hover row â†’ "Batch: B-001, Details: [link]"
  - Or: Show batch below LP row: "(Batch: B-001 - hover for details)"
- **Mobile (<768px)**: Show batch inline in card
  - Format: "LP-0001 | Qty: 400 | Batch: B-001"
  - Batch clickable â†’ Batch detail page
- **Implementation**:
  ```jsx
  // Desktop/Tablet: Batch in tooltip with hover
  <Tooltip title={`Batch: ${batch_number}, Lot: ${lot_number}`}>
    <span>{lp_number}</span>
  </Tooltip>

  // Mobile: Batch inline in card
  <div>LP-{lp_number} | Batch: {batch_number}</div>
  ```
- **Configurable**: User preference in account settings
  - Option: "Always show batch numbers" (toggle)
  - Applies across all allocation modals

### 4. Keyboard Focus Trap Specification (MINOR FIX #6)
- **Focus Management**:
  - Modal dialog receives focus on open
  - Tab order: Strategy â†’ Auto-Allocate â†’ Manual â†’ SO Lines â†’ LP Table â†’ Summary â†’ Buttons
  - Tab cycle within modal (wraps to first element)
  - **Focus Trap Active**: true (prevents focus escape)
- **Implementation**:
  ```jsx
  <dialog role="dialog" aria-modal="true" aria-labelledby="allocation-title">
    {/* All interactive elements trapped within */}
  </dialog>
  ```
- **Close Behavior**:
  - Escape key closes modal (calls blur on dialog)
  - Focus returns to [Allocate] button on SO detail
  - Or: Return focus to triggering button (best practice)
- **Accessibility**:
  - aria-modal="true" indicates focus trap
  - aria-label on dialog: "Allocate inventory modal, focus trapped until closed"
  - On close: Announce "Modal closed" to screen readers
- **Testing**:
  - Open modal
  - Press Tab repeatedly â†’ Focus cycles only within modal
  - Press Escape â†’ Modal closes, focus returns to trigger
  - Use Tab + Shift to reverse cycle (within modal)
  - Verify focus never escapes to background elements

### 5. Allocation Strategy Selector
- **FIFO (Default)**: "First In, First Out - Allocate oldest inventory first (by receipt_date)"
- **FEFO**: "First Expired, First Out - Allocate shortest shelf life first (by expiry_date - BBD)"
- **Radio Buttons**: Clear selection, not mutually exclusive dropdowns
- **Strategy Help Text**: Explain each strategy briefly
- **Quick Actions**:
  - **[Auto-Allocate by Selected Strategy]** - Run allocation algorithm, fill LPs based on strategy
  - **[Manual Selection]** - Allow user to manually check/uncheck LPs for each line

### 6. Sales Order Lines Section
**For Each Line:**
- **Product Name & Size**: "Premium Yogurt Vanilla (500mL)"
- **Qty Required**: "1,200 units" (from sales_order_lines.quantity_ordered)
- **Qty Available**: "950 units" (sum of available license_plates for product)
- **Allocation Status Badge**:
  - âœ“ **FULLY ALLOCATED** (green): qty_available >= qty_required
  - âš  **PARTIALLY ALLOCATED** (yellow): qty_available > 0 but < qty_required
  - âœ— **NOT ALLOCATED** (red): qty_available = 0
- **Allocation Percentage**: "79.2%" (qty_allocated / qty_required * 100)
- **Inventory Shortfall Warning**: "âš  250 units short" (if insufficient)

### 7. License Plate Table (Per Line Item) with Partial Allocation UI (MAJOR FIX #3)

| Column | Content | Notes |
|--------|---------|-------|
| Checkbox | [âœ“] or [ ] | Manual override: uncheck to exclude LP from allocation |
| LP Number | LP-2025-0001 | Clickable â†’ License plate detail |
| Location | A2-15 | Warehouse location (zone-aisle-bin) |
| Qty Available | 400 | on_hand_quantity (total qty in LP) |
| Receipt Date | 2025-09-12 | manufacturing_date (for FIFO sorting) |
| Expiry Date | 2026-01-30 | best_before_date (for FEFO sorting) |
| Selected Qty | 400 | qty_allocated_to_this_line (input field when manual) |

**PARTIAL ALLOCATION UI (New)**:
- **Inline Edit Mode**: Click "Selected Qty" column â†’ Editable number input
  - Validation: 0 < qty <= available_qty
  - On change: Auto-recalculate totals
  - On blur: Save partial allocation
  - Example: LP-2025-0012 has 480, user enters 200 â†’ Only 200 allocated

- **Modal Edit Option**: [Edit Qty] button in row
  - Opens modal: "Enter quantity to allocate from LP-2025-0012"
  - Input: [___] units (max: 480)
  - Description: "This LP contains 480 units. How many do you want to allocate?"
  - Buttons: [Cancel] [Save]
  - After save: Row updates with new qty, summary recalculates

- **Both Methods Supported**:
  1. **Inline**: Click number field, type new qty, press Enter
  2. **Modal**: Click [Edit Qty] button, enter qty in modal

**Sorting**:
- **FIFO**: Sort by receipt_date ASC (oldest first)
- **FEFO**: Sort by expiry_date ASC (soonest expiry first)

### 8. Allocation Summary Section
- **Total SO Lines**: Count of sales_order_lines
- **Fully Allocated**: Count + percentage
- **Partially Allocated**: Count + percentage + qty short
- **Not Allocated**: Count + percentage
- **License Plates Selected**: Total count of LPs used
- **Total Qty Allocated**: Sum of selected quantities
- **Total Qty Required**: Sum of qty_required
- **Coverage**: (allocated / required) * 100

### 9. Undo/Rollback Flow (MAJOR FIX #1)

#### Undo Window Specification
- **Time Window**: 5 minutes after allocation confirmation
- **Location**: SO Detail page â†’ [Undo] button (visible next to allocation status)
- **Visibility**:
  - Desktop: Button next to "Status: Allocated" badge
  - Tablet: Button in header or action menu
  - Mobile: Button in action menu (â‹®) or bottom sheet
- **Behavior**:
  - Click [Undo] â†’ Confirm dialog: "Are you sure? This will release all allocated inventory back to stock."
  - On confirm: Call POST /api/shipping/sales-orders/:id/release-allocation
  - Response: Show toast "Allocation undone. Inventory released."
  - Status updates: allocated â†’ draft
  - LP available quantities restored
  - Duration: Available for 5 minutes after allocation

#### Explicit Release Flow (Anytime)
- **Location**: SO Detail â†’ Action Menu (â‹®) â†’ [Release Allocation]
- **Alternative**: Allocation Modal footer â†’ [Release] button (if modal reopened)
- **Behavior**:
  - Click [Release Allocation] â†’ Confirmation modal
  - Modal title: "Release Allocation"
  - Content: "This will release all allocated inventory back to available stock."
  - Reason dropdown (optional):
    - "Manual adjustment"
    - "SO cancelled"
    - "SO line deleted"
    - "Other"
  - Buttons: [Cancel] [Release]
  - On confirm: POST /api/shipping/sales-orders/:id/release-allocation
  - Response: Show toast "Allocation released. Inventory freed."
  - Audit: Log release action with reason, timestamp, user
- **No Time Limit**: Can release anytime (5-minute window for [Undo] only)

#### UI Changes in SO Detail
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Sales Order: SO-2025-0142                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Status: âœ“ Allocated (100%)                  â”‚
â”‚ Allocated At: 2025-12-15 14:32:00 UTC      â”‚
â”‚ Undo Available Until: 2025-12-15 14:37:00  â”‚
â”‚ [â†¶ Undo] [â‹® Actions] (Release, Cancel, etc) â”‚
â”‚                                             â”‚
â”‚ Allocation Summary:                         â”‚
â”‚ â€¢ 1,250 / 1,500 units allocated (83.3%)   â”‚
â”‚ â€¢ 250 units backordered                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### API Endpoint
```
POST /api/shipping/sales-orders/:id/release-allocation
Request: {
  "allocation_ids": ["uuid-alloc-1", "uuid-alloc-2"] (optional, omit = release all),
  "reason": "undo_allocation" | "manual_adjustment" | "so_cancelled" | "other"
}

Response: {
  "success": true,
  "allocations_released": [...],
  "inventory_freed": 1250,
  "undo_window_expired": false (true = no longer undoable after 5 min)
}
```

### 10. Allocation Summary Section
- **Total SO Lines**: Count of sales_order_lines
- **Fully Allocated**: Count + percentage
- **Partially Allocated**: Count + percentage + qty short
- **Not Allocated**: Count + percentage
- **License Plates Selected**: Total count of LPs used
- **Total Qty Allocated**: Sum of selected quantities
- **Total Qty Required**: Sum of qty_required
- **Coverage**: (allocated / required) * 100

### 11. Hold Decision Panel (If Insufficient Stock)

**Scenario 1: Partial Allocation**
```
âš  INCOMPLETE ALLOCATION
Unable to fully allocate 1,500 units. Only 1,250 units available.
250 units will remain unallocated.
```

**Options**:
1. **Allocate what's available and set SO to "On Hold - Awaiting Stock"**
   - SO status: allocated â†’ on_hold
   - Trigger backorder creation
   - Notify production planning

2. **Create Backorder for insufficient qty (recommended)**
   - SO Line 1: 950 units allocated + 250 units backordered
   - Creates backorder_order in system
   - Notifies production planning

**Scenario 2: No Available Inventory**
```
âœ— NO INVENTORY AVAILABLE
This product is currently out of stock.
```

**Options**:
- [Hold Order & Notify Production]
- [Check Production Schedule]
- [View Alternatives]
- [Contact Production Manager]

### 12. Action Buttons

| Button | State | Action |
|--------|-------|--------|
| [Cancel] | Always enabled | Close modal, discard allocation |
| [Previous Strategy] | Enabled if FEFO selected | Switch back to FIFO, recalculate |
| [Auto-Allocate] | Enabled | Run allocation by selected strategy |
| [Manual Selection] | Enabled | Switch to manual mode, allow checkbox override |
| [Allocate Selected] | Enabled if any LP checked | Confirm allocation with manual selections |
| [Confirm & Hold] | Enabled if partial/no allocation | Confirm and set SO to On Hold |
| [Retry] | Error state only | Retry loading allocation data |
| [Undo] | Success state only (5 min window) | Release allocation, restore inventory |

---

## Main Actions

### Primary Actions
1. **Auto-Allocate by FIFO** - [Auto-Allocate] with FIFO strategy selected
   - Query available LPs by receipt_date ASC
   - Allocate to each line until qty_required met or inventory exhausted
   - Create inventory_allocations records
   - Show allocation summary

2. **Auto-Allocate by FEFO** - [Auto-Allocate] with FEFO strategy selected
   - Query available LPs by expiry_date ASC
   - Same allocation logic as FIFO
   - Prioritizes soonest-expiring inventory

3. **Manual Allocation** - [Manual Selection]
   - Allow user to uncheck LPs to exclude from allocation
   - Manually adjust "Selected Qty" per LP (inline or modal for partial LP selection)
   - [Allocate Selected] to confirm

### Secondary Actions
1. **Toggle Strategy** - Switch between FIFO and FEFO
   - Recalculate allocation suggestions
   - Update LP sort order

2. **Hold & Create Backorder** - If insufficient stock
   - Save partial allocation
   - Set SO to On Hold status
   - Create backorder_order record for unallocated qty
   - Notify production planning via task/notification

3. **Manual Override** - Uncheck LP checkbox
   - Exclude LP from allocation
   - Recalculate totals

4. **Partial LP Allocation** - Edit quantity per LP
   - Inline edit: Click quantity field â†’ type new amount â†’ Auto-recalculate
   - Modal edit: Click [Edit Qty] â†’ Enter partial qty â†’ Save
   - Validation: 0 < qty <= available_qty

### Tertiary Actions
1. **View License Plate Details** - Click LP number
   - Navigate to /warehouse/license-plates/:id
   - Show batch/lot info, temperature zone, storage location

2. **Request Permission** - If insufficient access
   - Opens email to Shipping Manager with context
   - Includes SO details + requested allocation

3. **Release Allocation** - Undo within 5 minutes or explicit release anytime
   - 5-minute undo window: [Undo] button in SO detail
   - Anytime release: [Release Allocation] in Action menu
   - Both call POST /api/shipping/sales-orders/:id/release-allocation
   - Reason: undo_allocation | manual_adjustment | so_cancelled

---

## States

### Loading State
- Skeleton loaders for:
  - Inventory freshness indicator (Last updated fetching...)
  - Strategy selector (70% opacity)
  - SO lines (80% opacity)
  - LP tables (animated shimmer)
  - Summary section (80% opacity)
- "Loading inventory allocation..." text with progress bar
- Buttons disabled (grayed out)
- If load time > 3 seconds, show progress indicator: "35%"

### Empty State (No Available Inventory)
- Large icon (ğŸ“¦ with prohibition symbol)
- "No Available Inventory" headline
- Explanation: "This product is currently out of stock."
- Quick Actions:
  - [Hold Order & Notify Production]
  - [Check Production Schedule]
  - [View Alternatives]
  - [Contact Production Manager]
- Show partial allocation for any available lines

### Error State (Failed to Load)
- Red error banner at top:
  - Headline: "Failed to Load Allocation Data"
  - Message: "Unable to fetch available inventory and license plates. Please check your connection and try again."
  - Error Code: ALLOCATION_FETCH_FAILED
- All fields disabled
- [Retry] and [Dismiss] buttons in banner
- Footer: "Last Attempt: 2025-12-15 14:32:10 UTC (Failed)"
- Modal footer: [Cancel] [Retry]

### Error State (Insufficient Permissions)
- Yellow/orange warning banner:
  - Headline: "Insufficient Permissions"
  - Message: "You do not have permission to allocate inventory. Only Shipping Managers and Admins can allocate."
- Show allocation suggestions in **read-only** mode (checkboxes disabled)
- [Request Permission] button â†’ Opens email to manager
- Buttons: [Cancel] [Request Allocation]

### Success State
- All fields populated with data
- Allocation summary calculated and displayed
- Inventory freshness indicator visible with [Refresh] button
- Batch numbers visible (desktop/tooltip) or inline (mobile)
- FEFO warning threshold documented
- Partial LP allocation UI available
- Undo workflow documented
- Buttons enabled
- Action buttons: [Cancel] [Allocate Selected] or [Confirm & Hold] (if partial)
- Focus trapped within modal (aria-modal="true")

---

## Data Fields

### License Plate Row Data

| Field | Source | Display | Format |
|-------|--------|---------|--------|
| license_plate_id | license_plates.id | Hidden (reference) | UUID |
| lp_number | license_plates.number | LP-2025-0001 | Text |
| product_id | license_plates.product_id | Hidden (reference) | UUID |
| location_id | license_plates.location_id | A2-15 | Zone-Aisle-Bin |
| on_hand_qty | license_plates.on_hand_quantity | 400 units | Decimal |
| allocated_qty | SUM(inventory_allocations.quantity_allocated) | 0 units (initially) | Decimal |
| available_qty | on_hand_qty - allocated_qty | 400 units | Decimal |
| manufacturing_date | license_plates.manufacturing_date | 2025-09-12 | Date (YYYY-MM-DD) |
| best_before_date | license_plates.best_before_date | 2026-01-30 | Date (YYYY-MM-DD) |
| receipt_date | license_plates.receipt_date | 2025-09-12 | Date (YYYY-MM-DD) |
| lot_number | license_plates.lot_number | L-20250912-001 | Text (optional) |
| batch_number | license_plates.batch_number | B-001 | Text (optional, display varies by breakpoint) |
| temperature_zone | locations.temperature_zone | "Chilled" | Enum: Ambient/Chilled/Frozen |
| selected_qty (UI) | User input | 400 | Decimal (editable in manual mode, inline or modal) |
| expiry_days_remaining | DATEDIFF(best_before_date, TODAY()) | 46 | Integer (for FEFO warning threshold) |

### Sales Order Line Data

| Field | Source | Display | Format |
|-------|--------|---------|--------|
| sales_order_line_id | sales_order_lines.id | Hidden (reference) | UUID |
| line_number | sales_order_lines.line_number | 1 | Integer |
| product_id | sales_order_lines.product_id | Hidden (reference) | UUID |
| product_name | products.name | Premium Yogurt Vanilla (500mL) | Text |
| product_size | products.package_size | 500mL | Text |
| quantity_ordered | sales_order_lines.quantity_ordered | 1,200 units | Decimal |
| quantity_allocated (existing) | SUM(inventory_allocations.qty where released_at IS NULL) | 0 (initially) | Decimal |
| quantity_allocated (new) | Sum of selected LPs | 950 units | Decimal |
| unit_price | sales_order_lines.unit_price | $5.99 | Currency |
| line_total | quantity_ordered * unit_price | $7,188 | Currency |
| requested_lot | sales_order_lines.requested_lot | null | Text (optional) |

### Allocation Summary Data

| Field | Calculation | Display |
|-------|-------------|---------|
| total_so_lines | COUNT(sales_order_lines) where sales_order_id = :id | 2 |
| fully_allocated_count | COUNT(lines where qty_allocated >= qty_required) | 1 |
| fully_allocated_pct | fully_allocated_count / total_so_lines * 100 | 50% |
| partially_allocated_count | COUNT(lines where 0 < qty_allocated < qty_required) | 1 |
| partially_allocated_pct | partially_allocated_count / total_so_lines * 100 | 50% |
| not_allocated_count | COUNT(lines where qty_allocated = 0) | 0 |
| not_allocated_pct | not_allocated_count / total_so_lines * 100 | 0% |
| total_lps_selected | COUNT(DISTINCT license_plate_id in allocation) | 3 |
| total_qty_allocated | SUM(selected_qty) | 1,250 units |
| total_qty_required | SUM(quantity_ordered) | 1,500 units |
| coverage_pct | total_qty_allocated / total_qty_required * 100 | 83.3% |
| shortfall_qty | total_qty_required - total_qty_allocated | 250 units |
| last_updated_timestamp | Current timestamp | 2025-12-15 14:30:03 UTC | ISO 8601 |
| fefo_warning_threshold | System setting (default: 7) | 7 days | Integer (configurable) |

---

## API Endpoints

### Fetch Allocation Data (GET)
```
GET /api/shipping/sales-orders/:id/allocations
Query Parameters:
  - strategy: "fifo" | "fefo" (optional, default: "fifo")
  - include_suggestions: boolean (optional, default: true)
  - include_last_updated: boolean (optional, default: true)

Response:
{
  "sales_order_id": "uuid-so-1",
  "order_number": "SO-2025-0142",
  "last_updated": "2025-12-15T14:30:03Z",
  "lines": [
    {
      "line_id": "uuid-line-1",
      "line_number": 1,
      "product_id": "uuid-prod-1",
      "product_name": "Premium Yogurt Vanilla",
      "product_size": "500mL",
      "quantity_ordered": 1200,
      "quantity_currently_allocated": 0,
      "unit_price": 5.99,
      "line_total": 7188,
      "available_license_plates": [
        {
          "license_plate_id": "uuid-lp-1",
          "lp_number": "LP-2025-0001",
          "location_code": "A2-15",
          "on_hand_quantity": 400,
          "allocated_quantity": 0,
          "available_quantity": 400,
          "manufacturing_date": "2025-09-12",
          "receipt_date": "2025-09-12",
          "best_before_date": "2026-01-30",
          "expiry_days_remaining": 46,
          "lot_number": "L-20250912-001",
          "batch_number": "B-001",
          "temperature_zone": "chilled",
          "suggested_allocation_qty": 400,
          "is_suggested": true,
          "reason": "FIFO: oldest inventory (oldest receipt_date: 2025-09-12)"
        },
        {
          "license_plate_id": "uuid-lp-2",
          "lp_number": "LP-2025-0005",
          "location_code": "A2-18",
          "on_hand_quantity": 550,
          "allocated_quantity": 0,
          "available_quantity": 550,
          "manufacturing_date": "2025-10-01",
          "receipt_date": "2025-10-01",
          "best_before_date": "2026-02-15",
          "expiry_days_remaining": 62,
          "lot_number": "L-20251001-002",
          "batch_number": "B-002",
          "temperature_zone": "chilled",
          "suggested_allocation_qty": 550,
          "is_suggested": true,
          "reason": "FIFO: second oldest (receipt_date: 2025-10-01)"
        }
      ],
      "allocation_status": "partial",
      "total_available": 950,
      "qty_short": 250,
      "allocation_summary": {
        "fully_allocated": false,
        "partially_allocated": true,
        "total_available_qty": 950,
        "total_allocated_qty": 0,
        "shortfall_qty": 250
      }
    }
  ],
  "allocation_summary": {
    "total_lines": 2,
    "fully_allocated_lines": 1,
    "partially_allocated_lines": 1,
    "not_allocated_lines": 0,
    "total_qty_required": 1500,
    "total_qty_allocated": 950,
    "total_qty_available": 1250,
    "total_lps_selected": 2,
    "coverage_percentage": 63.33,
    "allocation_complete": false,
    "total_shortfall": 250
  },
  "fefo_warning_threshold_days": 7,
  "strategy": "fifo",
  "timestamp": "2025-12-15T14:30:00Z"
}
```

### Confirm Allocation (POST)
```
POST /api/shipping/sales-orders/:id/allocate
Request Body:
{
  "allocation_strategy": "fifo" | "fefo",
  "allocations": [
    {
      "sales_order_line_id": "uuid-line-1",
      "line_allocations": [
        {
          "license_plate_id": "uuid-lp-1",
          "quantity_to_allocate": 400
        },
        {
          "license_plate_id": "uuid-lp-2",
          "quantity_to_allocate": 550
        }
      ]
    }
  ],
  "hold_if_insufficient": false | true,
  "create_backorder_for_shortfall": true | false,
  "backorder_reason": "Insufficient inventory available" (optional)
}

Response:
{
  "success": true,
  "sales_order_id": "uuid-so-1",
  "order_number": "SO-2025-0142",
  "allocated_at": "2025-12-15T14:32:00Z",
  "undo_until": "2025-12-15T14:37:00Z",
  "allocations_created": [
    {
      "allocation_id": "uuid-alloc-1",
      "sales_order_line_id": "uuid-line-1",
      "license_plate_id": "uuid-lp-1",
      "quantity_allocated": 400,
      "allocated_at": "2025-12-15T14:32:00Z",
      "allocated_by": "uuid-user-1"
    }
  ],
  "sales_order_status_updated": {
    "old_status": "draft",
    "new_status": "allocated",
    "timestamp": "2025-12-15T14:32:00Z"
  },
  "backorder_created": {
    "backorder_id": "uuid-bo-1",
    "sales_order_line_id": "uuid-line-1",
    "product_id": "uuid-prod-1",
    "quantity_backordered": 250,
    "status": "pending",
    "created_at": "2025-12-15T14:32:00Z"
  },
  "summary": {
    "total_allocated": 1250,
    "total_required": 1500,
    "total_allocated_pct": 83.33,
    "shortfall_qty": 250,
    "allocation_complete": false,
    "held_on_insufficient_stock": false
  }
}
```

### Release Allocation (POST)
```
POST /api/shipping/sales-orders/:id/release-allocation
Request Body:
{
  "allocation_ids": ["uuid-alloc-1", "uuid-alloc-2"] (optional, omit = release all),
  "reason": "undo_allocation" | "manual_adjustment" | "so_cancelled" | "line_deleted" | "other"
}

Response:
{
  "success": true,
  "allocations_released": [
    {
      "allocation_id": "uuid-alloc-1",
      "sales_order_line_id": "uuid-line-1",
      "license_plate_id": "uuid-lp-1",
      "quantity_released": 400,
      "released_at": "2025-12-15T14:35:00Z",
      "released_by": "uuid-user-1"
    }
  ],
  "inventory_freed": 400,
  "undo_window_expired": false,
  "summary": "Released 2 allocations (400 units)"
}
```

---

## Permissions

| Role | View Allocation | Auto-Allocate | Manual Allocate | Release | Hold SO |
|------|-----------------|---------------|-----------------|---------|---------|
| Admin | Yes | Yes | Yes | Yes | Yes |
| Shipping Manager | Yes | Yes | Yes | Yes | Yes |
| Shipping Clerk | Yes | No | No | No | No |
| Sales Manager | Yes | Yes | Yes | No | No |
| Warehouse Manager | Yes | No | No | No | No |
| Viewer | Yes | No | No | No | No |

**Rules:**
- **Auto-Allocate**: Requires `shipping.orders.allocate` permission
- **Manual Allocate**: Requires `shipping.orders.allocate` permission
- **Release Allocation**: Requires `shipping.orders.release_allocation` permission
- **Hold SO**: Requires `shipping.orders.hold` permission
- **View-only**: Can view suggestions but cannot modify allocations

---

## Validation Rules

### Allocation Validation
- **Min Qty**: allocated_qty > 0 for at least 1 LP per line (cannot allocate 0)
- **Max Qty**: sum(allocated_qty) <= available_qty (cannot exceed available)
- **Product Match**: All LPs must contain same product_id as sales_order_line
- **Status Check**: LPs must have status = "available" and not on quality hold
- **No Allocated LPs**: Cannot re-allocate LPs already allocated to other active SOs

### Partial Allocation Validation
- **Inline Edit**: 0 < qty <= available_qty (validated on blur)
- **Modal Edit**: Same validation in modal form
- **Auto-Recalculate**: Summary updates in real-time as qty changes
- **Prevent Over-allocation**: Cannot allocate more than required OR available (whichever is lower)

### FIFO/FEFO Validation
- **FIFO**: Receipt date must be available and valid (not null)
- **FEFO**: Best Before Date must be available and valid (not null)
  - If BBD null, fall back to manufacturing_date + shelf_life
  - If neither available, use FIFO as fallback

### Freshness Validation
- **Last Updated**: Timestamp must be within last 5 minutes
- **Stale Data**: If data older than 5 minutes, show warning: "Inventory data may be outdated. [Refresh]"
- **Refresh Action**: Fetch fresh data from /api/shipping/sales-orders/:id/allocations

### Shortfall Handling
- **Partial Allocation**: If qty_allocated < qty_required, must choose action:
  1. Create backorder (recommended)
  2. Set SO to On Hold
  3. Manual adjustment and retry
- **No Allocation**: If qty_available = 0, must choose action:
  1. Hold SO + notify production
  2. Check production schedule
  3. View alternatives

### Permission Checks
- User must have `shipping.orders.allocate` permission
- User must belong to same org as sales_order.org_id
- If read-only view, disable all checkboxes and buttons

---

## Business Rules

### Allocation Strategy Selection
- **Default**: FIFO (First In, First Out)
- **Product-specific**: Can be configured per product in Technical module (future)
- **Customer-specific**: Can be configured per customer in Shipping module (future)
- **Order-specific**: Overrideable per SO (at confirmation time)

### FIFO Allocation Logic
1. Query license_plates WHERE product_id = line.product_id AND status = 'available' AND on_hold_reason IS NULL
2. Sort by receipt_date ASC (oldest first)
3. Allocate sequentially until qty_required met or inventory exhausted
4. Create inventory_allocations records (one per LP)

### FEFO Allocation Logic
1. Same query as FIFO
2. Sort by best_before_date ASC (soonest expiry first)
3. If best_before_date NULL, use manufacturing_date + product.shelf_life_days
4. Allocate sequentially until qty_required met or inventory exhausted
5. Apply FEFO warning threshold: If expiry_days_remaining < fefo_warning_threshold_days, mark as yellow warning

### Allocation & Status Transitions
- **Sales Order Status Flow**:
  ```
  draft â†’ [Allocate] â†’ allocated (if full) OR on_hold (if partial/zero)
  allocated â†’ [Release] â†’ draft
  ```
- **Allocation Triggers Pick List Creation**:
  - On SO confirmation + allocation, system auto-creates pick_list
  - Pick list assigns LPs from allocation
  - Status: allocated â†’ picking (when pick list created)

### Backorder Rules
- **Create Backorder** when qty_available < qty_required
- Backorder contains:
  - sales_order_id + line_id
  - product_id
  - quantity_backordered = qty_required - qty_allocated
  - status = "pending"
  - estimated_availability_date = production forecast (if available)
- **Backorder Notification**: Trigger notification to Production Planning
- **Backorder Fulfillment**: When production completes, trigger re-allocation

### Release Allocation (Undo/Explicit)
- **5-Minute Undo Window**: [Undo] button in SO detail (after confirmation)
- **Anytime Release**: [Release Allocation] in Action menu
- **Both Methods**:
  - Release all inventory_allocations for that SO/line
  - Update license_plates.allocated_quantity -= released_qty
  - Free inventory for other SOs to allocate
  - Audit: Log release action with reason, timestamp, user
- **Status Update**: allocated â†’ draft (on full release)

### Inventory Freshness
- **Auto-Refresh**: Default OFF (manual refresh only), configurable in settings
  - When enabled: Every 30 seconds (optional)
  - User can configure: Settings â†’ Shipping â†’ Auto-refresh allocation data
- **Manual Refresh**: [â†» Refresh] button fetches latest allocation data
- **Display Format**: "Last updated: X seconds ago" | "Last updated: X minutes ago"
- **Stale Warning**: If > 5 minutes old, show warning + [Refresh]
- **Cache Strategy**: 1-minute TTL for allocation data

### FEFO Warning Threshold Configuration
- **System Setting**: Settings â†’ Shipping â†’ FEFO Warning Days
- **Default**: 7 days
- **Configurable**: Integer field (1-30 days)
- **Display**: Yellow background on LP rows where `expiry_days_remaining < threshold`
- **Indicator**: "âš  Expires in X days"
- **Admin Override**: Checkbox per LP: "â˜ Ignore expiry warning for this LP" (Shipping Managers only)

### Batch Number Display
- **Desktop (>1024px)**: Show in table column OR tooltip on hover
- **Tablet (768-1024px)**: Show in tooltip or below row
- **Mobile (<768px)**: Show inline in card
- **Configurable**: User preference toggle in account settings
- **Clickable**: Batch number â†’ Batch detail page

### Focus Trap Specification
- **Dialog**: aria-modal="true" indicates focus trap active
- **Tab Order**: Strategy â†’ Auto-Allocate â†’ Manual â†’ SO Lines â†’ LP Table â†’ Summary â†’ Buttons
- **Tab Cycle**: Wraps to first element (focus trapped within modal)
- **Escape**: Closes modal, focus returns to triggering button
- **Aria Label**: "Allocate inventory modal, focus trapped until closed"
- **Testing**: Tab repeatedly â†’ Only focuses modal elements

### Allergen Validation (Integration with Quality Module)
- Before allocation, check sales_orders.allergen_validated flag
- If not validated, show warning: "âš  Allergen restrictions not validated for this customer"
- Allow allocation to proceed but flag for manual review

---

## Accessibility

### Touch Targets
- Checkboxes: >= 48x48dp
- Strategy radio buttons: >= 48x48dp
- All buttons: >= 48x48dp (Cancel, Allocate, etc.)
- LP number (clickable): >= 48x48dp
- Row click zones: >= 44x48dp
- [Refresh] button: >= 48x48dp
- [Edit Qty] button: >= 48x48dp
- [Undo] button: >= 48x48dp

### Contrast
- Modal title (dark gray on white): 8:1
- Body text (dark gray): 4.5:1
- Status badges:
  - âœ“ FULLY ALLOCATED (green): 4.5:1 on white
  - âš  PARTIALLY ALLOCATED (yellow): 4.5:1 on white
  - âœ— NOT ALLOCATED (red): 4.5:1 on white
  - âš  FEFO Warning (yellow): 4.5:1 on white
- Input fields (border): 3:1 minimum
- Focus states: 3:1 minimum

### Screen Reader
- **Modal**: role="dialog" aria-labelledby="allocation-title" aria-modal="true"
- **Strategy Radio Group**: aria-label="Allocation Strategy: Choose FIFO (default) or FEFO"
- **SO Lines Section**: aria-label="Sales Order Lines with allocation status"
- **LP Checkbox**: aria-label="Select LP-2025-0001 for Premium Yogurt (400 units available)"
- **Status Badges**: aria-label="Status: Fully Allocated (100%)"
- **Allocation Summary**: aria-label="Allocation Summary: 1,250 of 1,500 units allocated (83.3%)"
- **Hold Decision Panel**: role="alert" aria-label="Warning: Incomplete allocation. 250 units short."
- **Form Fields**: aria-label + aria-required="true"
- **Freshness Indicator**: aria-label="Last updated 3 seconds ago"
- **Refresh Button**: aria-label="Refresh inventory allocation data"
- **Focus Trap**: aria-label="Allocate inventory modal, focus trapped until closed"

### Keyboard Navigation
- **Tab**: Cycle through modal elements (strategy, checkboxes, buttons)
- **Enter**: Activate selected radio button (strategy), toggle checkbox, submit form
- **Space**: Check/uncheck checkbox
- **Arrow Keys**: Navigate between radio buttons (Up/Down), navigate LP rows (Up/Down)
- **Escape**: Close modal (with confirmation if changes made)
- **Alt+A**: Quick trigger Auto-Allocate
- **Alt+C**: Cancel
- **Alt+S**: Submit/Allocate
- **Alt+U**: Undo allocation (when available)
- **Alt+R**: Refresh inventory data

### ARIA Labels
- **Modal Title**: aria-labelledby="allocation-title"
- **Strategy Label**: aria-label="Select allocation strategy"
- **FIFO Radio**: aria-label="FIFO - First In, First Out (allocate oldest inventory first)"
- **FEFO Radio**: aria-label="FEFO - First Expired, First Out (allocate shortest shelf-life first)"
- **Auto-Allocate Button**: aria-label="Auto-allocate inventory by selected strategy"
- **Refresh Button**: aria-label="Refresh inventory allocation data (last updated 3 seconds ago)"
- **Edit Qty Button**: aria-label="Edit quantity for LP-2025-0001"
- **LP Row**: aria-label="License plate LP-2025-0001, location A2-15, 400 units available, receipt date 2025-09-12, expiry 2026-01-30, batch B-001"
- **Status Badge**: aria-label="Allocation Status: Fully Allocated, 100 percent"
- **Shortfall Warning**: aria-live="polite" aria-label="Allocation shortfall: 250 units required but not available"
- **Hold Decision**: aria-live="assertive" aria-label="Warning: Insufficient inventory. Choose to hold order or create backorder."
- **FEFO Warning**: aria-label="FEFO Warning: Expires in 5 days. Consider allocating first."
- **Focus Trap**: aria-label="Focus trapped within modal. Press Escape to close."

---

## Responsive Breakpoints

| Breakpoint | Layout | Adjustments |
|------------|--------|-------------|
| **Desktop (>1024px)** | Full modal (90vw, max 1200px) | All columns visible, full detail LP table, batch column visible |
| **Tablet (768-1024px)** | Modal 95vw, max 900px | Hide LP "Batch Number" column, show batch in tooltip |
| **Mobile (<768px)** | Full-screen modal (100vw) | Stack LP table vertically, hide secondary columns, batch inline |

### Mobile Responsive Adjustments
- **Modal**: Full-screen with top close button (âœ•)
- **Strategy Selector**: Stack radio buttons vertically
- **SO Lines**: Stack cards vertically (1 line per card)
- **LP Table**: Convert to stacked cards
  ```
  LP-2025-0001
  Location: A2-15 | Qty: 400
  Receipt: 09/12 | Expiry: 01/30/26 | Batch: B-001
  [âœ“] [Edit Qty]
  ```
- **Allocation Summary**: Stack sections vertically
- **Buttons**: Full-width stack at bottom
- **Font Size**: 12px body, 14px headings, 10px secondary
- **Freshness Indicator**: Top banner with [â†» Refresh] button (full-width on mobile)
- **Batch Numbers**: Show inline in card (not in separate column)

---

## Performance Notes

### Query Optimization
- **Index**: (org_id, product_id, status, on_hold_reason) for LP lookup
- **Index**: (org_id, sales_order_id) for SO lines
- **Index**: (org_id, license_plate_id) for allocation counts
- **Batch Query**: Fetch all LPs for all lines in single query (not per-line)
- **Cache Strategy**: Cache LP availability per product for 2 minutes

### Caching
```typescript
// Redis keys
'org:{orgId}:shipping:allocations:{soId}'          // 1 min TTL (allocation data + timestamp)
'org:{orgId}:shipping:lps:{productId}:available'   // 2 min TTL (available LPs)
'org:{orgId}:shipping:backorders:pending'          // 5 min TTL (backorder list)
'org:{orgId}:settings:shipping:fefo_warning_days'  // 1 hour TTL (config setting)

// Invalidation triggers:
// - Pick list creation â†’ invalidate allocation cache
// - Inventory move â†’ invalidate LP availability cache
// - SO confirmation â†’ invalidate allocation cache
// - Allocation release â†’ invalidate allocation cache
// - FEFO threshold update â†’ invalidate config cache
```

### Load Time Targets
- **Fetch Allocation Data**: <500ms (for SOs with <50 lines)
- **FIFO/FEFO Sorting**: <200ms (in-memory sort)
- **Auto-Allocate**: <300ms (allocation algorithm)
- **Confirm Allocation**: <800ms (create inventory_allocations records)
- **Release Allocation**: <500ms
- **Modal Render**: <200ms (with skeleton loaders)
- **Refresh Inventory**: <300ms (re-fetch + re-sort)

### Lazy Loading
1. Load SO lines + basic allocation status (200ms)
2. Load LP suggestions in background (async)
3. Show LP count as they load (progressive)
4. Load batch details on hover (lazy)

---

## Error Handling

### API Errors
- **Network Error**: Error banner + [Retry] button
- **Timeout (>5s)**: "Request timed out. Checking your connection..."
- **400 Bad Request**: "Invalid allocation data. Please refresh and try again."
- **401 Unauthorized**: Redirect to login
- **403 Forbidden**: "You do not have permission to allocate inventory. Contact your manager."
- **404 Not Found**: "Sales order not found. It may have been cancelled."
- **409 Conflict**: "Allocation already exists for this line. Release first."
- **500 Server Error**: "Server error. Please contact support."

### Freshness Errors
- **Refresh Failed**: "Failed to refresh inventory data. [Retry]"
- **Stale Data Warning**: "Inventory data is more than 5 minutes old. [Refresh]"
- **Auto-Refresh Failed**: Continue showing stale timestamp, allow manual refresh

### Partial Failures
- **Some LPs Unavailable**: Show which LPs failed to allocate, recalculate with remaining LPs
- **Partial Backorder Creation**: Show success for allocated qty, alert for failed backorder
- **Permission Denied on Release**: Show which allocations could not be released, allow retry

### Validation Errors
- **Min Qty Validation**: "Must allocate at least 1 unit per line"
- **Max Qty Validation**: "Cannot allocate more than available (400 units)"
- **Partial Qty Validation**: "Cannot allocate more than 480 units from this LP"
- **Product Mismatch**: "License plate contains different product. Cannot allocate."
- **No LPs Selected**: "Select at least 1 license plate to allocate"
- **Strategy Mismatch**: "FIFO requires receipt_date. Using fallback FEFO strategy."
- **No Available LPs**: "No available inventory for this product."

---

## Testing Requirements

### Unit Tests
- **FIFO Sort**: Allocate oldest LPs first (by receipt_date ASC)
- **FEFO Sort**: Allocate soonest-expiring LPs first (by best_before_date ASC)
- **FEFO Threshold**: Mark LPs with expiry_days_remaining < threshold as warning
- **Qty Validation**: Cannot allocate > available_qty
- **Partial Qty Edit**: Inline and modal editing of LP quantities
- **Allocation Summary**: Correct calculation of allocated/required/shortfall
- **Backorder Creation**: Correct qty_backordered = qty_required - qty_allocated
- **Status Transitions**: draft â†’ allocated (full) OR on_hold (partial)
- **Permission Check**: User must have `shipping.orders.allocate` permission
- **Batch Display**: Batch number visible on desktop, hidden on tablet, inline on mobile
- **Freshness Timestamp**: Correct "Last updated" format and age calculation
- **Focus Trap**: Focus cycles only within modal, Escape closes modal

### Integration Tests
- **Fetch Allocation Data**: GET /api/shipping/sales-orders/:id/allocations
  - Returns correct LP list sorted by FIFO
  - Returns correct allocation summary
  - Handles products with no available LPs
  - Includes last_updated timestamp
  - Includes fefo_warning_threshold_days
- **Confirm Allocation**: POST /api/shipping/sales-orders/:id/allocate
  - Creates inventory_allocations records with correct quantities
  - Updates sales_order status
  - Creates backorder if shortfall
  - Updates license_plates.allocated_quantity
  - Returns undo_until timestamp (5 minutes after allocation)
- **Release Allocation**: POST /api/shipping/sales-orders/:id/release-allocation
  - Deletes inventory_allocations
  - Updates license_plates.allocated_quantity
  - Handles partial release
  - Updates undo_window_expired flag
- **Inventory Refresh**: Re-fetch allocation data without modal close
- **Partial Allocation**: Edit LP quantity, verify summary recalculates

### E2E Tests
- **Happy Path: FIFO Allocation**:
  - Open SO detail â†’ Click [Allocate] â†’ Allocation modal opens
  - Verify freshness indicator shows "Last updated: X seconds ago"
  - Click [Refresh] â†’ Data re-fetches
  - Select FIFO strategy (default)
  - Click [Auto-Allocate] â†’ LPs auto-selected by receipt_date
  - Review allocation summary
  - Click [Allocate Selected] â†’ SO status changes to "allocated", pick list created
  - Verify [Undo] button appears (5-minute window)
  - Verify inventory_allocations created in database
- **Happy Path: FEFO Allocation**:
  - Select FEFO strategy
  - Verify FEFO threshold warning explanation visible
  - Click [Auto-Allocate] â†’ LPs auto-selected by best_before_date
  - Verify LPs with < 7 days expiry marked yellow
  - Verify oldest expiry dates chosen first
- **Happy Path: Partial Allocation + On Hold**:
  - SO requires 1,500 units, only 950 available
  - Auto-allocate â†’ Shows "79.2% allocated"
  - Choose "Set to On Hold - Awaiting Stock"
  - Click [Confirm & Hold] â†’ SO status = "on_hold", backorder created
- **Happy Path: Partial LP Quantity**:
  - Auto-allocate suggests LP-0012 (480 units)
  - Click on "480" field or [Edit Qty] â†’ Edit quantity
  - Change 480 â†’ 200
  - Verify summary recalculates automatically
  - Click [Allocate Selected] â†’ Confirm
- **Happy Path: Manual Override**:
  - Auto-allocate suggests 2 LPs
  - Uncheck 1 LP checkbox
  - Recalculate â†’ Shows new allocation total
  - Click [Allocate Selected] â†’ Confirm
- **Happy Path: Undo Allocation**:
  - Allocate SO â†’ Confirm
  - [Undo] button appears in SO detail (5-minute window)
  - Click [Undo] â†’ Confirm "Release allocation?"
  - SO status changes back to "draft"
  - Inventory freed back to available stock
- **Happy Path: Release Allocation (Anytime)**:
  - SO has allocation
  - Click SO Actions â†’ [Release Allocation]
  - Modal: Reason dropdown + confirm
  - Click [Release] â†’ Inventory freed, audit log created
- **Error: No Available Inventory**:
  - SO requires 300 units, 0 available
  - Allocation modal shows empty LP table
  - Options: [Hold Order] [Check Schedule] [Alternatives]
- **Error: Insufficient Permissions**:
  - Shipping Clerk tries to allocate
  - Error: "You do not have permission"
  - [Request Permission] â†’ Email to manager
- **Error: Stale Inventory Data**:
  - Load allocation modal
  - Wait 5+ minutes
  - Verify "Inventory data may be outdated" warning
  - Click [Refresh] â†’ Data re-fetches
- **Responsive: Mobile Allocation**:
  - Open SO on mobile
  - Allocation modal full-screen
  - Freshness indicator visible at top
  - Scroll through LPs (stacked cards)
  - Batch numbers visible inline
  - Toggle strategy (radio buttons)
  - Click [Edit Qty] â†’ Inline modal opens
  - Click [Allocate] â†’ Confirm on mobile
- **Responsive: Tablet Batch Numbers**:
  - Open on tablet
  - LP table shows batch in tooltip (not column)
  - Hover row â†’ Batch details visible
  - Verify batch clickable â†’ Detail page

### Performance Tests
- **Load Allocation Data**: <500ms for SO with 10 lines
- **FIFO/FEFO Sort**: <200ms (1,000 LPs)
- **FEFO Warning Filter**: <100ms (mark LPs < threshold)
- **Auto-Allocate**: <300ms
- **Confirm Allocation**: <800ms (create 3 inventory_allocations)
- **Release Allocation**: <500ms
- **Refresh Allocation**: <300ms (re-fetch + re-sort)
- **Partial Qty Edit**: <100ms (update summary)

---

## Quality Gates

Before handoff to FRONTEND-DEV:
- [x] All 4 states defined (Loading, Empty, Error, Success)
- [x] Responsive breakpoints documented (Desktop/Tablet/Mobile)
- [x] All API endpoints specified with request/response schemas (3 endpoints)
- [x] Accessibility checklist passed (touch targets, contrast, screen reader, keyboard, ARIA)
- [x] FIFO/FEFO allocation logic documented
- [x] Allocation strategy selector defined (FIFO/FEFO radio buttons)
- [x] LP selection table documented (8 columns + checkbox)
- [x] Allocation summary calculated correctly
- [x] Hold/Backorder decision logic documented
- [x] Manual override (checkbox uncheck) documented
- [x] Insufficient permissions error handled
- [x] Shortfall warning + action options documented
- [x] Validation rules defined (qty, product match, status checks)
- [x] Permission matrix documented (6 roles)
- [x] Error handling strategy defined (API errors, validation, partial failures)
- [x] Performance targets defined (load times, caching strategy)
- [x] Business rules documented (FIFO/FEFO, status transitions, backorder creation)
- [x] Testing requirements defined (unit, integration, E2E, performance)
- [x] MAJOR FIX #1: Undo/Rollback Flow documented (5-minute window + explicit release)
- [x] MAJOR FIX #2: Real-Time Inventory Updates with freshness indicator + [Refresh] button
- [x] MAJOR FIX #3: Partial LP Allocation UI (inline or modal for partial quantities)
- [x] MINOR FIX #4: FEFO Expiry Warning Threshold configurable in System Settings
- [x] MINOR FIX #5: Batch Number Display visibility by breakpoint (desktop/tooltip, tablet/tooltip, mobile/inline)
- [x] MINOR FIX #6: Keyboard Focus Trap specification (focus trapped within modal, Tab cycles, Escape closes)

---

## Handoff to FRONTEND-DEV

```yaml
feature: Inventory Allocation (Auto/Manual with FIFO/FEFO)
story: SHIP-008
prd_coverage: "FR-7.12 (Auto-Allocate), FR-7.18 (Reserved Inventory Tracking)"
approval_status:
  mode: "review_each"
  user_approved: false
  screens_approved: []
  iterations_used: 0
deliverables:
  wireframe: docs/3-ARCHITECTURE/ux/wireframes/SHIP-008-inventory-allocation.md
  api_endpoints:
    - GET /api/shipping/sales-orders/:id/allocations (fetch allocation data with FIFO/FEFO + timestamp)
    - POST /api/shipping/sales-orders/:id/allocate (confirm allocation with undo window)
    - POST /api/shipping/sales-orders/:id/release-allocation (release allocations anytime)
states_per_screen: [loading, empty, error, success]
breakpoints:
  mobile: "<768px (full-screen modal, stacked LP cards, batch inline)"
  tablet: "768-1024px (95vw modal, compact LP table, batch in tooltip)"
  desktop: ">1024px (90vw modal, max 1200px, full LP table, batch column)"
accessibility:
  touch_targets: "48x48dp minimum"
  contrast: "4.5:1 minimum (text, badges)"
  aria_roles: "dialog, radio, checkbox, alert, live regions"
  keyboard_nav: "Tab, Enter, Space, Arrow keys, Escape, Alt+shortcuts"
  focus_trap: "Active within modal, cycles tab order, Escape closes"
modal_components:
  freshness_indicator: "Last updated: X seconds ago [â†» Refresh]"
  allocation_strategy: "FIFO (default) / FEFO radio buttons with FEFO threshold explanation"
  auto_allocate_button: "Auto-suggest by strategy"
  manual_selection_option: "Allow checkbox override + partial qty edit"
  so_line_table: "Product, Qty Required, Qty Available, Status badge"
  lp_table: "LP#, Location, Qty, Receipt Date, Expiry Date, Batch (configurable visibility), Selected Qty"
  partial_qty_edit: "Inline edit (click field) OR modal (click [Edit Qty])"
  allocation_summary: "Total lines, Fully/Partially/Not allocated, Coverage %"
  hold_decision: "On Hold vs. Create Backorder options"
  undo_workflow: "[Undo] button in SO detail (5-min window), [Release Allocation] anytime"
allocation_logic:
  fifo: "Sort by receipt_date ASC, allocate oldest first"
  fefo: "Sort by best_before_date ASC (or mfg_date + shelf_life), apply warning threshold"
  fefo_threshold: "Configurable in System Settings, default: 7 days, mark < threshold as yellow"
  validation: "Product match, qty <= available, status = available, partial qty <= LP qty"
  backorder: "Create on shortfall, notify production planning"
  inventory_freshness: "Timestamp on fetch, auto-refresh OFF by default (configurable), [Refresh] button"
  partial_allocation: "Inline edit or modal for taking < full LP qty"
permissions: 6 roles
  - admin (allocate, release, hold, all actions)
  - shipping_manager (allocate, release, hold)
  - shipping_clerk (view only)
  - sales_manager (allocate, hold, no release)
  - warehouse_manager (view only)
  - viewer (view only)
api_response_fields:
  lp_row: [lp_number, location, on_hand_qty, available_qty, receipt_date, best_before_date, batch_number, expiry_days_remaining]
  so_line: [product_name, qty_required, qty_available, allocation_status, qty_short]
  summary: [total_lines, fully_allocated_count, partially_allocated_count, total_qty_allocated, coverage_pct, last_updated_timestamp]
  fefo_threshold: [fefo_warning_threshold_days]
validation_rules:
  - min_qty: "> 0"
  - max_qty: "<= available_qty"
  - partial_qty: ">= 0 AND <= available_qty"
  - product_match: "same product_id as SO line"
  - status_check: "LP status = available"
  - no_allocated: "cannot re-allocate already-allocated LPs"
  - stale_data: "> 5 minutes old = show warning + [Refresh]"
performance_targets:
  fetch_allocation_data: "<500ms"
  fifo_fefo_sort: "<200ms"
  fefo_threshold_filter: "<100ms"
  auto_allocate: "<300ms"
  confirm_allocation: "<800ms"
  release_allocation: "<500ms"
  refresh_allocation: "<300ms"
  partial_qty_edit: "<100ms"
cache_ttl:
  allocation_data: "1min (with timestamp)"
  lp_availability: "2min"
  backorders: "5min"
  fefo_threshold: "1hour"
error_scenarios:
  - no_available_inventory: "Show empty state with hold/schedule options"
  - insufficient_permissions: "Show read-only view, [Request Permission] button"
  - partial_allocation: "Show shortfall warning, choose hold or backorder"
  - stale_inventory_data: "Show warning: 'Data > 5 min old', [Refresh]"
  - network_error: "Error banner with [Retry]"
  - partial_qty_validation: "Cannot allocate > available from LP"
undo_workflow:
  undo_window: "5 minutes after allocation confirmation"
  location: "[Undo] button in SO detail header"
  explicit_release: "[Release Allocation] in SO action menu (anytime)"
  reason_tracking: "undo_allocation | manual_adjustment | so_cancelled | line_deleted"
  status_update: "allocated â†’ draft on release"
  inventory_restoration: "LP available_quantity restored"
  audit_logging: "Log release action, timestamp, user, reason"
batch_display:
  desktop: "Show in table column OR hover tooltip"
  tablet: "Show in hover tooltip (not column)"
  mobile: "Show inline in card"
  configurable: "User preference toggle in account settings"
  clickable: "Batch number â†’ Batch detail page"
focus_management:
  dialog_role: "aria-modal='true' indicates focus trap"
  tab_order: "Strategy â†’ Auto-Allocate â†’ Manual â†’ SO Lines â†’ LP Table â†’ Summary â†’ Buttons"
  tab_cycle: "Wraps to first element (trapped)"
  escape_close: "Closes modal, returns focus to trigger button"
  accessibility: "aria-label on dialog for screen readers"
fefo_override:
  ui_element: "Checkbox per LP row (when FEFO strategy + yellow warning)"
  label: "â˜ Ignore expiry warning for this LP"
  permission: "Shipping Manager+ only"
  behavior: "When checked, allocation proceeds despite yellow warning"
  default: "Unchecked (warning enforced)"
auto_refresh_setting:
  default_state: "OFF (manual refresh only)"
  location: "User preferences or Organization Settings â†’ Shipping"
  options: "OFF | ON (every 30 seconds)"
  documentation: "Default: OFF. User can enable auto-refresh in settings."
```

---

**Status**: Ready for Review (Pending User Approval)
**Approval Mode**: review_each
**User Approved**: No
**Iterations**: 0 of 3
**Estimated Effort**: 28-36 hours (complex allocation modal with FIFO/FEFO, LP selection, partial allocation, undo workflow, real-time freshness)
**Quality Target**: 96%+ (production-ready allocation UI with all 6 issues fixed)
**PRD Coverage**: 100% (FR-7.12: Auto-allocate, FR-7.18: Reserved Inventory Tracking)
**Wireframe Length**: 1,400+ lines (target: 1,200-1,500 lines) âœ“

---

**KEY FEATURES**:

1. **Real-Time Inventory Freshness** (MAJOR FIX #2):
   - "Last updated: X seconds ago" indicator
   - [â†» Refresh] button to fetch latest data
   - Auto-refresh option OFF by default (configurable in settings)
   - Stale data warning (>5 min old)

2. **Undo/Rollback Workflow** (MAJOR FIX #1):
   - 5-minute undo window after allocation
   - [Undo] button in SO detail
   - Explicit [Release Allocation] anytime
   - Reason tracking + audit logging

3. **Partial LP Allocation UI** (MAJOR FIX #3):
   - Inline edit: Click quantity field, type new amount
   - Modal edit: Click [Edit Qty], enter partial qty
   - Auto-recalculate summary
   - Validation: 0 < qty <= available_qty

4. **FEFO Expiry Warning Threshold** (MINOR FIX #4):
   - Configurable in System Settings (default: 7 days)
   - Yellow warning on LPs < threshold
   - Display: "âš  Expires in X days"
   - Admin override option: â˜ "Ignore expiry warning for this LP"

5. **Batch Number Display** (MINOR FIX #5):
   - Desktop: Show in column OR hover tooltip
   - Tablet: Show in hover tooltip
   - Mobile: Show inline in card
   - User configurable preference
   - Clickable â†’ Batch detail page

6. **Keyboard Focus Trap** (MINOR FIX #6):
   - aria-modal="true" on dialog
   - Tab order: Strategy â†’ Buttons â†’ Summary
   - Tab cycles within modal only
   - Escape closes modal
   - Focus returns to trigger button

---

END OF WIREFRAME
