# UX Design Handoff - Story 01.2

**Story**: 01.2 - Settings Shell: Navigation + Role Guards
**Epic**: 01-Settings
**Phase**: P1 (UX Design) ✅ COMPLETE
**UX Designer**: Auto-Approved Mode
**Date**: 2026-01-04
**Next Phase**: P2 (Test Writing - RED)

---

## Handoff Summary

### Wireframes Delivered: 3

#### 1. SET-000: Settings Landing Page (NEW)
- **File**: `docs/3-ARCHITECTURE/ux/wireframes/SET-000-settings-landing.md`
- **Route**: `/settings`
- **Purpose**: Entry point to Settings module with overview cards and quick navigation
- **Status**: ✅ Auto-Approved
- **Key Features**:
  - Organization summary card with logo, name, location, contact
  - 6 quick access cards (Users & Roles, Infrastructure, Master Data, Integrations, System, Security)
  - Recent activity feed (last 5 audit log entries)
  - Empty state with setup wizard CTA
  - All 4 states defined (loading, empty, error, success)
  - Mobile-responsive (1/2/3 column grid)
  - Permission filtering by role

#### 2. COMP-001: Settings Navigation Sidebar (EXISTING)
- **File**: `docs/3-ARCHITECTURE/ux/wireframes/COMP-001-settings-navigation-sidebar.md`
- **Purpose**: Vertical navigation sidebar for Settings module
- **Status**: ✅ Auto-Approved (2025-12-17)
- **Key Features**:
  - 6 navigation sections (Organization, Users & Roles, Infrastructure, Master Data, Integrations, System)
  - 14 navigation items total
  - Role-based visibility filtering
  - Active state indication
  - Mobile sheet overlay
  - All 4 states defined

#### 3. COMP-003: Settings Layout Component (EXISTING)
- **File**: `docs/3-ARCHITECTURE/ux/wireframes/COMP-003-settings-layout.md`
- **Purpose**: Consistent page wrapper for all Settings pages
- **Status**: ✅ Auto-Approved (2025-12-17)
- **Key Features**:
  - Optional title and description props
  - Standardized spacing (p-6, space-y-6)
  - Semantic h1 heading
  - Mobile-responsive padding
  - No layout shift when title/description added or removed

---

## User Flows

### Flow 1: Admin Accessing Settings
```
1. User clicks "Settings" in main navigation
2. Navigate to /settings
3. Settings Landing Page loads (SET-000)
   - Organization summary displays
   - 6 quick access cards visible
   - Recent activity feed shows last 5 entries
4. User clicks "Manage Users →" on Users & Roles card
5. Navigate to /settings/users
6. Settings Navigation (COMP-001) highlights "Users" item
7. User Management page loads
```

### Flow 2: Non-Admin User Accessing Settings
```
1. Viewer role user clicks "Settings"
2. Navigate to /settings
3. Settings Landing Page loads (SET-000)
   - Organization summary displays (view-only)
   - Only accessible cards visible (filtered by role)
   - Edit Organization Profile link hidden
4. User attempts to navigate to /settings/users
5. useSettingsGuard() hook blocks access
6. Redirect to /dashboard with toast: "Insufficient permissions"
```

### Flow 3: New Organization Setup
```
1. New organization user navigates to /settings
2. Settings Landing Page loads in Empty State
3. Display: "Welcome to MonoPilot! Let's get your organization set up in 15 minutes."
4. User clicks [Start Setup Wizard]
5. Navigate to /settings/onboarding
6. Onboarding wizard step 1 loads
7. User completes 6-step wizard
8. Return to /settings
9. Settings Landing Page loads in Success State with real data
```

---

## Component Specifications

### Settings Landing Page (SET-000)

**Route**: `/settings`
**Layout**: Uses COMP-003 (SettingsLayout) wrapper
**Children**: SettingsDashboard component

**Components**:
1. **OrgSummaryCard**
   - Logo (80x80px)
   - Organization name (text-xl, font-semibold)
   - Location + timezone (text-sm, muted)
   - Contact email + phone (text-sm, muted)
   - Edit link (visible to SUPER_ADMIN, ADMIN only)

2. **QuickAccessCard** (6 instances)
   - Icon (48x48dp emoji or Lucide)
   - Title (text-lg, font-semibold)
   - Description (text-sm, muted)
   - Stats (2-3 metrics, text-sm)
   - Action link ([Manage →])

3. **RecentActivityFeed**
   - Last 5 audit log entries
   - Format: "• {user} {action} {time}"
   - [View All Audit Logs →] link

**API Endpoints**:
- `GET /api/v1/settings/context` (org context)
- `GET /api/v1/settings/dashboard/stats` (card statistics)
- `GET /api/v1/settings/audit-logs?limit=5` (recent activity)

**Performance Targets**:
- Initial load: <500ms
- Recent activity: <300ms
- Card click: <100ms navigation

### Settings Navigation Sidebar (COMP-001)

**Component**: `SettingsNav.tsx`
**Location**: Rendered in Settings module layout

**Navigation Sections (6)**:
1. Organization (1 item)
2. Users & Roles (3 items)
3. Infrastructure (3 items)
4. Master Data (2 items)
5. Integrations (2 items)
6. System (3 items)

**Total Items**: 14

**Dependencies**:
- `useOrgContext()` - Get user role/permissions
- `usePathname()` - Determine active route
- `buildSettingsNavigation(context)` - Service to filter items
- ShadCN Sheet (mobile)
- ShadCN Skeleton (loading)

**Responsive**:
- Desktop (≥768px): Fixed sidebar (256px width)
- Mobile (<768px): Hamburger menu + Sheet overlay

### Settings Layout (COMP-003)

**Component**: `SettingsLayout.tsx`
**Props**:
- `children: React.ReactNode` (required)
- `title?: string` (optional)
- `description?: string` (optional)

**Variants**:
1. Full header (title + description)
2. Title only (no description)
3. Content only (no header)

**Spacing**:
- Container padding: 24px (p-6)
- Vertical spacing: 24px (space-y-6)
- Header spacing: 8px (space-y-2)

---

## Permission Matrix

### Settings Landing Page (SET-000)

| Element | SUPER_ADMIN | ADMIN | Other Roles |
|---------|-------------|-------|-------------|
| Organization Summary | ✓ | ✓ | ✓ (view-only) |
| Edit Org Profile Link | ✓ | ✓ | - |
| Users & Roles Card | ✓ | ✓ | - |
| Infrastructure Card | ✓ | ✓ | Warehouse/Prod Managers only |
| Master Data Card | ✓ | ✓ | Quality Manager only |
| Integrations Card | ✓ | ✓ | - |
| System Card | ✓ | ✓ | - |
| Security Card | ✓ | ✓ | - |
| Recent Activity Feed | ✓ | ✓ | - |

### Settings Navigation (COMP-001)

See COMP-001 wireframe, Section "Permission Filtering" for detailed role-based visibility matrix.

---

## Accessibility Compliance

### WCAG AA Requirements Met

**Touch Targets**:
- Desktop: ≥36px height
- Mobile: ≥48dp height

**Contrast Ratios**:
- Text on background: 7:1 (foreground)
- Muted text: 4.5:1 (muted-foreground)
- Active items: 4.5:1 (primary on primary-foreground)

**Semantic HTML**:
- `<main>` for page container
- `<h1>` for page title
- `<h2>` for section headings
- `<nav>` for navigation sidebar
- `<article>` for cards
- `<a>` or `<Link>` for all clickable elements

**Keyboard Navigation**:
- Tab order: top to bottom, left to right
- Enter key activates links
- Focus indicators: 2px visible outline

**Screen Reader**:
- Page announcements: "Settings dashboard, main navigation for configuration"
- Card announcements: "{Title} card, {stats}, {action} link"
- Navigation announcements: "Settings navigation menu, 6 sections, 14 items"

---

## Responsive Breakpoints

### Settings Landing Page

| Breakpoint | Layout | Card Grid |
|------------|--------|-----------|
| Desktop (≥1024px) | 3 columns | gap-6, ~280px each |
| Tablet (768-1024px) | 2 columns | gap-6, ~320px each |
| Mobile (<768px) | 1 column | gap-4, full width |

### Settings Navigation

| Breakpoint | Display |
|------------|---------|
| Desktop (≥768px) | Fixed sidebar (256px) |
| Tablet (768-1024px) | Fixed sidebar (256px) |
| Mobile (<768px) | Hamburger menu + Sheet overlay |

---

## Testing Requirements

### Visual Regression Tests
- [ ] Settings Landing Page renders correctly (all 4 states)
- [ ] Settings Navigation renders correctly (all 4 states)
- [ ] Settings Layout renders with title + description
- [ ] Settings Layout renders with title only
- [ ] Settings Layout renders with children only

### Interaction Tests
- [ ] Clicking quick access card navigates to correct page
- [ ] Clicking edit org profile navigates to /settings/organization
- [ ] Clicking [View All Audit Logs →] navigates to /settings/audit-logs
- [ ] Mobile hamburger menu opens/closes sheet
- [ ] Navigation item click activates correct route
- [ ] Active navigation item highlights correctly

### Permission Tests
- [ ] SUPER_ADMIN sees all cards and links
- [ ] ADMIN sees all cards and links
- [ ] VIEWER sees only organization summary (no edit link)
- [ ] WAREHOUSE_MANAGER sees only Infrastructure card
- [ ] QUALITY_MANAGER sees only Master Data card
- [ ] Non-admin role redirected from protected routes

### Accessibility Tests
- [ ] All touch targets ≥48dp (mobile)
- [ ] Contrast ratios pass WCAG AA
- [ ] Keyboard navigation works (Tab, Enter)
- [ ] Screen reader announces page correctly
- [ ] Focus indicators visible

### Performance Tests
- [ ] Settings Landing Page loads in <500ms
- [ ] Navigation sidebar loads in <300ms
- [ ] Card click navigation <100ms

---

## Dependencies

### Story Dependencies
- **01.1**: Org Context + Base RLS (COMPLETE)
  - Provides: `GET /api/v1/settings/context` endpoint
  - Provides: `useOrgContext()` hook
  - Provides: organizations, users, roles tables

### External Dependencies
- ShadCN UI components: Sheet, Skeleton, Card, Button
- Lucide icons: Users, Factory, AlertTriangle, Link, Puzzle, Lock
- Next.js: Link, usePathname
- Supabase Realtime (optional for live updates)

---

## File Structure

```
apps/frontend/
├── app/(authenticated)/
│   └── settings/
│       ├── layout.tsx (renders COMP-001 + COMP-003)
│       └── page.tsx (implements SET-000)
├── components/settings/
│   ├── SettingsNav.tsx (COMP-001)
│   ├── SettingsLayout.tsx (COMP-003)
│   ├── SettingsDashboard.tsx (SET-000 children)
│   ├── OrgSummaryCard.tsx
│   ├── QuickAccessCard.tsx
│   └── RecentActivityFeed.tsx
└── lib/services/
    └── settings-navigation-service.ts
```

---

## Acceptance Criteria Mapping

| AC | Wireframe | Status |
|----|-----------|--------|
| User with Admin role sees all settings sections | COMP-001, SET-000 | ✅ Designed |
| User with Viewer role blocked from admin routes | COMP-001 (permission filtering) | ✅ Designed |
| Settings landing page loads with navigation | SET-000 | ✅ Designed |
| Non-admin blocked from admin-only routes | COMP-001 (useSettingsGuard hook) | ✅ Designed |
| Unimplemented routes show "coming soon" | COMP-001 (disabled items) | ✅ Designed |
| Module toggles hide/disable navigation sections | COMP-001 (buildSettingsNavigation service) | ✅ Designed |

---

## Design Decisions

### Decision 1: Landing Page vs Direct Navigation
**Choice**: Provide landing page with overview cards
**Rationale**:
- Improves discoverability of Settings features
- Provides context for new users
- Shows organization summary at a glance
- Matches modern SaaS patterns (Stripe, Shopify)

### Decision 2: Quick Access Cards vs Full Page List
**Choice**: 6 categorized cards with stats
**Rationale**:
- Visual hierarchy guides users to common tasks
- Stats provide immediate value (user count, warehouse count)
- Cards are mobile-friendly (stacks on small screens)
- Reduces cognitive load vs long list of links

### Decision 3: Recent Activity on Landing Page
**Choice**: Include last 5 audit log entries
**Rationale**:
- Provides transparency for admin actions
- Useful for multi-user teams
- Encourages audit log usage
- Fits "dashboard" mental model

### Decision 4: Auto-Approve Mode
**Choice**: User opted for auto-approve (no iteration required)
**Rationale**:
- Settings shell is foundational (patterns established)
- Existing wireframes (COMP-001, COMP-003) already approved
- New wireframe (SET-000) follows established patterns
- Faster delivery for Phase 1A MVP

---

## Next Steps (Phase P2)

### For Test Writer
1. Read this handoff document
2. Read wireframes: SET-000, COMP-001, COMP-003
3. Write unit tests for:
   - `buildSettingsNavigation()` service (permission filtering)
   - `useSettingsGuard()` hook (role-based access)
   - Dashboard stats aggregation
4. Write integration tests for:
   - Settings routing (/settings, /settings/users, etc.)
   - Redirect behavior for non-admin users
   - Navigation active state updates
5. Create test fixtures for organization context
6. Aim for ≥80% test coverage

### For Frontend Developer
1. Implement SET-000 (Settings Landing Page)
2. Verify COMP-001 and COMP-003 exist and match wireframes
3. Create `settings-navigation-service.ts`
4. Create `useSettingsGuard()` hook
5. Implement permission filtering logic
6. Add API endpoints:
   - `GET /api/v1/settings/dashboard/stats`
   - `GET /api/v1/settings/audit-logs?limit=5`
7. Ensure all 4 states render correctly
8. Test mobile responsiveness
9. Verify accessibility compliance

---

## Blockers

**None** - All dependencies satisfied (Story 01.1 complete)

---

## Open Questions

**None** - Auto-approve mode selected, all design decisions made

---

## Approval

**UX Designer**: ✅ Approved (Auto-Approve Mode)
**User**: ✅ Approved (Explicit opt-in for auto-approve)
**Iterations**: 0 of 3
**Ready for Phase P2**: Yes

---

**Handoff Complete**: 2026-01-04 14:35
**Next Agent**: TEST-WRITER
**Next Phase**: P2 (RED - Write Tests)
