# Story 01.9 - Frontend Specification
# Purpose: Components, hooks, types, tree view UI
# Agent: FRONTEND-DEV (components/UX focus)

# Page
page:
  path: "apps/frontend/app/(authenticated)/settings/warehouses/[id]/locations/page.tsx"
  description: "Locations list page with hierarchical tree view"
  layout:
    left_panel:
      width: "40%"
      content: "Location tree (expandable/collapsible)"
    right_panel:
      width: "60%"
      content: "Selected location details/form"
    toolbar:
      - "Create button"
      - "Type filter dropdown"
      - "Search input"
    actions:
      - "Edit"
      - "Delete"
      - "Add Child"

# TypeScript Types
types:
  - path: "apps/frontend/lib/types/location.ts"
    content: |
      export type LocationLevel = 'zone' | 'aisle' | 'rack' | 'bin';
      export type LocationType = 'bulk' | 'pallet' | 'shelf' | 'floor' | 'staging';

      export interface Location {
        id: string;
        org_id: string;
        warehouse_id: string;
        parent_id: string | null;
        code: string;
        name: string;
        description: string | null;
        level: LocationLevel;
        full_path: string;
        depth: number;
        location_type: LocationType;
        max_pallets: number | null;
        max_weight_kg: number | null;
        current_pallets: number;
        current_weight_kg: number;
        is_active: boolean;
        created_at: string;
        updated_at: string;
      }

      export interface LocationNode extends Location {
        children: LocationNode[];
        children_count: number;
        capacity_percent: number | null;
      }

      export interface LocationTreeResponse {
        locations: LocationNode[];
        total_count: number;
      }

      export interface CreateLocationInput {
        code: string;
        name: string;
        description?: string;
        parent_id?: string | null;
        level: LocationLevel;
        location_type?: LocationType;
        max_pallets?: number | null;
        max_weight_kg?: number | null;
        is_active?: boolean;
      }

      export interface UpdateLocationInput {
        name?: string;
        description?: string;
        location_type?: LocationType;
        max_pallets?: number | null;
        max_weight_kg?: number | null;
        is_active?: boolean;
      }

      export interface LocationListParams {
        view?: 'tree' | 'flat';
        level?: LocationLevel;
        type?: LocationType;
        parent_id?: string | null;
        search?: string;
        include_capacity?: boolean;
      }

# Components
components:
  - path: "components/settings/locations/LocationTree.tsx"
    description: "Hierarchical tree view with expand/collapse"
    props:
      warehouseId: "string"
      locations: "LocationNode[]"
      selectedId: "string | undefined"
      onSelect: "(location: LocationNode) => void"
      onExpand: "(locationId: string) => void"
      expandedIds: "Set<string>"
    features:
      - "Expandable/collapsible tree nodes"
      - "Level-based indentation (16px per level)"
      - "Location type icons (different per type)"
      - "Capacity indicator bars on each node"
      - "Click to select, double-click to edit"
      - "Drag-and-drop for reordering (Phase 2)"

  - path: "components/settings/locations/LocationModal.tsx"
    description: "Create/Edit form modal"
    props:
      open: "boolean"
      onOpenChange: "(open: boolean) => void"
      warehouseId: "string"
      parentLocation: "Location | undefined"
      location: "Location | undefined"  # Edit mode if provided
      onSuccess: "() => void"
    form_sections:
      - section: "Identity"
        fields: ["code", "name", "description"]
      - section: "Hierarchy"
        fields: ["parent_id (dropdown)", "level (auto-set from parent)"]
      - section: "Type"
        fields: ["location_type (dropdown with descriptions)"]
      - section: "Capacity"
        fields: ["max_pallets", "max_weight_kg"]
      - section: "Status"
        fields: ["is_active (toggle)"]

  - path: "components/settings/locations/CapacityIndicator.tsx"
    description: "Visual capacity indicator with color states"
    props:
      current: "number"
      max: "number | null"
      unit: "'pallets' | 'kg'"
      size: "'sm' | 'md'"
    visual_states:
      green: "0-69% (normal)"
      yellow: "70-89% (warning)"
      red: "90-100% (full)"
      none: "max is null (unlimited)"

  - path: "components/settings/locations/LocationBreadcrumb.tsx"
    description: "Breadcrumb path display with navigation"
    props:
      fullPath: "string"  # e.g., "WH-001/ZONE-A/A01/R01/B001"
      onClick: "(segment: string, index: number) => void (optional)"
    display: "WH-001 > ZONE-A > A01 > R01 > B001"
    behavior:
      - "Each segment clickable to navigate to that level"
      - "Current segment (last) is bold/highlighted"

  - path: "components/settings/locations/LocationRow.tsx"
    description: "Single location row in tree"
    props:
      location: "LocationNode"
      level: "number"
      isSelected: "boolean"
      isExpanded: "boolean"
      onSelect: "() => void"
      onExpand: "() => void"
    display:
      - "Indentation based on depth"
      - "Expand/collapse icon (if has children)"
      - "Location type icon"
      - "Code and name"
      - "Capacity indicator (if has limits)"
      - "Actions menu (edit, delete, add child)"

# Hooks
hooks:
  - path: "apps/frontend/lib/hooks/use-location-tree.ts"
    description: "React Query hook for location tree data"
    exports:
      - name: "useLocationTree"
        params: "warehouseId: string, params: LocationListParams"
        returns: "UseQueryResult<LocationTreeResponse>"
    features:
      - "Fetches tree structure"
      - "Caches with 5 min staleTime"
      - "Refetch on warehouse change"

  - path: "apps/frontend/lib/hooks/use-location-form.ts"
    description: "Form state and validation for location modal"
    exports:
      - name: "useLocationForm"
        params: "warehouseId: string, location?: Location"
        returns: "{ form, onSubmit, isLoading }"

# UX Notes
ux:
  wireframes: []  # No wireframes specified in story
  patterns:
    tree: "Expandable tree with nested indentation"
    modal: "ShadCN Dialog pattern for create/edit"
    capacity: "Progress bar with color states"
    breadcrumb: "Breadcrumb with clickable segments"
  states:
    loading: "Skeleton loader for tree nodes"
    empty: "Empty state - 'No locations. Create first zone.'"
    error: "Error banner with retry button"
    success: "Toast notification on create/update/delete"
  interactions:
    expand: "Click expand icon or arrow key"
    select: "Single click on row"
    edit: "Double-click or menu action"
    delete: "Menu action with confirmation dialog"
    add_child: "Menu action - opens modal with parent pre-selected"

# Validation (Frontend)
validation:
  code:
    - "Required"
    - "Uppercase transformation"
    - "Regex: ^[A-Z0-9-]+$"
  name:
    - "Required"
    - "Min 2 characters"
  level:
    - "Required"
    - "Auto-set from parent level + 1"
  hierarchy:
    - "Root must be zone"
    - "Zone children must be aisle"
    - "Aisle children must be rack"
    - "Rack children must be bin"
    - "Bin cannot have children"
  capacity:
    - "max_pallets must be positive or null"
    - "max_weight_kg must be positive or null"

# Accessibility
accessibility:
  tree_navigation:
    - "Keyboard navigation: arrow keys to expand/collapse"
    - "Tab navigation through actions"
    - "Screen reader: announce level and children count"
  modal:
    - "Focus trap within modal"
    - "Escape to close"
    - "Enter to submit"
  capacity_indicator:
    - "Aria-label with capacity text"
    - "Color not sole indicator (use icons/text)"

# Performance
performance:
  tree_loading:
    - "Lazy-load children on expand"
    - "Virtualization for large trees (>1000 nodes)"
  caching:
    - "Cache expanded state in sessionStorage"
    - "Cache tree data with React Query (5 min)"
  optimistic_updates:
    - "Optimistic UI update on create/edit"
    - "Rollback on error"
