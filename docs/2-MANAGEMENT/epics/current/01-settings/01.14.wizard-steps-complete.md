# 01.14 - Wizard Steps Complete (Steps 2-6)

| Field | Value |
|-------|-------|
| **Story ID** | 01.14 |
| **Epic** | 01 - Settings |
| **Status** | Ready |
| **Phase** | 1A |
| **Complexity** | L (Large) |
| **Estimate** | 5-7 days |
| **Type** | Full-stack |
| **Competitive Differentiator** | YES - "15-minute onboarding" promise |

---

## PRD References

| FR ID | Requirement | Priority | Phase | Coverage |
|-------|-------------|----------|-------|----------|
| FR-SET-182 | First warehouse creation step (Step 2) | P0 | 1A | FULL |
| FR-SET-183 | First location setup step (Step 3) | P0 | 1A | FULL |
| FR-SET-184 | First product creation step (Step 4) | P0 | 1A | FULL |
| FR-SET-185 | First work order creation step (Step 5 - OPTIONAL) | P0 | 1A | FULL |
| FR-SET-188 | Wizard completion celebration (Step 6) | P0 | 1A | FULL |
| FR-SET-186 | Wizard progress tracking | P0 | 1A | PARTIAL (framework in 01.3) |
| FR-SET-187 | Skip wizard option | P0 | 1A | PARTIAL (framework in 01.3) |

**Primary PRD:** `docs/1-BASELINE/product/modules/settings.md`

---

## User Story

**As a** new organization administrator completing initial setup,
**I want to** complete the remaining wizard steps (warehouse, locations, product, work order, celebration),
**So that** I can start using MonoPilot within 15 minutes with real data configured for my operation.

---

## Dependencies

| Dependency | Story | Type | Reason |
|------------|-------|------|--------|
| Wizard Framework | 01.3 | HARD | Provides modal shell, step navigation, progress tracking |
| Org Profile Step | 01.4 | HARD | Step 1 must complete before Step 2 begins |
| Warehouses CRUD | 01.8 | HARD | Step 2 creates warehouse using warehouse service |
| Locations CRUD | 01.9 | HARD | Step 3 creates locations using location service |
| Org Context + RLS | 01.1 | HARD | All wizard data requires org context |
| Settings Shell | 01.2 | SOFT | Modal mounting point |

**Note:** Stories 01.8 and 01.9 are Phase 1B, but wizard calls their creation APIs early. The wizard uses simplified forms with sensible defaults, not full CRUD UIs.

**Dependents:**
- None (wizard completion is terminal)

---

## Acceptance Criteria (Gherkin)

### Step 2: First Warehouse (FR-SET-182)

```gherkin
Feature: Wizard Step 2 - First Warehouse Creation
  As a new admin
  I want to create my first warehouse
  So that I have a location to store inventory

  Background:
    Given wizard step 1 (Organization Profile) is complete
    And wizard advances to step 2

  Scenario: Pre-filled warehouse defaults
    Given wizard is on step 2 (Warehouse)
    Then warehouse code field shows pre-filled value "WH-MAIN"
    And warehouse code field is editable
    And warehouse name field is empty (required)
    And warehouse type dropdown defaults to "General"
    And warehouse type dropdown shows tooltip on each option

  Scenario: Warehouse type tooltips
    Given wizard is on step 2
    When user hovers over warehouse type dropdown options
    Then tooltips explain each type:
      | Type            | Tooltip                                        |
      | General         | Multi-purpose warehouse (recommended for start) |
      | Raw Materials   | Store incoming ingredients and packaging        |
      | Work in Progress| For items currently in production               |
      | Finished Goods  | Completed products ready for shipping           |
      | Quarantine      | Items on hold for quality inspection            |

  Scenario: Create warehouse with valid data
    Given wizard is on step 2
    When user enters warehouse name "Main Warehouse"
    And user keeps code "WH-MAIN" and type "General"
    And user clicks "Next"
    Then warehouse record is created with:
      | code      | WH-MAIN        |
      | name      | Main Warehouse |
      | type      | GENERAL        |
      | is_default| true           |
      | is_active | true           |
    And wizard_progress updates step_2_warehouse_id
    And wizard advances to step 3 (Location)

  Scenario: Required field validation
    Given wizard is on step 2
    When user leaves warehouse name empty
    And user clicks "Next"
    Then error message "Warehouse name is required" displays
    And wizard does not advance

  Scenario: Skip warehouse step (use demo data)
    Given wizard is on step 2
    When user clicks "Skip - Use Demo Warehouse"
    Then demo warehouse is created:
      | code      | DEMO-WH        |
      | name      | Demo Warehouse |
      | type      | GENERAL        |
      | is_default| true           |
    And info toast displays "Demo warehouse created. You can edit it later in Settings."
    And wizard advances to step 3

  Scenario: Navigate back to organization profile
    Given wizard is on step 2
    When user clicks "Back"
    Then wizard returns to step 1
    And previously entered warehouse data is preserved in session state
```

### Step 3: First Location (FR-SET-183)

```gherkin
Feature: Wizard Step 3 - First Location Setup
  As a new admin
  I want to create storage locations
  So that I can organize inventory in my warehouse

  Background:
    Given wizard step 2 (Warehouse) is complete
    And warehouse exists (either user-created or demo)
    And wizard advances to step 3

  Scenario: Location template selection display
    Given wizard is on step 3 (Location)
    Then template selector displays with 4 options:
      | Template          | Description                           | Locations Created |
      | Simple - 1 Zone   | Single location for small operations  | 1                 |
      | Basic - 3 Zones   | Receiving, Storage, Shipping          | 3                 |
      | Full - 9 Locations| 3 zones with 3 locations each         | 9                 |
      | Custom            | Create your own structure             | User-defined      |
    And "Simple - 1 Zone" is pre-selected by default

  Scenario: Create simple location (1 zone)
    Given wizard is on step 3
    And "Simple - 1 Zone" template is selected
    When user clicks "Next"
    Then location is created:
      | code          | RECEIVING      |
      | name          | Receiving Area |
      | level         | zone           |
      | location_type | staging        |
    And wizard advances to step 4 (Product)

  Scenario: Create basic locations (3 zones)
    Given wizard is on step 3
    When user selects "Basic - 3 Zones" template
    And user clicks "Next"
    Then 3 locations are created:
      | code      | name             | level | location_type |
      | RECEIVING | Receiving Area   | zone  | staging       |
      | STORAGE   | Storage Area     | zone  | bulk          |
      | SHIPPING  | Shipping Area    | zone  | staging       |
    And wizard advances to step 4

  Scenario: Create full hierarchy (9 locations)
    Given wizard is on step 3
    When user selects "Full - 9 Locations" template
    And user clicks "Next"
    Then 9 locations are created:
      | code        | name              | level | parent    |
      | RAW-ZONE    | Raw Materials     | zone  | null      |
      | RAW-A1      | Raw Aisle 1       | aisle | RAW-ZONE  |
      | RAW-A1-R1   | Raw Rack 1        | rack  | RAW-A1    |
      | PROD-ZONE   | Production        | zone  | null      |
      | PROD-A1     | Prod Aisle 1      | aisle | PROD-ZONE |
      | PROD-A1-R1  | Prod Rack 1       | rack  | PROD-A1   |
      | FG-ZONE     | Finished Goods    | zone  | null      |
      | FG-A1       | FG Aisle 1        | aisle | FG-ZONE   |
      | FG-A1-R1    | FG Rack 1         | rack  | FG-A1     |
    And wizard advances to step 4

  Scenario: Custom location creation
    Given wizard is on step 3
    When user selects "Custom" template
    Then custom location form appears with fields:
      | Field         | Required | Default       |
      | Code          | Yes      | (empty)       |
      | Name          | Yes      | (empty)       |
      | Location Type | Yes      | "shelf"       |
    And "Add Location" button is available
    And location preview list shows added locations

  Scenario: Add multiple custom locations
    Given user is in custom location mode
    When user enters code "SHELF-A1", name "Shelf A1", type "shelf"
    And user clicks "Add Location"
    Then location appears in preview list
    And form clears for next entry
    When user enters code "SHELF-A2", name "Shelf A2", type "shelf"
    And user clicks "Add Location"
    Then 2 locations appear in preview list
    When user clicks "Next"
    Then both locations are created
    And wizard advances to step 4

  Scenario: Skip location step
    Given wizard is on step 3
    When user clicks "Skip - Create Locations Later"
    Then default location is created:
      | code          | DEFAULT          |
      | name          | Default Location |
      | level         | zone             |
      | location_type | bulk             |
    And info toast displays "Default location created."
    And wizard advances to step 4
```

### Step 4: First Product (FR-SET-184)

```gherkin
Feature: Wizard Step 4 - First Product Creation
  As a new admin
  I want to create my first product
  So that I can start planning production

  Background:
    Given wizard steps 1-3 are complete
    And wizard advances to step 4

  Scenario: Industry template selection
    Given wizard is on step 4 (Product)
    Then industry selector displays with options:
      | Industry        | Icon     |
      | Bakery          | bread    |
      | Dairy           | milk     |
      | Meat Processing | meat     |
      | Beverages       | drink    |
      | Snacks          | cookie   |
      | Other           | package  |
    And no industry is pre-selected
    And "Start from Scratch" option is available

  Scenario: Select bakery industry templates
    Given wizard is on step 4
    When user selects "Bakery" industry
    Then product template dropdown shows:
      | Template    | Pre-filled Values                                    |
      | Bread Loaf  | Type: Finished Good, UOM: EA, Shelf Life: 7 days    |
      | Pastry      | Type: Finished Good, UOM: EA, Shelf Life: 3 days    |
      | Cookie      | Type: Finished Good, UOM: EA, Shelf Life: 14 days   |
      | Cake        | Type: Finished Good, UOM: EA, Shelf Life: 5 days    |

  Scenario: Select dairy industry templates
    Given wizard is on step 4
    When user selects "Dairy" industry
    Then product template dropdown shows:
      | Template | Pre-filled Values                                   |
      | Milk     | Type: Finished Good, UOM: L, Shelf Life: 14 days    |
      | Cheese   | Type: Finished Good, UOM: KG, Shelf Life: 90 days   |
      | Yogurt   | Type: Finished Good, UOM: EA, Shelf Life: 21 days   |
      | Butter   | Type: Finished Good, UOM: KG, Shelf Life: 60 days   |

  Scenario: Select meat processing industry templates
    Given wizard is on step 4
    When user selects "Meat Processing" industry
    Then product template dropdown shows:
      | Template  | Pre-filled Values                                  |
      | Sausage   | Type: Finished Good, UOM: KG, Shelf Life: 14 days  |
      | Ham       | Type: Finished Good, UOM: KG, Shelf Life: 21 days  |
      | Bacon     | Type: Finished Good, UOM: KG, Shelf Life: 28 days  |
      | Deli Meat | Type: Finished Good, UOM: KG, Shelf Life: 7 days   |

  Scenario: Select beverages industry templates
    Given wizard is on step 4
    When user selects "Beverages" industry
    Then product template dropdown shows:
      | Template     | Pre-filled Values                                  |
      | Juice        | Type: Finished Good, UOM: L, Shelf Life: 30 days   |
      | Soft Drink   | Type: Finished Good, UOM: L, Shelf Life: 180 days  |
      | Water        | Type: Finished Good, UOM: L, Shelf Life: 365 days  |
      | Energy Drink | Type: Finished Good, UOM: L, Shelf Life: 365 days  |

  Scenario: Create product from template
    Given wizard is on step 4
    And user selected "Bakery" industry and "Bread Loaf" template
    Then form pre-fills:
      | Field           | Value         |
      | Product Type    | Finished Good |
      | Unit of Measure | EA (Each)     |
      | Shelf Life Days | 7             |
      | Storage Temp    | Ambient       |
    When user enters product name "Whole Wheat Bread"
    And user enters SKU "WWB-001"
    And user clicks "Create Product"
    Then product is created in products table
    And wizard_progress updates step_4_product_id
    And wizard advances to step 5

  Scenario: Modify pre-filled values
    Given template pre-fills shelf life as 7 days
    When user changes shelf life to 5 days
    And user clicks "Create Product"
    Then product is created with shelf life 5 days

  Scenario: Start from scratch (no template)
    Given wizard is on step 4
    When user clicks "Start from Scratch"
    Then empty product form displays with fields:
      | Field           | Required | Default        |
      | SKU             | Yes      | (empty)        |
      | Product Name    | Yes      | (empty)        |
      | Product Type    | Yes      | Finished Good  |
      | Unit of Measure | Yes      | EA             |
      | Shelf Life Days | No       | (empty)        |
      | Storage Temp    | No       | Ambient        |
    And helper tooltips explain each field

  Scenario: SKU validation - duplicate
    Given product with SKU "WWB-001" already exists
    When user enters SKU "WWB-001"
    And user clicks "Create Product"
    Then error "SKU already exists" displays
    And product is not created

  Scenario: SKU validation - format
    Given wizard is on step 4
    When user enters SKU "invalid sku!"
    Then inline error "SKU must be uppercase alphanumeric with hyphens only" displays

  Scenario: Required field validation
    Given wizard is on step 4
    When user leaves product name empty
    And user clicks "Create Product"
    Then error "Product name is required" displays

  Scenario: Skip product step
    Given wizard is on step 4
    When user clicks "Skip - Create Products Later"
    Then no product is created
    And wizard_progress sets step_4_skipped = true
    And info toast displays "You can create products anytime in Technical module."
    And wizard advances to step 5
```

### Step 5: First Work Order (FR-SET-185) - OPTIONAL

```gherkin
Feature: Wizard Step 5 - First Work Order (Optional Demo)
  As a new admin
  I want to see how work orders work
  So that I understand the production process

  Background:
    Given wizard steps 1-4 are complete
    And wizard advances to step 5

  Scenario: Work order available (product was created)
    Given product "Whole Wheat Bread" (WWB-001) was created in step 4
    When wizard loads step 5 (Work Order)
    Then work order form displays with:
      | Field       | Default          | Editable |
      | Product     | WWB-001          | No       |
      | Quantity    | 100              | Yes      |
      | Due Date    | Tomorrow         | Yes      |
      | Priority    | Normal           | Yes      |
    And "Create Demo Work Order" button is enabled
    And explanatory text displays "See how production planning works"

  Scenario: Create demo work order
    Given wizard is on step 5 with product available
    When user enters quantity "50"
    And user selects due date "next week"
    And user clicks "Create Demo Work Order"
    Then work order is created:
      | status   | Draft    |
      | quantity | 50       |
      | priority | Normal   |
    And wizard_progress updates step_5_work_order_id
    And success message displays "Demo work order created! You'll find it in Planning."
    And wizard advances to step 6 (Completion)

  Scenario: Work order field tooltips
    Given wizard is on step 5
    Then tooltips explain:
      | Field    | Tooltip                                    |
      | Quantity | How many units to produce                  |
      | Due Date | When production should complete            |
      | Status   | Work orders start as Draft until scheduled |
      | Priority | Normal, High, or Urgent                    |

  Scenario: No product created - work order disabled
    Given step 4 was skipped (no product created)
    When wizard loads step 5
    Then message displays "Create a product first to demo work orders"
    And work order form fields are disabled
    And "Create Demo Work Order" button is disabled
    And "Skip to Finish" button is available and prominent

  Scenario: Skip work order step (product exists)
    Given wizard is on step 5
    And product was created
    When user clicks "Skip - I'll Create Work Orders Later"
    Then no work order is created
    And wizard_progress sets step_5_skipped = true
    And wizard advances to step 6

  Scenario: Skip to finish (no product)
    Given wizard is on step 5
    And no product was created
    When user clicks "Skip to Finish"
    Then wizard advances to step 6
```

### Step 6: Wizard Completion Celebration (FR-SET-188)

```gherkin
Feature: Wizard Step 6 - Completion Celebration
  As a new admin who completed setup
  I want to see what I accomplished
  So that I feel confident using MonoPilot

  Background:
    Given all wizard steps completed or skipped
    And wizard advances to step 6 (Completion)

  Scenario: Display celebration animation
    Given wizard reaches step 6
    Then confetti animation plays for 3 seconds
    And celebration music note icon pulses
    And large checkmark animates in

  Scenario: Display completion summary
    Given user created:
      | Entity     | Name               | Code       |
      | Warehouse  | Main Warehouse     | WH-MAIN    |
      | Locations  | 3 zones            | -          |
      | Product    | Whole Wheat Bread  | WWB-001    |
      | Work Order | WO-0001            | Draft      |
    When wizard shows completion summary
    Then summary displays:
      """
      Congratulations! MonoPilot is ready.

      You created:
      - Organization: Bakery Fresh Ltd
      - Warehouse: Main Warehouse (WH-MAIN)
      - Locations: 3 zones
      - Product: Whole Wheat Bread (WWB-001)
      - Work Order: WO-0001 (Demo)

      Setup completed in: 12 minutes 34 seconds
      """

  Scenario: Summary shows skipped items
    Given user skipped product creation (step 4)
    When wizard shows completion summary
    Then summary shows:
      | Entity     | Status              |
      | Warehouse  | Main Warehouse      |
      | Locations  | 3 zones             |
      | Product    | (skipped)           |
      | Work Order | (requires product)  |

  Scenario: Speed setup champion badge (under 15 minutes)
    Given wizard started at 10:00:00
    And wizard completed at 10:12:34
    Then badge displays: "Speed Setup Champion!"
    And badge tooltip: "You completed setup in under 15 minutes"
    And badge is animated (subtle glow)
    And achievement is stored in organization.badges JSONB

  Scenario: Standard completion (over 15 minutes)
    Given wizard started at 10:00:00
    And wizard completed at 10:18:45
    Then no speed badge displays
    And completion message is still celebratory
    And time displays: "Setup completed in: 18 minutes 45 seconds"

  Scenario: Suggested next steps
    Given wizard completion screen displays
    Then next steps section shows:
      | Action              | Description                  | Button        | Link                   |
      | Add Team Members    | Invite your team to MonoPilot| Invite Users  | /settings/users        |
      | Create More Products| Build your product catalog   | Go to Products| /technical/products    |
      | Schedule Production | Plan your first production   | Open Planning | /planning              |
      | Explore Settings    | Fine-tune your configuration | Open Settings | /settings              |

  Scenario: Next steps contextual based on what was created
    Given user skipped product creation
    Then next steps prominently shows:
      | Action                     | Prominence |
      | Create Your First Product  | Primary    |
    And other actions are secondary

  Scenario: Next steps for demo data users
    Given user used demo warehouse (DEMO-WH)
    Then next steps prominently shows:
      | Action                 | Prominence |
      | Replace Demo Data      | Primary    |
    And tooltip explains "Update demo warehouse with your real data"

  Scenario: Close wizard and go to dashboard
    Given wizard completion screen displays
    When user clicks "Go to Dashboard"
    Then wizard modal closes permanently
    And organizations.onboarding_completed_at is set to NOW()
    And organizations.wizard_completed is set to true
    And user lands on main dashboard
    And dashboard shows dismissible welcome banner

  Scenario: Welcome banner on dashboard
    Given wizard just completed
    When user lands on dashboard
    Then welcome banner displays:
      """
      Welcome to MonoPilot! Setup complete.
      Here are some quick actions to get started...
      [Dismiss]
      """
    And banner can be permanently dismissed
```

---

## Technical Specification

### Database Schema Additions

```sql
-- Add wizard_progress JSONB to organizations table
ALTER TABLE organizations ADD COLUMN IF NOT EXISTS wizard_progress JSONB DEFAULT '{}'::jsonb;

-- wizard_progress structure:
-- {
--   "step_1": { "completed_at": "timestamp", "org_name": "..." },
--   "step_2": { "completed_at": "timestamp", "warehouse_id": "uuid", "skipped": false },
--   "step_3": { "completed_at": "timestamp", "location_ids": ["uuid"], "template": "basic", "skipped": false },
--   "step_4": { "completed_at": "timestamp", "product_id": "uuid", "skipped": false },
--   "step_5": { "completed_at": "timestamp", "work_order_id": "uuid", "skipped": true },
--   "step_6": { "completed_at": "timestamp", "duration_seconds": 754, "badge": "speed_champion" }
-- }

-- Add badges JSONB to organizations for achievements
ALTER TABLE organizations ADD COLUMN IF NOT EXISTS badges JSONB DEFAULT '[]'::jsonb;

-- Badge structure:
-- [
--   { "code": "speed_champion", "name": "Speed Setup Champion", "earned_at": "timestamp" }
-- ]
```

### Step State Machine

```typescript
// Wizard step states
type WizardStepState = 'pending' | 'active' | 'completed' | 'skipped';

interface WizardStep {
  step: number;
  name: string;
  state: WizardStepState;
  required: boolean;
  data?: Record<string, unknown>;
}

const WIZARD_STEPS: WizardStep[] = [
  { step: 1, name: 'Organization Profile', state: 'pending', required: true },
  { step: 2, name: 'First Warehouse', state: 'pending', required: true },
  { step: 3, name: 'Storage Locations', state: 'pending', required: true },
  { step: 4, name: 'First Product', state: 'pending', required: false },
  { step: 5, name: 'Demo Work Order', state: 'pending', required: false },
  { step: 6, name: 'Completion', state: 'pending', required: true },
];

// State transitions
const validTransitions: Record<WizardStepState, WizardStepState[]> = {
  pending: ['active'],
  active: ['completed', 'skipped'],
  completed: [], // terminal
  skipped: [], // terminal
};
```

### Location Templates Definition

```typescript
// lib/constants/wizard-templates.ts

export interface LocationTemplate {
  id: string;
  name: string;
  description: string;
  locations: TemplateLocation[];
}

export interface TemplateLocation {
  code: string;
  name: string;
  level: 'zone' | 'aisle' | 'rack' | 'bin';
  location_type: 'bulk' | 'pallet' | 'shelf' | 'floor' | 'staging';
  parent_code?: string; // null for root zones
}

export const LOCATION_TEMPLATES: LocationTemplate[] = [
  {
    id: 'simple',
    name: 'Simple - 1 Zone',
    description: 'Single location for small operations',
    locations: [
      { code: 'RECEIVING', name: 'Receiving Area', level: 'zone', location_type: 'staging' },
    ],
  },
  {
    id: 'basic',
    name: 'Basic - 3 Zones',
    description: 'Receiving, Storage, Shipping areas',
    locations: [
      { code: 'RECEIVING', name: 'Receiving Area', level: 'zone', location_type: 'staging' },
      { code: 'STORAGE', name: 'Storage Area', level: 'zone', location_type: 'bulk' },
      { code: 'SHIPPING', name: 'Shipping Area', level: 'zone', location_type: 'staging' },
    ],
  },
  {
    id: 'full',
    name: 'Full - 9 Locations',
    description: '3 zones with aisle and rack structure',
    locations: [
      // Raw Materials Zone
      { code: 'RAW-ZONE', name: 'Raw Materials', level: 'zone', location_type: 'bulk' },
      { code: 'RAW-A1', name: 'Raw Aisle 1', level: 'aisle', location_type: 'pallet', parent_code: 'RAW-ZONE' },
      { code: 'RAW-A1-R1', name: 'Raw Rack 1', level: 'rack', location_type: 'pallet', parent_code: 'RAW-A1' },
      // Production Zone
      { code: 'PROD-ZONE', name: 'Production', level: 'zone', location_type: 'floor' },
      { code: 'PROD-A1', name: 'Prod Aisle 1', level: 'aisle', location_type: 'floor', parent_code: 'PROD-ZONE' },
      { code: 'PROD-A1-R1', name: 'Prod Rack 1', level: 'rack', location_type: 'shelf', parent_code: 'PROD-A1' },
      // Finished Goods Zone
      { code: 'FG-ZONE', name: 'Finished Goods', level: 'zone', location_type: 'bulk' },
      { code: 'FG-A1', name: 'FG Aisle 1', level: 'aisle', location_type: 'pallet', parent_code: 'FG-ZONE' },
      { code: 'FG-A1-R1', name: 'FG Rack 1', level: 'rack', location_type: 'pallet', parent_code: 'FG-A1' },
    ],
  },
];
```

### Product Templates Definition

```typescript
// lib/constants/product-templates.ts

export interface IndustryConfig {
  id: string;
  name: string;
  icon: string;
  templates: ProductTemplate[];
}

export interface ProductTemplate {
  id: string;
  name: string;
  prefill: {
    product_type: 'finished_good' | 'raw_material' | 'wip';
    uom: string;
    shelf_life_days: number;
    storage_temp: 'ambient' | 'chilled' | 'frozen';
  };
}

export const INDUSTRY_TEMPLATES: IndustryConfig[] = [
  {
    id: 'bakery',
    name: 'Bakery',
    icon: 'bread',
    templates: [
      { id: 'bread', name: 'Bread Loaf', prefill: { product_type: 'finished_good', uom: 'EA', shelf_life_days: 7, storage_temp: 'ambient' } },
      { id: 'pastry', name: 'Pastry', prefill: { product_type: 'finished_good', uom: 'EA', shelf_life_days: 3, storage_temp: 'chilled' } },
      { id: 'cookie', name: 'Cookie', prefill: { product_type: 'finished_good', uom: 'EA', shelf_life_days: 14, storage_temp: 'ambient' } },
      { id: 'cake', name: 'Cake', prefill: { product_type: 'finished_good', uom: 'EA', shelf_life_days: 5, storage_temp: 'chilled' } },
    ],
  },
  {
    id: 'dairy',
    name: 'Dairy',
    icon: 'milk',
    templates: [
      { id: 'milk', name: 'Milk', prefill: { product_type: 'finished_good', uom: 'L', shelf_life_days: 14, storage_temp: 'chilled' } },
      { id: 'cheese', name: 'Cheese', prefill: { product_type: 'finished_good', uom: 'KG', shelf_life_days: 90, storage_temp: 'chilled' } },
      { id: 'yogurt', name: 'Yogurt', prefill: { product_type: 'finished_good', uom: 'EA', shelf_life_days: 21, storage_temp: 'chilled' } },
      { id: 'butter', name: 'Butter', prefill: { product_type: 'finished_good', uom: 'KG', shelf_life_days: 60, storage_temp: 'chilled' } },
    ],
  },
  {
    id: 'meat',
    name: 'Meat Processing',
    icon: 'meat',
    templates: [
      { id: 'sausage', name: 'Sausage', prefill: { product_type: 'finished_good', uom: 'KG', shelf_life_days: 14, storage_temp: 'chilled' } },
      { id: 'ham', name: 'Ham', prefill: { product_type: 'finished_good', uom: 'KG', shelf_life_days: 21, storage_temp: 'chilled' } },
      { id: 'bacon', name: 'Bacon', prefill: { product_type: 'finished_good', uom: 'KG', shelf_life_days: 28, storage_temp: 'chilled' } },
      { id: 'deli', name: 'Deli Meat', prefill: { product_type: 'finished_good', uom: 'KG', shelf_life_days: 7, storage_temp: 'chilled' } },
    ],
  },
  {
    id: 'beverages',
    name: 'Beverages',
    icon: 'drink',
    templates: [
      { id: 'juice', name: 'Juice', prefill: { product_type: 'finished_good', uom: 'L', shelf_life_days: 30, storage_temp: 'chilled' } },
      { id: 'softdrink', name: 'Soft Drink', prefill: { product_type: 'finished_good', uom: 'L', shelf_life_days: 180, storage_temp: 'ambient' } },
      { id: 'water', name: 'Water', prefill: { product_type: 'finished_good', uom: 'L', shelf_life_days: 365, storage_temp: 'ambient' } },
      { id: 'energy', name: 'Energy Drink', prefill: { product_type: 'finished_good', uom: 'L', shelf_life_days: 365, storage_temp: 'ambient' } },
    ],
  },
  {
    id: 'snacks',
    name: 'Snacks',
    icon: 'cookie',
    templates: [
      { id: 'chips', name: 'Chips', prefill: { product_type: 'finished_good', uom: 'EA', shelf_life_days: 90, storage_temp: 'ambient' } },
      { id: 'crackers', name: 'Crackers', prefill: { product_type: 'finished_good', uom: 'EA', shelf_life_days: 180, storage_temp: 'ambient' } },
      { id: 'nuts', name: 'Nuts', prefill: { product_type: 'finished_good', uom: 'KG', shelf_life_days: 365, storage_temp: 'ambient' } },
      { id: 'candy', name: 'Candy', prefill: { product_type: 'finished_good', uom: 'EA', shelf_life_days: 365, storage_temp: 'ambient' } },
    ],
  },
  {
    id: 'other',
    name: 'Other',
    icon: 'package',
    templates: [
      { id: 'readymeal', name: 'Ready Meal', prefill: { product_type: 'finished_good', uom: 'EA', shelf_life_days: 5, storage_temp: 'chilled' } },
      { id: 'sauce', name: 'Sauce', prefill: { product_type: 'finished_good', uom: 'L', shelf_life_days: 180, storage_temp: 'ambient' } },
      { id: 'soup', name: 'Soup', prefill: { product_type: 'finished_good', uom: 'L', shelf_life_days: 14, storage_temp: 'chilled' } },
      { id: 'salad', name: 'Salad', prefill: { product_type: 'finished_good', uom: 'EA', shelf_life_days: 3, storage_temp: 'chilled' } },
    ],
  },
];
```

### API Endpoints

```
POST /api/v1/settings/onboarding/step/2   - Save warehouse (Step 2)
POST /api/v1/settings/onboarding/step/3   - Save locations (Step 3)
POST /api/v1/settings/onboarding/step/4   - Save product (Step 4)
POST /api/v1/settings/onboarding/step/5   - Save work order (Step 5)
POST /api/v1/settings/onboarding/step/6   - Complete wizard (Step 6)
GET  /api/v1/settings/onboarding/templates/locations  - Get location templates
GET  /api/v1/settings/onboarding/templates/products   - Get product templates
```

**Step 2 Request/Response:**
```typescript
// POST /api/v1/settings/onboarding/step/2
interface Step2Request {
  code: string;      // Default: "WH-MAIN"
  name: string;      // Required
  type: WarehouseType; // Default: "GENERAL"
  skip?: boolean;    // If true, creates demo warehouse
}

interface Step2Response {
  success: true;
  next_step: 3;
  warehouse: { id: string; code: string; name: string };
}
```

**Step 3 Request/Response:**
```typescript
// POST /api/v1/settings/onboarding/step/3
interface Step3Request {
  template?: 'simple' | 'basic' | 'full' | 'custom';
  custom_locations?: CreateLocationInput[]; // Only if template = 'custom'
  skip?: boolean;
}

interface Step3Response {
  success: true;
  next_step: 4;
  locations: { id: string; code: string; name: string }[];
  count: number;
}
```

**Step 4 Request/Response:**
```typescript
// POST /api/v1/settings/onboarding/step/4
interface Step4Request {
  sku: string;
  name: string;
  product_type: 'finished_good' | 'raw_material' | 'wip';
  uom: string;
  shelf_life_days?: number;
  storage_temp?: 'ambient' | 'chilled' | 'frozen';
  skip?: boolean;
}

interface Step4Response {
  success: true;
  next_step: 5;
  product?: { id: string; sku: string; name: string };
  skipped?: boolean;
}
```

**Step 5 Request/Response:**
```typescript
// POST /api/v1/settings/onboarding/step/5
interface Step5Request {
  product_id?: string;  // From step 4
  quantity?: number;    // Default: 100
  due_date?: string;    // Default: tomorrow
  skip?: boolean;
}

interface Step5Response {
  success: true;
  next_step: 6;
  work_order?: { id: string; code: string; status: string };
  skipped?: boolean;
}
```

**Step 6 Request/Response:**
```typescript
// POST /api/v1/settings/onboarding/step/6
interface Step6Request {
  // No input needed - completion is automatic
}

interface Step6Response {
  success: true;
  completed: true;
  summary: {
    organization: { name: string };
    warehouse: { code: string; name: string } | null;
    locations: { count: number; template: string } | null;
    product: { sku: string; name: string } | null;
    work_order: { code: string; status: string } | null;
    duration_seconds: number;
    badge?: 'speed_champion';
  };
}
```

### Service Layer

```typescript
// lib/services/wizard-service.ts

export interface WizardService {
  // Step handlers
  saveStep2Warehouse(data: Step2Request): Promise<Step2Response>;
  saveStep3Locations(data: Step3Request): Promise<Step3Response>;
  saveStep4Product(data: Step4Request): Promise<Step4Response>;
  saveStep5WorkOrder(data: Step5Request): Promise<Step5Response>;
  completeWizard(): Promise<Step6Response>;

  // Progress
  getProgress(): Promise<WizardProgress>;
  updateProgress(step: number, data: Record<string, unknown>): Promise<void>;

  // Summary
  getSummary(): Promise<WizardSummary>;
  calculateDuration(): Promise<number>; // seconds since started_at

  // Badges
  awardBadge(badge: string): Promise<void>;
  checkSpeedChampion(): Promise<boolean>; // duration < 900 seconds (15 min)
}
```

### Validation Schemas (Zod)

```typescript
// lib/validation/wizard-steps.ts
import { z } from 'zod';

// Step 2: Warehouse
export const wizardStep2Schema = z.object({
  code: z.string()
    .min(2, 'Code must be at least 2 characters')
    .max(20, 'Code must be at most 20 characters')
    .regex(/^[A-Z0-9-]+$/, 'Code must be uppercase alphanumeric with hyphens')
    .default('WH-MAIN'),
  name: z.string()
    .min(2, 'Warehouse name is required')
    .max(100, 'Name must be at most 100 characters'),
  type: z.enum(['GENERAL', 'RAW_MATERIALS', 'WIP', 'FINISHED_GOODS', 'QUARANTINE'])
    .default('GENERAL'),
  skip: z.boolean().optional(),
});

// Step 3: Locations
export const wizardStep3Schema = z.object({
  template: z.enum(['simple', 'basic', 'full', 'custom']).optional(),
  custom_locations: z.array(z.object({
    code: z.string().min(1).max(50).regex(/^[A-Z0-9-]+$/),
    name: z.string().min(2).max(255),
    location_type: z.enum(['bulk', 'pallet', 'shelf', 'floor', 'staging']),
  })).optional(),
  skip: z.boolean().optional(),
}).refine(data => {
  if (data.template === 'custom' && (!data.custom_locations || data.custom_locations.length === 0)) {
    return false;
  }
  return true;
}, { message: 'Custom template requires at least one location', path: ['custom_locations'] });

// Step 4: Product
export const wizardStep4Schema = z.object({
  sku: z.string()
    .min(1, 'SKU is required')
    .max(50, 'SKU must be at most 50 characters')
    .regex(/^[A-Z0-9-]+$/, 'SKU must be uppercase alphanumeric with hyphens')
    .transform(val => val.toUpperCase()),
  name: z.string()
    .min(2, 'Product name is required')
    .max(255, 'Name must be at most 255 characters'),
  product_type: z.enum(['finished_good', 'raw_material', 'wip']).default('finished_good'),
  uom: z.string().min(1).max(10).default('EA'),
  shelf_life_days: z.number().int().positive().nullable().optional(),
  storage_temp: z.enum(['ambient', 'chilled', 'frozen']).default('ambient'),
  skip: z.boolean().optional(),
});

// Step 5: Work Order
export const wizardStep5Schema = z.object({
  product_id: z.string().uuid().optional(),
  quantity: z.number().int().positive().default(100),
  due_date: z.string().datetime().optional(),
  skip: z.boolean().optional(),
});
```

---

## UI Components

### Component Tree

```
components/onboarding/wizard/
  WizardStep2Warehouse.tsx         -- Warehouse creation form
  WizardStep3Locations.tsx         -- Location template selector + custom form
  WizardStep4Product.tsx           -- Industry + template selector + product form
  WizardStep5WorkOrder.tsx         -- Work order demo creation
  WizardStep6Complete.tsx          -- Celebration + summary + next steps

  templates/
    TemplateSelector.tsx           -- Reusable template card selector
    LocationTemplateCard.tsx       -- Single location template option
    IndustrySelector.tsx           -- Industry icon grid
    ProductTemplateDropdown.tsx    -- Product templates for selected industry

  celebration/
    ConfettiAnimation.tsx          -- Confetti canvas animation
    SpeedBadge.tsx                 -- "Speed Setup Champion" badge component
    CompletionSummary.tsx          -- Summary of created items
    NextStepCard.tsx               -- Single next step action card
    NextStepsSection.tsx           -- Grid of next step cards
    WelcomeBanner.tsx              -- Dashboard welcome banner (dismissible)

  shared/
    WizardTooltip.tsx              -- Tooltip wrapper for field explanations
    SkipStepButton.tsx             -- Consistent skip button styling
    StepTimer.tsx                  -- Elapsed time display (optional)
```

### WizardStep2Warehouse.tsx

```typescript
interface WizardStep2WarehouseProps {
  onNext: (data: Step2Response) => void;
  onBack: () => void;
  initialData?: Partial<Step2Request>;
}

// Features:
// - Pre-filled code "WH-MAIN" (editable)
// - Warehouse name input (required)
// - Type dropdown with tooltips
// - Skip button creates demo warehouse
// - Back button returns to step 1
// - Validation inline errors
```

### WizardStep3Locations.tsx

```typescript
interface WizardStep3LocationsProps {
  onNext: (data: Step3Response) => void;
  onBack: () => void;
  warehouseId: string;
}

// Features:
// - Template selector cards (Simple, Basic, Full, Custom)
// - Visual preview of what each template creates
// - Custom mode: add locations one by one
// - Location preview list in custom mode
// - Skip creates DEFAULT location
```

### WizardStep4Product.tsx

```typescript
interface WizardStep4ProductProps {
  onNext: (data: Step4Response) => void;
  onBack: () => void;
}

// Features:
// - Industry selector (icon grid)
// - Template dropdown based on industry
// - Pre-filled form from template
// - All fields editable
// - "Start from Scratch" option
// - SKU validation (format + uniqueness)
// - Skip advances without creating product
```

### WizardStep5WorkOrder.tsx

```typescript
interface WizardStep5WorkOrderProps {
  onNext: (data: Step5Response) => void;
  onBack: () => void;
  productId?: string;  // From step 4, may be null if skipped
  productName?: string;
}

// Features:
// - Disabled state if no product created
// - Pre-filled with product from step 4
// - Quantity input (default 100)
// - Due date picker (default tomorrow)
// - Priority dropdown
// - Explanatory tooltips
// - Skip available regardless of product
```

### WizardStep6Complete.tsx

```typescript
interface WizardStep6CompleteProps {
  onComplete: () => void;
  summary: WizardSummary;
  durationSeconds: number;
  badge?: 'speed_champion';
}

// Features:
// - Confetti animation on mount
// - Summary of all created items
// - Duration display
// - Speed Champion badge if < 15 minutes
// - Next steps contextual cards
// - "Go to Dashboard" primary button
```

### ConfettiAnimation.tsx

```typescript
interface ConfettiAnimationProps {
  active: boolean;
  duration?: number; // ms, default 3000
  particleCount?: number; // default 100
}

// Features:
// - Canvas-based confetti particles
// - Multiple colors (brand colors)
// - Falls from top of viewport
// - Auto-stops after duration
// - Performance optimized (requestAnimationFrame)
```

### SpeedBadge.tsx

```typescript
interface SpeedBadgeProps {
  durationSeconds: number;
  threshold?: number; // default 900 (15 min)
}

// Features:
// - Only renders if duration < threshold
// - Animated glow effect
// - Trophy/star icon
// - Tooltip with exact time
// - Badge design: gold/yellow with border
```

---

## Test Cases

### Unit Tests

**File:** `__tests__/unit/services/wizard-service.test.ts`

| Test ID | Test Case | Expected Result |
|---------|-----------|-----------------|
| WIZ-U-001 | saveStep2Warehouse creates warehouse | Warehouse created, is_default=true |
| WIZ-U-002 | saveStep2Warehouse with skip creates demo | DEMO-WH warehouse created |
| WIZ-U-003 | saveStep3Locations with 'simple' template | 1 RECEIVING location created |
| WIZ-U-004 | saveStep3Locations with 'basic' template | 3 locations created |
| WIZ-U-005 | saveStep3Locations with 'full' template | 9 locations with hierarchy |
| WIZ-U-006 | saveStep3Locations with custom | Custom locations created |
| WIZ-U-007 | saveStep4Product validates SKU format | Uppercase, alphanumeric |
| WIZ-U-008 | saveStep4Product rejects duplicate SKU | Error returned |
| WIZ-U-009 | saveStep5WorkOrder requires product | Error if no product_id |
| WIZ-U-010 | completeWizard sets completed_at | Timestamp set |
| WIZ-U-011 | checkSpeedChampion under 15 min | Returns true, badge awarded |
| WIZ-U-012 | checkSpeedChampion over 15 min | Returns false, no badge |
| WIZ-U-013 | calculateDuration returns seconds | Correct difference |
| WIZ-U-014 | getSummary aggregates all steps | All entities listed |

**File:** `__tests__/unit/components/wizard-steps.test.tsx`

| Test ID | Test Case | Expected Result |
|---------|-----------|-----------------|
| WIZ-C-001 | Step2 pre-fills WH-MAIN | Code input shows WH-MAIN |
| WIZ-C-002 | Step2 validates required name | Error on empty name |
| WIZ-C-003 | Step3 shows 4 template options | All templates render |
| WIZ-C-004 | Step3 custom mode shows add form | Form visible on custom select |
| WIZ-C-005 | Step4 industry selector renders | 6 industry options |
| WIZ-C-006 | Step4 template dropdown filters | Templates match industry |
| WIZ-C-007 | Step5 disabled without product | Form inputs disabled |
| WIZ-C-008 | Step6 confetti plays on mount | Animation starts |
| WIZ-C-009 | Step6 speed badge shows under 15m | Badge visible |
| WIZ-C-010 | Step6 next steps contextual | Correct actions shown |

### Integration Tests

**File:** `__tests__/integration/api/settings/onboarding-steps.test.ts`

| Test ID | Test Case | Expected Result |
|---------|-----------|-----------------|
| WIZ-I-001 | POST /step/2 creates warehouse | 200, warehouse in DB |
| WIZ-I-002 | POST /step/2 skip creates demo | 200, DEMO-WH in DB |
| WIZ-I-003 | POST /step/3 template=simple | 200, 1 location |
| WIZ-I-004 | POST /step/3 template=basic | 200, 3 locations |
| WIZ-I-005 | POST /step/3 template=full | 200, 9 locations with parents |
| WIZ-I-006 | POST /step/3 custom locations | 200, custom locations |
| WIZ-I-007 | POST /step/4 creates product | 200, product in DB |
| WIZ-I-008 | POST /step/4 duplicate SKU | 400, error message |
| WIZ-I-009 | POST /step/5 creates work order | 200, draft WO in DB |
| WIZ-I-010 | POST /step/5 without product | 400, error message |
| WIZ-I-011 | POST /step/6 sets completed_at | 200, timestamp set |
| WIZ-I-012 | POST /step/6 awards speed badge | Badge in organizations.badges |
| WIZ-I-013 | GET /templates/locations | Returns all templates |
| WIZ-I-014 | GET /templates/products | Returns all industries + templates |

### E2E Tests

**File:** `__tests__/e2e/onboarding/wizard-complete.spec.ts`

| Test ID | Test Case | Expected Result |
|---------|-----------|-----------------|
| WIZ-E-001 | Complete wizard happy path | All 6 steps, dashboard |
| WIZ-E-002 | Skip all optional steps | Steps 4+5 skipped, completes |
| WIZ-E-003 | Back navigation preserves data | Data persists on return |
| WIZ-E-004 | Step 3 full template | 9 locations visible in settings |
| WIZ-E-005 | Step 4 bakery template | Product with 7-day shelf life |
| WIZ-E-006 | Speed badge under 15 min | Badge visible on completion |
| WIZ-E-007 | Dashboard welcome banner | Banner shows, dismissible |
| WIZ-E-008 | Custom locations flow | Multiple custom locations added |
| WIZ-E-009 | Industry change resets template | Form clears on industry switch |
| WIZ-E-010 | Confetti animation renders | Visual verification |

---

## Definition of Done

### Step 2 (Warehouse)
- [ ] Pre-filled code "WH-MAIN" displayed and editable
- [ ] Required field validation for warehouse name
- [ ] Type dropdown with tooltips for each option
- [ ] Skip creates DEMO-WH with is_default=true
- [ ] Back navigation returns to step 1
- [ ] Next navigation advances to step 3
- [ ] wizard_progress.step_2 updated on completion

### Step 3 (Locations)
- [ ] 4 template options displayed (Simple, Basic, Full, Custom)
- [ ] Simple template creates 1 RECEIVING location
- [ ] Basic template creates 3 zones (RECEIVING, STORAGE, SHIPPING)
- [ ] Full template creates 9 locations with hierarchy
- [ ] Custom mode allows adding multiple locations
- [ ] Skip creates DEFAULT location
- [ ] wizard_progress.step_3 updated on completion

### Step 4 (Product)
- [ ] 6 industry options with icons
- [ ] Industry-specific templates in dropdown
- [ ] Template pre-fills form fields
- [ ] All pre-filled fields editable
- [ ] "Start from Scratch" shows empty form
- [ ] SKU format validation (uppercase alphanumeric)
- [ ] SKU uniqueness validation
- [ ] Skip advances without creating product
- [ ] wizard_progress.step_4 updated on completion

### Step 5 (Work Order)
- [ ] Disabled state when no product from step 4
- [ ] Product pre-selected from step 4
- [ ] Quantity defaults to 100
- [ ] Due date defaults to tomorrow
- [ ] Creates draft work order on submit
- [ ] Skip available regardless of product state
- [ ] wizard_progress.step_5 updated on completion

### Step 6 (Completion)
- [ ] Confetti animation plays for 3 seconds
- [ ] Summary displays all created items
- [ ] Duration shows total setup time
- [ ] Speed Champion badge if < 15 minutes
- [ ] Badge stored in organizations.badges
- [ ] Next steps section displays contextually
- [ ] "Go to Dashboard" sets wizard_completed=true
- [ ] Dashboard shows dismissible welcome banner

### General
- [ ] All validation schemas implemented (Zod)
- [ ] All API endpoints functional and documented
- [ ] wizard-service.ts implements all methods
- [ ] Template constants defined (locations, products)
- [ ] Unit tests pass (>80% coverage)
- [ ] Integration tests pass for all endpoints
- [ ] E2E tests pass for complete flow
- [ ] Loading states for all async operations
- [ ] Error states with user-friendly messages
- [ ] Toast notifications on success/skip
- [ ] Accessibility: keyboard navigation, ARIA labels
- [ ] Mobile responsive (wizard works on tablet)

---

## Risks

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| Step dependencies complex | Medium | Medium | Clear state machine, exhaustive tests |
| Product templates outdated for industries | Low | Low | Review with PM, make templates configurable |
| Speed badge threshold too aggressive | Low | Medium | A/B test threshold (15 vs 20 min) |
| Confetti performance on low-end devices | Low | Low | Use CSS animations fallback |
| Custom location hierarchy validation | Medium | High | Reuse location-service validation |

---

## Out of Scope

| Feature | Reason | Future Story |
|---------|--------|--------------|
| BOM creation in wizard | Too complex for onboarding | Technical module |
| Recipe creation | Too complex for onboarding | Technical module |
| Multi-warehouse wizard | MVP focuses on single warehouse | Phase 2 |
| Import from Excel in wizard | Separate import feature | Story 01.x (Import/Export) |
| Wizard analytics/tracking | Separate analytics feature | Phase 2 |
| Re-run wizard after completion | Edge case, manual setup available | Phase 2 |

---

## Version History

| Version | Date | Changes | Author |
|---------|------|---------|--------|
| 1.0 | 2025-12-16 | Initial story creation | ARCHITECT-AGENT |
