# Epic 01a - Settings Module (Demo MVP)

**Epic ID:** 01a
**Module:** Settings
**Status:** READY (Architecture + UX approved)
**Type:** Demo/MVP Subset
**Primary References:**
- PRD: `docs/1-BASELINE/product/modules/settings.md`
- Architecture: `docs/1-BASELINE/architecture/modules/settings.md`
- UX Wireframes: `docs/3-ARCHITECTURE/ux/wireframes/SET-001` to `SET-011`
- Full Epic: `docs/2-MANAGEMENT/epics/current/01-settings/01.0.epic-overview.md`

---

## Goal

Deliver a **minimal viable Settings module** focused on core Phase 1A functionality to demonstrate:
- Multi-tenant organization configuration with RLS foundation
- User management with 10-role permission system
- Module activation/deactivation toggles
- Onboarding wizard launcher (framework only)

This epic provides the **authentication and authorization foundation** required by all other epics.

---

## Non-Goals (Explicit)

**Out of Scope for 01a:**
- Full onboarding wizard (steps 2-6: warehouse, location, product, work order, completion)
- Infrastructure setup (warehouses, locations, machines, production lines)
- Master data management (allergens, tax codes)
- API keys and webhooks
- Audit logs and security policies
- Notification settings
- Subscription and billing (Stripe)
- Import/export utilities
- User invitations (email integration)

These are covered in the full **Epic 01** (`01-settings`) and will be implemented after the demo MVP.

---

## Delivery Strategy (Small Stories)

We intentionally keep stories small to reduce context load and enable rapid demo iteration:

1. **Foundation First:** Establish org context and RLS before any UI
2. **Shell + Guards:** Navigation structure and permission checking
3. **Wizard Framework:** State machine without full step implementation
4. **User CRUD:** Core user management with role assignment
5. **Module Toggles:** Enable/disable modules with dependency validation

**Constraints:**
- No external email integration (user creation without invitation flow)
- No Stripe integration (billing deferred)
- Wizard launcher shows framework, not complete wizard

---

## Story Index (Phase 1A Core)

| Story | Name | PRD FRs | UX | Dependencies | Complexity |
|------:|------|---------|-----|--------------|------------|
| 01a.1 | Org context + base RLS scaffolding | FR-SET-002 | (none) | -- | M |
| 01a.2 | Settings shell: navigation + guards | FR-SET-030, FR-SET-031 | (implicit) | 01a.1 | S |
| 01a.3 | Onboarding wizard launcher | FR-SET-180, FR-SET-186, FR-SET-187 | SET-001 | 01a.2 | M |
| 01a.4 | Organization profile step | FR-SET-001, FR-SET-003, FR-SET-004, FR-SET-181 | SET-002, SET-007 | 01a.3 | M |
| 01a.5 | Users: list + create/edit modal | FR-SET-010, FR-SET-017 | SET-008, SET-009 | 01a.6 | L |
| 01a.6 | Role-based permissions (10 roles) | FR-SET-011, FR-SET-020 to FR-SET-031 | SET-011 | 01a.1 | M |
| 01a.7 | Module toggles | FR-SET-090 to FR-SET-097 | SET-022 | 01a.6 | M |

**Total Stories:** 7
**Estimated Effort:** 5-7 days (1 developer)

---

## Story Dependency Graph

```
01a.1 (Org Context + RLS)
  |
  +---> 01a.2 (Settings Shell)
  |       |
  |       +---> 01a.3 (Wizard Launcher)
  |               |
  |               +---> 01a.4 (Org Profile Step)
  |
  +---> 01a.6 (Roles & Permissions)
          |
          +---> 01a.5 (Users CRUD)
          |
          +---> 01a.7 (Module Toggles)
```

**Critical Path:** 01a.1 -> 01a.6 -> 01a.5

---

## PRD Requirements Coverage

### Covered in 01a (Phase 1A Core)

| Req ID | Requirement | Story |
|--------|-------------|-------|
| FR-SET-001 | Organization profile | 01a.4 |
| FR-SET-002 | Multi-tenant isolation | 01a.1 |
| FR-SET-003 | Timezone and locale | 01a.4 |
| FR-SET-004 | Currency configuration | 01a.4 |
| FR-SET-010 | User CRUD operations | 01a.5 |
| FR-SET-011 | 10-role permission system | 01a.6 |
| FR-SET-017 | User deactivation/archiving | 01a.5 |
| FR-SET-020-029 | Role definitions (10 roles) | 01a.6 |
| FR-SET-030 | Module-level permissions | 01a.6 |
| FR-SET-031 | CRUD-level permissions | 01a.6 |
| FR-SET-090 | Module activation/deactivation | 01a.7 |
| FR-SET-091-096 | Individual module toggles | 01a.7 |
| FR-SET-097 | Module dependency validation | 01a.7 |
| FR-SET-180 | Setup wizard launcher | 01a.3 |
| FR-SET-181 | Organization profile step | 01a.4 |
| FR-SET-186 | Wizard progress tracking | 01a.3 |
| FR-SET-187 | Skip wizard option | 01a.3 |

### Deferred to Full Epic 01

| Req ID | Requirement | Reason |
|--------|-------------|--------|
| FR-SET-005 | Business hours configuration | Phase 1B |
| FR-SET-012-016 | User invitations, sessions, MFA | Email integration required |
| FR-SET-040-065 | Warehouses, locations, machines, lines | Phase 1B infrastructure |
| FR-SET-070-084 | Allergens, tax codes | Phase 2 master data |
| FR-SET-100-106 | Subscription & billing | Phase 3, Stripe required |
| FR-SET-110-116 | Multi-language support | Phase 1A but deferred |
| FR-SET-120-135 | API keys, webhooks | Phase 2 integrations |
| FR-SET-140-146 | Audit trail | Phase 1B |
| FR-SET-150-155 | Import/export | Phase 3 |
| FR-SET-160-163 | Notifications | Phase 2 |
| FR-SET-170-174 | Security policies | Phase 1B/3 |
| FR-SET-182-185, FR-SET-188 | Onboarding wizard steps 2-6 | Full epic 01 |

---

## External Dependencies (Cross-Epic)

None for 01a - this epic is self-contained and provides the foundation for other epics.

**Provides to Other Epics:**
- `org_id` context for all tenant-scoped operations
- RLS policies for data isolation
- User authentication and role checking
- Module toggle validation

---

## Technical Notes

### Database Tables (Created/Modified in 01a)

| Table | Action | Notes |
|-------|--------|-------|
| `organizations` | Create | Core org data + onboarding state |
| `users` | Create | User accounts with role assignment |
| `module_settings` | Create | Module activation flags |

### RLS Policies (Established in 01a.1)

All policies follow the pattern:
```sql
USING (org_id = (SELECT org_id FROM users WHERE id = auth.uid()))
```

### Key Services

- `organization-service.ts` - Org CRUD, onboarding state
- `user-service.ts` - User CRUD (no invitation flow)
- `permission-service.ts` - Role checking, RBAC enforcement
- `module-settings-service.ts` - Module toggles, dependency validation

---

## Definition of Done (Epic 01a)

- [ ] Organization context established with RLS on all tables
- [ ] Settings shell with proper navigation and route guards
- [ ] Onboarding wizard launcher with skip/resume capability
- [ ] Organization profile form with validation
- [ ] User list with search, filter, pagination
- [ ] User create/edit modal with role assignment
- [ ] 10 roles with correct permission matrix enforced
- [ ] Module toggles with dependency validation
- [ ] All stories have unit tests (>80% coverage)
- [ ] Integration tests for API endpoints
- [ ] E2E smoke tests for critical flows

---

## Risk Assessment

| Risk | Impact | Mitigation |
|------|--------|------------|
| RLS policy gaps | High | Comprehensive integration tests |
| Permission misconfiguration | High | Test matrix for all 10 roles |
| Module dependency bugs | Medium | Validation tests for all toggle combinations |
| Onboarding state corruption | Low | State machine tests |

---

## Success Metrics

- [ ] Demo: Create org, user, assign role, toggle modules
- [ ] All 10 roles enforced correctly
- [ ] Module toggles hide/show navigation items
- [ ] Onboarding wizard can be started, skipped, resumed
- [ ] Response time <500ms for all Settings APIs

---

## Handoff to DEV Agents

```yaml
epic: "01a-settings"
epic_folder: docs/2-MANAGEMENT/epics/current/01a-settings/
stories_count: 7
start_story: "01a.1.org-context-base-rls"
adrs: []
technical_notes: |
  - Foundation epic - establishes multi-tenant architecture
  - No external integrations (email, Stripe) in this epic
  - Focus on RBAC and module toggle framework
dependencies: []
```

---

## Version History

| Version | Date | Changes | Author |
|---------|------|---------|--------|
| 1.0 | 2025-12-15 | Initial epic overview for demo MVP | ARCHITECT-AGENT |
