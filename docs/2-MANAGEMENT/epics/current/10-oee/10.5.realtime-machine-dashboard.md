# 10.5 - Real-Time Machine Dashboard

**Priority**: P0 (MVP)
**Story Points**: L (Large)
**Type**: frontend
**Phase**: 1A (Core OEE)
**Model**: SONNET

**State:** ready
**Estimate:** L (4-5 days)
**Primary PRD:** `docs/1-BASELINE/product/modules/oee.md` (FR-OEE-002)
**Architecture:** `docs/1-BASELINE/architecture/modules/oee.md` (Dashboard spec)
**Wireframe:** `docs/3-ARCHITECTURE/ux/wireframes/PROD-001-production-dashboard.md` (Similar pattern)

---

## Goal

Implement real-time OEE dashboard displaying live machine status, OEE metrics, active downtime, and performance gauges. Dashboard updates every 30 seconds via WebSocket or polling, providing at-a-glance visibility into production floor performance. This is the primary interface for monitoring OEE in real-time.

---

## User Story

As a **Production Supervisor**, I want to **view real-time OEE metrics for all machines on one dashboard** so that **I can quickly identify underperforming machines and respond to issues**.

As a **Plant Manager**, I want to **see aggregated OEE across production lines** so that **I can assess overall facility performance and track progress toward targets**.

---

## Scope

**In scope (this story)**
- `/oee/dashboard` - Main OEE dashboard page
- `/oee/machines/:id` - Individual machine detail view
- Header KPI cards: OEE Today, Availability, Performance, Quality
- Machine status grid: Running/Idle/Down status, current OEE, progress
- Active alerts panel: OEE below target, extended downtime
- OEE trend chart: Last 7 days
- Real-time updates: WebSocket or polling every 30s
- Machine status badges with color coding
- OEE gauge charts (circular progress)
- Downtime timeline visualization
- Current work order info per machine
- Filter by line/shift
- Responsive design (desktop + tablet)

**Out of scope (this story)**
- Mobile scanner app (Phase 3)
- Historical trend analysis (Phase 1B)
- Pareto charts (Phase 2)
- Custom dashboard builder (Phase 2)
- Email alerts (Phase 2)
- Export to PDF/Excel (Phase 2)

---

## Dependencies

### Cross-Epic Dependencies

| Dependency | Story/Epic | Type | What It Provides | Status |
|------------|------------|------|------------------|--------|
| 01.1 | Org Context + RLS | HARD | User authentication | Ready |
| 01.3 | Machine Settings | HARD | Machine data | Ready |
| 01.5 | Production Lines | HARD | Line grouping | Ready |
| 04.1 | Work Orders CRUD | SOFT | Current WO display | Ready |

### Within Epic Dependencies

| Dependency | Story | Type | What It Provides |
|------------|-------|------|------------------|
| 10.1 | OEE Settings & Targets | HARD | Target values for comparison | Ready |
| 10.2 | Downtime Reason Codes | SOFT | Downtime reason display | Ready |
| 10.3 | Downtime Event Tracking | HARD | Active downtime data | Ready |
| 10.4 | OEE Calculation Engine | HARD | OEE snapshots, metrics | Ready |

### Provides To (Downstream)

| Story | What This Provides |
|-------|-------------------|
| Phase 1B | Visual patterns for alert configuration |
| Phase 2 | Dashboard patterns for analytics pages |

---

## Wireframe

### Main OEE Dashboard Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OEE Dashboard                            Filters: [Line â–¼] [Shift â–¼]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚ â”‚ OEE Today â”‚Availabilityâ”‚Performanceâ”‚  Quality  â”‚                   â”‚
â”‚ â”‚   78.5%   â”‚   85.2%   â”‚   92.1%   â”‚   100%    â”‚                   â”‚
â”‚ â”‚  â–² +2.3%  â”‚  â–¼ -1.5%  â”‚  â–² +0.8%  â”‚  â”€ 0%     â”‚                   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ PRODUCTION LINE 1              [View Details] â”‚ â”‚ACTIVE ALERTS â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚Mixer-01 â”‚Filler-02â”‚Labeler-3â”‚Packer-04â”‚      â”‚ â”‚ğŸ”´ Labeler-3  â”‚ â”‚
â”‚ â”‚â— Runningâ”‚â— Runningâ”‚â¸ Paused â”‚â— Runningâ”‚      â”‚ â”‚  Down 12m    â”‚ â”‚
â”‚ â”‚  82.1%  â”‚  91.3%  â”‚  0%     â”‚  76.5%  â”‚      â”‚ â”‚  MECH-JAM    â”‚ â”‚
â”‚ â”‚WO-2451  â”‚WO-2451  â”‚WO-2451  â”‚WO-2451  â”‚      â”‚ â”‚  [Ack][View] â”‚ â”‚
â”‚ â”‚1,450/   â”‚1,420/   â”‚0/2,000  â”‚1,380/   â”‚      â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚2,000    â”‚2,000    â”‚         â”‚2,000    â”‚      â”‚ â”‚ğŸŸ¡ Packer-04  â”‚ â”‚
â”‚ â”‚[View]   â”‚[View]   â”‚[View]   â”‚[View]   â”‚      â”‚ â”‚  Low Perf    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜ â”‚  76.5% <85%  â”‚ â”‚
â”‚                                                   â”‚  [Ack][View] â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”‚ OEE TREND - LAST 7 DAYS    [Export CSV]    â”‚                    â”‚
â”‚ â”‚ 100%â”‚                                       â”‚                    â”‚
â”‚ â”‚  90%â”‚     â—â”€â”€â”€â”€â”€â—                           â”‚                    â”‚
â”‚ â”‚  80%â”‚  â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—             â”‚                    â”‚
â”‚ â”‚  70%â”‚                                â—      â”‚                    â”‚
â”‚ â”‚   0%â”œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€   â”‚                    â”‚
â”‚ â”‚     Mon   Tue   Wed   Thu   Fri   Sat      â”‚                    â”‚
â”‚ â”‚ â”€ OEE  â”€ Availability  â”€ Performance       â”‚                    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Machine Detail View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† Back to Dashboard                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MIXER-01                          Production Line 1                 â”‚
â”‚ â— Running - WO-2451 (Chocolate Cookie Dough)                        â”‚
â”‚ Started: 08:30 | Runtime: 6h 15m | Output: 1,450/2,000              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚ â”‚ OEE       â”‚Availabilityâ”‚Performanceâ”‚  Quality  â”‚                   â”‚
â”‚ â”‚  82.1%    â”‚   85.2%   â”‚   96.4%   â”‚   100%    â”‚                   â”‚
â”‚ â”‚ Target:85%â”‚  â–² Above  â”‚  â–² Above  â”‚ â”€ On Tgt  â”‚                   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ TIMELINE - TODAY                                                â”‚ â”‚
â”‚ â”‚ 08:00 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ Running (WO-2451) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ           â”‚ â”‚
â”‚ â”‚ 10:30          â¸ Break (15m)                                    â”‚ â”‚
â”‚ â”‚ 12:00                  â¸ Lunch (30m)                            â”‚ â”‚
â”‚ â”‚ 14:23                            â¹ Down: Jam (12m)              â”‚ â”‚
â”‚ â”‚ 16:00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚ â”‚
â”‚ â”‚ Legend: â–ˆâ–ˆ Running  â¸ Paused  â¹ Down  âš  Low Performance        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ DOWNTIME EVENTS                          [+ Log Downtime]       â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ Start  â”‚ End     â”‚ Duration   â”‚ Reason   â”‚ Type           â”‚    â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ 14:23  â”‚ (Active)â”‚ 12m â±     â”‚ MECH-JAM â”‚ Unplanned      â”‚[End]â”‚ â”‚
â”‚ â”‚ 12:00  â”‚ 12:30   â”‚ 30m        â”‚ BRK-LUNCHâ”‚ Planned        â”‚    â”‚ â”‚
â”‚ â”‚ 10:30  â”‚ 10:45   â”‚ 15m        â”‚ BRK-REST â”‚ Planned        â”‚    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Acceptance Criteria (Given/When/Then)

### AC-1: Dashboard Page Loads

```gherkin
Scenario: Load OEE dashboard
  Given user navigates to /oee/dashboard
  When page loads
  Then header KPI cards display with today's metrics
  And machine status grid displays for active line
  And active alerts panel loads
  And trend chart displays last 7 days
  And page loads within 2 seconds

Scenario: No machines configured
  Given organization has no machines
  When loading dashboard
  Then empty state: "No machines configured. Go to Settings > Machines."
  And [Configure Machines] button displayed
```

### AC-2: Header KPI Cards

```gherkin
Scenario: Display current OEE metrics
  Given current organization OEE today = 78.5%
  And yesterday OEE = 76.2%
  When viewing dashboard
  Then KPI card shows:
    | Metric | Value | Change |
    | OEE Today | 78.5% | â–² +2.3% |
    | Availability | 85.2% | â–¼ -1.5% |
    | Performance | 92.1% | â–² +0.8% |
    | Quality | 100% | â”€ 0% |
  And change arrows colored (green up, red down, gray neutral)

Scenario: KPI comparison to target
  Given OEE target = 85%
  And current OEE = 78.5%
  Then OEE card highlighted in yellow (below target)
  And tooltip: "7.5% below target"
```

### AC-3: Machine Status Grid

```gherkin
Scenario: Display machine cards
  Given Production Line 1 has 4 machines
  When viewing dashboard
  Then 4 machine cards displayed:
    | Machine | Status | OEE | WO | Output |
    | Mixer-01 | Running | 82.1% | WO-2451 | 1,450/2,000 |
    | Filler-02 | Running | 91.3% | WO-2451 | 1,420/2,000 |
    | Labeler-03 | Paused | 0% | WO-2451 | 0/2,000 |
    | Packer-04 | Running | 76.5% | WO-2451 | 1,380/2,000 |
  And cards grouped by production line

Scenario: Machine status color coding
  Given machine statuses:
    | Status | Color | Icon |
    | Running | Green | â— |
    | Idle | Yellow | â—‹ |
    | Paused | Orange | â¸ |
    | Down | Red | â¹ |
  Then cards display with corresponding colors
```

### AC-4: OEE Gauge Charts

```gherkin
Scenario: Display OEE as circular gauge
  Given machine OEE = 82.1%
  And target = 85%
  When viewing machine card
  Then circular gauge shows:
    - 82.1% filled
    - Target line at 85%
    - Color = yellow (below target)
    - Percentage label in center

Scenario: Gauge color logic
  Given OEE and thresholds:
    | OEE | Target | Warning | Critical | Color |
    | 90% | 85% | 85% | 75% | Green |
    | 82% | 85% | 85% | 75% | Yellow |
    | 72% | 85% | 85% | 75% | Red |
  Then gauge colored accordingly
```

### AC-5: Real-Time Updates

```gherkin
Scenario: Auto-refresh every 30 seconds
  Given dashboard open for 2 minutes
  When auto-refresh triggers (4 times)
  Then OEE metrics update with latest data
  And machine statuses refresh
  And active downtime durations increment
  And no full page reload (smooth update)

Scenario: WebSocket updates (if available)
  Given WebSocket connection established
  When OEE snapshot created on server
  Then dashboard receives push update
  And metrics update immediately
  And timestamp shows "Updated 2s ago"

Scenario: Manual refresh
  Given user clicks [Refresh] button
  Then data reloads immediately
  And loading spinner displayed briefly
  And timestamp updates
```

### AC-6: Active Alerts Panel

```gherkin
Scenario: Display active alerts
  Given 2 active alerts:
    | Machine | Type | Details |
    | Labeler-03 | Downtime | Down 12m - MECH-JAM |
    | Packer-04 | Low Performance | 76.5% (Target: 85%) |
  When viewing dashboard
  Then alerts panel shows both alerts
  And alerts sorted by severity (critical first)
  And [Acknowledge] and [View] buttons per alert

Scenario: No active alerts
  Given all machines running within targets
  Then alerts panel shows: "âœ“ All systems normal"
  And panel background = green

Scenario: Alert acknowledge
  Given active alert exists
  When user clicks [Acknowledge]
  Then alert marked as acknowledged
  And moves to bottom of list (or removed based on settings)
  And audit log records acknowledgment
```

### AC-7: OEE Trend Chart

```gherkin
Scenario: Display 7-day trend
  Given last 7 days OEE data exists
  When viewing dashboard
  Then line chart shows:
    - X-axis: Mon-Sun
    - Y-axis: 0-100%
    - OEE line (primary)
    - Availability line (optional toggle)
    - Performance line (optional toggle)
    - Quality line (optional toggle)
  And target line at 85%

Scenario: Hover tooltip
  Given viewing trend chart
  When user hovers over Wednesday point
  Then tooltip shows:
    | Date | Wed, Jan 10 |
    | OEE | 81.2% |
    | Availability | 86.5% |
    | Performance | 93.8% |
    | Quality | 100% |
```

### AC-8: Filter by Line

```gherkin
Scenario: Filter dashboard by production line
  Given organization has 2 production lines
  When user selects "Line 1" from dropdown
  Then only Line 1 machines displayed
  And KPI cards recalculate for Line 1 only
  And trend chart updates for Line 1
  And URL updates: /oee/dashboard?line=line-1-uuid

Scenario: Filter by shift
  Given user selects "Morning Shift" filter
  Then dashboard shows Morning Shift metrics only
  And time range adjusted to shift hours
```

### AC-9: Machine Detail View

```gherkin
Scenario: Navigate to machine detail
  Given viewing dashboard
  When user clicks [View] on Mixer-01 card
  Then navigates to /oee/machines/{mixer-01-uuid}
  And machine detail page loads
  And shows OEE metrics, timeline, downtime log

Scenario: Machine timeline visualization
  Given viewing machine detail
  Then timeline shows:
    - 08:00-10:30: Running (green bar)
    - 10:30-10:45: Break (gray bar)
    - 12:00-12:30: Lunch (gray bar)
    - 14:23-14:35: Down - Jam (red bar)
  And current time indicator (vertical line)
  And total runtime displayed
```

### AC-10: Current Work Order Display

```gherkin
Scenario: Show active WO on machine card
  Given Mixer-01 running WO-2451
  And WO-2451 product = "Chocolate Cookie Dough"
  When viewing machine card
  Then displays:
    - WO Number: WO-2451
    - Product: Chocolate Cookie Dough
    - Progress: 1,450/2,000 (72.5%)
    - Progress bar visual
  And clicking WO number navigates to WO detail

Scenario: Machine idle (no WO)
  Given Mixer-01 has no active WO
  Then card shows: "Idle - No Work Order"
  And OEE = 0% or N/A
```

### AC-11: Downtime Log on Machine Detail

```gherkin
Scenario: Display downtime events for machine
  Given viewing machine detail for Mixer-01
  When downtime log section loads
  Then table shows:
    | Start | End | Duration | Reason | Type | Actions |
    | 14:23 | (Active) | 12m â± | MECH-JAM | Unplanned | [End] |
    | 12:00 | 12:30 | 30m | BRK-LUNCH | Planned | - |
  And active events highlighted
  And [+ Log Downtime] button available

Scenario: End active downtime from dashboard
  Given active downtime displayed
  When user clicks [End] button
  Then end downtime modal opens
  And user confirms end time
  Then downtime ended
  And machine status updates to Running
```

### AC-12: Responsive Design

```gherkin
Scenario: Desktop view (>1280px)
  Given viewing on desktop
  Then 4-column machine grid
  And KPI cards in single row
  And trend chart full width

Scenario: Tablet view (768-1280px)
  Given viewing on tablet
  Then 2-column machine grid
  And KPI cards in 2Ã—2 grid
  And trend chart full width

Scenario: Mobile view (<768px)
  Given viewing on mobile
  Then 1-column machine grid
  And KPI cards stacked
  And trend chart simplified
  And alerts panel collapsible
```

### AC-13: Performance Requirements

```gherkin
Scenario: Dashboard load performance
  Given 20 machines in organization
  When loading dashboard
  Then initial load < 2 seconds
  And auto-refresh < 500ms

Scenario: Chart rendering performance
  Given 7 days Ã— 288 snapshots (5-min intervals)
  When rendering trend chart
  Then chart renders < 1 second
  And smooth animations
```

### AC-14: Empty States

```gherkin
Scenario: No OEE data yet
  Given organization just enabled OEE
  And no snapshots exist
  Then dashboard shows: "No OEE data yet. Data will appear once production starts."
  And KPI cards show "N/A"

Scenario: Filters return no results
  Given user filters by Line 2
  And Line 2 has no active machines
  Then message: "No active machines on this line."
  And [Clear Filters] button
```

---

## Implementation Notes

### Frontend Components

```
apps/frontend/app/(authenticated)/oee/
  dashboard/
    page.tsx                       -- Main dashboard
  machines/
    [id]/
      page.tsx                     -- Machine detail view

components/oee/dashboard/
  OEEDashboard.tsx                 -- Main container
  OEEHeaderKPIs.tsx                -- 4 KPI cards
  MachineStatusGrid.tsx            -- Machine cards grid
  MachineCard.tsx                  -- Individual machine card
  MachineStatusBadge.tsx           -- Running/Idle/Down badge
  OEEGaugeChart.tsx                -- Circular gauge component
  OEETrendChart.tsx                -- 7-day line chart
  ActiveAlertsPanel.tsx            -- Alerts sidebar
  AlertCard.tsx                    -- Individual alert
  LineFilter.tsx                   -- Production line dropdown
  ShiftFilter.tsx                  -- Shift dropdown
  DashboardRefresh.tsx             -- Auto-refresh logic

components/oee/machine/
  MachineDetailView.tsx            -- Machine detail container
  MachineHeader.tsx                -- Machine name, status, WO
  MachineMetricsCards.tsx          -- OEE breakdown
  MachineTimeline.tsx              -- Timeline visualization
  DowntimeLogTable.tsx             -- Downtime events table
  LogDowntimeButton.tsx            -- Quick log downtime
  EndDowntimeButton.tsx            -- End active downtime
```

### Real-Time Updates

```typescript
// hooks/use-oee-realtime.ts

export function useOEERealtime(options: {
  orgId: string;
  lineId?: string;
  refreshInterval?: number; // Default: 30000ms
}) {
  const [data, setData] = useState<OEEDashboardData>();
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    // Initial load
    fetchOEEData();

    // Setup polling
    const interval = setInterval(fetchOEEData, options.refreshInterval || 30000);

    // Or WebSocket (if implemented)
    // const ws = new WebSocket(`wss://.../oee/${orgId}`);
    // ws.onmessage = (event) => setData(JSON.parse(event.data));

    return () => clearInterval(interval);
  }, [orgId, lineId]);

  const fetchOEEData = async () => {
    const res = await fetch(`/api/oee/dashboard?line_id=${lineId}`);
    const data = await res.json();
    setData(data);
    setIsLoading(false);
  };

  return { data, isLoading, refresh: fetchOEEData };
}
```

### API Endpoint

```typescript
// GET /api/oee/dashboard
interface DashboardParams {
  line_id?: string;
  shift_id?: string;
}

interface OEEDashboardData {
  kpis: {
    oee_today: number;
    availability_today: number;
    performance_today: number;
    quality_today: number;
    oee_yesterday: number; // For comparison
  };
  machines: MachineStatus[];
  active_alerts: Alert[];
  trend: { date: string; oee: number; availability: number; performance: number; quality: number }[];
}

interface MachineStatus {
  machine_id: string;
  machine_name: string;
  status: 'running' | 'idle' | 'paused' | 'down';
  oee_current: number;
  target_oee: number;
  work_order_id?: string;
  work_order_number?: string;
  product_name?: string;
  output_current: number;
  output_target: number;
  active_downtime?: {
    reason: string;
    duration_minutes: number;
  };
}
```

---

## Deliverables

### Frontend Pages
- [ ] `/oee/dashboard` - Main dashboard
- [ ] `/oee/machines/:id` - Machine detail view

### Components
- [ ] Header KPI cards (4 metrics)
- [ ] Machine status grid
- [ ] Machine card component
- [ ] OEE gauge chart
- [ ] Trend line chart
- [ ] Active alerts panel
- [ ] Timeline visualization
- [ ] Downtime log table
- [ ] Filters (line, shift)

### Hooks
- [ ] `useOEERealtime` - Real-time data hook
- [ ] `useOEETrend` - Trend data hook

### Tests
- [ ] Component tests: All major components
- [ ] Integration tests: Dashboard data flow
- [ ] E2E: Dashboard navigation, filtering

---

## Definition of Done

- [ ] Dashboard loads within 2 seconds
- [ ] Real-time updates working (30s interval)
- [ ] Machine cards display all info
- [ ] Gauges render correctly
- [ ] Trend chart interactive
- [ ] Filters functional
- [ ] Responsive design (desktop/tablet)
- [ ] Tests passing (>80% coverage)

---

**Document Status**: Ready for Implementation
**Created**: 2025-01-15
**Complexity**: L (Large)
**Phase**: 1A (Core OEE)
