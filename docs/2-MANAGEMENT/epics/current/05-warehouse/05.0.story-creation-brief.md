# Epic 05 Warehouse Module - Story Creation Brief

**Date:** 2025-12-16
**Author:** ARCHITECT-AGENT
**Status:** READY FOR STORY CREATION
**Target Audience:** Story-writing agents (DEV-AGENT, TECH-WRITER)

---

## Executive Summary

This brief provides comprehensive guidance for creating Epic 05 (Warehouse Module) stories with **LP Foundation as the critical path**. The Warehouse Module's primary value is providing License Plate (LP) infrastructure that Epic 04 Production Phase 1 is blocked on.

**Key Statistics:**
- PRD Lines: ~1,600
- Functional Requirements: 30 total (WH-FR-001 to WH-FR-030)
- Phase 0 (LP Foundation): 8 stories - **CRITICAL PATH**
- Phase 1 (Goods Receipt): 8 stories
- Phase 2 (Scanner): 8 stories
- Phase 3 (Advanced): 10 stories
- Phase 4 (Inventory): 6 stories
- Architecture: `/docs/1-BASELINE/architecture/modules/warehouse.md`
- PRD: `/docs/1-BASELINE/product/modules/warehouse.md`

**CRITICAL CONSTRAINT:** Phase 0 (LP Foundation) must complete first to unblock Epic 04 Production Phase 1 (10 blocked stories).

---

## 1. Story Breakdown Strategy

### 1.1 Phase Structure (LP-First)

| Phase | Focus | Stories | Days | Priority |
|-------|-------|---------|------|----------|
| **Phase 0** | **LP Foundation** | 8 | 8-12 | **CRITICAL PATH** |
| Phase 1 | Goods Receipt | 8 | 10-14 | P1 |
| Phase 2 | Scanner | 8 | 10-14 | P1 |
| Phase 3 | Advanced | 10 | 10-14 | P2 |
| Phase 4 | Inventory | 6 | 8-10 | P2 |

### 1.2 Phase 0 Story Breakdown (CRITICAL)

| Story | Name | PRD FRs | Complexity | UNBLOCKS |
|-------|------|---------|------------|----------|
| 05.0 | Warehouse Settings | WH-FR-* | M | All Phase 0 |
| **05.1** | **LP Table + Basic Service** | WH-FR-001, 002 | **L** | **Epic 04** |
| **05.2** | **LP Genealogy** | WH-FR-028 | **M** | **Epic 04** |
| **05.3** | **LP Reservations** | WH-FR-027 | **M** | **Epic 04** |
| **05.4** | **FIFO/FEFO Pick Suggestions** | WH-FR-019, 020 | **M** | **Epic 04** |
| 05.5 | LP CRUD (Desktop) | WH-FR-001, 002 | M | Manual mgmt |
| 05.6 | LP Split/Merge | WH-FR-006, 007 | M | Partial consume |
| 05.7 | QA Status Management | WH-FR-008 | M | Consumption validation |

**Stories 05.1-05.4 are HARD BLOCKERS for Epic 04 Production Phase 1**

### 1.3 Phase 1 Story Breakdown

| Story | Name | PRD FRs | Complexity | Dependencies |
|-------|------|---------|------------|--------------|
| 05.8 | GRN from PO | WH-FR-003 | L | 05.1, Epic 03.2 |
| 05.9 | GRN from TO | WH-FR-004 | M | 05.1, Epic 03.7 |
| 05.10 | ASN Management | WH-FR-015 | M | 05.8 |
| 05.11 | Stock Moves | WH-FR-005 | M | 05.1 |
| 05.12 | Batch/Expiry Tracking | WH-FR-009, 010 | M | 05.1 |
| 05.13 | Over-Receipt Control | WH-FR-029 | S | 05.8 |
| 05.14 | Label Printing (ZPL) | WH-FR-014 | M | 05.1 |
| 05.15 | Warehouse Dashboard | WH-FR-030 | M | 05.1-05.14 |

### 1.4 Phase 2 Story Breakdown (Scanner)

| Story | Name | PRD FRs | Complexity | Dependencies |
|-------|------|---------|------------|--------------|
| 05.16 | Scanner Login + Session | WH-FR-011 | S | 05.0 |
| 05.17 | Scanner Receive | WH-FR-011 | L | 05.8 |
| 05.18 | Scanner Move | WH-FR-012 | M | 05.11 |
| 05.19 | Scanner Putaway | WH-FR-013 | M | 05.4, 05.11 |
| 05.20 | Scanner Split | WH-FR-006 | S | 05.6 |
| 05.21 | Scanner Merge | WH-FR-007 | S | 05.6 |
| 05.22 | Scanner Pick | WH-FR-019, 020 | M | 05.4 |
| 05.23 | Scanner UI Components | WH-NFR-* | M | All scanner |

### 1.5 Phase 3 Story Breakdown (Advanced)

| Story | Name | PRD FRs | Complexity | Dependencies |
|-------|------|---------|------------|--------------|
| 05.24 | GS1 GTIN Support | WH-FR-017 | M | 05.17 |
| 05.25 | GS1 SSCC Support | WH-FR-018 | M | 05.26 |
| 05.26 | Pallet Management | WH-FR-016 | L | 05.1 |
| 05.27 | Catch Weight | WH-FR-021 | M | 05.1 |
| 05.28 | Shelf Life Calculation | WH-FR-022 | S | 05.12 |
| 05.29 | Location Capacity | WH-FR-025 | M | 05.0 |
| 05.30 | Zone Management | WH-FR-026 | M | 05.0 |
| 05.31 | LP Genealogy Tree View | WH-FR-028 | M | 05.2 |
| 05.32 | Stock Adjustments | WH-FR-024 | M | 05.11 |
| 05.33 | Expiry Alerts | WH-FR-030 | S | 05.12 |

### 1.6 Phase 4 Story Breakdown (Inventory)

| Story | Name | PRD FRs | Complexity | Dependencies |
|-------|------|---------|------------|--------------|
| 05.34 | Cycle Count Planning | WH-FR-023 | M | 05.0 |
| 05.35 | Cycle Count Execution | WH-FR-023 | L | 05.34 |
| 05.36 | Inventory Browser | WH-FR-* | M | 05.1 |
| 05.37 | Aging Report | WH-FR-019, 020 | S | 05.4 |
| 05.38 | Inventory Summary Report | WH-FR-* | S | 05.36 |
| 05.39 | Warehouse Polish | WH-NFR-* | M | All |

---

## 2. MVP Scope Definition

### 2.1 Phase 0 MVP (LP Foundation) - CRITICAL

These stories deliver the MINIMUM to unblock Epic 04:

| Story | Minimum Deliverables | Why Critical |
|-------|---------------------|--------------|
| 05.0 | `warehouse_settings` table, settings service | Foundation |
| 05.1 | `license_plates` table, LP service (create, read, consume) | **ALL Epic 04 LP operations** |
| 05.2 | `lp_genealogy` table, genealogy service | **Production traceability** |
| 05.3 | `lp_reservations` table, reservation service | **WO material allocation** |
| 05.4 | FIFO/FEFO query service | **Consumption ordering** |
| 05.5 | LP list page, detail panel | Manual management |
| 05.6 | Split/merge service | Partial consumption |
| 05.7 | QA status transitions | Consumption validation |

**What Phase 0 Does NOT Include:**
- GRN/ASN receiving workflow
- Scanner workflows
- Pallet management
- GS1 barcode parsing
- Label printing
- Dashboard
- Cycle counts
- Zone/capacity management

### 2.2 LP Table Schema (Phase 0)

```sql
CREATE TABLE license_plates (
  -- Identity
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  org_id UUID NOT NULL REFERENCES organizations(id),
  lp_number TEXT NOT NULL,

  -- Product Reference
  product_id UUID NOT NULL REFERENCES products(id),
  quantity DECIMAL(15,4) NOT NULL,
  uom TEXT NOT NULL,

  -- Location
  location_id UUID NOT NULL REFERENCES locations(id),
  warehouse_id UUID NOT NULL REFERENCES warehouses(id),

  -- Status
  status TEXT NOT NULL DEFAULT 'available',     -- available, reserved, consumed, blocked
  qa_status TEXT NOT NULL DEFAULT 'pending',    -- pending, passed, failed, quarantine

  -- Tracking
  batch_number TEXT,
  supplier_batch_number TEXT,
  expiry_date DATE,
  manufacture_date DATE,

  -- GS1 (Phase 3)
  gtin TEXT,

  -- Catch Weight (Phase 3)
  catch_weight_kg DECIMAL(10,3),

  -- References
  po_number TEXT,
  grn_id UUID,                                  -- Phase 1
  wo_id UUID,                                   -- WO that created this LP (output)
  parent_lp_id UUID REFERENCES license_plates(id),  -- For split/merge
  consumed_by_wo_id UUID,                       -- WO that consumed this LP
  pallet_id UUID,                               -- Phase 3

  -- Source
  source TEXT NOT NULL DEFAULT 'manual',        -- manual, receipt, production, return, adjustment

  -- Audit
  created_at TIMESTAMPTZ DEFAULT NOW(),
  created_by UUID REFERENCES users(id),
  updated_at TIMESTAMPTZ DEFAULT NOW(),

  -- Constraints
  UNIQUE(org_id, lp_number)
);

-- Indexes for Epic 04 queries
CREATE INDEX idx_lp_org_status ON license_plates(org_id, status);
CREATE INDEX idx_lp_org_product ON license_plates(org_id, product_id);
CREATE INDEX idx_lp_org_location ON license_plates(org_id, location_id);
CREATE INDEX idx_lp_org_qa ON license_plates(org_id, qa_status);
CREATE INDEX idx_lp_expiry ON license_plates(expiry_date) WHERE expiry_date IS NOT NULL;
CREATE INDEX idx_lp_created ON license_plates(created_at);

-- RLS
ALTER TABLE license_plates ENABLE ROW LEVEL SECURITY;

CREATE POLICY "LP org isolation" ON license_plates
  FOR ALL USING (org_id = (SELECT org_id FROM users WHERE id = auth.uid()));
```

### 2.3 LP Genealogy Schema (Phase 0)

```sql
CREATE TABLE lp_genealogy (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  org_id UUID NOT NULL REFERENCES organizations(id),
  parent_lp_id UUID NOT NULL REFERENCES license_plates(id),
  child_lp_id UUID NOT NULL REFERENCES license_plates(id),
  operation_type TEXT NOT NULL,                 -- split, merge, consume, output
  quantity DECIMAL(15,4) NOT NULL,
  operation_date TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  wo_id UUID REFERENCES work_orders(id),
  operation_id UUID,                            -- Reference to wo_operations
  is_reversed BOOLEAN DEFAULT false,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Indexes for traceability queries
CREATE INDEX idx_genealogy_parent ON lp_genealogy(parent_lp_id);
CREATE INDEX idx_genealogy_child ON lp_genealogy(child_lp_id);
CREATE INDEX idx_genealogy_wo ON lp_genealogy(wo_id) WHERE wo_id IS NOT NULL;

-- RLS
ALTER TABLE lp_genealogy ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Genealogy org isolation" ON lp_genealogy
  FOR ALL USING (org_id = (SELECT org_id FROM users WHERE id = auth.uid()));
```

### 2.4 LP Reservations Schema (Phase 0)

```sql
CREATE TABLE lp_reservations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  org_id UUID NOT NULL REFERENCES organizations(id),
  lp_id UUID NOT NULL REFERENCES license_plates(id),
  wo_id UUID REFERENCES work_orders(id),
  to_id UUID REFERENCES transfer_orders(id),
  reserved_qty DECIMAL(15,4) NOT NULL,
  status TEXT NOT NULL DEFAULT 'active',        -- active, released, consumed
  reserved_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  released_at TIMESTAMPTZ,
  reserved_by UUID REFERENCES users(id),
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_reservation_lp ON lp_reservations(lp_id);
CREATE INDEX idx_reservation_wo ON lp_reservations(wo_id) WHERE wo_id IS NOT NULL;
CREATE INDEX idx_reservation_status ON lp_reservations(org_id, status);

-- RLS
ALTER TABLE lp_reservations ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Reservation org isolation" ON lp_reservations
  FOR ALL USING (org_id = (SELECT org_id FROM users WHERE id = auth.uid()));
```

---

## 3. Story Template

### 3.1 Standard Story Structure

All Epic 05 stories should follow this template:

```markdown
# 05.X - [Story Title]

**Priority**: P0 (MVP) | P1 (Phase 1) | P2 (Phase 2+)
**Story Points**: S (1-2 days) | M (3-4 days) | L (5-7 days)
**Type:** backend | frontend | backend + frontend | scanner

**State:** ready | in_progress | done
**Primary PRD:** `docs/1-BASELINE/product/modules/warehouse.md` (WH-FR-XXX)
**Architecture:** `docs/1-BASELINE/architecture/modules/warehouse.md`

---

## MVP Scope

[Describe what is in this story's MVP scope]

---

## Epic 04 Dependency Status

[State if this story unblocks Epic 04 Production]
- [ ] CRITICAL - Unblocks Epic 04 Phase 1
- [ ] NOT CRITICAL - Can defer

---

## Goal

[1-2 sentences describing the objective]

## User Story

As a **[warehouse operator/manager]**, I want **[action]** so that **[benefit]**.

## Scope

**In scope (this story)**
- [Specific features]

**Out of scope (this story)**
- [What's NOT included, reference other stories]

## Dependencies

- **01.X** - [Description]
- **02.X** - [Description]
- **03.X** - [Description]

## Acceptance Criteria (Given/When/Then)

### AC-1: [Feature Name]

**Given** [precondition]
**When** [action]
**Then** [expected result]

[Repeat for all ACs - aim for 5-10 ACs per story]

## Scanner UI Requirements (if applicable)

### Touch Targets
- Minimum 48x48 pixels for all buttons
- Large barcode scan area

### Audio Feedback
- Success tone on valid scan
- Error beep on invalid scan

## Implementation Notes

### API Endpoints

```typescript
GET /api/warehouse/[resource]
POST /api/warehouse/[resource]
```

### Database

```sql
-- Reference tables from architecture doc
```

### Frontend Components

```
app/(authenticated)/warehouse/[route]/
  components/
    [ComponentName].tsx
```

### Services

```typescript
// lib/services/[resource]-service.ts
export async function [operation](): Promise<[Type]>
```

### Validation (Zod)

```typescript
const [schema]Schema = z.object({
  // Fields
});
```

### Key Business Rules

1. [Rule 1]
2. [Rule 2]

## Deliverables

- API routes: [list endpoints]
- Components: [list components]
- Services: [list services]
- Tests: [describe test coverage]

## Definition of Done

- [ ] [Checkbox items]
- [ ] API tests passing (>80% coverage)
- [ ] RLS policies verified
- [ ] E2E smoke test for critical path

---

## Future Phases (Not in This Story)

### Phase 1+
- [Feature] - Brief description

---

## Version History

| Version | Date | Changes | Author |
|---------|------|---------|--------|
| 1.0 | YYYY-MM-DD | Initial story | [Agent] |
```

### 3.2 Required Sections for Warehouse Stories

Every story MUST have:
1. **MVP Scope** - Clear boundaries
2. **Epic 04 Dependency Status** - Does this unblock Production?
3. **User Story** - As a / I want / So that
4. **Scanner UI Requirements** - For scanner stories (Phase 2)
5. **Acceptance Criteria** - Given/When/Then format (match PRD ACs)
6. **Key Business Rules** - From PRD Business Rules section
7. **Definition of Done** - Checkboxes
8. **Future Phases** - Deferred features

### 3.3 Complexity Guidelines

| Complexity | Days | When to Use | Model |
|------------|------|-------------|-------|
| S (Small) | 1-2 | Single feature, simple UI | sonnet |
| M (Medium) | 3-4 | Feature + relationships, moderate UI | sonnet |
| L (Large) | 5-7 | Complex logic, scanner UI, multiple entities | opus |

---

## 4. Dependency Map

### 4.1 Story Dependencies Within Epic 05

```
05.0 (Warehouse Settings)
     |
     +---> 05.1 (LP Table + Service) ============> EPIC 04 PHASE 1 STARTS
     |       |
     |       +---> 05.2 (LP Genealogy)
     |       |
     |       +---> 05.3 (LP Reservations)
     |       |
     |       +---> 05.4 (FIFO/FEFO Pick)
     |       |
     |       +---> 05.5 (LP CRUD Desktop)
     |       |
     |       +---> 05.6 (LP Split/Merge)
     |       |
     |       +---> 05.7 (QA Status)
     |       |
     |       v
     |   PHASE 0 COMPLETE
     |       |
     |       +---> 05.8 (GRN from PO) <---- Epic 03.2 (PO)
     |       |
     |       +---> 05.9 (GRN from TO) <---- Epic 03.7 (TO)
     |       |
     |       +---> 05.11 (Stock Moves)
     |       |
     |       v
     |   PHASE 1 STORIES
     |       |
     |       +---> 05.16-05.23 (Scanner Workflows)
     |       |
     |       v
     |   PHASE 2 COMPLETE
     |       |
     |       +---> 05.24-05.33 (Advanced)
     |       |
     |       v
     |   PHASE 3 COMPLETE
     |       |
     |       +---> 05.34-05.39 (Inventory)
     |       |
     |       v
     |   PHASE 4 COMPLETE
```

### 4.2 External Dependencies

| Epic 05 Story | From Epic 01 | From Epic 02 | From Epic 03 |
|---------------|--------------|--------------|--------------|
| 05.0 Settings | 01.1 (RLS) | - | - |
| 05.1 LP Table | 01.8 (Warehouses), 01.9 (Locations) | 02.1 (Products) | - |
| 05.8 GRN from PO | - | 02.1 (Products) | 03.2 (PO) |
| 05.9 GRN from TO | - | 02.1 (Products) | 03.7 (TO) |

### 4.3 What Epic 05 Unblocks

```
Epic 05 Phase 0 Complete
    |
    +---> Epic 04.6a Consumption Desktop
    +---> Epic 04.6b Consumption Scanner
    +---> Epic 04.6c 1:1 Consumption
    +---> Epic 04.6d Consumption Correction
    +---> Epic 04.6e Over-Consumption Control
    +---> Epic 04.7a Output Desktop
    +---> Epic 04.7b Output Scanner
    +---> Epic 04.7c By-Product Registration
    +---> Epic 04.7d Multiple Outputs
    +---> Epic 04.8 Material Reservations
    |
    v
    10 Epic 04 stories unblocked (18-24 days of work)
```

---

## 5. Agent Assignment Strategy

### 5.1 Parallel Development Waves

**Wave 1 (Phase 0 Foundation) - Days 1-4 - CRITICAL**

| Story | Agent | Model | Days | Notes |
|-------|-------|-------|------|-------|
| 05.0 Warehouse Settings | BACKEND-DEV | sonnet | 2 | Configure first |
| 05.1 LP Table + Service | BACKEND-DEV | opus | 3 | **CRITICAL - Start Day 1** |

**Wave 2 (Phase 0 Core) - Days 3-8 - CRITICAL**

| Story | Agent | Model | Days | Notes |
|-------|-------|-------|------|-------|
| 05.2 LP Genealogy | BACKEND-DEV | sonnet | 2 | After 05.1 |
| 05.3 LP Reservations | BACKEND-DEV | sonnet | 2 | After 05.1 |
| 05.4 FIFO/FEFO Pick | BACKEND-DEV | sonnet | 2 | After 05.1 |

**Wave 3 (Phase 0 Complete) - Days 7-12**

| Story | Agent | Model | Days | Notes |
|-------|-------|-------|------|-------|
| 05.5 LP CRUD Desktop | FULLSTACK-DEV | sonnet | 2 | After 05.1 |
| 05.6 LP Split/Merge | BACKEND-DEV | sonnet | 2 | After 05.1 |
| 05.7 QA Status | BACKEND-DEV | sonnet | 2 | After 05.1 |

**=== EPIC 04 PHASE 1 FULLY UNBLOCKED ===**

**Wave 4 (Phase 1 GRN) - Days 13-20**

| Story | Agent | Model | Days | Notes |
|-------|-------|-------|------|-------|
| 05.8 GRN from PO | FULLSTACK-DEV | opus | 4 | Core receiving |
| 05.9 GRN from TO | FULLSTACK-DEV | sonnet | 2 | After 05.8 |
| 05.10 ASN Management | FULLSTACK-DEV | sonnet | 2 | After 05.8 |

**Wave 5 (Phase 1 Complete) - Days 20-28**

| Story | Agent | Model | Days | Notes |
|-------|-------|-------|------|-------|
| 05.11 Stock Moves | BACKEND-DEV | sonnet | 2 | Movement audit |
| 05.12 Batch/Expiry | BACKEND-DEV | sonnet | 2 | Tracking |
| 05.13 Over-Receipt | BACKEND-DEV | sonnet | 1 | Validation |
| 05.14 Label Printing | FULLSTACK-DEV | sonnet | 2 | ZPL |
| 05.15 Dashboard | FULLSTACK-DEV | sonnet | 2 | KPIs |

**Wave 6+ (Phases 2-4) - Days 29+**

Scanner workflows, advanced features, inventory management.

### 5.2 Model Selection Guidelines

| Criterion | Use Opus | Use Sonnet |
|-----------|----------|------------|
| Complexity | L (5+ days) | S/M (1-4 days) |
| LP Table creation | Yes (critical) | No |
| Scanner UI | Yes (mobile-first) | No |
| GRN workflow | Yes (complex validation) | No |
| Simple CRUD | No | Yes |
| Single service | No | Yes |

**Opus-Required Stories:**
- 05.1 LP Table + Service (critical foundation)
- 05.8 GRN from PO (complex receiving)
- 05.17 Scanner Receive (mobile UX)
- 05.26 Pallet Management (multiple entities)
- 05.35 Cycle Count Execution (scanner)

**Sonnet-Suitable Stories:**
- 05.0 Settings (configuration)
- 05.2-05.7 (focused services)
- 05.9-05.15 (extensions to 05.8)
- 05.16, 05.18-05.23 (scanner extensions)
- 05.24-05.33 (advanced features)
- 05.34, 05.36-05.39 (inventory)

---

## 6. Scanner UI Guidelines

### 6.1 Design Principles (Phase 2)

For stories 05.16-05.23:

1. **Mobile-First**: Design for handheld devices with one-hand operation
2. **Large Touch Targets**: Minimum 48x48 pixels, prefer 64px for primary actions
3. **Clear Feedback**: Visual (green/red indicators) + Audio (tones/beeps)
4. **Minimal Steps**: Reduce workflow to essential screens only
5. **Offline Consideration**: Note Phase 3+ offline support requirement

### 6.2 Scanner Workflow Structure

```
+------------------+     +------------------+     +------------------+
| Scan Barcode     | --> | Validate         | --> | Enter Details    |
| (LP/Location)    |     | (status, match)  |     | (qty, reason)    |
+------------------+     +------------------+     +------------------+
                                                          |
+------------------+     +------------------+              |
| Print Label      | <-- | Confirm & Submit | <-----------+
| (ZPL to printer) |     | (Green check)    |
+------------------+     +------------------+
```

### 6.3 Audio Feedback Specification

| Event | Sound | Duration |
|-------|-------|----------|
| Valid scan | Success tone (high pitch) | 200ms |
| Invalid scan | Error beep (low pitch) | 300ms |
| Submission complete | Confirmation chime | 500ms |
| Network error | Alert tone | 400ms |

### 6.4 ZPL Label Template (for 05.14)

```zpl
^XA
^FO50,50^BY2
^BCN,100,Y,N,N
^FD{LP_NUMBER}^FS
^FO50,180^A0N,40,40^FD{PRODUCT_NAME}^FS
^FO50,230^A0N,30,30^FDQty: {QTY} {UOM}^FS
^FO50,270^A0N,30,30^FDBatch: {BATCH}^FS
^FO50,310^A0N,30,30^FDExp: {EXPIRY}^FS
^FO50,350^A0N,30,30^FDLoc: {LOCATION}^FS
^FO400,50^BQN,2,4
^FDQA,{QR_DATA}^FS
^XZ
```

---

## 7. Quality Checklist

Before submitting a story for review:

### 7.1 PRD Coverage
- [ ] All referenced WH-FR-XXX have ACs mapped
- [ ] ACs match PRD Given/When/Then format
- [ ] Business rules from PRD included
- [ ] Phase 1+ features documented in "Future Phases"

### 7.2 Epic 04 Dependency
- [ ] Epic 04 dependency status explicitly stated
- [ ] Phase 0 stories marked as CRITICAL if they unblock Epic 04
- [ ] Phase 1+ stories have clear dependency chain

### 7.3 Technical Completeness
- [ ] API endpoints fully specified (match Architecture doc)
- [ ] Database tables referenced from warehouse.md
- [ ] Service methods listed
- [ ] Zod validation schemas defined
- [ ] RLS policies mentioned

### 7.4 Scanner Stories (05.16-05.23)
- [ ] Touch target sizes specified (48px+)
- [ ] Audio feedback defined
- [ ] Workflow steps documented
- [ ] Error handling specified

### 7.5 Story Quality (INVEST)
- [ ] **I**ndependent: Can be developed standalone
- [ ] **N**egotiable: Scope can adjust if needed
- [ ] **V**aluable: Delivers user value
- [ ] **E**stimable: Complexity is clear (S/M/L)
- [ ] **S**mall: Can complete in 1 sprint
- [ ] **T**estable: ACs are verifiable

### 7.6 Definition of Done
- [ ] Has API test coverage target (>80%)
- [ ] Has E2E smoke test for critical path
- [ ] Has RLS policy test
- [ ] Scanner: Touch targets verified, audio tested

---

## 8. Story Index (To Be Created)

### Phase 0 - LP Foundation (CRITICAL PATH)

| Story ID | Name | Complexity | Priority | Status | UNBLOCKS |
|----------|------|------------|----------|--------|----------|
| 05.0 | Warehouse Settings | M | P0 | TO CREATE | All |
| **05.1** | **LP Table + Basic Service** | **L** | **P0** | **TO CREATE** | **Epic 04** |
| **05.2** | **LP Genealogy** | **M** | **P0** | **TO CREATE** | **Epic 04** |
| **05.3** | **LP Reservations** | **M** | **P0** | **TO CREATE** | **Epic 04** |
| **05.4** | **FIFO/FEFO Pick Suggestions** | **M** | **P0** | **TO CREATE** | **Epic 04** |
| 05.5 | LP CRUD (Desktop) | M | P0 | TO CREATE | UI |
| 05.6 | LP Split/Merge | M | P0 | TO CREATE | Partial |
| 05.7 | QA Status Management | M | P0 | TO CREATE | Validation |

**Phase 0 Stories: 8** (CRITICAL PATH)
**Estimated Days: 8-12**

### Phase 1 - Goods Receipt

| Story ID | Name | Complexity | Priority | Status |
|----------|------|------------|----------|--------|
| 05.8 | GRN from PO | L | P1 | TO CREATE |
| 05.9 | GRN from TO | M | P1 | TO CREATE |
| 05.10 | ASN Management | M | P1 | TO CREATE |
| 05.11 | Stock Moves | M | P1 | TO CREATE |
| 05.12 | Batch/Expiry Tracking | M | P1 | TO CREATE |
| 05.13 | Over-Receipt Control | S | P1 | TO CREATE |
| 05.14 | Label Printing (ZPL) | M | P1 | TO CREATE |
| 05.15 | Warehouse Dashboard | M | P1 | TO CREATE |

**Phase 1 Stories: 8**
**Estimated Days: 10-14**

### Phase 2 - Scanner Workflows

| Story ID | Name | Complexity | Priority | Status |
|----------|------|------------|----------|--------|
| 05.16 | Scanner Login + Session | S | P1 | TO CREATE |
| 05.17 | Scanner Receive | L | P1 | TO CREATE |
| 05.18 | Scanner Move | M | P1 | TO CREATE |
| 05.19 | Scanner Putaway | M | P1 | TO CREATE |
| 05.20 | Scanner Split | S | P1 | TO CREATE |
| 05.21 | Scanner Merge | S | P1 | TO CREATE |
| 05.22 | Scanner Pick | M | P1 | TO CREATE |
| 05.23 | Scanner UI Components | M | P1 | TO CREATE |

**Phase 2 Stories: 8**
**Estimated Days: 10-14**

### Phase 3 - Advanced Features

| Story ID | Name | Complexity | Priority | Status |
|----------|------|------------|----------|--------|
| 05.24 | GS1 GTIN Support | M | P2 | TO CREATE |
| 05.25 | GS1 SSCC Support | M | P2 | TO CREATE |
| 05.26 | Pallet Management | L | P2 | TO CREATE |
| 05.27 | Catch Weight | M | P2 | TO CREATE |
| 05.28 | Shelf Life Calculation | S | P2 | TO CREATE |
| 05.29 | Location Capacity | M | P2 | TO CREATE |
| 05.30 | Zone Management | M | P2 | TO CREATE |
| 05.31 | LP Genealogy Tree View | M | P2 | TO CREATE |
| 05.32 | Stock Adjustments | M | P2 | TO CREATE |
| 05.33 | Expiry Alerts | S | P2 | TO CREATE |

**Phase 3 Stories: 10**
**Estimated Days: 10-14**

### Phase 4 - Inventory Management

| Story ID | Name | Complexity | Priority | Status |
|----------|------|------------|----------|--------|
| 05.34 | Cycle Count Planning | M | P2 | TO CREATE |
| 05.35 | Cycle Count Execution | L | P2 | TO CREATE |
| 05.36 | Inventory Browser | M | P2 | TO CREATE |
| 05.37 | Aging Report | S | P2 | TO CREATE |
| 05.38 | Inventory Summary Report | S | P2 | TO CREATE |
| 05.39 | Warehouse Polish | M | P2 | TO CREATE |

**Phase 4 Stories: 6**
**Estimated Days: 8-10**

---

## 9. Handoff to Story Writers

### 9.1 Instructions for Story Creation

1. **Read PRD Section** - Each WH-FR-XXX has detailed ACs in PRD
2. **Use Template** - Follow template in Section 3
3. **Reference Architecture** - Use schema from warehouse.md
4. **Map FRs to ACs** - PRD ACs are comprehensive, use as-is
5. **Document Epic 04 Dependency** - Explicit for Phase 0 stories
6. **Scanner UI** - Include design specs for Phase 2 stories

### 9.2 File Naming Convention

```
docs/2-MANAGEMENT/epics/current/05-warehouse/
  05.0.epic-overview.md
  05.0.story-creation-brief.md (this file)
  MVP-DEPENDENCY-ANALYSIS.md
  05.0.warehouse-settings.md
  05.1.lp-table-service.md
  05.2.lp-genealogy.md
  05.3.lp-reservations.md
  05.4.fifo-fefo-pick.md
  05.5.lp-crud-desktop.md
  05.6.lp-split-merge.md
  05.7.qa-status-management.md
  05.8.grn-from-po.md
  05.9.grn-from-to.md
  ... (05.10 through 05.39)
```

### 9.3 Priority Order for Story Creation

**First Priority (Phase 0 - CRITICAL):**
1. 05.0 Warehouse Settings
2. 05.1 LP Table + Service
3. 05.2 LP Genealogy
4. 05.3 LP Reservations
5. 05.4 FIFO/FEFO Pick
6. 05.5 LP CRUD Desktop
7. 05.6 LP Split/Merge
8. 05.7 QA Status

**Second Priority (Phase 1):**
9. 05.8 GRN from PO
10. 05.9-05.15 (remaining Phase 1)

**Third Priority (Phases 2-4):**
11. 05.16-05.39 (as needed)

---

## 10. Risk Assessment

| Risk | Impact | Likelihood | Mitigation |
|------|--------|------------|------------|
| **Phase 0 delayed** | CRITICAL | LOW | Prioritize Phase 0, defer all else |
| **LP schema changes after Epic 04 starts** | HIGH | MEDIUM | Review schema with Epic 04 before starting |
| Genealogy complexity | MEDIUM | MEDIUM | Simple parent/child model first |
| RLS policy gaps | HIGH | LOW | Test multi-tenant isolation early |
| Scanner device issues | MEDIUM | MEDIUM | Test on multiple devices early |
| GS1 parsing edge cases | LOW | MEDIUM | Comprehensive test suite |
| Performance at scale | MEDIUM | LOW | Index strategy, pagination |

---

## 11. Key Business Rules Reference

From PRD, these rules MUST be enforced:

### License Plates
- LP number unique per organization
- Auto-generated: `{prefix}{zero-padded sequence}` (e.g., LP00000001)
- Status transitions: available -> reserved/consumed/blocked
- QA Status: pending -> passed/failed/quarantine
- Consumed LP cannot be modified (immutable except reversal)

### FIFO/FEFO
- FIFO: ORDER BY created_at ASC
- FEFO: ORDER BY expiry_date ASC (takes precedence if both enabled)
- Warning on violation, allow override with audit
- Exclude expired LPs from suggestions

### Split/Merge
- Split qty must be less than source LP qty
- Merge requires same product, UoM, batch, expiry, QA status
- Genealogy link created for all operations

### Consumption
- LP must be status='available', qa_status='passed'
- Consume qty cannot exceed LP qty
- Full consumption sets status='consumed'
- Genealogy link to output LP

### Output
- WO creates output LP with source='production'
- Genealogy links consumed LPs as parents
- QA status from settings or WO configuration
- Expiry calculated from product shelf_life_days

---

## Version History

| Version | Date | Changes | Author |
|---------|------|---------|--------|
| 1.0 | 2025-12-16 | Initial story creation brief with LP-first strategy | ARCHITECT-AGENT |
