# 03.17 - Planning Settings (Module Configuration)

**Priority**: P1 (Phase 1)
**Story Points**: S (1-2 days)
**Type:** backend + frontend

**State:** ready
**Primary PRD:** `docs/1-BASELINE/product/modules/planning.md` (Section 9, Lines 914-1007)
**Architecture:** `docs/1-BASELINE/architecture/modules/planning.md` (planning_settings table)
**UX Wireframes:** PLAN-024

---

## MVP Scope

Story 03.17 implements the Planning Module's configuration UI and backend, enabling administrators to control PO, TO, and WO behavior through a centralized settings page.

**MVP Includes**:
1. **Planning Settings Page** (`/settings/planning`) with three collapsible sections
2. **PO Settings Section** - Approval workflow, numbering format, payment terms defaults
3. **TO Settings Section** - Partial shipments, LP selection, numbering format
4. **WO Settings Section** - Auto BOM select, routing copy, material check, numbering
5. **API Endpoints** - GET/PUT `/api/settings/planning`
6. **Service Layer** - Settings CRUD with org scoping and defaults
7. **Validation Schemas** - Zod schemas for all settings fields
8. **Tests** - Unit and E2E coverage

**Note**: Status configuration (drag-drop reordering, custom statuses) is deferred to Phase 2.

---

## Goal

Provide administrators with a single page to configure all planning module behavior including purchase order approval workflows, transfer order shipping rules, work order material checks, and auto-numbering formats.

## User Story

As an **Administrator**, I want **a centralized planning settings page where I can configure PO/TO/WO defaults and business rules** so that **the planning module behavior matches my organization's procurement and production policies**.

## Scope

**In scope (this story)**
- Planning Settings UI page at `/settings/planning`
- Three collapsible sections: PO Settings, TO Settings, WO Settings
- 18 configurable settings fields (see Implementation Notes for full list)
- GET/PUT API endpoints for settings persistence
- Service layer with org scoping and auto-initialization
- Zod validation for all settings fields
- Settings defaults per PRD (approval disabled, partial shipments enabled, etc.)
- RLS enforcement (org-isolated settings)
- Unit tests for service layer and validation
- E2E test for settings page load and save

**Out of scope (this story)**
- Status configuration UI (drag-drop reorder, custom statuses) - Phase 2
- Status lifecycle visualization - Phase 2
- MRP/Forecasting settings - Phase 2 (Epic 03b)
- Supplier quality settings - Phase 3
- Field visibility configuration - Phase 2
- Import/Export settings - Phase 2

## Dependencies

- **01.1** - Organization Context + RLS (for org_id scoping)
- **01.14** - Settings Infrastructure (if unified settings pattern exists)
- **03.5a** - PO Approval Setup (partial overlap on approval settings, 03.5a can proceed in parallel)

**Dependents:**
- **03.3** - PO CRUD (reads po_require_approval, po_auto_number_prefix, etc.)
- **03.5b** - PO Approval Workflow (reads po_approval_threshold, po_approval_roles)
- **03.8** - TO CRUD (reads to_allow_partial_shipments, to_auto_number_prefix)
- **03.9a** - TO Partial Shipments (reads to_allow_partial_shipments)
- **03.10** - WO CRUD (reads wo_auto_select_bom, wo_require_bom, wo_auto_number_prefix)
- **03.11a** - WO Materials (reads wo_material_check)
- **03.12** - WO Operations (reads wo_copy_routing)

---

## Acceptance Criteria (Given/When/Then)

### AC-1: Planning Settings Page Loads

**Given** I am authenticated as an administrator
**When** I navigate to `/settings/planning`
**Then** the Planning Settings page loads successfully
**And** I see the page header "Planning Settings"
**And** I see a description: "Configure planning module behavior including purchase orders, transfer orders, work orders, and custom status management."
**And** I see three collapsible sections:
  - ðŸ“¦ Purchase Order Settings
  - ðŸšš Transfer Order Settings
  - ðŸ­ Work Order Settings
**And** all sections are expanded by default
**And** I see a "Save Changes" button (disabled if no changes)

### AC-2: PO Settings Section - Fields and Defaults

**Given** I am on the Planning Settings page
**When** the page loads
**Then** I see the PO Settings section with the following fields:

| Field | Type | Default | Validation |
|-------|------|---------|------------|
| **Require PO Approval** | Toggle | OFF | boolean |
| **Approval Threshold Amount** | Number | null (disabled) | decimal(15,4), nullable, >= 0 |
| **Approval Roles** | Multi-select | ['admin', 'manager'] | array of role slugs |
| **Auto-Numbering Prefix** | Text | 'PO-' | text, 1-10 chars, alphanumeric + dash |
| **Auto-Numbering Format** | Text | 'YYYY-NNNNN' | text, must contain YYYY and NNNNN |
| **Default Payment Terms** | Dropdown | 'Net 30' | enum: Net 30, Net 60, Net 90, 2/10 Net 30, Due on Receipt |
| **Default Currency** | Dropdown | 'PLN' | enum: PLN, EUR, USD, GBP |

**And** each field has a label and help text explaining its purpose
**And** "Approval Threshold Amount" is disabled (grayed out) when "Require PO Approval" is OFF
**And** help text for "Auto-Numbering Format" shows example: "Example: PO-2025-00123"

### AC-3: TO Settings Section - Fields and Defaults

**Given** I am on the Planning Settings page
**When** the page loads
**Then** I see the TO Settings section with the following fields:

| Field | Type | Default | Validation |
|-------|------|---------|------------|
| **Allow Partial Shipments** | Toggle | ON | boolean |
| **Require License Plate Selection** | Toggle | OFF | boolean |
| **Auto-Numbering Prefix** | Text | 'TO-' | text, 1-10 chars, alphanumeric + dash |
| **Auto-Numbering Format** | Text | 'YYYY-NNNNN' | text, must contain YYYY and NNNNN |
| **Default Transit Days** | Number | 1 | integer, >= 0, <= 365 |

**And** each field has a label and help text
**And** help text for "Require License Plate Selection" says: "Require LP assignment when creating transfer order (requires Epic 05 - Warehouse)"
**And** help text for "Auto-Numbering Format" shows example: "Example: TO-2025-00042"

### AC-4: WO Settings Section - Fields and Defaults

**Given** I am on the Planning Settings page
**When** the page loads
**Then** I see the WO Settings section with the following fields:

| Field | Type | Default | Validation |
|-------|------|---------|------------|
| **Check Material Availability on Create** | Toggle | ON | boolean |
| **Copy Routing Operations to WO** | Toggle | ON | boolean |
| **Auto-Select Active BOM** | Toggle | ON | boolean |
| **Require BOM to Create WO** | Toggle | ON | boolean |
| **Allow Overproduction** | Toggle | OFF | boolean |
| **Overproduction Limit (%)** | Number | 10 | decimal(5,2), >= 0, <= 100 |
| **Auto-Numbering Prefix** | Text | 'WO-' | text, 1-10 chars, alphanumeric + dash |
| **Auto-Numbering Format** | Text | 'YYYY-NNNNN' | text, must contain YYYY and NNNNN |
| **Default Scheduling Buffer (hours)** | Number | 2 | integer, >= 0, <= 168 |

**And** each field has a label and help text
**And** "Overproduction Limit (%)" is disabled when "Allow Overproduction" is OFF
**And** help text for "Auto-Numbering Format" shows example: "Example: WO-2025-00078"
**And** help text for "Require BOM to Create WO" says: "Block WO creation if product has no active BOM"

### AC-5: Settings Auto-Initialization on First Access

**Given** organization has no `planning_settings` record
**When** I navigate to `/settings/planning` for the first time
**Then** a new `planning_settings` record is auto-created with defaults
**And** all fields display default values as defined in AC-2, AC-3, AC-4
**And** the settings record has `org_id = current_user.org_id`
**And** `created_at` and `updated_at` timestamps are set

### AC-6: Settings Update - Success Path

**Given** I have loaded the Planning Settings page
**When** I change "Require PO Approval" from OFF to ON
**And** I set "Approval Threshold Amount" to 5000.00
**And** I click "Save Changes"
**Then** I see a success toast: "Planning settings saved successfully"
**And** the "Save Changes" button becomes disabled (no unsaved changes)
**And** if I reload the page, my changes persist
**And** the `updated_at` timestamp is updated in the database

### AC-7: Settings Update - Validation Errors

**Given** I am on the Planning Settings page
**When** I set "Auto-Numbering Format" to "INVALID" (missing YYYY or NNNNN)
**And** I click "Save Changes"
**Then** I see a validation error: "Format must contain both YYYY (year) and NNNNN (sequence)"
**And** the settings are not saved to the database
**And** the field is highlighted in red

**Examples of invalid formats:**
- "YYYY" (missing NNNNN)
- "NNNNN" (missing YYYY)
- "ABC-123" (missing both)
- Empty string

### AC-8: Settings Update - Approval Threshold Logic

**Given** "Require PO Approval" is ON
**And** "Approval Threshold Amount" is null (empty)
**When** I save settings
**Then** settings save successfully
**And** ALL POs will require approval regardless of amount

**Given** "Require PO Approval" is ON
**And** "Approval Threshold Amount" is 10000.00
**When** I save settings
**Then** settings save successfully
**And** only POs with total >= 10000.00 will require approval

**Given** "Require PO Approval" is OFF
**When** I save settings
**Then** "Approval Threshold Amount" is saved but not enforced
**And** NO POs require approval

### AC-9: Collapsible Sections

**Given** I am on the Planning Settings page
**When** I click "Collapse" button on PO Settings section header
**Then** the PO Settings section collapses (fields hidden)
**And** the button changes to "Expand"
**And** the section header remains visible

**When** I click "Expand" button
**Then** the PO Settings section expands (fields visible)
**And** the button changes to "Collapse"

**And** collapse state persists in localStorage: `planning_settings_sections_collapsed: ["po"]`
**And** when I reload the page, collapsed sections remain collapsed

### AC-10: RLS and Multi-Tenancy

**Given** I am a user in Organization A
**When** I load `/settings/planning`
**Then** I see only Organization A's planning settings
**And** API query filters by `org_id = current_user.org_id`
**And** RLS policy enforces org isolation

**When** I save changes
**Then** only Organization A's settings are updated
**And** Organization B's settings remain unchanged

**When** I switch organizations (via org selector)
**Then** the settings page reloads with new organization's settings
**And** unsaved changes are discarded with confirmation prompt

### AC-11: Unsaved Changes Warning

**Given** I have made changes to settings fields
**And** I have NOT clicked "Save Changes"
**When** I attempt to navigate away from the page
**Then** I see a browser confirmation dialog: "You have unsaved changes. Are you sure you want to leave?"

**When** I click "Cancel"
**Then** I remain on the settings page
**And** my changes are preserved

**When** I click "OK" (confirm)
**Then** I navigate away
**And** unsaved changes are discarded

### AC-12: Settings Persistence Across Stories

**Given** settings are saved via Story 03.17 (this story)
**When** I navigate to PO creation page (Story 03.3)
**Then** the PO form uses settings from `planning_settings`:
  - Auto-number format: `po_auto_number_prefix` + `po_auto_number_format`
  - Default payment terms: `po_default_payment_terms`
  - Default currency: `po_default_currency`

**When** I create a WO (Story 03.10)
**Then** the WO creation logic reads settings:
  - Auto-select BOM: `wo_auto_select_bom`
  - Require BOM: `wo_require_bom`
  - Material check: `wo_material_check`

**When** I create a TO (Story 03.8)
**Then** the TO creation logic reads settings:
  - Allow partial shipments: `to_allow_partial_shipments`
  - Auto-number format: `to_auto_number_prefix` + `to_auto_number_format`

### AC-13: Future Features (Phase 2+)

Features deferred to Phase 2+:
- **Status Configuration UI** - Drag-drop reorder, custom statuses (PLAN-024 wireframe complete)
- **Status Lifecycle Visualization** - State machine diagram
- **Field Visibility Configuration** - Hide/show optional fields on PO/TO/WO forms
- **MRP/Forecasting Settings** - Safety stock days, forecast horizon, auto-PO/WO rules
- **Import/Export Settings** - Bulk settings import from JSON/YAML
- **Settings Audit Log** - Track who changed which setting when

**Implementation**: Per Epic 03.0 guidance, do not show placeholders for Phase 2+ features.

---

## Implementation Notes

### API Endpoints

```typescript
// Get planning settings for current org
GET /api/settings/planning
Query Params: (none - org_id from session)
Response: {
  id: string
  org_id: string
  // PO Settings
  po_require_approval: boolean
  po_approval_threshold: number | null
  po_approval_roles: string[]
  po_auto_number_prefix: string
  po_auto_number_format: string
  po_default_payment_terms: string
  po_default_currency: string
  // TO Settings
  to_allow_partial_shipments: boolean
  to_require_lp_selection: boolean
  to_auto_number_prefix: string
  to_auto_number_format: string
  to_default_transit_days: number
  // WO Settings
  wo_material_check: boolean
  wo_copy_routing: boolean
  wo_auto_select_bom: boolean
  wo_require_bom: boolean
  wo_allow_overproduction: boolean
  wo_overproduction_limit: number
  wo_auto_number_prefix: string
  wo_auto_number_format: string
  wo_default_scheduling_buffer_hours: number
  // Audit
  created_at: string
  updated_at: string
}

// Update planning settings for current org
PUT /api/settings/planning
Request Body: Partial<PlanningSettings>
Response: {
  success: boolean
  message: string
  settings: PlanningSettings
}

// Note: No DELETE endpoint - settings are singleton per org
```

### Database

Reference from `docs/1-BASELINE/architecture/modules/planning.md`:

```sql
-- planning_settings table (already defined in architecture)
CREATE TABLE planning_settings (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  org_id UUID NOT NULL UNIQUE REFERENCES organizations(id),

  -- PO Settings
  po_require_approval BOOLEAN DEFAULT false,
  po_approval_threshold DECIMAL(15,4),
  po_approval_roles TEXT[] DEFAULT ARRAY['admin', 'manager'],
  po_auto_number_prefix TEXT DEFAULT 'PO-',
  po_auto_number_format TEXT DEFAULT 'YYYY-NNNNN',
  po_default_payment_terms TEXT DEFAULT 'Net 30',
  po_default_currency TEXT DEFAULT 'PLN',

  -- TO Settings
  to_allow_partial_shipments BOOLEAN DEFAULT true,
  to_require_lp_selection BOOLEAN DEFAULT false,
  to_auto_number_prefix TEXT DEFAULT 'TO-',
  to_auto_number_format TEXT DEFAULT 'YYYY-NNNNN',
  to_default_transit_days INTEGER DEFAULT 1,

  -- WO Settings
  wo_material_check BOOLEAN DEFAULT true,
  wo_copy_routing BOOLEAN DEFAULT true,
  wo_auto_select_bom BOOLEAN DEFAULT true,
  wo_require_bom BOOLEAN DEFAULT true,
  wo_allow_overproduction BOOLEAN DEFAULT false,
  wo_overproduction_limit DECIMAL(5,2) DEFAULT 10,
  wo_auto_number_prefix TEXT DEFAULT 'WO-',
  wo_auto_number_format TEXT DEFAULT 'YYYY-NNNNN',
  wo_default_scheduling_buffer_hours INTEGER DEFAULT 2,

  -- Status Configuration (Phase 2)
  po_statuses JSONB NOT NULL DEFAULT '["draft","submitted","pending_approval","approved","confirmed","receiving","closed","cancelled"]',
  to_statuses JSONB NOT NULL DEFAULT '["draft","planned","partially_shipped","shipped","partially_received","received","closed"]',
  wo_statuses JSONB NOT NULL DEFAULT '["draft","planned","released","in_progress","on_hold","completed","closed","cancelled"]',

  -- MRP Settings (Phase 2 - not exposed in UI yet)
  mrp_enabled BOOLEAN DEFAULT false,
  safety_stock_days INTEGER DEFAULT 7,
  forecast_horizon_days INTEGER DEFAULT 30,

  -- Audit
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- RLS Policies
ALTER TABLE planning_settings ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view planning_settings for their org"
  ON planning_settings FOR SELECT
  USING (org_id = auth.uid_org());

CREATE POLICY "Admins can update planning_settings for their org"
  ON planning_settings FOR UPDATE
  USING (org_id = auth.uid_org())
  WITH CHECK (org_id = auth.uid_org());

CREATE POLICY "System can insert planning_settings for any org"
  ON planning_settings FOR INSERT
  WITH CHECK (true);

-- Indexes
CREATE INDEX idx_planning_settings_org ON planning_settings(org_id);
```

**Note**: `po_statuses`, `to_statuses`, `wo_statuses` fields exist in table but are NOT exposed in UI for this story (Phase 2).

### Frontend Components

```
app/(authenticated)/settings/planning/
  page.tsx                              -> Planning Settings page (server component)

components/settings/planning/
  PlanningSettingsForm.tsx              -> Main form component (client component)
  POSettingsSection.tsx                 -> PO settings section
  TOSettingsSection.tsx                 -> TO settings section
  WOSettingsSection.tsx                 -> WO settings section
  CollapsibleSection.tsx                -> Reusable collapsible section wrapper
```

### Services

```typescript
// lib/services/planning-settings-service.ts
export async function getPlanningSettings(orgId: string): Promise<PlanningSettings>
export async function updatePlanningSettings(
  orgId: string,
  updates: Partial<PlanningSettings>
): Promise<PlanningSettings>
export async function initializePlanningSettingsIfMissing(orgId: string): Promise<PlanningSettings>

interface PlanningSettings {
  id: string
  org_id: string
  // PO Settings
  po_require_approval: boolean
  po_approval_threshold: number | null
  po_approval_roles: string[]
  po_auto_number_prefix: string
  po_auto_number_format: string
  po_default_payment_terms: string
  po_default_currency: string
  // TO Settings
  to_allow_partial_shipments: boolean
  to_require_lp_selection: boolean
  to_auto_number_prefix: string
  to_auto_number_format: string
  to_default_transit_days: number
  // WO Settings
  wo_material_check: boolean
  wo_copy_routing: boolean
  wo_auto_select_bom: boolean
  wo_require_bom: boolean
  wo_allow_overproduction: boolean
  wo_overproduction_limit: number
  wo_auto_number_prefix: string
  wo_auto_number_format: string
  wo_default_scheduling_buffer_hours: number
  // Audit
  created_at: string
  updated_at: string
}
```

### Validation (Zod)

```typescript
// lib/validation/planning-settings-schemas.ts
import { z } from 'zod'

const autoNumberFormatRegex = /YYYY.*NNNNN|NNNNN.*YYYY/

export const planningSettingsSchema = z.object({
  // PO Settings
  po_require_approval: z.boolean(),
  po_approval_threshold: z.number().min(0).nullable(),
  po_approval_roles: z.array(z.string()).min(1).default(['admin', 'manager']),
  po_auto_number_prefix: z.string().min(1).max(10).regex(/^[A-Za-z0-9-]+$/),
  po_auto_number_format: z.string().regex(autoNumberFormatRegex, {
    message: 'Format must contain both YYYY (year) and NNNNN (sequence)'
  }),
  po_default_payment_terms: z.enum(['Net 30', 'Net 60', 'Net 90', '2/10 Net 30', 'Due on Receipt']),
  po_default_currency: z.enum(['PLN', 'EUR', 'USD', 'GBP']),

  // TO Settings
  to_allow_partial_shipments: z.boolean(),
  to_require_lp_selection: z.boolean(),
  to_auto_number_prefix: z.string().min(1).max(10).regex(/^[A-Za-z0-9-]+$/),
  to_auto_number_format: z.string().regex(autoNumberFormatRegex, {
    message: 'Format must contain both YYYY (year) and NNNNN (sequence)'
  }),
  to_default_transit_days: z.number().int().min(0).max(365),

  // WO Settings
  wo_material_check: z.boolean(),
  wo_copy_routing: z.boolean(),
  wo_auto_select_bom: z.boolean(),
  wo_require_bom: z.boolean(),
  wo_allow_overproduction: z.boolean(),
  wo_overproduction_limit: z.number().min(0).max(100),
  wo_auto_number_prefix: z.string().min(1).max(10).regex(/^[A-Za-z0-9-]+$/),
  wo_auto_number_format: z.string().regex(autoNumberFormatRegex, {
    message: 'Format must contain both YYYY (year) and NNNNN (sequence)'
  }),
  wo_default_scheduling_buffer_hours: z.number().int().min(0).max(168)
}).partial() // Allow partial updates

export const planningSettingsUpdateSchema = planningSettingsSchema

export type PlanningSettingsInput = z.infer<typeof planningSettingsSchema>
```

### Key Business Rules

1. **Singleton Per Org** - One `planning_settings` record per organization (enforced by UNIQUE constraint on org_id)
2. **Auto-Initialization** - If org has no settings record, auto-create with defaults on first GET request
3. **Approval Threshold Logic**:
   - If `po_require_approval = false`, no POs require approval
   - If `po_require_approval = true` AND `po_approval_threshold = null`, ALL POs require approval
   - If `po_require_approval = true` AND `po_approval_threshold = X`, only POs with total >= X require approval
4. **Dependent Field Logic**:
   - `po_approval_threshold` only enforced when `po_require_approval = true`
   - `wo_overproduction_limit` only enforced when `wo_allow_overproduction = true`
5. **Auto-Number Format Validation** - Must contain both YYYY (year) and NNNNN (sequence) placeholders
6. **RLS Enforcement** - All queries filtered by `org_id` from session
7. **Partial Updates** - PUT endpoint accepts partial updates (only changed fields sent)
8. **Settings Propagation** - Other stories (03.3, 03.8, 03.10) read settings on entity creation
9. **Unsaved Changes Guard** - Browser `beforeunload` event warns user of unsaved changes
10. **Collapse State Persistence** - Section collapse state saved to localStorage

---

## Deliverables

### API Routes
- `GET /api/settings/planning` - Fetch settings for current org (auto-initialize if missing)
- `PUT /api/settings/planning` - Update settings for current org

### Components
- `PlanningSettingsForm.tsx` - Main form with save button and unsaved changes tracking
- `POSettingsSection.tsx` - PO settings fields (7 fields)
- `TOSettingsSection.tsx` - TO settings fields (5 fields)
- `WOSettingsSection.tsx` - WO settings fields (9 fields)
- `CollapsibleSection.tsx` - Reusable collapsible section wrapper

### Services
- `planning-settings-service.ts` - CRUD operations with org scoping and auto-initialization

### Validation Schemas
- `planning-settings-schemas.ts` - Zod schemas for settings validation

### Tests
- **Unit Tests**:
  - `planning-settings-service.test.ts` - Service layer tests
  - `planning-settings-schemas.test.ts` - Validation tests
  - `planning-settings-api.test.ts` - API route tests
- **E2E Tests**:
  - `planning-settings.spec.ts` - Page loads, sections collapse/expand, save success/error, RLS

---

## Definition of Done

- [ ] Planning Settings page renders at `/settings/planning`
- [ ] All three sections (PO, TO, WO) display with correct fields and defaults
- [ ] Collapsible sections work correctly (expand/collapse with state persistence)
- [ ] GET `/api/settings/planning` returns settings (auto-initializes if missing)
- [ ] PUT `/api/settings/planning` saves changes and returns updated settings
- [ ] Validation errors display for invalid inputs (auto-number format, negative numbers)
- [ ] "Approval Threshold Amount" field disabled when "Require PO Approval" is OFF
- [ ] "Overproduction Limit (%)" field disabled when "Allow Overproduction" is OFF
- [ ] Success toast displays after successful save
- [ ] Unsaved changes warning displays when navigating away with changes
- [ ] RLS policies enforce org_id isolation
- [ ] Multi-tenancy tested (org A cannot see org B's settings)
- [ ] Settings persist across page reloads
- [ ] Service layer has >80% test coverage
- [ ] API routes have >80% test coverage
- [ ] E2E smoke test passes (load, edit, save, verify)
- [ ] Mobile responsive (sections stack vertically, fields full-width on small screens)
- [ ] Story 03.3 (PO CRUD) can read settings from `planning_settings` table
- [ ] Story 03.8 (TO CRUD) can read settings from `planning_settings` table
- [ ] Story 03.10 (WO CRUD) can read settings from `planning_settings` table

---

## Future Phases (Not in MVP)

### Phase 1
- **Approval Roles Multi-Select** - Populate from Epic 01.10 roles table (currently hardcoded)
- **Settings Validation on Dependent Stories** - Enforce settings in PO/TO/WO creation logic

### Phase 2
- **Status Configuration UI** - Drag-drop reorder, add/edit/delete custom statuses (PLAN-024 wireframe ready)
- **Status Lifecycle Visualization** - State machine diagram showing valid transitions
- **Field Visibility Configuration** - Show/hide optional fields on PO/TO/WO forms via `po_field_visibility` JSONB
- **MRP/Forecasting Settings** - Safety stock days, forecast horizon, auto-PO/WO generation rules
- **Settings Templates** - Pre-configured settings for common industry types (bakery, dairy, beverage)
- **Import/Export Settings** - Bulk settings import from JSON/YAML for multi-org deployments

### Phase 3
- **Settings Audit Log** - Track who changed which setting when (separate `settings_audit` table)
- **Settings Permissions** - Fine-grained permissions (e.g., can change PO settings but not WO settings)
- **Settings Versioning** - Rollback to previous settings versions
- **Settings API Webhooks** - Notify external systems when settings change

**Implementation**: See Epic 03.0 "Future Feature Handling" section.

---

## Version History

| Version | Date | Changes | Author |
|---------|------|---------|--------|
| 1.0 | 2025-12-16 | Initial story creation | ARCHITECT-AGENT |
