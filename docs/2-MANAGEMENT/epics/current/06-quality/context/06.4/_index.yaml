# Story 06.4 - Index File (Entry Point)
# Generated: 2025-12-17
# Purpose: Story metadata and dependencies - read this first

story:
  id: "06.4"
  name: "Test Parameters"
  slug: "test-parameters"
  epic: "06-quality"
  phase: "1A"
  complexity: "M"
  estimate_days: 3
  type: "full-stack"
  state: "ready"

# Files in this context folder
context_files:
  - _index.yaml      # This file - metadata, dependencies
  - database.yaml    # Tables, RLS, seed data
  - api.yaml         # Endpoints, auth, errors
  - frontend.yaml    # Components, hooks, validation
  - tests.yaml       # Acceptance criteria, test specifications

# Dependencies
dependencies:
  required:
    - story: "01.1"
      name: "Org Context + Base RLS"
      provides: ["organizations", "users", "roles tables", "RLS pattern"]
    - story: "02.1"
      name: "Products CRUD"
      provides: ["products table", "product reference for specs"]
    - story: "06.3"
      name: "Product Specifications"
      provides: ["quality_specifications table", "spec_id FK reference"]
  blocked_by:
    - story: "06.3"
      reason: "Parameters attach to specifications - spec must exist first"
  blocks:
    - story: "06.5"
      name: "Incoming Inspection"
      reason: "Parameters define what to inspect"
    - story: "06.6"
      name: "Test Results Recording"
      reason: "Parameters define what values to record"
    - story: "06.10"
      name: "In-Process Inspection"
      reason: "Parameters reference for inspection"
    - story: "06.11"
      name: "Final Inspection"
      reason: "Parameters reference for inspection"
    - story: "06.18"
      name: "Test Result Trending"
      reason: "Parameter data for trending analysis"
    - story: "06.27"
      name: "CoA Templates"
      reason: "Parameters for Certificate of Analysis"

# Reference Documents
files_to_read:
  prd:
    path: "docs/1-BASELINE/product/modules/quality.md"
    sections: ["FR-QA-004", "quality_spec_parameters table"]
  architecture:
    path: "docs/1-BASELINE/architecture/modules/quality.md"
    sections: ["quality_spec_parameters", "Database Schema", "API Design"]
  story:
    path: "docs/2-MANAGEMENT/epics/current/06-quality/06.4.test-parameters.md"
  wireframes:
    - path: "docs/3-ARCHITECTURE/ux/wireframes/QA-004-test-templates.md"
      sections: ["Add/Edit Parameter Modal", "Test Parameters table"]
  adrs:
    - path: "docs/1-BASELINE/architecture/decisions/ADR-013-rls-org-isolation-pattern.md"
      relevance: "RLS policy pattern for org isolation via quality_specifications"
  patterns:
    - path: "apps/frontend/lib/services/specification-service.ts"
      relevance: "Service pattern for quality module"

# High-level deliverables
deliverables:
  - type: "migration"
    count: 1
    description: "Create quality_spec_parameters table with RLS + functions"
  - type: "service"
    count: 1
    description: "spec-parameter-service.ts - CRUD, reorder, validation"
  - type: "api"
    count: 5
    description: "GET/POST/PUT/DELETE/PATCH endpoints for parameters"
  - type: "validation"
    count: 1
    description: "Zod schemas for parameter types with type-specific validation"
  - type: "components"
    count: 7
    description: "Parameter editor components with drag-to-reorder"
  - type: "test"
    count: 3
    description: "Unit + integration + E2E tests"

# Technical notes
technical_notes:
  - "Parameters belong to specifications - RLS via spec_id FK lookup"
  - "4 parameter types: numeric, text, boolean, range"
  - "Numeric/range require min/max validation"
  - "Drag-to-reorder via react-dnd or @dnd-kit"
  - "Critical parameters (is_critical) affect overall inspection pass/fail"
  - "Draft-only editing - trigger blocks modification on active specs"
  - "Sequence auto-generated on create, updatable via reorder endpoint"
  - "Value validation logic exported for use in Story 06.6 (Test Results)"
