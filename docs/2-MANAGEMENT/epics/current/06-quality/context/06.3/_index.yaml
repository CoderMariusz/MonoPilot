# Story 06.3 - Index File (Entry Point)
# Generated: 2025-12-17
# Purpose: Story metadata and dependencies - read this first

story:
  id: "06.3"
  name: "Product Specifications"
  slug: "product-specifications"
  epic: "06-quality"
  phase: "1A"
  complexity: "M"
  estimate_days: 3
  type: "full-stack"
  state: "ready"

# Files in this context folder
context_files:
  - _index.yaml      # This file - metadata, dependencies
  - database.yaml    # Tables, RLS, seed data
  - api.yaml         # Endpoints, auth, errors
  - frontend.yaml    # Pages, components, validation
  - tests.yaml       # Acceptance criteria, test specifications

# Dependencies
dependencies:
  required:
    - story: "01.1"
      name: "Org Context + Base RLS"
      provides: ["organizations", "users", "roles", "RLS patterns"]
    - story: "02.1"
      name: "Products CRUD"
      provides: ["products table", "product-service.ts"]
  blocked_by:
    - story: "06.0"
      name: "Quality Settings"
      reason: "quality_settings table for defaults"
  blocks:
    - story: "06.4"
      name: "Test Parameters"
    - story: "06.5"
      name: "Incoming Inspection"
    - story: "06.6"
      name: "Test Results Recording"
    - story: "06.10"
      name: "In-Process Inspection"
    - story: "06.11"
      name: "Final Inspection"
    - story: "06.27"
      name: "CoA Templates"

# Reference Documents
files_to_read:
  prd:
    path: "docs/1-BASELINE/product/modules/quality.md"
    sections: ["FR-QA-003"]
  architecture:
    path: "docs/1-BASELINE/architecture/modules/quality.md"
    sections: ["quality_specifications", "quality_spec_parameters", "API Design"]
  story:
    path: "docs/2-MANAGEMENT/epics/current/06-quality/06.3.product-specifications.md"
  wireframes:
    - path: "docs/3-ARCHITECTURE/ux/wireframes/QA-003-specifications-list.md"
      relevance: "List page, detail view, filters, states"
    - path: "docs/3-ARCHITECTURE/ux/wireframes/QA-003-specification-modal.md"
      relevance: "Create/edit modal, parameter form, approval modal"
  adrs:
    - path: "docs/1-BASELINE/architecture/decisions/ADR-013-rls-org-isolation-pattern.md"
      relevance: "RLS policy pattern for quality tables"

# High-level deliverables
deliverables:
  - type: "migration"
    count: 2
    description: "quality_specifications table + quality_spec_parameters table"
  - type: "rls"
    count: 4
    description: "RLS policies for CRUD operations"
  - type: "function"
    count: 2
    description: "get_active_specification, supersede_previous_spec"
  - type: "api"
    count: 10
    description: "CRUD + approve + clone + active resolution endpoints"
  - type: "service"
    count: 1
    description: "specification-service.ts"
  - type: "validation"
    count: 4
    description: "Zod schemas for create, update, approve, review"
  - type: "page"
    count: 3
    description: "List, detail, create pages"
  - type: "component"
    count: 8
    description: "Table, form, detail, modals, version history, badges"
  - type: "test"
    count: 3
    description: "Unit (service), integration (API), E2E (workflow)"

# Technical notes
technical_notes:
  - "Specifications are versioned - same spec_number can have multiple versions"
  - "Only one ACTIVE spec per product at a time - activation supersedes previous"
  - "Status workflow: draft -> active -> expired/superseded (no pending state in MVP)"
  - "Immutability rule: approved specs cannot be edited, must clone to new version"
  - "Review frequency calculated on approval: next_review_date = effective_date + review_frequency_days"
  - "Use ADR-013 RLS pattern: (SELECT org_id FROM users WHERE id = auth.uid())"
  - "Delete restricted to draft status only via RLS policy"
  - "Spec_number auto-generated: QS-{YYYYMM}-{SEQ} format"
