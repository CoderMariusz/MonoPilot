# 02.10 - Traceability + Lot Tracking Setup (ARCHIVED)

> **ARCHIVED**: This file has been split into two stories:
> - **02.10a** - Traceability Configuration (Ready - no LP dependency)
> - **02.10b** - Traceability Queries & Genealogy (Deferred - requires Epic 05)
>
> See the new story files for current specifications.

---

**State:** ARCHIVED (Split into 02.10a and 02.10b)
**Type:** backend + frontend
**Estimate:** M
**Primary PRD:** `docs/1-BASELINE/product/modules/technical.md` (FR-2.60, FR-2.61, FR-2.62, FR-2.63, FR-2.64, FR-2.65)
**UX Wireframes:** TEC-016 (Traceability Search), TEC-014 (Shelf Life Config - lot tracking aspects)

## Goal
Implement traceability configuration for products including lot number format setup per product, batch size defaults, traceability level selection (lot/batch/serial), expiry date rules, and GS1 compliance settings for lot encoding. Enable forward/backward traceability queries and recall simulation capabilities.

## Scope

**In scope**
- Lot number format configuration per product (prefix, pattern, auto-increment)
- Batch size defaults per product (standard batch, minimum batch, maximum batch)
- Traceability level selection: lot, batch, or serial per product
- Expiry date calculation rules (fixed days, rolling from ingredients, manual)
- GS1-128 lot encoding settings (AI 10 for lot, AI 17 for expiry)
- Forward traceability API (where-used query)
- Backward traceability API (what-consumed query)
- Recall simulation API with impact assessment
- Genealogy tree data structure for lot relationships
- Traceability matrix report generation
- Traceability search page with list/tree/matrix views
- Lot configuration modal for product-level settings

**Out of scope**
- Actual lot creation during production (Production module Story 04.x)
- Inventory lot management (Warehouse module Story 05.x)
- Real-time genealogy tree D3.js visualization (frontend enhancement phase)
- Customer notification generation (Shipping module)
- FDA report XML export (regulatory compliance phase)
- Cross-contamination tracking (FR-2.67 - Future)
- Ingredient origin tracking (FR-2.66 - Future)

## Dependencies
- **01.1** - Org Context + Base RLS (for multi-tenant isolation)
- **02.1** - Products CRUD (required for product_id references and product-level config)
- **05.x** - License Plate structure (Warehouse module - required for lot genealogy tables)

---

## SPLIT RATIONALE

This story was split because:

1. **Configuration (02.10a)** has NO dependency on Epic 05 (Warehouse)
   - Product traceability settings
   - GS1 encoding service
   - Lot format configuration
   - Can be implemented immediately

2. **Queries (02.10b)** REQUIRES Epic 05 tables
   - Forward/backward trace needs `license_plates` table
   - Genealogy tree needs `lp_genealogy` table
   - Recall simulation needs consumption records
   - Must wait for Epic 05 completion

**Decision**: Option B from dependency analysis - split to unblock Epic 02

---

## Original Content Below (For Reference)

[Original content preserved for historical reference - see 02.10a and 02.10b for current specs]
