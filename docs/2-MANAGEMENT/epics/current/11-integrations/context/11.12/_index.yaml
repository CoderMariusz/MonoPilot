# Story 11.12 - Index File (Entry Point)
# Generated: 2026-01-15
# Purpose: Story metadata and dependencies - read this first

story:
  id: "11.12"
  name: "Retry Logic & Dead Letter Queue"
  slug: "retry-logic-dlq"
  epic: "11-integrations"
  phase: "2"
  complexity: "M"
  estimate_days: 3-4
  type: "backend + frontend"
  state: "ready"

# Dependencies
dependencies:
  required:
    - story: "01.1"
      name: "Org Context + Base RLS"
      provides: ["organizations"]
    - story: "11.3"
      name: "Integration Logs"
      provides: ["integration_logs table"]
    - story: "11.4"
      name: "Webhooks"
      provides: ["Webhook delivery failures"]
  blocks: []

# Reference Documents
files_to_read:
  prd:
    path: "docs/1-BASELINE/product/modules/integrations.md"
    sections: ["FR-INT-020", "FR-INT-021"]
  story:
    path: "docs/2-MANAGEMENT/epics/current/11-integrations/11.12.retry-logic-dlq.md"

# High-level deliverables
deliverables:
  - type: "migration"
    count: 1
    description: "integration_retry_queue table + calculate_next_retry() function"
  - type: "service"
    count: 1
    description: "retry-service.ts (auto-retry, manual retry, DLQ)"
  - type: "api"
    count: 6
    description: "List retry queue, manual retry, bulk retry, skip, list DLQ, delete DLQ"
  - type: "page"
    count: 2
    description: "Retry queue, DLQ"
  - type: "background_job"
    count: 1
    description: "Scheduled job (every 1 minute) to process retry queue"
  - type: "test"
    count: 4
    description: "Unit + integration + RLS + E2E tests"

# Technical notes
technical_notes:
  - "Exponential backoff (5s, 30s, 5min)"
  - "Max 3 retry attempts (configurable)"
  - "DLQ for permanent failures"
  - "Manual retry resets retry_count to 0"
  - "Scheduled job checks next_retry_at every minute"
