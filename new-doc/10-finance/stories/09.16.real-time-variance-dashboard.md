# Story 09.16: Real-Time Variance Dashboard

**Epic:** 09-finance
**Phase:** 2
**Complexity:** L (4-5 days)
**Type:** Full-stack
**Story File:** `09.16.real-time-variance-dashboard.md`

---

## User Story

As a **Finance Manager** or **Production Supervisor**,
I want to view **real-time cost variance data** as work orders progress,
So that I can **identify and respond to cost overruns immediately** rather than waiting for post-production analysis.

---

## Business Context

**Problem**: Current variance analysis only happens after WO completion, preventing timely corrective action when costs exceed standards.

**Competitive Gap**: 3/4 competitors (Katana, Odoo, SAP) offer real-time variance dashboards. MonoPilot must match this capability.

**Impact**:
- Reduce variance-related losses by 30%
- Enable same-day corrective action
- Improve production efficiency and cost control
- Support proactive decision-making vs reactive reporting

---

## Acceptance Criteria

### AC1: Real-Time Variance Calculation (FR-FIN-050)

**Given** a work order is in progress with material consumption and labor time recorded
**When** a production event occurs (material consumed, labor logged)
**Then** the system:
- Calculates current actual cost to date
- Calculates standard cost for units completed to date
- Computes current variance (amount and percentage)
- Projects final variance based on current trend
- Updates variance last-calculated timestamp

**Formula**:
```
Real-Time Variance = Actual Cost to Date - (Standard Cost per Unit Ã— Units Completed to Date)
Projected Final Variance = Real-Time Variance + (Remaining Qty Ã— Projected Unit Cost) - (Remaining Qty Ã— Standard Unit Cost)
```

**Validation**:
- Variance calculation completes in <300ms
- Projection uses linear extrapolation from current trend
- Units completed to date sourced from production outputs table

---

### AC2: Variance Threshold Alerts (FR-FIN-051)

**Given** variance thresholds configured per cost category (Material: 5%, Labor: 10%, Overhead: 15%)
**When** real-time variance exceeds any configured threshold
**Then** the system:
- Creates variance_alerts record with severity (warning/critical)
- Notifies assigned users (configurable by role)
- Displays alert on dashboard and WO detail page
- Sends email notification if enabled for user
- Logs alert with timestamp, WO ID, variance type, amount
- Allows acknowledgment with optional notes

**Given** multiple threshold levels configured (warning at 5%, critical at 10%)
**When** variance crosses each threshold
**Then** appropriate severity level is assigned

**Validation**:
- Alert triggers within 5 seconds of threshold breach
- Email sent within 30 seconds
- Alert persists until acknowledged or WO completed
- No duplicate alerts for same variance threshold

---

### AC3: Variance Trend Dashboard (FR-FIN-055)

**Given** user accesses `/finance/reports/variance-trends`
**When** selecting time period (daily, weekly, monthly, custom)
**Then** the system displays:
- Line chart showing total variance trend over time
- Stacked bar chart showing variance by category (material, labor, overhead)
- Table of top 10 variance contributors (products, work orders, cost centers)
- Comparison to previous period (period-over-period change %)
- Moving average trend line (7-day or 4-week)

**Given** variance data exists for selected period
**When** user filters by product/line/cost center/variance type
**Then** dashboard updates to show filtered variance trends

**Given** user identifies variance spike in trend
**When** clicking specific data point
**Then** navigate to detailed variance analysis for that period/entity

**Validation**:
- Dashboard renders in <2 seconds
- Chart data updates without full page reload
- Export to CSV/Excel available
- Responsive design works on tablets

---

### AC4: WebSocket Real-Time Updates

**Given** user viewing variance dashboard or WO cost detail
**When** production event occurs on any monitored work order
**Then** the system:
- Pushes update via WebSocket to connected clients
- Updates variance metrics without page refresh
- Displays "Last Updated" timestamp
- Shows visual indicator (pulse animation) for changed values

**Validation**:
- WebSocket connection established on page load
- Updates received within 5 seconds of event
- Graceful fallback to polling if WebSocket unavailable
- Connection auto-reconnects on disconnect

---

## Technical Design

### Database Schema Additions

#### variance_thresholds
```sql
CREATE TABLE variance_thresholds (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  org_id UUID NOT NULL REFERENCES organizations(id),
  cost_category TEXT NOT NULL, -- 'material', 'labor', 'overhead', 'total'
  warning_threshold_percent NUMERIC(5,2) NOT NULL DEFAULT 5.00,
  critical_threshold_percent NUMERIC(5,2) NOT NULL DEFAULT 10.00,
  is_active BOOLEAN NOT NULL DEFAULT true,
  notify_roles TEXT[] NOT NULL DEFAULT ARRAY['finance_manager', 'production_supervisor'],
  notify_email BOOLEAN NOT NULL DEFAULT true,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  UNIQUE(org_id, cost_category)
);

-- RLS policies
ALTER TABLE variance_thresholds ENABLE ROW LEVEL SECURITY;
CREATE POLICY variance_thresholds_org_isolation ON variance_thresholds FOR ALL USING (org_id = current_setting('app.org_id')::UUID);
```

#### variance_alerts
```sql
CREATE TABLE variance_alerts (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  org_id UUID NOT NULL REFERENCES organizations(id),
  work_order_id UUID NOT NULL REFERENCES work_orders(id),
  variance_type TEXT NOT NULL, -- 'material_price', 'material_usage', 'labor_rate', 'labor_efficiency', 'overhead', 'total'
  severity TEXT NOT NULL CHECK (severity IN ('warning', 'critical')),
  variance_amount NUMERIC(15,2) NOT NULL,
  variance_percent NUMERIC(5,2) NOT NULL,
  threshold_id UUID REFERENCES variance_thresholds(id),
  status TEXT NOT NULL DEFAULT 'active' CHECK (status IN ('active', 'acknowledged', 'resolved')),
  acknowledged_by UUID REFERENCES users(id),
  acknowledged_at TIMESTAMPTZ,
  acknowledged_notes TEXT,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

CREATE INDEX idx_variance_alerts_org_status ON variance_alerts(org_id, status);
CREATE INDEX idx_variance_alerts_work_order ON variance_alerts(work_order_id);

-- RLS policies
ALTER TABLE variance_alerts ENABLE ROW LEVEL SECURITY;
CREATE POLICY variance_alerts_org_isolation ON variance_alerts FOR ALL USING (org_id = current_setting('app.org_id')::UUID);
```

### Backend Logic

#### Database Trigger for Real-Time Variance
```sql
-- Trigger function to recalculate variance on production events
CREATE OR REPLACE FUNCTION recalculate_work_order_variance()
RETURNS TRIGGER AS $$
BEGIN
  -- Update work_order_costs with real-time calculations
  -- Check thresholds and create alerts if needed
  PERFORM finance_service.calculate_realtime_variance(NEW.work_order_id);
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Attach to material_consumption_costs and labor_costs
CREATE TRIGGER trigger_material_variance
AFTER INSERT OR UPDATE ON material_consumption_costs
FOR EACH ROW EXECUTE FUNCTION recalculate_work_order_variance();

CREATE TRIGGER trigger_labor_variance
AFTER INSERT OR UPDATE ON labor_costs
FOR EACH ROW EXECUTE FUNCTION recalculate_work_order_variance();
```

#### Service: VarianceAlertService
```typescript
// apps/frontend/lib/services/variance-alert-service.ts
export class VarianceAlertService {
  static async checkThresholds(workOrderId: string): Promise<void> {
    // Get work order current variance
    // Get configured thresholds for org
    // Compare variance % to thresholds
    // Create alert if exceeded and not already exists
    // Send notifications (email, in-app)
  }

  static async acknowledgeAlert(alertId: string, notes?: string): Promise<void> {
    // Update alert status to 'acknowledged'
    // Record acknowledging user and timestamp
    // Add notes if provided
  }

  static async getActiveAlerts(filters?: AlertFilters): Promise<VarianceAlert[]> {
    // Return active alerts with filters
  }
}
```

### API Endpoints

#### Variance Thresholds
- `GET /api/finance/variance-thresholds` - List thresholds
- `POST /api/finance/variance-thresholds` - Create threshold
- `PATCH /api/finance/variance-thresholds/:id` - Update threshold
- `DELETE /api/finance/variance-thresholds/:id` - Delete threshold

#### Variance Alerts
- `GET /api/finance/variance-alerts` - List active alerts (with filters)
- `GET /api/finance/variance-alerts/:id` - Get alert details
- `POST /api/finance/variance-alerts/:id/acknowledge` - Acknowledge alert
- `POST /api/finance/variance-alerts/:id/resolve` - Resolve alert
- `GET /api/finance/variance-alerts/summary` - Get alert counts by severity

#### Real-Time Variance
- `GET /api/finance/work-order-costs/:workOrderId/realtime` - Get real-time variance
- `GET /api/finance/reports/variance-trends` - Variance trend dashboard data

### Frontend Components

#### VarianceTrendDashboard
```tsx
// apps/frontend/app/(authenticated)/finance/reports/variance-trends/page.tsx
export default function VarianceTrendDashboard() {
  return (
    <div>
      <DashboardHeader />
      <PeriodSelector /> {/* daily, weekly, monthly, custom */}
      <FilterPanel /> {/* product, line, cost center, variance type */}
      <VarianceTrendChart /> {/* Line chart with moving average */}
      <VarianceCategoryChart /> {/* Stacked bar chart */}
      <TopVarianceContributorsTable /> {/* Drill-down navigation */}
      <PeriodComparisonCard /> {/* Period-over-period change */}
    </div>
  );
}
```

#### RealTimeVarianceCard
```tsx
// apps/frontend/components/finance/variance/RealTimeVarianceCard.tsx
export function RealTimeVarianceCard({ workOrderId }: Props) {
  const { data, isLoading } = useRealTimeVariance(workOrderId);

  // WebSocket subscription for live updates
  useEffect(() => {
    const ws = new WebSocket(WS_URL);
    ws.onmessage = (event) => {
      const update = JSON.parse(event.data);
      if (update.workOrderId === workOrderId) {
        mutate(update); // Update SWR cache
      }
    };
    return () => ws.close();
  }, [workOrderId]);

  return (
    <Card>
      <CardHeader>
        <CardTitle>Real-Time Variance</CardTitle>
        <Badge>{data?.lastUpdated}</Badge>
      </CardHeader>
      <CardContent>
        <VarianceMetric label="Current Variance" value={data?.currentVariance} />
        <VarianceMetric label="Projected Final" value={data?.projectedVariance} />
        <ProgressBar current={data?.completionPercent} />
      </CardContent>
    </Card>
  );
}
```

#### VarianceAlertPanel
```tsx
// apps/frontend/components/finance/variance/VarianceAlertPanel.tsx
export function VarianceAlertPanel() {
  const { data: alerts } = useVarianceAlerts({ status: 'active' });

  return (
    <div className="space-y-2">
      <div className="flex items-center justify-between">
        <h3>Active Alerts</h3>
        <Badge variant="destructive">{alerts?.length || 0}</Badge>
      </div>
      {alerts?.map(alert => (
        <Alert key={alert.id} variant={alert.severity === 'critical' ? 'destructive' : 'warning'}>
          <AlertCircle className="h-4 w-4" />
          <AlertTitle>{alert.variance_type} - WO #{alert.work_order_number}</AlertTitle>
          <AlertDescription>
            Variance: {alert.variance_percent}% ({formatCurrency(alert.variance_amount)})
            <Button size="sm" onClick={() => acknowledgeAlert(alert.id)}>Acknowledge</Button>
          </AlertDescription>
        </Alert>
      ))}
    </div>
  );
}
```

---

## Dependencies

### Required Stories (Must Complete First)
- **09.1** - Finance Settings (variance thresholds configuration)
- **09.2** - Standard Cost Definition (needed for variance baseline)
- **09.3** - Material Cost Tracking (provides actual material costs)
- **09.4** - Labor Cost Tracking (provides actual labor costs)
- **09.6** - WO Cost Summary (base cost calculation structure)

### Cross-Epic Dependencies
- **04.2** - Material Consumption (production events trigger variance recalc)
- **04.3** - Operation Tracking (labor events trigger variance recalc)

---

## Testing Requirements

### Unit Tests
- Variance calculation formula accuracy
- Threshold breach detection logic
- Alert creation and deduplication
- WebSocket connection handling
- Projection calculation accuracy

### Integration Tests
- Real-time variance updates on production events
- Alert notification delivery (email, in-app)
- Dashboard data aggregation correctness
- WebSocket reconnection on disconnect
- Multi-user concurrent alert viewing

### E2E Tests
1. **Real-time variance scenario**:
   - Start WO with standard costs
   - Record material consumption exceeding standard
   - Verify variance updates immediately
   - Verify alert triggered if threshold exceeded

2. **Dashboard workflow**:
   - Navigate to variance trend dashboard
   - Select time period and filters
   - Verify chart data matches raw data
   - Drill down to specific variance
   - Acknowledge alert from dashboard

---

## Performance Requirements

- Variance calculation: <300ms
- Alert trigger: <5 seconds from event
- Dashboard render: <2 seconds
- WebSocket update delivery: <5 seconds
- Chart rendering (1000 data points): <1 second

---

## Security & Permissions

### Roles
- **finance_manager**: Full access (view, configure thresholds, acknowledge alerts)
- **production_supervisor**: View alerts, acknowledge alerts
- **cost_accountant**: View-only access to dashboard
- **admin**: Full access

### RLS Policies
- All finance tables filtered by `org_id`
- Variance thresholds only visible/editable by finance_manager, admin
- Alerts visible to assigned roles only

---

## UX/UI Specifications

### Variance Trend Dashboard Layout
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Variance Trend Dashboard                    [Export]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Period: [Dailyâ–¼] [Last 30 days â–¼]                    â”‚
â”‚  Filters: Product [All â–¼] Line [All â–¼] Type [All â–¼]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Variance Trend (Line Chart)                    â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”‚  â”‚
â”‚  â”‚         /\      /\                              â”‚  â”‚
â”‚  â”‚        /  \    /  \        Moving Avg ----      â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€    \â”€â”€/    \â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Variance by Category (Stacked Bar)             â”‚  â”‚
â”‚  â”‚  [Material] [Labor] [Overhead]                  â”‚  â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘   â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘   â–ˆâ–ˆâ–‘â–‘â–‘â–‘                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Top Variance Contributors                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Rank â”‚ Product â”‚ WO      â”‚ Variance â”‚ %       â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  1   â”‚ SKU-101 â”‚ WO-1234 â”‚ +$1,250  â”‚ +12.5%  â”‚   â”‚
â”‚  â”‚  2   â”‚ SKU-205 â”‚ WO-1235 â”‚ +$890    â”‚ +8.2%   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Real-Time Variance Card (on WO Detail Page)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Real-Time Variance   [Last Updated: 2s ago] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Current Variance:    +$345  (+8.5%) ðŸ”´  â”‚
â”‚  Projected Final:     +$420  (+10.3%)    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Progress: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 80% complete     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Material:   +$200 (price: +$50, qty: +$150) â”‚
â”‚  Labor:      +$100 (rate: $0, eff: +$100)    â”‚
â”‚  Overhead:   +$45                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Variance Alert Toast Notification
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ Variance Alert - WO-1234           â”‚
â”‚ Material variance exceeded 10%         â”‚
â”‚ Current: +12.5% (+$1,250)              â”‚
â”‚ [View Details] [Acknowledge]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Documentation Requirements

- API endpoint documentation (OpenAPI/Swagger)
- WebSocket message format specification
- Alert notification configuration guide
- Variance calculation formula reference
- Dashboard user guide with screenshots
- Threshold configuration best practices

---

## Future Enhancements (Out of Scope for 09.16)

- Predictive variance forecasting using ML
- Automated root cause analysis suggestions
- Integration with Slack/Teams for alerts
- Custom variance formulas per product
- Historical variance pattern recognition
- Mobile app push notifications

---

## Story Metadata

**Estimated Effort:** 4-5 days
**Story Points:** 13
**Priority:** P0 (Phase 2)
**FR Coverage:** FR-FIN-050, FR-FIN-051, FR-FIN-055
**Related Stories:** 09.17 (Variance Drill-Down), 09.13 (Material Variance), 09.14 (Labor Variance)
