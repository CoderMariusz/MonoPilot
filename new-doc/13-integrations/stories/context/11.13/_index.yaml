# Story 11.13 - Index File (Entry Point)
# Generated: 2026-01-15
# Purpose: Story metadata and dependencies - read this first

story:
  id: "11.13"
  name: "Comarch Advanced (CoA/VAT)"
  slug: "comarch-advanced"
  epic: "11-integrations"
  phase: "2"
  complexity: "M"
  estimate_days: 3-4
  type: "backend + frontend"
  state: "ready"

# Dependencies
dependencies:
  required:
    - story: "01.1"
      name: "Org Context + Base RLS"
      provides: ["organizations"]
    - story: "11.1"
      name: "Integrations Dashboard"
      provides: ["Comarch sync status"]
    - story: "11.3"
      name: "Integration Logs"
      provides: ["Sync event logging"]
    - story: "11.6"
      name: "Comarch Basic (Invoice Push)"
      provides: ["Comarch API connection"]
      status: "ready"
  blocks: []

# Reference Documents
files_to_read:
  prd:
    path: "docs/1-BASELINE/product/modules/integrations.md"
    sections: ["FR-INT-022", "FR-INT-023"]
  story:
    path: "docs/2-MANAGEMENT/epics/current/11-integrations/11.13.comarch-advanced.md"

# High-level deliverables
deliverables:
  - type: "migration"
    count: 1
    description: "gl_accounts, gl_account_mapping, vat_reports tables"
  - type: "service"
    count: 1
    description: "comarch-advanced-service.ts (CoA sync, JPK_VAT generation)"
  - type: "api"
    count: 8
    description: "Sync CoA, GL mapping CRUD, generate JPK_VAT, download XML"
  - type: "page"
    count: 3
    description: "Chart of Accounts sync, GL mapping, VAT reports"
  - type: "background_job"
    count: 1
    description: "Daily sync (2 AM) of Chart of Accounts"
  - type: "test"
    count: 4
    description: "Unit + integration + RLS + E2E tests"

# Technical notes
technical_notes:
  - "Pull Chart of Accounts from Comarch Optima API"
  - "Map MonoPilot cost centers to Comarch GL accounts"
  - "Generate JPK_VAT report (XML v7 format for Polish tax office)"
  - "Daily scheduled sync (2 AM)"
  - "Schema validation for JPK_VAT XML"
