# 04.6b - Material Consumption Scanner

**Story ID:** 04.6b
**Epic:** 04 - Production
**Phase:** 1 (MVP)
**Complexity:** M (Medium)
**Estimate:** 3 days
**Type:** Full-stack
**State:** ready

**Primary PRD:** `docs/1-BASELINE/product/modules/PRODUCTION.md` (FR-PROD-007)
**UX Wireframes:** PROD-005 (Scanner Consume Material)

## PRD References

| FR ID | Requirement | Priority | Phase | Covered |
|-------|-------------|----------|-------|---------|
| FR-PROD-007 | Material Consumption (Scanner) | P0 | MVP | Yes |

## User Story

**As a** production operator,
**I want** to scan material LPs for consumption using a mobile scanner,
**So that** I can quickly record material usage on the shop floor without returning to a desktop.

**As a** production manager,
**I want** operators to use a guided scanner workflow with validation,
**So that** consumption errors are minimized and traceability is maintained.

## Goal

Implement a mobile-first scanner workflow for material consumption with barcode scanning, validation feedback, and a 6-step guided flow. The scanner interface must support industrial handheld devices (Zebra, Honeywell) and consumer mobile devices with large touch targets, audio/vibration feedback, and sub-500ms response times.

## Scope

**In scope:**
- WO barcode scan and lookup (< 500ms)
- LP barcode scan with product/UoM validation
- Number pad quantity entry with decimal support
- "Full Consumption" quick action button
- Visual feedback (green check / red X animations)
- Audio feedback (success beep, error beeps)
- Vibration feedback (200ms success, 100ms error)
- 6-step guided flow state machine
- Materials progress tracking
- Mobile-first responsive design (320-480px width)

**Out of scope:**
- Offline queue and sync (Phase 2)
- Camera barcode scanning (uses hardware scanner or manual entry)
- Voice input for notes
- Print label from scanner
- Consumption correction/reversal (handled in desktop 04.6a)

## Dependencies

| Story | Requirement | Status |
|-------|-------------|--------|
| 04.6a | Material Consumption Desktop | Required - provides service layer, API, database schema |
| 01.1 | Org Context + Base RLS | Required - provides auth context |
| 04.5 | Production Settings | Required - provides production_settings |
| 05.1 | License Plates Table | Required - provides license_plates table |

## Acceptance Criteria (Given/When/Then)

### Step 1: WO Barcode Scan

#### AC-001: Valid WO Barcode
- GIVEN valid WO barcode scanned (e.g., "WO-2025-0156"), WHEN processed, THEN WO info displays within 500ms with materials list and progress.
- GIVEN WO has 3 required materials, WHEN WO info displays, THEN materials list shows all 3 with progress bars.
- GIVEN WO status is "in_progress", WHEN barcode processed, THEN WO accepted and flow proceeds.

#### AC-002: Invalid WO Barcode
- GIVEN invalid WO barcode scanned (e.g., "WO-99999"), WHEN processed, THEN red X displays with shake animation.
- GIVEN invalid barcode processed, WHEN error shown, THEN 2 short error beeps play (200ms each).
- GIVEN invalid barcode processed, WHEN error shown, THEN message "Invalid WO barcode" displays.
- GIVEN error state, WHEN recovery options shown, THEN [Scan Again] and [Manual Entry] buttons display.

#### AC-003: Inactive WO
- GIVEN WO with status "completed" or "cancelled", WHEN barcode scanned, THEN error "Work order is not active" displays.

### Step 2: LP Barcode Scan

#### AC-004: Valid LP Barcode
- GIVEN valid LP barcode scanned, WHEN processed, THEN green check displays with 1 long success beep (500ms).
- GIVEN valid LP scanned, WHEN feedback shown, THEN 200ms vibration triggered.
- GIVEN LP has qty = 500 kg, WHEN LP info displays, THEN quantity and UoM show correctly.

#### AC-005: LP Product Mismatch
- GIVEN LP scanned with product_id different from material requirement, WHEN validated, THEN error "Product mismatch: LP contains X, material requires Y" displays.
- GIVEN product mismatch error, WHEN shown, THEN red X with shake animation displays.

#### AC-006: LP UoM Mismatch
- GIVEN LP scanned with UoM different from material requirement, WHEN validated, THEN error "Unit mismatch: LP is kg, material requires L" displays.

#### AC-007: LP Not Available
- GIVEN LP scanned with status "consumed" or "reserved", WHEN validated, THEN error "LP not available (status: consumed)" displays.

### Step 3: Enter Quantity

#### AC-008: Number Pad Input
- GIVEN number pad displayed, WHEN user taps [5] [0] [.] [5], THEN qty input shows "50.5".
- GIVEN number pad displayed, WHEN rendered, THEN keys are 64x64 dp minimum.
- GIVEN number pad has backspace key, WHEN tapped, THEN last digit removed.
- GIVEN number pad has [C] key, WHEN tapped, THEN entire input cleared.

#### AC-009: Full Consumption Button
- GIVEN LP has qty = 500 kg, WHEN "Full Consumption" button tapped, THEN qty auto-fills with 500.
- GIVEN "Full Consumption" button tapped, WHEN processed, THEN flow skips directly to Step 4 Review.
- GIVEN "Full Consumption" button, WHEN rendered, THEN shows "Full Consumption (500 kg)" text.

#### AC-010: Quantity Validation
- GIVEN user enters qty > LP.qty, WHEN proceeding, THEN error "Quantity exceeds LP available (500 kg)" displays.
- GIVEN user enters qty = 0, WHEN proceeding, THEN error "Quantity must be greater than 0" displays.

### Step 4: Review Consumption

#### AC-011: Review Screen Content
- GIVEN review screen displays, WHEN rendered, THEN shows: material name, LP number, quantity to consume, LP remaining after.
- GIVEN LP has batch_number and expiry_date, WHEN review displayed, THEN LP details section shows batch and expiry.
- GIVEN consumption will change progress from 40% to 60%, WHEN review displayed, THEN impact summary shows progress change.

### Step 5: Confirm (Processing)

#### AC-012: Confirmation Success
- GIVEN user clicks [Confirm], WHEN API call in progress, THEN spinner displays with "Processing..." text.
- GIVEN consumption API returns success, WHEN complete, THEN green check animation displays for 1-2 seconds.
- GIVEN consumption successful, WHEN feedback shown, THEN success beep plays.
- GIVEN consumption successful, WHEN complete, THEN LP qty decremented in database.

#### AC-013: Confirmation Error
- GIVEN API returns error (network, validation), WHEN error occurs, THEN red X displays with error message.
- GIVEN error shown, WHEN recovery options displayed, THEN [Retry] and [Cancel] buttons display.

### Step 6: Next Material or Done

#### AC-014: Post-Consumption Options
- GIVEN consumption complete, WHEN Step 6 displays, THEN [Next Material] and [Done] buttons display.
- GIVEN materials progress updated, WHEN Step 6 displays, THEN updated progress shown (e.g., "2 of 3 materials complete").
- GIVEN user clicks [Next Material], WHEN processed, THEN flow returns to Step 2 (Scan LP) with same WO.
- GIVEN user clicks [Done], WHEN processed, THEN returns to scanner home or WO detail.

### Touch Targets and Accessibility

#### AC-015: Touch Target Sizes
- GIVEN any button on scanner, WHEN rendered, THEN minimum touch target is 48x48 dp.
- GIVEN number pad keys, WHEN rendered, THEN each key is 64x64 dp.
- GIVEN materials list items, WHEN rendered, THEN each item is 64 dp height.

#### AC-016: Font Sizes
- GIVEN body text on scanner, WHEN rendered, THEN font size is minimum 18px.
- GIVEN input fields, WHEN rendered, THEN font size is 24px monospace.
- GIVEN headings, WHEN rendered, THEN font size is 24px bold.

### Performance

#### AC-017: Response Times
- GIVEN WO barcode scan, WHEN API called, THEN response received within 500ms.
- GIVEN LP barcode scan, WHEN API called, THEN response received within 300ms.
- GIVEN consumption confirm, WHEN API called, THEN success feedback within 2 seconds.

## Technical Specification

### Database Schema

**No new tables required** - Scanner reuses `wo_material_consumptions` table from Story 04.6a.

#### Optimized Views

```sql
-- v_scanner_wo_summary: Optimized view for scanner WO lookup
CREATE VIEW v_scanner_wo_summary AS
SELECT
  wo.id,
  wo.wo_number,
  wo.status,
  wo.batch_number,
  wo.planned_qty,
  wo.actual_qty,
  p.name AS product_name,
  p.sku AS product_sku,
  l.name AS line_name,
  (SELECT COUNT(*) FROM wo_materials wm WHERE wm.wo_id = wo.id) AS total_materials,
  (SELECT COUNT(*) FROM wo_materials wm
   WHERE wm.wo_id = wo.id AND wm.consumed_qty >= wm.required_qty) AS completed_materials
FROM work_orders wo
JOIN products p ON wo.product_id = p.id
LEFT JOIN production_lines l ON wo.line_id = l.id
WHERE wo.status IN ('in_progress', 'started');

-- Index for barcode lookup
CREATE INDEX idx_wo_barcode ON work_orders(wo_number);

-- v_scanner_lp_details: Optimized view for scanner LP lookup
CREATE VIEW v_scanner_lp_details AS
SELECT
  lp.id,
  lp.lp_number,
  lp.product_id,
  p.name AS product_name,
  p.sku AS product_sku,
  lp.quantity,
  lp.uom,
  lp.batch_number,
  lp.expiry_date,
  lp.status,
  loc.name AS location_name
FROM license_plates lp
JOIN products p ON lp.product_id = p.id
LEFT JOIN locations loc ON lp.location_id = loc.id
WHERE lp.status = 'available';

-- Index for LP barcode lookup
CREATE INDEX idx_lp_barcode ON license_plates(lp_number);
```

#### Database Functions

```sql
-- get_wo_by_barcode: Single query for WO + materials
CREATE OR REPLACE FUNCTION get_wo_by_barcode(
  p_barcode TEXT,
  p_org_id UUID
) RETURNS JSONB AS $$
SELECT jsonb_build_object(
  'wo', row_to_json(wo.*),
  'materials', (
    SELECT jsonb_agg(jsonb_build_object(
      'id', wm.id,
      'material_name', p.name,
      'required_qty', wm.required_qty,
      'consumed_qty', wm.consumed_qty,
      'uom', wm.uom,
      'consume_whole_lp', wm.consume_whole_lp,
      'progress_percent', ROUND((wm.consumed_qty / NULLIF(wm.required_qty, 0)) * 100)
    ) ORDER BY wm.sequence)
    FROM wo_materials wm
    JOIN products p ON wm.product_id = p.id
    WHERE wm.wo_id = wo.id
  )
)
FROM work_orders wo
WHERE wo.wo_number = p_barcode
  AND wo.org_id = p_org_id;
$$ LANGUAGE sql;

-- get_lp_by_barcode: LP lookup with material validation
CREATE OR REPLACE FUNCTION get_lp_by_barcode(
  p_barcode TEXT,
  p_material_id UUID,
  p_org_id UUID
) RETURNS JSONB AS $$
SELECT jsonb_build_object(
  'lp', row_to_json(lp.*),
  'validation', jsonb_build_object(
    'is_available', lp.status = 'available',
    'product_match', lp.product_id = wm.product_id,
    'uom_match', lp.uom = wm.uom,
    'error_code', CASE
      WHEN lp.status != 'available' THEN 'LP_NOT_AVAILABLE'
      WHEN lp.product_id != wm.product_id THEN 'PRODUCT_MISMATCH'
      WHEN lp.uom != wm.uom THEN 'UOM_MISMATCH'
      ELSE NULL
    END
  )
)
FROM license_plates lp
CROSS JOIN wo_materials wm
WHERE lp.lp_number = p_barcode
  AND lp.org_id = p_org_id
  AND wm.id = p_material_id;
$$ LANGUAGE sql;
```

### API Endpoints

```
# WO Barcode Lookup (Scanner)
GET    /api/production/work-orders/barcode/:barcode    - Lookup WO by barcode

# LP Barcode Lookup (Scanner)
GET    /api/warehouse/license-plates/barcode/:barcode  - Lookup LP by barcode with validation

# Reuses from 04.6a
POST   /api/production/work-orders/:woId/consume       - Record material consumption
```

#### GET /api/production/work-orders/barcode/:barcode

**Request:**
```
Params: barcode (string) - WO barcode (e.g., "WO-2025-0156")
Auth: Required (production_operator, production_manager, admin, owner)
```

**Response (200):**
```typescript
{
  wo: {
    id: string;
    wo_number: string;
    product_name: string;
    product_sku: string;
    planned_qty: number;
    actual_qty: number;
    status: 'in_progress' | 'started';
    line_name: string;
    batch_number: string;
  };
  materials: Array<{
    id: string;
    material_name: string;
    required_qty: number;
    consumed_qty: number;
    uom: string;
    consume_whole_lp: boolean;
    progress_percent: number;
  }>;
}
```

**Errors:**
- 404: `WO_NOT_FOUND` - Work order with barcode X not found
- 400: `WO_NOT_ACTIVE` - Work order is not in active status

**Performance:** < 500ms response time

#### GET /api/warehouse/license-plates/barcode/:barcode

**Request:**
```
Params: barcode (string) - LP barcode (e.g., "LP-2025-01234")
Query: material_id (UUID, optional) - Validate product match if provided
Auth: Required (production_operator, warehouse_operator, admin)
```

**Response (200):**
```typescript
{
  lp: {
    id: string;
    lp_number: string;
    product_id: string;
    product_name: string;
    quantity: number;
    uom: string;
    batch_number: string;
    expiry_date: string;
    location_name: string;
    status: 'available' | 'consumed' | 'reserved';
  };
  validation: {
    is_available: boolean;
    product_match: boolean;
    uom_match: boolean;
    error_code: string | null;
    error_message: string | null;
  };
}
```

**Errors:**
- 404: `LP_NOT_FOUND` - License plate with barcode X not found

**Performance:** < 300ms response time

### Service Methods

**Location:** `lib/services/scanner-service.ts`

```typescript
interface ScannerService {
  // Audio feedback
  playSuccessSound(): void;   // 1 long beep (500ms, 440Hz)
  playErrorSound(): void;     // 2 short beeps (200ms each, 100ms gap)

  // Vibration feedback
  triggerVibration(duration: number): void;  // 200ms success, 100ms error

  // Combined feedback
  showSuccessFeedback(): void;  // Sound + vibration + visual
  showErrorFeedback(): void;    // Sound + vibration + visual
}
```

### Zod Validation Schemas

**Location:** `lib/validation/scanner-schema.ts`

```typescript
import { z } from 'zod';

// Scanner state machine schema
export const scannerStateSchema = z.enum([
  'scan_wo',
  'scan_lp',
  'enter_qty',
  'review',
  'confirm',
  'next'
]);

// Scanner flow state
export const scannerFlowStateSchema = z.object({
  step: scannerStateSchema,
  woId: z.string().uuid().optional(),
  lpId: z.string().uuid().optional(),
  materialId: z.string().uuid().optional(),
  consumeQty: z.number().positive().optional(),
});

// WO barcode response
export const woBarcodeScanResultSchema = z.object({
  wo: z.object({
    id: z.string().uuid(),
    wo_number: z.string(),
    product_name: z.string(),
    product_sku: z.string(),
    planned_qty: z.number(),
    actual_qty: z.number(),
    status: z.enum(['in_progress', 'started']),
    line_name: z.string().nullable(),
    batch_number: z.string().nullable(),
  }),
  materials: z.array(z.object({
    id: z.string().uuid(),
    material_name: z.string(),
    required_qty: z.number(),
    consumed_qty: z.number(),
    uom: z.string(),
    consume_whole_lp: z.boolean(),
    progress_percent: z.number(),
  })),
});

// LP barcode response
export const lpBarcodeScanResultSchema = z.object({
  lp: z.object({
    id: z.string().uuid(),
    lp_number: z.string(),
    product_id: z.string().uuid(),
    product_name: z.string(),
    quantity: z.number(),
    uom: z.string(),
    batch_number: z.string().nullable(),
    expiry_date: z.string().nullable(),
    location_name: z.string().nullable(),
    status: z.enum(['available', 'consumed', 'reserved']),
  }),
  validation: z.object({
    is_available: z.boolean(),
    product_match: z.boolean(),
    uom_match: z.boolean(),
    error_code: z.string().nullable(),
    error_message: z.string().nullable(),
  }),
});
```

## UI Components

### Pages

- `app/(authenticated)/scanner/consume/page.tsx` - Scanner consumption flow (6 steps)

### Components

**Location:** `components/scanner/`

```
ScannerLayout.tsx           - Mobile-first scanner layout with header and progress
ScanInput.tsx               - Barcode scan input with manual entry fallback
NumberPad.tsx               - Large touch target number pad with decimal support
FullConsumptionButton.tsx   - Quick action button for full LP consumption
ScannerFeedback.tsx         - Visual + audio + vibration feedback component
MaterialsList.tsx           - Required materials list for scanner view
ConsumptionReview.tsx       - Review screen before confirmation
ScannerStepIndicator.tsx    - Step progress indicator (Step X of 6)
```

### Component Specifications

**ScannerLayout.tsx**
```tsx
interface ScannerLayoutProps {
  title: string;
  step: number;
  totalSteps: number;
  onBack: () => void;
}
// Features: 56dp header, step progress, full height container, 64dp bottom action bar
```

**ScanInput.tsx**
```tsx
interface ScanInputProps {
  placeholder: string;
  onScan: (barcode: string) => void;
  autoFocus: boolean;
}
// Features: 48dp height, 24px monospace font, camera button, hardware scanner support
```

**NumberPad.tsx**
```tsx
interface NumberPadProps {
  value: string;
  onChange: (value: string) => void;
  disabled: boolean;
  maxDecimals: number;
}
// Layout: [7][8][9][<] / [4][5][6][C] / [1][2][3][.] / [0][00]
// Specs: 64x64dp keys, 8dp spacing, Slate-700 background, 24px bold white text
```

**ScannerFeedback.tsx**
```tsx
interface ScannerFeedbackProps {
  type: 'success' | 'error' | 'loading';
  message: string;
  duration: number;
}
// Success: Green check (96dp), scale-in 300ms, Green-500
// Error: Red X (68dp), shake 300ms, Red-500
// Loading: Spinner (32dp), rotate continuous, Cyan-500
```

### Scanner Flow (6 Steps)

```
Step 1: Scan WO Barcode
        Display: Barcode icon (68dp), scan input focused
        Action: Enter WO barcode
        Next: Auto-advance on valid scan

Step 2: Scan LP Barcode
        Display: WO summary, materials list, LP scan input
        Action: Scan material LP
        Next: Auto-advance on valid scan

Step 3: Enter Quantity
        Display: LP info, number pad, Full Consumption button
        Action: Enter qty or tap Full Consumption
        Next: Manual [Next: Review] or auto on Full Consumption

Step 4: Review Consumption
        Display: Material, LP, Qty, LP remaining, batch/expiry
        Action: Review and confirm
        Next: [Confirm] button

Step 5: Confirm (Processing)
        Display: Spinner, "Processing..."
        Action: API call to record consumption
        Next: Auto-advance on success

Step 6: Next Material or Done
        Display: Success check (2s), updated progress
        Action: Choose next action
        Options: [Next Material] -> Step 2, [Done] -> Exit
```

### UI States

| State | Visual | Audio | Vibration |
|-------|--------|-------|-----------|
| Scanning | Barcode icon, focused input | None | None |
| Loading | Spinner, "Loading..." | None | None |
| Success | Green check (96dp), scale-in | 1 long beep (500ms) | 200ms |
| Error | Red X (68dp), shake | 2 short beeps | 100ms |
| Offline | Yellow warning | None | None |

## Test Cases

### Unit Tests

**scanner-service.test.ts**
```typescript
describe('ScannerService', () => {
  describe('playSuccessSound', () => {
    it('plays 500ms beep at 440Hz');
  });

  describe('playErrorSound', () => {
    it('plays 2x 200ms beeps with 100ms gap');
  });

  describe('triggerVibration', () => {
    it('calls navigator.vibrate with correct duration');
    it('handles devices without vibration support');
  });

  describe('showSuccessFeedback', () => {
    it('triggers sound, vibration, and visual feedback together');
  });
});
```

**use-scanner-flow.test.ts**
```typescript
describe('useScannerFlow', () => {
  describe('state transitions', () => {
    it('initial state is scan_wo');
    it('valid WO scan transitions to scan_lp');
    it('valid LP scan transitions to enter_qty');
    it('Full Consumption button skips to review');
    it('confirm success transitions to next');
    it('Next Material returns to scan_lp');
    it('Done exits flow');
  });

  describe('data persistence', () => {
    it('stores WO data on valid scan');
    it('stores LP data on valid scan');
    it('clears LP data on Next Material');
  });
});
```

### Integration Tests

**wo-barcode-api.test.ts**
```typescript
describe('GET /api/production/work-orders/barcode/:barcode', () => {
  it('returns WO with materials for valid barcode');
  it('returns 404 for invalid barcode');
  it('returns 400 for inactive WO');
  it('response time under 500ms');
  it('requires authentication');
  it('enforces org_id RLS');
});
```

**lp-barcode-api.test.ts**
```typescript
describe('GET /api/warehouse/license-plates/barcode/:barcode', () => {
  it('returns LP with validation for valid barcode');
  it('validates product match when material_id provided');
  it('validates UoM match when material_id provided');
  it('returns is_available=false for consumed LP');
  it('returns 404 for invalid barcode');
  it('response time under 300ms');
});
```

### E2E Tests

**consume-material.spec.ts**
```typescript
describe('Scanner Consumption Flow', () => {
  it('completes full 6-step flow');
  it('Full Consumption button skips number pad');
  it('handles invalid WO barcode with error feedback');
  it('handles product mismatch with error message');
  it('number pad accepts decimal input');
  it('touch targets meet 48dp minimum');
  it('WO lookup completes within 500ms');
  it('LP lookup completes within 300ms');
});
```

## Device Support

### Industrial Scanners
- Zebra TC52/TC57
- Honeywell CT60/CK65
- Hardware keyboard input (barcode as keystrokes + Enter)

### Consumer Devices
- iPhone (Safari) - iOS 14+
- Android (Chrome) - Android 8+
- Ring scanners via Bluetooth HID

### Viewport
- Minimum: 320px width
- Target: 375px width (iPhone SE)
- Maximum: 480px width

## Accessibility

| Requirement | Specification |
|-------------|---------------|
| Touch targets | 48x48dp minimum (64dp for number pad) |
| Font sizes | 18px minimum, 24px for inputs |
| Contrast | 4.5:1 WCAG AA |
| Audio feedback | Success beep, error beeps |
| Vibration | 200ms success, 100ms error |
| Keyboard | Tab order, Enter to submit |

## Security Considerations

1. **Authentication Required**
   - All scanner endpoints require valid session token
   - Session timeout applies to scanner workflows

2. **Authorization**
   - production_operator role minimum for consumption
   - RLS enforces org_id isolation on all queries

3. **Audit Trail**
   - All consumptions logged with user_id, timestamp
   - Reuses audit patterns from 04.6a

## Deliverables

- [ ] WO barcode lookup API (`/api/production/work-orders/barcode/:barcode`)
- [ ] LP barcode lookup API (`/api/warehouse/license-plates/barcode/:barcode`)
- [ ] Database views (v_scanner_wo_summary, v_scanner_lp_details)
- [ ] Database functions (get_wo_by_barcode, get_lp_by_barcode)
- [ ] Scanner service (`lib/services/scanner-service.ts`)
- [ ] Scanner validation schemas (`lib/validation/scanner-schema.ts`)
- [ ] useScannerFlow hook (`lib/hooks/use-scanner-flow.ts`)
- [ ] useScannerFeedback hook (`lib/hooks/use-scanner-feedback.ts`)
- [ ] useBarcodeScan hook (`lib/hooks/use-barcode-scan.ts`)
- [ ] ScannerLayout component
- [ ] ScanInput component
- [ ] NumberPad component
- [ ] FullConsumptionButton component
- [ ] ScannerFeedback component
- [ ] MaterialsList component
- [ ] ConsumptionReview component
- [ ] ScannerStepIndicator component
- [ ] Scanner consume page (`/scanner/consume`)
- [ ] Unit tests (scanner service, hooks)
- [ ] Integration tests (API endpoints)
- [ ] E2E tests (6-step flow, error handling)

## Definition of Done

- [ ] WO barcode scan returns WO + materials within 500ms
- [ ] LP barcode scan validates product/UoM/status within 300ms
- [ ] Number pad supports decimal input (e.g., 50.5)
- [ ] Full Consumption button auto-fills qty and skips to review
- [ ] Success feedback: green check + beep + vibration
- [ ] Error feedback: red X + shake + error beeps
- [ ] 6-step flow state machine works correctly
- [ ] Touch targets minimum 48dp (64dp for number pad)
- [ ] Font sizes minimum 18px (24px for inputs)
- [ ] Works on Zebra TC52 industrial scanner
- [ ] Works on iPhone Safari mobile browser
- [ ] Consumption records correctly via 04.6a API
- [ ] RLS enforces org_id isolation
- [ ] Unit test coverage >= 80%
- [ ] Integration tests pass
- [ ] E2E tests pass
- [ ] Performance targets met (500ms WO, 300ms LP, 2s confirm)
