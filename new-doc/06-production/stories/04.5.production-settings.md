# 04.5 - Production Settings (Module Configuration)

**Priority**: P0 (MVP Core - Phase 0)
**Story Points**: M (3-4 days)
**Type:** backend + frontend

**State:** ready
**Primary PRD:** `docs/1-BASELINE/product/modules/production.md` (FR-PROD-017)
**Architecture:** `docs/1-BASELINE/architecture/modules/production.md`
**UX Wireframes:** N/A (Settings form - standard toggle/input layout)

---

## MVP Scope

Production Settings provides centralized configuration for production execution behavior. This story establishes the foundational settings infrastructure that all other Production Module stories depend on for feature toggles and operational parameters.

**Phase 0 MVP includes:**
- Production settings configuration page at `/settings/production`
- Phase 0 (MVP Core) settings:
  - WO Execution: `allow_pause_wo`, `auto_complete_wo`, `require_operation_sequence`
  - Dashboard: `dashboard_refresh_seconds`, `show_material_alerts`, `show_delay_alerts`, `show_quality_alerts`
- Phase 1 (Full Production) settings (UI ONLY - not enforced until Phase 1):
  - Material Consumption: `allow_over_consumption`, `allow_partial_lp_consumption`
  - Output: `require_qa_on_output`, `auto_create_by_product_lp`
  - Reservations: `enable_material_reservations`
- Phase 2 (OEE) settings (UI ONLY - not enforced until Phase 2):
  - OEE: `enable_oee_tracking`, `target_oee_percent`, `enable_downtime_tracking`
- Settings CRUD API with org scoping
- Zod validation schemas
- Service layer for settings management
- RLS policies for multi-tenant isolation

**Phase 0 ENFORCES:**
- Only Phase 0 settings are actively enforced in business logic (Stories 04.1, 04.2a-c, 04.3, 04.4)
- Phase 1/2 settings are stored but not used until respective stories implement them

---

## LP Dependency Status

- [x] NO LP dependency - can proceed immediately
- [ ] REQUIRES Epic 05 - defer to Phase 1

**Rationale:** Settings table is independent configuration storage. No LP transactions or references required. Phase 1 LP-related settings (`allow_over_consumption`, etc.) are stored but not enforced until Stories 04.6a-e and 04.7a-d implement them.

---

## Goal

Provide centralized, org-scoped configuration for production execution behavior, enabling production managers to customize WO lifecycle, material consumption, output registration, dashboard behavior, and OEE tracking to match their operational requirements.

## User Story

As a **production manager**, I want **configurable production settings** so that **I can customize work order execution rules, material consumption policies, and dashboard behavior to match my facility's standard operating procedures**.

## Scope

**In scope (this story)**
- Settings page at `/settings/production`
- Complete `production_settings` table with all 15 fields (Phase 0, 1, and 2)
- Settings sections organized by functional area:
  - **WO Execution** (3 toggles)
  - **Material Consumption** (2 toggles) - Phase 1 fields
  - **Output** (2 toggles) - Phase 1 fields
  - **Reservations** (1 toggle) - Phase 1 field
  - **Dashboard** (4 settings: 1 number input, 3 toggles)
  - **OEE** (3 settings: 2 toggles, 1 number input) - Phase 2 fields
- API endpoints:
  - `GET /api/production/settings` - Retrieve org's production settings
  - `PUT /api/production/settings` - Update org's production settings
- Service layer: `production-settings-service.ts` with CRUD operations
- Zod validation schemas:
  - `productionSettingsSchema` for full settings object
  - `updateProductionSettingsSchema` for partial updates
- Form with unsaved changes warning
- Success/error toast notifications
- Default values for new orgs
- RLS policies for org_id isolation
- Unit tests for validation logic
- API integration tests

**Out of scope (this story)**
- Enforcing Phase 1 LP-related settings → Stories 04.6a-e, 04.7a-d (Phase 1)
- Enforcing Phase 2 OEE settings → Stories 04.9a-d (Phase 2)
- Audit log for settings changes → Phase 3
- Settings versioning/history → Phase 3
- Role-based settings permissions (admin vs manager) → Phase 3
- Settings export/import → Phase 3
- Settings templates → Phase 3

## Dependencies

- **01.1** - Multi-tenancy (RLS, org_id scoping)
- **01.14** - Settings Infrastructure (if generic settings pattern exists)
- **03.10** - Work Orders CRUD (WO lifecycle settings apply to work_orders table)

---

## Acceptance Criteria (Given/When/Then)

### AC-1: Settings Page Load with All Fields

**Given** user is logged in as production manager
**When** user navigates to `/settings/production`
**Then**
- All 15 settings display with current values
- Settings are grouped into 6 sections: WO Execution, Material Consumption, Output, Reservations, Dashboard, OEE
- Phase 1 fields (Material Consumption, Output, Reservations) have info tooltip: "Available in Phase 1 after Epic 05"
- Phase 2 fields (OEE section) have info tooltip: "Available in Phase 2 - OEE Module"
- All toggles show correct ON/OFF state
- Number inputs show numeric values
- No console errors logged
- Page loads within 1.5 seconds

### AC-2: Toggle allow_pause_wo (Phase 0 - Enforced)

**Given** user is on `/settings/production`
**When** user toggles `allow_pause_wo` from OFF to ON and clicks "Save"
**Then**
- Success toast "Settings saved successfully" displays
- Setting persists in database (`allow_pause_wo = true`)
- WO detail pages immediately show "Pause" button (verified in Story 04.2b)
- No page reload required

### AC-3: Toggle allow_pause_wo OFF Hides Pause Button (Phase 0 - Enforced)

**Given** `allow_pause_wo = true` and WO detail page shows "Pause" button
**When** user sets `allow_pause_wo = false` and saves
**Then**
- "Pause" button disappears from all WO detail pages
- Existing paused WOs can still be resumed (Resume button visible)
- No new WOs can be paused

### AC-4: Number Input Validation - dashboard_refresh_seconds (Phase 0 - Enforced)

**Given** user is editing `dashboard_refresh_seconds`
**When** user enters value "0" and clicks "Save"
**Then**
- Validation error displays: "Refresh interval must be at least 5 seconds"
- Settings are NOT saved
- Form field highlights in red
- Save button remains disabled until valid value entered

### AC-5: Number Input Validation - dashboard_refresh_seconds Valid Range (Phase 0 - Enforced)

**Given** user is editing `dashboard_refresh_seconds`
**When** user enters value "15" and clicks "Save"
**Then**
- Settings save successfully
- Success toast displays
- Dashboard auto-refresh updates to 15 seconds (verified in Story 04.1)
- Valid range: 5 to 300 seconds

### AC-6: Number Input Validation - target_oee_percent (Phase 2 - Stored Only)

**Given** user is editing `target_oee_percent`
**When** user enters value "110" and clicks "Save"
**Then**
- Validation error displays: "Target OEE must be between 0 and 100"
- Settings are NOT saved
- Form field highlights in red

### AC-7: Number Input Validation - target_oee_percent Valid (Phase 2 - Stored Only)

**Given** user is editing `target_oee_percent`
**When** user enters value "85" and clicks "Save"
**Then**
- Settings save successfully
- Success toast displays
- Value stored for future use in Story 04.9a (OEE Calculation)
- Valid range: 0 to 100

### AC-8: Toggle Phase 1 Setting (Stored but Not Enforced)

**Given** user is on `/settings/production`
**When** user toggles `allow_over_consumption` from OFF to ON and clicks "Save"
**Then**
- Success toast "Settings saved successfully" displays
- Setting persists in database (`allow_over_consumption = true`)
- Info tooltip shows: "Available in Phase 1 after Epic 05"
- Setting has NO effect on application behavior until Story 04.6e implements it

### AC-9: Multiple Settings Changed at Once

**Given** user is on `/settings/production`
**When** user changes 3 settings:
  - `allow_pause_wo` OFF → ON
  - `dashboard_refresh_seconds` 30 → 15
  - `show_material_alerts` ON → OFF
**And** clicks "Save"
**Then**
- All 3 settings save successfully in single transaction
- Success toast displays once
- All changes persist in database
- All changes take effect immediately for Phase 0 settings

### AC-10: Unsaved Changes Warning

**Given** user has changed `allow_pause_wo` but NOT saved
**When** user attempts to navigate away from `/settings/production`
**Then**
- Browser confirmation dialog displays: "You have unsaved changes. Leave this page?"
- If user clicks "Cancel", they remain on settings page with changes preserved
- If user clicks "Leave", they navigate away and changes are lost

### AC-11: Unsaved Changes Warning - After Save

**Given** user has changed and saved settings
**When** user navigates away from `/settings/production`
**Then**
- NO confirmation dialog displays
- Navigation proceeds immediately

### AC-12: GET API - Retrieve Settings for Org

**Given** organization has production settings configured
**When** API call `GET /api/production/settings` is made
**Then**
- Response status 200 OK
- Response body contains all 15 settings fields
- Response includes only settings for authenticated user's org_id
- Response time < 200ms
- RLS policy enforces org_id isolation

### AC-13: GET API - Default Settings for New Org

**Given** organization has NO production settings configured yet
**When** API call `GET /api/production/settings` is made
**Then**
- Response status 200 OK
- Response body contains all 15 settings with default values:
  - `allow_pause_wo = false`
  - `auto_complete_wo = false`
  - `require_operation_sequence = true`
  - `allow_over_consumption = false`
  - `allow_partial_lp_consumption = true`
  - `require_qa_on_output = true`
  - `auto_create_by_product_lp = true`
  - `enable_material_reservations = true`
  - `dashboard_refresh_seconds = 30`
  - `show_material_alerts = true`
  - `show_delay_alerts = true`
  - `show_quality_alerts = true`
  - `enable_oee_tracking = false`
  - `target_oee_percent = 85`
  - `enable_downtime_tracking = false`
- Settings row created in database on first GET (upsert pattern)

### AC-14: PUT API - Update Settings

**Given** organization has existing production settings
**When** API call `PUT /api/production/settings` with body `{ "allow_pause_wo": true, "dashboard_refresh_seconds": 15 }`
**Then**
- Response status 200 OK
- Only specified fields are updated in database
- Unspecified fields remain unchanged
- Response body contains full updated settings object
- `updated_at` timestamp is set to current time
- RLS policy enforces org_id isolation

### AC-15: PUT API - Validation Error

**Given** user attempts to update settings
**When** API call `PUT /api/production/settings` with body `{ "dashboard_refresh_seconds": 3 }`
**Then**
- Response status 400 Bad Request
- Response body contains validation error: `{ "error": "Validation failed", "details": { "dashboard_refresh_seconds": "Refresh interval must be at least 5 seconds" } }`
- Settings are NOT updated in database
- No partial updates occur (transaction rollback)

### AC-16: PUT API - Validation Error - target_oee_percent

**Given** user attempts to update OEE target
**When** API call `PUT /api/production/settings` with body `{ "target_oee_percent": 105 }`
**Then**
- Response status 400 Bad Request
- Response body contains validation error: `{ "error": "Validation failed", "details": { "target_oee_percent": "Target OEE must be between 0 and 100" } }`
- Settings are NOT updated in database

### AC-17: RLS Policy - Org Isolation

**Given** Org A has settings `{ "allow_pause_wo": true }` and Org B has settings `{ "allow_pause_wo": false }`
**When** user from Org A calls `GET /api/production/settings`
**Then**
- Response contains only Org A's settings (`allow_pause_wo = true`)
- User CANNOT see or modify Org B's settings
- RLS policy blocks cross-org access at database level

### AC-18: Form Reset Button

**Given** user has changed 2 settings but NOT saved
**When** user clicks "Reset" button
**Then**
- All form fields revert to last saved values
- Unsaved changes are discarded
- No API call is made
- Success/error toast does NOT display

### AC-19: Settings Apply Immediately to Active Features (Phase 0 Only)

**Given** `dashboard_refresh_seconds = 30` and dashboard is auto-refreshing every 30 seconds
**When** user changes `dashboard_refresh_seconds = 10` and saves
**Then**
- Dashboard immediately updates to 10-second auto-refresh
- No page reload required
- Change applies to all open dashboard instances for the org

### AC-20: Phase 1/2 Settings Have No Effect Until Implemented

**Given** user sets `allow_over_consumption = true` (Phase 1 setting)
**When** user attempts to consume materials (if Phase 1 stories not yet implemented)
**Then**
- Setting is stored in database
- Setting has NO effect on application behavior
- Material consumption feature does not exist yet (deferred to Story 04.6a-e)
- Info tooltip on setting indicates: "Available in Phase 1 after Epic 05"

---

## Implementation Notes

### API Endpoints

```typescript
// GET /api/production/settings
// Response: ProductionSettings object with all 15 fields
// Upserts default settings on first GET for new orgs

// PUT /api/production/settings
// Request Body: Partial<ProductionSettings> (any fields to update)
// Response: Full ProductionSettings object after update
// Validates all fields using Zod schema
```

### Database

**Table: `production_settings`** (already defined in architecture)

```sql
-- Located in: supabase/migrations/XXX_create_production_settings.sql

CREATE TABLE production_settings (
  id                  UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  org_id              UUID NOT NULL REFERENCES organizations(id) UNIQUE,

  -- WO Execution (Phase 0 - Enforced)
  allow_pause_wo              BOOLEAN DEFAULT false,
  auto_complete_wo            BOOLEAN DEFAULT false,
  require_operation_sequence  BOOLEAN DEFAULT true,

  -- Material Consumption (Phase 1 - Stored only)
  allow_over_consumption      BOOLEAN DEFAULT false,
  allow_partial_lp_consumption BOOLEAN DEFAULT true,

  -- Output (Phase 1 - Stored only)
  require_qa_on_output        BOOLEAN DEFAULT true,
  auto_create_by_product_lp   BOOLEAN DEFAULT true,

  -- Reservations (Phase 1 - Stored only)
  enable_material_reservations BOOLEAN DEFAULT true,

  -- Dashboard (Phase 0 - Enforced)
  dashboard_refresh_seconds   INTEGER DEFAULT 30 CHECK (dashboard_refresh_seconds >= 5 AND dashboard_refresh_seconds <= 300),
  show_material_alerts        BOOLEAN DEFAULT true,
  show_delay_alerts           BOOLEAN DEFAULT true,
  show_quality_alerts         BOOLEAN DEFAULT true,

  -- OEE (Phase 2 - Stored only)
  enable_oee_tracking         BOOLEAN DEFAULT false,
  target_oee_percent          DECIMAL(5,2) DEFAULT 85 CHECK (target_oee_percent >= 0 AND target_oee_percent <= 100),
  enable_downtime_tracking    BOOLEAN DEFAULT false,

  created_at          TIMESTAMPTZ DEFAULT now(),
  updated_at          TIMESTAMPTZ DEFAULT now()
);

-- RLS Policies
ALTER TABLE production_settings ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view their org's production settings"
  ON production_settings FOR SELECT
  USING (org_id = auth.org_id());

CREATE POLICY "Users can update their org's production settings"
  ON production_settings FOR UPDATE
  USING (org_id = auth.org_id());

CREATE POLICY "Users can insert their org's production settings"
  ON production_settings FOR INSERT
  WITH CHECK (org_id = auth.org_id());

-- Index
CREATE INDEX idx_production_settings_org ON production_settings(org_id);

-- Trigger for updated_at
CREATE TRIGGER update_production_settings_updated_at
  BEFORE UPDATE ON production_settings
  FOR EACH ROW
  EXECUTE FUNCTION update_updated_at_column();
```

### Frontend Components

```
app/(authenticated)/settings/production/
  page.tsx                          -- Main settings page
  components/
    ProductionSettingsForm.tsx      -- Form with all 15 settings grouped by section
    SettingToggle.tsx               -- Reusable toggle component
    SettingNumberInput.tsx          -- Reusable number input with validation
    SettingsSection.tsx             -- Section container with title and divider
```

### Services

```typescript
// lib/services/production-settings-service.ts

export interface ProductionSettings {
  id: string;
  org_id: string;
  // WO Execution (Phase 0)
  allow_pause_wo: boolean;
  auto_complete_wo: boolean;
  require_operation_sequence: boolean;
  // Material Consumption (Phase 1)
  allow_over_consumption: boolean;
  allow_partial_lp_consumption: boolean;
  // Output (Phase 1)
  require_qa_on_output: boolean;
  auto_create_by_product_lp: boolean;
  // Reservations (Phase 1)
  enable_material_reservations: boolean;
  // Dashboard (Phase 0)
  dashboard_refresh_seconds: number;
  show_material_alerts: boolean;
  show_delay_alerts: boolean;
  show_quality_alerts: boolean;
  // OEE (Phase 2)
  enable_oee_tracking: boolean;
  target_oee_percent: number;
  enable_downtime_tracking: boolean;
  // Metadata
  created_at: string;
  updated_at: string;
}

export async function getProductionSettings(): Promise<ProductionSettings> {
  // GET from Supabase with org_id from auth context
  // Upsert default settings if none exist
}

export async function updateProductionSettings(
  updates: Partial<ProductionSettings>
): Promise<ProductionSettings> {
  // Validate with Zod
  // PUT to Supabase
  // Return full updated settings
}

// Helper functions for consuming services
export async function isWoPauseAllowed(): Promise<boolean> {
  const settings = await getProductionSettings();
  return settings.allow_pause_wo;
}

export async function getDashboardRefreshInterval(): Promise<number> {
  const settings = await getProductionSettings();
  return settings.dashboard_refresh_seconds;
}

// Add more helper functions as needed by consuming stories
```

### Validation (Zod)

```typescript
// lib/validation/production-settings.ts

import { z } from 'zod';

export const productionSettingsSchema = z.object({
  // WO Execution
  allow_pause_wo: z.boolean().default(false),
  auto_complete_wo: z.boolean().default(false),
  require_operation_sequence: z.boolean().default(true),

  // Material Consumption
  allow_over_consumption: z.boolean().default(false),
  allow_partial_lp_consumption: z.boolean().default(true),

  // Output
  require_qa_on_output: z.boolean().default(true),
  auto_create_by_product_lp: z.boolean().default(true),

  // Reservations
  enable_material_reservations: z.boolean().default(true),

  // Dashboard
  dashboard_refresh_seconds: z.number()
    .int()
    .min(5, "Refresh interval must be at least 5 seconds")
    .max(300, "Refresh interval must not exceed 300 seconds")
    .default(30),
  show_material_alerts: z.boolean().default(true),
  show_delay_alerts: z.boolean().default(true),
  show_quality_alerts: z.boolean().default(true),

  // OEE
  enable_oee_tracking: z.boolean().default(false),
  target_oee_percent: z.number()
    .min(0, "Target OEE must be between 0 and 100")
    .max(100, "Target OEE must be between 0 and 100")
    .default(85),
  enable_downtime_tracking: z.boolean().default(false),
});

export const updateProductionSettingsSchema = productionSettingsSchema.partial();

export type ProductionSettingsInput = z.infer<typeof productionSettingsSchema>;
export type UpdateProductionSettingsInput = z.infer<typeof updateProductionSettingsSchema>;
```

### Key Business Rules

1. **Org Isolation**: Each org has exactly ONE production_settings row (enforced by UNIQUE constraint on org_id)
2. **Default on First Access**: If no settings exist for org, upsert defaults on first GET
3. **Partial Updates**: PUT endpoint accepts partial updates, only changes specified fields
4. **Validation**: All number inputs must pass Zod validation (min/max ranges)
5. **Phase 0 Enforcement**: Only Phase 0 settings (WO Execution, Dashboard) actively control application behavior
6. **Phase 1/2 Storage**: Phase 1 (LP-related) and Phase 2 (OEE) settings are stored but NOT enforced until respective stories implement them
7. **Immediate Effect**: Phase 0 settings apply immediately without page reload (real-time updates)
8. **Unsaved Changes**: Browser warns users navigating away with unsaved changes
9. **Transaction Safety**: Settings updates are atomic (all or nothing)
10. **RLS Enforcement**: All queries filtered by org_id via RLS policies

### Phase Enforcement Strategy

**Phase 0 (Stories 04.1, 04.2a-c, 04.3, 04.4) - ENFORCES:**
- `allow_pause_wo` → Story 04.2b checks this before showing Pause button
- `auto_complete_wo` → Story 04.2c checks this for auto-completion logic
- `require_operation_sequence` → Story 04.3 enforces operation order
- `dashboard_refresh_seconds` → Story 04.1 uses this for auto-refresh interval
- `show_material_alerts` → Story 04.1 conditionally displays material alerts
- `show_delay_alerts` → Story 04.1 conditionally displays delay alerts
- `show_quality_alerts` → Story 04.1 conditionally displays quality alerts

**Phase 1 (Stories 04.6a-e, 04.7a-d, 04.8) - WILL ENFORCE:**
- `allow_over_consumption` → Story 04.6e implements over-consumption validation
- `allow_partial_lp_consumption` → Story 04.6a implements partial consumption logic
- `require_qa_on_output` → Story 04.7a enforces QA status requirement
- `auto_create_by_product_lp` → Story 04.7c implements by-product LP creation
- `enable_material_reservations` → Story 04.8 conditionally creates reservations

**Phase 2 (Stories 04.9a-d, 04.10a-g) - WILL ENFORCE:**
- `enable_oee_tracking` → Story 04.9a conditionally calculates OEE
- `target_oee_percent` → Story 04.9a uses as target line in charts
- `enable_downtime_tracking` → Story 04.9b conditionally tracks downtime

## Deliverables

- **Migration**: `supabase/migrations/XXX_create_production_settings.sql` (table + RLS + indexes)
- **API routes**:
  - `app/api/production/settings/route.ts` (GET, PUT)
- **Frontend page**: `app/(authenticated)/settings/production/page.tsx`
- **Components**:
  - `ProductionSettingsForm.tsx` (main form with 6 sections)
  - `SettingToggle.tsx` (reusable toggle component)
  - `SettingNumberInput.tsx` (reusable number input with validation)
  - `SettingsSection.tsx` (section container)
- **Services**: `lib/services/production-settings-service.ts` (CRUD + helper functions)
- **Validation**: `lib/validation/production-settings.ts` (Zod schemas)
- **Tests**:
  - `lib/validation/production-settings.test.ts` (Zod validation unit tests)
  - `app/api/production/settings/route.test.ts` (API integration tests)
  - `lib/services/production-settings-service.test.ts` (Service unit tests)

## Definition of Done

- [ ] Database migration creates `production_settings` table with all 15 fields
- [ ] RLS policies enforce org_id isolation (tested with multi-org scenarios)
- [ ] GET /api/production/settings returns settings for authenticated org
- [ ] GET /api/production/settings upserts defaults for new orgs
- [ ] PUT /api/production/settings updates specified fields only
- [ ] PUT /api/production/settings validates all inputs with Zod
- [ ] PUT /api/production/settings returns 400 for invalid inputs
- [ ] Settings page displays all 15 settings grouped into 6 sections
- [ ] Phase 1/2 settings have info tooltips indicating future availability
- [ ] Toggle components correctly display and update boolean fields
- [ ] Number inputs validate min/max ranges (5-300 for refresh, 0-100 for OEE target)
- [ ] Form shows unsaved changes warning when navigating away
- [ ] Form resets to last saved values on "Reset" button click
- [ ] Success toast displays on successful save
- [ ] Error toast displays on failed save with validation details
- [ ] API tests passing (>80% coverage):
  - GET with existing settings
  - GET with new org (default upsert)
  - PUT with valid partial updates
  - PUT with invalid values (validation errors)
  - RLS isolation (cross-org blocked)
- [ ] Unit tests passing for Zod schemas (all validation rules tested)
- [ ] E2E smoke test: Navigate to settings, change 3 settings, save, verify persistence
- [ ] Performance: Page loads within 1.5 seconds
- [ ] Performance: PUT /api/production/settings responds within 300ms
- [ ] No console errors on settings page
- [ ] Phase 0 settings (WO Execution, Dashboard) immediately affect dependent features
- [ ] Phase 1/2 settings stored but have no effect on application behavior
- [ ] Code review approved
- [ ] PR merged to main

---

## Future Phases (Not in This Story)

### Phase 1 - Settings Enforcement (Stories 04.6a-e, 04.7a-d, 04.8)
- `allow_over_consumption` enforcement in Story 04.6e (Over-Consumption Control)
- `allow_partial_lp_consumption` enforcement in Story 04.6a (Consumption Desktop)
- `require_qa_on_output` enforcement in Story 04.7a (Output Desktop)
- `auto_create_by_product_lp` enforcement in Story 04.7c (By-Product Registration)
- `enable_material_reservations` enforcement in Story 04.8 (Material Reservations)

### Phase 2 - OEE Settings Enforcement (Stories 04.9a-d)
- `enable_oee_tracking` enforcement in Story 04.9a (OEE Calculation)
- `target_oee_percent` usage in Story 04.9a (OEE dashboard target line)
- `enable_downtime_tracking` enforcement in Story 04.9b (Downtime Tracking)

### Phase 3 - Advanced Settings Features
- Settings audit log (track who changed what and when)
- Settings versioning and rollback
- Settings history view
- Role-based permissions (admin vs manager can change different settings)
- Settings templates (export/import settings between orgs)
- Settings profiles (different settings for different production lines)
- Scheduled settings changes (e.g., enable OEE tracking starting next Monday)

**Implementation**: See Epic 04.0 "Future Feature Handling" section.

---

## Version History

| Version | Date | Changes | Author |
|---------|------|---------|--------|
| 1.0 | 2025-12-16 | Initial story creation from brief | ARCHITECT-AGENT |
