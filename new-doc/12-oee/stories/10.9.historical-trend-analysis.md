# 10.9 - Historical Trend Analysis

**Priority**: P0
**Story Points**: M (Medium)
**Type**: frontend
**Phase**: 1B
**Model**: OPUS

**State:** ready
**Estimate:** M (3-4 days)
**Primary PRD:** `docs/1-BASELINE/product/modules/oee.md` (FR-OEE-014, OEE-015)

---

## Goal

Provide historical OEE trend visualization (7/30/90 days), period-over-period comparisons (week-over-week, month-over-month), and trend export capabilities for continuous improvement analysis.

---

## User Story

As a **Production Manager**, I want to **view OEE trends over time and compare periods** so that **I can identify performance patterns and measure improvement initiatives**.

---

## Scope

**In scope**
- OEE trend charts (7/30/90 days with multi-metric overlay)
- Period comparison (week-over-week, month-over-month)
- Trend data export (CSV, Excel)
- Machine/Line comparison charts
- Shift comparison
- GET /api/oee/analytics/trends
- GET /api/oee/analytics/comparisons
- Analytics dashboard page (/oee/analytics)

**Out of scope**
- Predictive analytics (Phase 3)
- Custom date range builder (Phase 2)
- Anomaly detection (Phase 3)

---

## Acceptance Criteria

### AC-1: OEE Trend Chart

```gherkin
Scenario: View 30-day OEE trend
  Given user on /oee/analytics
  When selects period = "Last 30 Days"
  Then line chart displays:
    - X-axis: Dates (30 days)
    - Y-axis: OEE % (0-100)
    - Lines: OEE, Availability, Performance, Quality
    - Target line (dashed)
  And data points show daily average
  And hover shows exact values

Scenario: Multi-metric overlay
  Given trend chart displayed
  Then chart shows 4 lines:
    | Metric | Color | Style |
    | OEE | Blue | Solid |
    | Availability | Green | Solid |
    | Performance | Orange | Solid |
    | Quality | Red | Solid |
  And legend toggles line visibility
```

### AC-2: Period Comparison

```gherkin
Scenario: Week-over-week comparison
  Given current week OEE avg = 84.2%
  And last week OEE avg = 82.5%
  When viewing comparison
  Then shows:
    | Period | OEE | Change |
    | This Week | 84.2% | +1.7% â–² |
    | Last Week | 82.5% | - |
  And variance = +2.1% improvement
  And color-coded: green if improved, red if declined

Scenario: Month-over-month comparison
  Given December OEE = 85.1%
  And November OEE = 83.8%
  Then comparison shows +1.3% improvement
  And breakdown by week within each month
```

### AC-3: Machine Comparison

```gherkin
Scenario: Compare machines over time
  Given 4 machines on same line
  When viewing machine comparison chart
  Then grouped bar chart shows:
    - X-axis: Machines
    - Y-axis: OEE %
    - Bars: This Week vs Last Week
  And table shows detailed metrics per machine
```

### AC-4: Trend Export

```gherkin
Scenario: Export trend data to CSV
  Given trend chart with 30 days data
  When user clicks [Export CSV]
  Then CSV file downloads with columns:
    | Date | OEE | Availability | Performance | Quality |
  And filename = "OEE_Trend_2025-01-15.csv"
```

### AC-5: Shift Comparison

```gherkin
Scenario: Compare shifts
  Given 3 shifts (Morning, Afternoon, Night)
  When viewing shift comparison
  Then chart shows OEE by shift over 7 days
  And identifies best/worst performing shift
  And variance analysis shown
```

---

## Deliverables

- [ ] Analytics API endpoints
- [ ] Trend visualization components (Chart.js/Recharts)
- [ ] Period comparison components
- [ ] Export functionality
- [ ] Analytics dashboard page

---

**Document Status**: Ready
**Lines**: ~300
**Phase**: 1B
