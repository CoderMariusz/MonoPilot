# 10.13 - Custom Report Builder

**Priority**: P1
**Story Points**: L (Large)
**Type**: fullstack
**Phase**: 2
**Model**: OPUS

**State:** ready
**Estimate:** L (4-5 days)
**Primary PRD:** `docs/1-BASELINE/product/modules/oee.md` (FR-OEE-019)

---

## Goal

Drag-and-drop custom report builder allowing users to select metrics, dimensions, filters, and charts to create personalized OEE reports. Save templates for reuse and schedule automated generation.

---

## User Story

As a **Production Manager**, I want to **build custom reports with specific metrics and filters** so that **I can answer specific questions without developer help**.

---

## Scope

**In scope**
- Report builder UI (drag-and-drop interface)
- Metric selection: OEE, availability, downtime, output, energy
- Dimension selection: Machine, Line, Shift, Product, Date
- Filter configuration: Date range, specific machines/products
- Chart type selection: Line, Bar, Pie, Table
- Save report templates
- POST /api/oee/reports/custom
- GET /api/oee/reports/templates

**Out of scope**
- Scheduled report generation (Phase 3)
- Email distribution (Phase 3)
- Advanced calculations (custom formulas) (Phase 3)

---

## Acceptance Criteria

```gherkin
Scenario: Build custom report
  Given user on /oee/reports/builder
  When user:
    - Selects metrics: OEE, Downtime
    - Selects dimension: Machine
    - Adds filter: Date = Last 7 Days
    - Selects chart type: Bar
  And clicks [Generate Preview]
  Then preview shows bar chart with OEE and downtime by machine
  And data table displayed below chart

Scenario: Save report template
  Given custom report built
  When user clicks [Save Template]
  And enters name "Weekly Machine Performance"
  Then template saved
  And appears in "My Templates" list
  And can be reused

Scenario: Run saved template
  Given saved template "Weekly Machine Performance"
  When user clicks [Run]
  Then report generated with current data
  And matches saved configuration
```

---

## Deliverables

- [ ] Report builder UI (drag-drop)
- [ ] Template storage (report_templates table)
- [ ] Custom report API endpoints
- [ ] Report generation engine
- [ ] Template library page

---

**Lines**: ~200
**Phase**: 2
