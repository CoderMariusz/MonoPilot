# 10.1 - OEE Settings & Targets

**Priority**: P0 (MVP)
**Story Points**: M (Medium)
**Type**: backend + frontend
**Phase**: 1A (Core OEE)
**Model**: SONNET

**State:** ready
**Estimate:** M (2-3 days)
**Primary PRD:** `docs/1-BASELINE/product/modules/oee.md` (FR-OEE-009)
**Architecture:** `docs/1-BASELINE/architecture/modules/oee.md` (performance_targets table)

---

## Goal

Implement OEE module configuration and performance target management. This enables administrators to toggle OEE tracking, configure performance targets (availability/performance/quality) per machine/line, and define alert thresholds for proactive monitoring.

---

## User Story

As a **Production Manager**, I want to **configure OEE targets and alert thresholds for my machines and production lines** so that **I can track performance against goals and receive notifications when performance drops below acceptable levels**.

As a **System Administrator**, I want to **enable/disable OEE tracking at the organization level** so that **I can control when OEE data collection begins**.

---

## Scope

**In scope (this story)**
- `performance_targets` table with machine/line/organization scope
- OEE module enable/disable toggle in settings
- Target configuration: OEE%, Availability%, Performance%, Quality%
- Threshold configuration: Warning (85%), Critical (75%)
- Effective date and expiry date support for target scheduling
- GET /api/oee/targets (list targets)
- GET /api/oee/targets/:id (target detail)
- POST /api/oee/targets (create target)
- PATCH /api/oee/targets/:id (update target)
- DELETE /api/oee/targets/:id (delete target)
- Settings page: OEE module configuration
- Targets page: Target CRUD with table
- Target form modal with validation

**Out of scope (this story)**
- OEE calculation engine (story 10.4)
- Real-time dashboard (story 10.5)
- Alert notification delivery (Phase 1B)
- Historical trend analysis (Phase 1B)
- Benchmark reports (Phase 3)

---

## Dependencies

### Cross-Epic Dependencies

| Dependency | Story/Epic | Type | What It Provides | Status |
|------------|------------|------|------------------|--------|
| 01.1 | Org Context + RLS | HARD | organizations, users, roles tables | Ready |
| 01.3 | Machine Settings | HARD | machines table for target reference | Ready |
| 01.5 | Production Lines | HARD | production_lines table for target reference | Ready |

### Within Epic Dependencies

None (This is the first OEE story)

### Provides To (Downstream)

| Story | What This Provides |
|-------|-------------------|
| 10.2 | Target reference for downtime severity classification |
| 10.4 | Target values for OEE calculation comparisons |
| 10.5 | Target thresholds for dashboard color coding |
| Phase 1B | Alert threshold configuration for notifications |

---

## Database Migration

### Migration: Create performance_targets table

```sql
-- Migration: YYYYMMDDHHMMSS_create_performance_targets.sql

CREATE TABLE performance_targets (
    -- Identity
    id                      UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    org_id                  UUID NOT NULL REFERENCES organizations(id) ON DELETE CASCADE,

    -- Target Scope (one of these will be populated)
    target_type             TEXT NOT NULL
                            CHECK (target_type IN ('organization', 'line', 'machine')),

    -- Reference (based on target_type)
    reference_id            UUID, -- NULL for organization-level, line_id or machine_id otherwise

    -- Target Metrics (percentage values)
    oee_target              DECIMAL(5,2) NOT NULL
                            CHECK (oee_target >= 0 AND oee_target <= 100),
    availability_target     DECIMAL(5,2)
                            CHECK (availability_target IS NULL OR (availability_target >= 0 AND availability_target <= 100)),
    performance_target      DECIMAL(5,2)
                            CHECK (performance_target IS NULL OR (performance_target >= 0 AND performance_target <= 100)),
    quality_target          DECIMAL(5,2)
                            CHECK (quality_target IS NULL OR (quality_target >= 0 AND quality_target <= 100)),

    -- Alert Thresholds (percentage values, below target)
    warning_threshold       DECIMAL(5,2) DEFAULT 85.0
                            CHECK (warning_threshold >= 0 AND warning_threshold <= 100),
    critical_threshold      DECIMAL(5,2) DEFAULT 75.0
                            CHECK (critical_threshold >= 0 AND critical_threshold <= 100),

    -- Validity Period
    effective_date          DATE NOT NULL DEFAULT CURRENT_DATE,
    expiry_date             DATE,

    -- Status
    is_active               BOOLEAN DEFAULT true,

    -- Notes
    notes                   TEXT,

    -- Audit
    created_at              TIMESTAMPTZ NOT NULL DEFAULT now(),
    created_by              UUID REFERENCES users(id),
    updated_at              TIMESTAMPTZ NOT NULL DEFAULT now(),
    updated_by              UUID REFERENCES users(id),

    -- Constraints
    CONSTRAINT chk_expiry_after_effective
        CHECK (expiry_date IS NULL OR expiry_date >= effective_date),
    CONSTRAINT chk_critical_below_warning
        CHECK (critical_threshold <= warning_threshold),
    CONSTRAINT chk_reference_type_match
        CHECK (
            (target_type = 'organization' AND reference_id IS NULL) OR
            (target_type IN ('line', 'machine') AND reference_id IS NOT NULL)
        )
);

-- =============================================================================
-- Indexes for Performance
-- =============================================================================

CREATE INDEX idx_targets_org ON performance_targets(org_id);
CREATE INDEX idx_targets_org_type ON performance_targets(org_id, target_type);
CREATE INDEX idx_targets_org_active ON performance_targets(org_id, is_active) WHERE is_active = true;
CREATE INDEX idx_targets_reference ON performance_targets(reference_id) WHERE reference_id IS NOT NULL;
CREATE INDEX idx_targets_effective ON performance_targets(org_id, effective_date, expiry_date);

-- Composite index for active target lookup
CREATE INDEX idx_targets_active_lookup ON performance_targets(
    org_id, target_type, reference_id, is_active
) WHERE is_active = true;

-- =============================================================================
-- RLS Policies
-- =============================================================================

ALTER TABLE performance_targets ENABLE ROW LEVEL SECURITY;

CREATE POLICY "targets_select" ON performance_targets
    FOR SELECT USING (
        org_id = (SELECT org_id FROM users WHERE id = auth.uid())
    );

CREATE POLICY "targets_insert" ON performance_targets
    FOR INSERT WITH CHECK (
        org_id = (SELECT org_id FROM users WHERE id = auth.uid())
    );

CREATE POLICY "targets_update" ON performance_targets
    FOR UPDATE USING (
        org_id = (SELECT org_id FROM users WHERE id = auth.uid())
    );

CREATE POLICY "targets_delete" ON performance_targets
    FOR DELETE USING (
        org_id = (SELECT org_id FROM users WHERE id = auth.uid())
    );

-- =============================================================================
-- Trigger for updated_at
-- =============================================================================

CREATE TRIGGER update_performance_targets_updated_at
    BEFORE UPDATE ON performance_targets
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at_column();

-- =============================================================================
-- OEE Settings in settings table
-- =============================================================================

-- Add OEE module settings to existing settings table
ALTER TABLE settings
ADD COLUMN IF NOT EXISTS oee_enabled BOOLEAN DEFAULT false,
ADD COLUMN IF NOT EXISTS oee_snapshot_interval_minutes INTEGER DEFAULT 5
    CHECK (oee_snapshot_interval_minutes >= 1 AND oee_snapshot_interval_minutes <= 60),
ADD COLUMN IF NOT EXISTS oee_auto_fail_on_critical BOOLEAN DEFAULT true,
ADD COLUMN IF NOT EXISTS oee_default_target DECIMAL(5,2) DEFAULT 85.0
    CHECK (oee_default_target >= 0 AND oee_default_target <= 100);

COMMENT ON COLUMN settings.oee_enabled IS 'Enable OEE tracking module';
COMMENT ON COLUMN settings.oee_snapshot_interval_minutes IS 'OEE calculation interval (1-60 minutes)';
COMMENT ON COLUMN settings.oee_auto_fail_on_critical IS 'Auto-fail OEE when critical defects detected';
COMMENT ON COLUMN settings.oee_default_target IS 'Default OEE target for new machines (%)';
```

---

## Acceptance Criteria (Given/When/Then)

### AC-1: Performance Targets Table Creation

```gherkin
Scenario: performance_targets table exists with all required columns
  Given database migration runs
  When schema is inspected
  Then performance_targets table has all columns from schema
  And CHECK constraints enforce valid percentages (0-100)
  And CHECK constraint enforces critical <= warning threshold
  And RLS policies enforce org isolation
```

### AC-2: Organization-Level Target

```gherkin
Scenario: Create organization-wide OEE target
  Given user is admin for Org A
  When creating target:
    | Field | Value |
    | target_type | organization |
    | reference_id | NULL |
    | oee_target | 85.0 |
    | availability_target | 90.0 |
    | performance_target | 95.0 |
    | quality_target | 100.0 |
    | warning_threshold | 85.0 |
    | critical_threshold | 75.0 |
  Then target created with status = active
  And effective_date = today
  And applies to all machines/lines without specific targets

Scenario: Organization target validation
  Given creating organization target
  When reference_id is NOT NULL
  Then validation error: "Organization targets must have NULL reference_id"
```

### AC-3: Machine-Specific Target

```gherkin
Scenario: Create machine-specific OEE target
  Given machine "Mixer-01" exists in Org A
  When creating target:
    | Field | Value |
    | target_type | machine |
    | reference_id | {mixer-01-uuid} |
    | oee_target | 88.0 |
    | availability_target | 92.0 |
    | performance_target | 96.0 |
    | quality_target | 100.0 |
  Then target created and linked to Mixer-01
  And machine-specific target overrides organization target

Scenario: Machine target validation
  Given creating machine target
  When reference_id is NULL
  Then validation error: "Machine targets require valid reference_id"

  When reference_id points to non-existent machine
  Then validation error: "Machine not found"
```

### AC-4: Line-Specific Target

```gherkin
Scenario: Create production line OEE target
  Given production line "Line-1" exists in Org A
  When creating target:
    | Field | Value |
    | target_type | line |
    | reference_id | {line-1-uuid} |
    | oee_target | 82.0 |
  Then target created and applies to all machines on Line-1
  And line target overrides organization target
  And machine-specific target overrides line target
```

### AC-5: Target Threshold Configuration

```gherkin
Scenario: Configure alert thresholds
  Given creating OEE target with oee_target = 85.0
  When setting:
    | Field | Value |
    | warning_threshold | 85.0 |
    | critical_threshold | 75.0 |
  Then warning alerts trigger when OEE drops below 85%
  And critical alerts trigger when OEE drops below 75%

Scenario: Threshold validation
  Given creating target
  When critical_threshold = 90 and warning_threshold = 80
  Then validation error: "Critical threshold must be <= warning threshold"

  When warning_threshold = 105
  Then validation error: "Threshold must be between 0 and 100"
```

### AC-6: Effective Date and Expiry

```gherkin
Scenario: Schedule target for future
  Given today is 2025-01-15
  When creating target:
    | Field | Value |
    | effective_date | 2025-02-01 |
    | expiry_date | 2025-12-31 |
  Then target created with is_active = true
  And applies from 2025-02-01 through 2025-12-31

Scenario: Expire old targets
  Given target exists with expiry_date = 2025-01-14
  When date is 2025-01-15
  Then target no longer applies (manual or batch job marks inactive)

Scenario: Date validation
  Given creating target
  When expiry_date = 2025-01-01 and effective_date = 2025-06-01
  Then validation error: "Expiry date must be >= effective date"
```

### AC-7: Target Priority (Resolution)

```gherkin
Scenario: Target resolution hierarchy
  Given organization target = 85%
  And line "Line-1" target = 82%
  And machine "Mixer-01" (on Line-1) target = 88%
  When calculating OEE for Mixer-01
  Then use machine target = 88% (highest priority)

  When calculating OEE for "Filler-02" (on Line-1, no machine target)
  Then use line target = 82%

  When calculating OEE for "Packer-03" (no line, no machine target)
  Then use organization target = 85%
```

### AC-8: OEE Module Enable/Disable

```gherkin
Scenario: Enable OEE module
  Given OEE module is disabled
  When admin navigates to Settings > OEE
  And toggles "Enable OEE Tracking" to ON
  Then settings.oee_enabled = true
  And OEE calculation engine starts collecting snapshots
  And /oee/dashboard becomes accessible

Scenario: Disable OEE module
  Given OEE module is enabled
  When admin disables OEE tracking
  Then settings.oee_enabled = false
  And OEE snapshots stop collecting
  And existing data preserved but not updated
```

### AC-9: Default Target Configuration

```gherkin
Scenario: Configure default OEE target
  Given admin in Settings > OEE
  When setting default_target = 85.0
  Then new machines inherit 85% OEE target
  And existing machines keep current targets (not retroactive)
```

### AC-10: Targets List Page

```gherkin
Scenario: View targets list
  Given user navigates to /oee/settings/targets
  When page loads
  Then DataTable displays targets with columns:
    | Column | Description |
    | Scope | Organization / Line / Machine |
    | Reference | Line/Machine name or "All" |
    | OEE Target | Percentage |
    | Availability | Percentage |
    | Performance | Percentage |
    | Quality | Percentage |
    | Effective Date | Date range |
    | Status | Active/Inactive badge |
    | Actions | Edit, Delete |
  And list loads within 500ms

Scenario: Filter targets by scope
  Given targets exist for all scopes
  When user filters by "Machine"
  Then only machine-specific targets display
```

### AC-11: Create Target Form

```gherkin
Scenario: Create new target via modal
  Given user clicks [+ New Target]
  When modal opens
  Then form displays:
    | Field | Type | Default |
    | Scope | Dropdown | Organization |
    | Reference | Dropdown (if line/machine) | - |
    | OEE Target % | Number | 85.0 |
    | Availability Target % | Number | 90.0 |
    | Performance Target % | Number | 95.0 |
    | Quality Target % | Number | 100.0 |
    | Warning Threshold % | Number | 85.0 |
    | Critical Threshold % | Number | 75.0 |
    | Effective Date | Date | Today |
    | Expiry Date | Date | (Optional) |
    | Notes | Text | - |
  And user fills values
  And clicks [Create Target]
  Then target created and appears in list
  And success toast: "Target created successfully"
```

### AC-12: Update Target

```gherkin
Scenario: Edit existing target
  Given target exists for Mixer-01
  When user clicks [Edit] on target row
  Then form pre-filled with current values
  And user changes oee_target from 88% to 90%
  And clicks [Save]
  Then target updated
  And audit log records change
  And success toast: "Target updated"
```

### AC-13: Delete Target

```gherkin
Scenario: Delete target
  Given target exists with no dependencies
  When user clicks [Delete]
  Then confirmation dialog: "Delete this target? This action cannot be undone."
  And user confirms
  Then target deleted
  And removed from list

Scenario: Cannot delete if referenced
  Given target is being used by active OEE calculations
  When attempting to delete
  Then warning: "Target is in use. Set expiry date instead of deleting."
  And delete blocked
```

### AC-14: Permission Enforcement

```gherkin
Scenario: Admin can manage targets
  Given user has ADMIN or PRODUCTION_MANAGER role
  When viewing /oee/settings/targets
  Then [+ New Target] button visible
  And [Edit], [Delete] actions enabled

Scenario: Viewer cannot modify targets
  Given user has VIEWER role
  When viewing /oee/settings/targets
  Then [+ New Target] button hidden
  And [Edit], [Delete] actions disabled
  And can view target list (read-only)
```

### AC-15: RLS Policy Enforcement

```gherkin
Scenario: Org isolation on targets
  Given User A from Org A and User B from Org B
  And targets exist in both orgs
  When User A requests GET /api/oee/targets
  Then only Org A targets returned

Scenario: Cannot view target from different org
  Given target belongs to Org B
  When User A (Org A) requests GET /api/oee/targets/:id
  Then 404 Not Found returned
```

### AC-16: Performance Requirements

```gherkin
Scenario: Targets list performance
  Given 100 targets in organization
  When loading targets list
  Then response time < 500ms

Scenario: Target creation performance
  Given valid target data
  When creating target
  Then operation completes < 300ms
```

---

## Implementation Notes

### API Endpoints

```typescript
// =============================================================================
// OEE Targets Endpoints
// =============================================================================

// GET /api/oee/targets
interface TargetsListParams {
  target_type?: 'organization' | 'line' | 'machine';
  is_active?: boolean;
  reference_id?: string;
  effective_on?: string; // Date filter (YYYY-MM-DD)
  sort_by?: 'created_at' | 'effective_date' | 'target_type';
  sort_order?: 'asc' | 'desc';
  page?: number;
  limit?: number;
}

interface TargetsListResponse {
  targets: PerformanceTarget[];
  pagination: {
    total: number;
    page: number;
    limit: number;
    pages: number;
  };
}

interface PerformanceTarget {
  id: string;
  org_id: string;
  target_type: 'organization' | 'line' | 'machine';
  reference_id?: string;
  reference_name?: string; // Line or Machine name (joined)

  oee_target: number;
  availability_target?: number;
  performance_target?: number;
  quality_target?: number;

  warning_threshold: number;
  critical_threshold: number;

  effective_date: string;
  expiry_date?: string;
  is_active: boolean;
  notes?: string;

  created_at: string;
  created_by: string;
  updated_at: string;
}

// GET /api/oee/targets/:id
interface TargetDetailResponse {
  target: PerformanceTarget;
  usage_count?: number; // Number of active OEE calculations using this target
}

// POST /api/oee/targets
interface CreateTargetRequest {
  target_type: 'organization' | 'line' | 'machine';
  reference_id?: string; // Required if type = line/machine
  oee_target: number;
  availability_target?: number;
  performance_target?: number;
  quality_target?: number;
  warning_threshold?: number; // Default: 85.0
  critical_threshold?: number; // Default: 75.0
  effective_date?: string; // Default: today
  expiry_date?: string;
  notes?: string;
}

// PATCH /api/oee/targets/:id
interface UpdateTargetRequest {
  oee_target?: number;
  availability_target?: number;
  performance_target?: number;
  quality_target?: number;
  warning_threshold?: number;
  critical_threshold?: number;
  expiry_date?: string;
  is_active?: boolean;
  notes?: string;
}

// GET /api/oee/targets/resolve?type=machine&id={uuid}
// Resolve effective target for a machine/line (follows hierarchy)
interface ResolveTargetResponse {
  effective_target: PerformanceTarget;
  source: 'machine' | 'line' | 'organization' | 'default';
  hierarchy: {
    machine?: PerformanceTarget;
    line?: PerformanceTarget;
    organization?: PerformanceTarget;
  };
}
```

### Validation Schemas (Zod)

```typescript
import { z } from 'zod';

export const targetTypeEnum = z.enum(['organization', 'line', 'machine']);

const percentageSchema = z.number()
  .min(0, 'Percentage must be >= 0')
  .max(100, 'Percentage must be <= 100');

export const createTargetSchema = z.object({
  target_type: targetTypeEnum,
  reference_id: z.string().uuid().optional(),

  oee_target: percentageSchema,
  availability_target: percentageSchema.optional(),
  performance_target: percentageSchema.optional(),
  quality_target: percentageSchema.optional(),

  warning_threshold: percentageSchema.default(85.0),
  critical_threshold: percentageSchema.default(75.0),

  effective_date: z.string().regex(/^\d{4}-\d{2}-\d{2}$/).optional(),
  expiry_date: z.string().regex(/^\d{4}-\d{2}-\d{2}$/).optional(),
  notes: z.string().max(1000).optional(),
}).refine(
  (data) => {
    if (data.target_type === 'organization') {
      return !data.reference_id;
    }
    return !!data.reference_id;
  },
  {
    message: 'Organization targets must not have reference_id; line/machine targets require reference_id',
    path: ['reference_id'],
  }
).refine(
  (data) => data.critical_threshold <= data.warning_threshold,
  {
    message: 'Critical threshold must be <= warning threshold',
    path: ['critical_threshold'],
  }
);

export const updateTargetSchema = z.object({
  oee_target: percentageSchema.optional(),
  availability_target: percentageSchema.optional(),
  performance_target: percentageSchema.optional(),
  quality_target: percentageSchema.optional(),
  warning_threshold: percentageSchema.optional(),
  critical_threshold: percentageSchema.optional(),
  expiry_date: z.string().regex(/^\d{4}-\d{2}-\d{2}$/).optional(),
  is_active: z.boolean().optional(),
  notes: z.string().max(1000).optional(),
}).refine(
  (data) => {
    if (data.critical_threshold !== undefined && data.warning_threshold !== undefined) {
      return data.critical_threshold <= data.warning_threshold;
    }
    return true;
  },
  {
    message: 'Critical threshold must be <= warning threshold',
    path: ['critical_threshold'],
  }
);
```

### Service Layer

```typescript
// lib/services/oee-target-service.ts

export class OEETargetService {
  /**
   * List performance targets with filtering
   */
  static async list(params: TargetsListParams): Promise<PaginatedResult<PerformanceTarget>>;

  /**
   * Get target by ID
   */
  static async getById(id: string): Promise<PerformanceTarget | null>;

  /**
   * Create new performance target
   */
  static async create(input: CreateTargetInput): Promise<PerformanceTarget>;

  /**
   * Update existing target
   */
  static async update(id: string, input: UpdateTargetInput): Promise<PerformanceTarget>;

  /**
   * Delete target (soft delete if in use)
   */
  static async delete(id: string): Promise<void>;

  /**
   * Resolve effective target for machine/line
   * Follows hierarchy: machine > line > organization > default
   */
  static async resolveTarget(
    type: 'machine' | 'line',
    referenceId: string
  ): Promise<{
    effective: PerformanceTarget;
    source: 'machine' | 'line' | 'organization' | 'default';
  }>;

  /**
   * Get active target for specific date
   */
  static async getActiveTarget(
    type: string,
    referenceId: string | null,
    date: Date
  ): Promise<PerformanceTarget | null>;

  /**
   * Check if target is in use by OEE calculations
   */
  static async isInUse(targetId: string): Promise<boolean>;

  /**
   * Get default target from settings
   */
  static async getDefaultTarget(orgId: string): Promise<number>;
}
```

---

## Frontend Components

```
apps/frontend/app/(authenticated)/oee/
  settings/
    page.tsx                       -- OEE module settings
    targets/
      page.tsx                     -- Targets list
      new/
        page.tsx                   -- Create target (optional)

components/oee/settings/
  OEESettingsForm.tsx              -- OEE module enable/disable, defaults
  TargetsDataTable.tsx             -- DataTable for targets list
  TargetFormModal.tsx              -- Create/Edit target modal
  TargetScopeBadge.tsx             -- Badge for org/line/machine
  TargetStatusBadge.tsx            -- Active/Inactive badge
  TargetMetricsDisplay.tsx         -- Display OEE/Availability/Performance/Quality
  ThresholdSlider.tsx              -- Visual slider for warning/critical thresholds
```

---

## Key Business Rules

1. **Target Hierarchy**: Machine-specific > Line-specific > Organization-wide > System default (85%)
2. **Threshold Logic**: Critical threshold must be <= Warning threshold
3. **Effective Dates**: Targets apply from effective_date through expiry_date (NULL = no expiry)
4. **Organization Scope**: target_type='organization' must have reference_id=NULL
5. **Reference Validation**: target_type='line'/'machine' must have valid reference_id
6. **Default Target**: New machines inherit settings.oee_default_target if no specific target exists
7. **Deletion**: Cannot delete targets in use; set expiry_date instead
8. **Audit Trail**: All target changes logged for compliance

---

## Deliverables

### Database
- [ ] Migration: `performance_targets` table with RLS
- [ ] Migration: Add OEE settings to `settings` table
- [ ] All indexes for performance
- [ ] RLS policies for org isolation

### API Routes
- [ ] `GET /api/oee/targets` - List targets
- [ ] `GET /api/oee/targets/:id` - Get target detail
- [ ] `POST /api/oee/targets` - Create target
- [ ] `PATCH /api/oee/targets/:id` - Update target
- [ ] `DELETE /api/oee/targets/:id` - Delete target
- [ ] `GET /api/oee/targets/resolve` - Resolve effective target

### Service Layer
- [ ] `OEETargetService.list()` - List with filters
- [ ] `OEETargetService.create()` - Create target
- [ ] `OEETargetService.update()` - Update target
- [ ] `OEETargetService.delete()` - Delete target
- [ ] `OEETargetService.resolveTarget()` - Hierarchy resolution
- [ ] `OEETargetService.getActiveTarget()` - Date-filtered lookup

### Validation
- [ ] `createTargetSchema` - Full validation
- [ ] `updateTargetSchema` - Partial updates

### Frontend
- [ ] OEE Settings page (/oee/settings)
- [ ] Targets list page (/oee/settings/targets)
- [ ] Target form modal (create/edit)
- [ ] Target scope badge component
- [ ] Threshold slider component

### Tests
- [ ] Unit tests: OEETargetService methods (>80% coverage)
- [ ] Integration tests: All API endpoints
- [ ] RLS tests: Multi-tenancy isolation
- [ ] E2E: Create/update/delete target workflow

---

## Definition of Done

### Database
- [ ] `performance_targets` table created with constraints
- [ ] OEE settings columns added to `settings` table
- [ ] All indexes created
- [ ] RLS policies enforce org isolation

### API
- [ ] All endpoints return correct status codes
- [ ] Validation errors return 400 with messages
- [ ] Cross-tenant access returns 404
- [ ] Response times < 500ms

### Service
- [ ] Target hierarchy resolution works correctly
- [ ] Date filtering for active targets
- [ ] Validation enforced at service layer

### Frontend
- [ ] Settings page displays OEE module toggle
- [ ] Targets list displays with filters
- [ ] Form modal validates input
- [ ] Success/error toasts display
- [ ] Mobile responsive

### Testing
- [ ] Unit tests: >80% coverage
- [ ] Integration tests: All endpoints covered
- [ ] E2E tests: Full CRUD workflow passing

---

## Risk Assessment

| Risk | Impact | Likelihood | Mitigation |
|------|--------|------------|------------|
| Target hierarchy complexity | MEDIUM | MEDIUM | Clear resolution algorithm, comprehensive tests |
| Date range validation | LOW | LOW | Database CHECK constraints, validation schemas |
| Performance with many targets | LOW | LOW | Proper indexes, pagination |
| Permission complexity | MEDIUM | LOW | RLS policies, role checks |

---

## Version History

| Version | Date | Changes | Author |
|---------|------|---------|--------|
| 1.0 | 2025-01-15 | Initial story creation for OEE MVP | SONNET |

---

**Document Status**: Ready for Implementation
**Created**: 2025-01-15
**Lines**: ~550
**Complexity**: M (Medium)
**Phase**: 1A (Core OEE)
