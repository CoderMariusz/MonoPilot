# Story 10.2 - Downtime Reason Codes & Categories Context
# Generated: 2025-01-15
# Phase: 1A (Core OEE)

story:
  id: "10.2"
  name: "Downtime Reason Codes & Categories"
  slug: "downtime-reason-codes"
  epic: "10-oee"
  phase: "1A"
  complexity: "M"
  estimate_days: 2-3
  type: "full-stack"
  state: "ready"
  priority: "P0"

context_files:
  - _index.yaml
  - database.yaml
  - api.yaml
  - frontend.yaml
  - tests.yaml

dependencies:
  required:
    - story: "01.1"
      provides: ["organizations, users, roles"]
    - story: "10.1"
      provides: ["OEE enabled flag (soft)"]
  blocks:
    - story: "10.3"
      reason: "Reason codes required for downtime event logging"

files_to_read:
  prd:
    path: "docs/1-BASELINE/product/modules/oee.md"
    sections: ["FR-OEE-004, FR-OEE-005 - Downtime Reason Codes"]
  story:
    path: "docs/2-MANAGEMENT/epics/current/10-oee/10.2.downtime-reason-codes.md"

deliverables:
  - type: "migration"
    count: 1
    description: "oee_downtime_reasons table + seed function"
  - type: "function"
    count: 1
    description: "seed_default_downtime_reasons(org_id)"
  - type: "service"
    count: 1
    description: "downtime-reason-service.ts"
  - type: "api"
    count: 5
    description: "CRUD endpoints + seed"
  - type: "components"
    count: 4
    description: "List, modal, category badge, color picker"
  - type: "page"
    count: 1
    description: "/oee/settings/downtime-reasons"

technical_notes:
  - "Categories: mechanical, electrical, material, changeover, break, quality, operator, utility, other"
  - "Planned vs unplanned flag for availability calculation"
  - "Color coding for visual distinction (hex codes)"
  - "Sort order for dropdown presentation"
  - "23 default reason codes seeded per org"
  - "Code format: UPPERCASE with hyphens (e.g., MECH-JAM)"

business_rules:
  - rule: "Code Uniqueness"
    enforcement: "UNIQUE constraint on (org_id, code)"
  - rule: "Planned vs Unplanned Classification"
    enforcement: "Used in OEE availability calculation (exclude planned downtime)"
  - rule: "Deactivate Instead of Delete"
    enforcement: "Set is_active=false if code in use, preserve historical data"
