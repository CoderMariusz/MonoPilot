# 10.16 - MTBF/MTTR Calculation

**Priority**: P1
**Story Points**: M (Medium)
**Type**: backend
**Phase**: 3
**Model**: OPUS

**State:** ready
**Estimate:** M (3-4 days)
**Primary PRD:** `docs/1-BASELINE/product/modules/oee.md` (FR-OEE-022)

---

## Goal

Calculate reliability metrics: MTBF (Mean Time Between Failures), MTTR (Mean Time To Repair), and overall equipment reliability. Track failure frequency, repair times, and identify unreliable machines for preventive maintenance prioritization.

---

## User Story

As a **Maintenance Manager**, I want to **track MTBF and MTTR for each machine** so that **I can prioritize preventive maintenance and reduce unplanned downtime**.

---

## Scope

- MTBF calculation: Total running time / Number of failures
- MTTR calculation: Total repair time / Number of failures
- Failure event categorization (mechanical, electrical, other)
- Reliability trend tracking
- Machine reliability ranking
- GET /api/oee/analytics/mtbf
- Reliability dashboard widget

---

## Acceptance Criteria

```gherkin
Scenario: Calculate MTBF
  Given machine ran 480 hours last month
  And had 6 failures
  When calculating MTBF
  Then MTBF = 480 / 6 = 80 hours
  And means failure every 80 hours on average

Scenario: Calculate MTTR
  Given 6 failures with repair times: 15, 20, 30, 10, 25, 20 min
  When calculating MTTR
  Then total repair time = 120 min
  And MTTR = 120 / 6 = 20 minutes
  And means average repair time is 20 min

Scenario: Reliability ranking
  Given 5 machines with MTBF:
    | Machine | MTBF |
    | Mixer-01 | 120 hours |
    | Filler-02 | 85 hours |
    | Labeler-03 | 60 hours |
  Then reliability ranking:
    1. Mixer-01 (most reliable)
    2. Filler-02
    3. Labeler-03 (least reliable)
  And Labeler-03 flagged for preventive maintenance priority
```

---

## Deliverables

- [ ] MTBF/MTTR calculation service
- [ ] Failure categorization
- [ ] Reliability API endpoints
- [ ] Reliability dashboard widget
- [ ] Machine reliability ranking page

---

**Lines**: ~180
**Phase**: 3
