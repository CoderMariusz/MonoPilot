# TEC-010: Allergen Management (Product)

**Module**: Technical
**Feature**: Product Allergen Declaration (FR-2.4, FR-2.28)
**Type**: Page Section / Modal Dialog
**Status**: Approved (Auto-Approve Mode)
**Completion**: 95%+
**Last Updated**: 2025-12-14

---

## ASCII Wireframe

### Success State (Product Detail - Allergen Section)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Product: Whole Wheat Bread (PROD-157)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  [Basic Info] [Allergens] [Nutrition] [BOM] [History]           â”‚
â”‚                                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚  ALLERGEN DECLARATIONS                                           â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ”„ Auto-Inherited from BOM                  [Recalculate]  â”‚ â”‚
â”‚  â”‚ Last Updated: 2025-12-10 15:23 (BOM v3)                    â”‚ â”‚
â”‚  â”‚ 5 allergens detected from 8 ingredients                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Contains (Present in Product)                [+ Add Allergen]  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸŒ¾ Gluten (Cereals with gluten)                            â”‚ â”‚
â”‚  â”‚    Source: Wheat Flour (PROD-001), Oat Fiber (PROD-034)   â”‚ â”‚
â”‚  â”‚    [View Details] [Change to "May Contain"] [Remove]   [â‹®] â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ ğŸ¥› Milk (Milk and dairy products)                          â”‚ â”‚
â”‚  â”‚    Source: Milk Powder (PROD-012)                          â”‚ â”‚
â”‚  â”‚    [View Details] [Change to "May Contain"] [Remove]   [â‹®] â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ ğŸ¥š Eggs (Eggs and egg products)                            â”‚ â”‚
â”‚  â”‚    Source: Egg White Powder (PROD-023)                     â”‚ â”‚
â”‚  â”‚    [View Details] [Change to "May Contain"] [Remove]   [â‹®] â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ ğŸ«˜ Soybeans (Soya and soya products)                       â”‚ â”‚
â”‚  â”‚    Source: Soy Lecithin (PROD-067)                         â”‚ â”‚
â”‚  â”‚    [View Details] [Change to "May Contain"] [Remove]   [â‹®] â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ ğŸŒ° Nuts (Tree nuts)                                        â”‚ â”‚
â”‚  â”‚    Source: Walnut Pieces (PROD-089)                        â”‚ â”‚
â”‚  â”‚    [View Details] [Change to "May Contain"] [Remove]   [â‹®] â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  May Contain (Cross-Contamination Risk)       [+ Add Allergen]  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ¥œ Peanuts (Peanuts and peanut products)                   â”‚ â”‚
â”‚  â”‚    Risk: Shared production line - Line 3                   â”‚ â”‚
â”‚  â”‚    Reason: Shared production line with peanut products     â”‚ â”‚
â”‚  â”‚    Risk Level: âš ï¸ Medium (cleaned between runs)            â”‚ â”‚
â”‚  â”‚    Added: 2025-12-01 by Jane Smith (Manual)                â”‚ â”‚
â”‚  â”‚    [View Details] [Change to "Contains"] [Remove]      [â‹®] â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ ğŸŒ± Sesame (Sesame seeds and products)                      â”‚ â”‚
â”‚  â”‚    Risk: Shared warehouse - Zone B                         â”‚ â”‚
â”‚  â”‚    Reason: Shared warehouse storage area                   â”‚ â”‚
â”‚  â”‚    Risk Level: âš ï¸ Low (separate containers)                â”‚ â”‚
â”‚  â”‚    Added: 2025-11-15 by John Doe (Manual)                  â”‚ â”‚
â”‚  â”‚    [View Details] [Change to "Contains"] [Remove]      [â‹®] â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Free From (Explicitly Allergen-Free)      [+ Add Free From]    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸŸ Fish    ğŸ¦ Crustaceans    ğŸŒ¿ Celery    ğŸŸ¡ Mustard       â”‚ â”‚
â”‚  â”‚ ğŸ‡ Sulphites    ğŸ«› Lupin    ğŸš Molluscs                    â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ 7 allergens confirmed as not present         [Manage]     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  âš  Warnings & Compliance                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âœ“ All EU 14 allergens reviewed                             â”‚ â”‚
â”‚  â”‚ âš  Manual "May Contain" declarations require review every   â”‚ â”‚
â”‚  â”‚   90 days (Next: 2025-03-01)                               â”‚ â”‚
â”‚  â”‚ âœ“ Label generation ready                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  [View Allergen History] [Generate Allergen Label] [Export PDF] â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Allergen Icons/Badges Specification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ALLERGEN ICON/BADGE SYSTEM SPECIFICATION                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Visual Design:                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  1. CONTAINS (Direct Allergen Presence):                         â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚ ğŸŒ¾ Gluten                            [AUTO] [Contains] â”‚    â”‚
â”‚     â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚    â”‚
â”‚     â”‚ Color: Red (#DC2626)                                  â”‚    â”‚
â”‚     â”‚ Border: 2px solid red                                 â”‚    â”‚
â”‚     â”‚ Background: Light red (#FEE2E2)                       â”‚    â”‚
â”‚     â”‚ Icon: Emoji ğŸŒ¾ (32x32px) or SVG alternative           â”‚    â”‚
â”‚     â”‚ Badge: "AUTO" (green) or "MANUAL" (blue)              â”‚    â”‚
â”‚     â”‚ Status Badge: "Contains" (red pill)                   â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  2. MAY CONTAIN (Cross-Contamination Risk):                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚ ğŸ¥œ Peanuts                     [MANUAL] [May Contain] â”‚    â”‚
â”‚     â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚    â”‚
â”‚     â”‚ Color: Orange (#F59E0B)                               â”‚    â”‚
â”‚     â”‚ Border: 2px solid orange                              â”‚    â”‚
â”‚     â”‚ Background: Light orange (#FEF3C7)                    â”‚    â”‚
â”‚     â”‚ Icon: Emoji ğŸ¥œ (32x32px) or SVG alternative           â”‚    â”‚
â”‚     â”‚ Badge: Always "MANUAL" (blue)                         â”‚    â”‚
â”‚     â”‚ Status Badge: "May Contain" (orange pill)             â”‚    â”‚
â”‚     â”‚ Risk Indicator: âš ï¸ Low/Medium/High                    â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  3. FREE FROM (Allergen-Free):                                   â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚ ğŸŸ Fish                            [CERTIFIED] [Free] â”‚    â”‚
â”‚     â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚    â”‚
â”‚     â”‚ Color: Green (#059669)                                â”‚    â”‚
â”‚     â”‚ Border: 1px solid green                               â”‚    â”‚
â”‚     â”‚ Background: Light green (#D1FAE5)                     â”‚    â”‚
â”‚     â”‚ Icon: Emoji ğŸŸ (24x24px) with strikethrough          â”‚    â”‚
â”‚     â”‚ Badge: "CERTIFIED" if cert uploaded, none if assumed  â”‚    â”‚
â”‚     â”‚ Status Badge: "Free" (green pill)                     â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  Icon Mapping (EU 14 Allergens):                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  1.  Gluten (Cereals)        â†’ ğŸŒ¾ (Wheat/grain)                 â”‚
â”‚  2.  Crustaceans             â†’ ğŸ¦ (Shrimp)                      â”‚
â”‚  3.  Eggs                    â†’ ğŸ¥š (Egg)                         â”‚
â”‚  4.  Fish                    â†’ ğŸŸ (Fish)                        â”‚
â”‚  5.  Peanuts                 â†’ ğŸ¥œ (Peanuts)                     â”‚
â”‚  6.  Soybeans                â†’ ğŸ«˜ (Beans/soy)                   â”‚
â”‚  7.  Milk                    â†’ ğŸ¥› (Milk glass)                  â”‚
â”‚  8.  Nuts (Tree nuts)        â†’ ğŸŒ° (Chestnut)                    â”‚
â”‚  9.  Celery                  â†’ ğŸŒ¿ (Herb/celery)                 â”‚
â”‚  10. Mustard                 â†’ ğŸŸ¡ (Yellow circle/mustard seed)  â”‚
â”‚  11. Sesame                  â†’ ğŸŒ± (Seedling/sesame)             â”‚
â”‚  12. Sulphites               â†’ ğŸ‡ (Grapes)                      â”‚
â”‚  13. Lupin                   â†’ ğŸ«› (Pea pod/lupin)               â”‚
â”‚  14. Molluscs                â†’ ğŸš (Shell/mollusc)               â”‚
â”‚                                                                  â”‚
â”‚  Risk Level Indicators (May Contain only):                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  âš ï¸ HIGH RISK   - Red shield icon                               â”‚
â”‚    Example: Shared equipment, no cleaning between runs          â”‚
â”‚    Visual: Solid red âš ï¸ triangle (24x24px)                      â”‚
â”‚                                                                  â”‚
â”‚  âš ï¸ MEDIUM RISK - Orange alert icon                             â”‚
â”‚    Example: Shared equipment, cleaned between runs              â”‚
â”‚    Visual: Solid orange âš ï¸ triangle (24x24px)                   â”‚
â”‚                                                                  â”‚
â”‚  âš ï¸ LOW RISK    - Yellow caution icon                           â”‚
â”‚    Example: Shared facility, separate production lines          â”‚
â”‚    Visual: Hollow yellow âš ï¸ triangle (24x24px)                  â”‚
â”‚                                                                  â”‚
â”‚  Accessibility:                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  - All icons have ARIA labels (e.g., aria-label="Gluten icon")  â”‚
â”‚  - Text alternatives provided for screen readers                â”‚
â”‚  - Color is supplemented with text/shape (WCAG 2.1 Level AA)    â”‚
â”‚  - Touch targets: 48x48dp minimum for clickable icons/badges    â”‚
â”‚  - Contrast ratios: 4.5:1 for text, 3:1 for UI components       â”‚
â”‚  - Focus indicators: 2px solid outline on keyboard focus        â”‚
â”‚                                                                  â”‚
â”‚  Usage in UI:                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  - Product Lists: Small icon (16x16px) + text                   â”‚
â”‚  - Product Detail: Large icon (32x32px) + full description      â”‚
â”‚  - Labels: Icon only (48x48px) for compact labeling             â”‚
â”‚  - Reports: Icon + text in tables/exports                       â”‚
â”‚  - Tooltips: Hover over icon shows full allergen name + details â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Cross-Contamination Risk UI Clarification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CROSS-CONTAMINATION RISK ASSESSMENT UI                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Risk Assessment Form (in Add/Edit "May Contain" Modal):         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  Allergen: ğŸ¥œ Peanuts (selected)                                 â”‚
â”‚                                                                  â”‚
â”‚  Cross-Contamination Risk Assessment *                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Risk Source Type *                                        â”‚ â”‚
â”‚  â”‚  ( ) Shared Production Equipment                           â”‚ â”‚
â”‚  â”‚  (â€¢) Shared Production Line/Room                           â”‚ â”‚
â”‚  â”‚  ( ) Shared Warehouse/Storage                              â”‚ â”‚
â”‚  â”‚  ( ) Shared Transportation                                 â”‚ â”‚
â”‚  â”‚  ( ) Supplier Cross-Contamination                          â”‚ â”‚
â”‚  â”‚  ( ) Other (specify below)                                 â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Specific Location/Equipment                               â”‚ â”‚
â”‚  â”‚  [Production Line 3_______________________________]        â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Control Measures in Place                                 â”‚ â”‚
â”‚  â”‚  â˜‘ Cleaning/sanitization between production runs           â”‚ â”‚
â”‚  â”‚  â˜‘ Visual inspection after cleaning                        â”‚ â”‚
â”‚  â”‚  â˜ ATP testing (allergen swab)                             â”‚ â”‚
â”‚  â”‚  â˜ Dedicated production time (allergen-free first)         â”‚ â”‚
â”‚  â”‚  â˜‘ Operator training on allergen handling                  â”‚ â”‚
â”‚  â”‚  â˜ Segregated storage                                      â”‚ â”‚
â”‚  â”‚  â˜ Color-coded equipment                                   â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Cleaning Validation Method                                â”‚ â”‚
â”‚  â”‚  [Visual inspection + swab test        â–¼]                  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Frequency of Cleaning                                     â”‚ â”‚
â”‚  â”‚  [Between every production run         â–¼]                  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Last Risk Assessment Date                                 â”‚ â”‚
â”‚  â”‚  [2025-12-01 â–¼]  By: [Jane Smith, QA Manager_____]        â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Supporting Documentation                                  â”‚ â”‚
â”‚  â”‚  ğŸ“„ HACCP_Allergen_Plan_2025.pdf (2.1 MB)                  â”‚ â”‚
â”‚  â”‚  ğŸ“„ Cross_Contamination_Study_Line3.pdf (1.5 MB)           â”‚ â”‚
â”‚  â”‚  [+ Upload Additional Documents]                           â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚ â”‚
â”‚  â”‚  CALCULATED RISK LEVEL                                     â”‚ â”‚
â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Based on your selections:                                 â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  âš ï¸ MEDIUM RISK                                            â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Factors:                                                  â”‚ â”‚
â”‚  â”‚  + Shared production line (High Risk Factor)               â”‚ â”‚
â”‚  â”‚  - Cleaning between runs (Risk Reducer)                    â”‚ â”‚
â”‚  â”‚  - Visual inspection (Risk Reducer)                        â”‚ â”‚
â”‚  â”‚  - Operator training (Risk Reducer)                        â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Recommendations:                                          â”‚ â”‚
â”‚  â”‚  â€¢ Consider ATP testing for validation                     â”‚ â”‚
â”‚  â”‚  â€¢ Review cleaning SOP quarterly                           â”‚ â”‚
â”‚  â”‚  â€¢ Schedule dedicated allergen-free production blocks      â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  [Cancel]                           [Save Risk Assessment]       â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Risk Level Calculation Algorithm:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Base Risk Score = Risk Source Type Score
- Shared Equipment: 100 points (HIGH)
- Shared Line/Room: 80 points (MEDIUM-HIGH)
- Shared Warehouse: 60 points (MEDIUM)
- Shared Transport: 40 points (LOW-MEDIUM)
- Supplier: 50 points (MEDIUM)

Control Measures (subtract points):
- Cleaning between runs: -20 points
- Visual inspection: -10 points
- ATP testing: -15 points
- Dedicated time: -25 points
- Operator training: -10 points
- Segregated storage: -15 points
- Color-coded equipment: -10 points

Final Risk Level:
- 0-30 points: LOW RISK (âš ï¸ Yellow)
- 31-60 points: MEDIUM RISK (âš ï¸ Orange)
- 61-100 points: HIGH RISK (âš ï¸ Red)

Example:
Shared Production Line (80) - Cleaning (-20) - Inspection (-10) - Training (-10)
= 40 points = MEDIUM RISK
```

### Cross-Contamination Risk Display (in Allergen Card)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  May Contain: ğŸ¥œ Peanuts (Enhanced Display)           [â‹®]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Allergen: Peanuts and peanut products                           â”‚
â”‚  Relation: May Contain (Cross-Contamination Risk)                â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âš ï¸ RISK LEVEL: MEDIUM                                       â”‚ â”‚
â”‚  â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ Risk Source:                                               â”‚ â”‚
â”‚  â”‚ â€¢ Shared Production Line - Line 3                          â”‚ â”‚
â”‚  â”‚ â€¢ Products containing peanuts manufactured on same line    â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ Control Measures:                                          â”‚ â”‚
â”‚  â”‚ âœ“ Cleaning/sanitization between runs                       â”‚ â”‚
â”‚  â”‚ âœ“ Visual inspection after cleaning                         â”‚ â”‚
â”‚  â”‚ âœ“ Operator training on allergen handling                   â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ Cleaning Validation:                                       â”‚ â”‚
â”‚  â”‚ â€¢ Method: Visual inspection + swab test                    â”‚ â”‚
â”‚  â”‚ â€¢ Frequency: Between every production run                  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ Last Risk Assessment:                                      â”‚ â”‚
â”‚  â”‚ â€¢ Date: 2025-12-01                                         â”‚ â”‚
â”‚  â”‚ â€¢ Assessor: Jane Smith, QA Manager                         â”‚ â”‚
â”‚  â”‚ â€¢ Next Review: 2025-03-01 (90 days)                        â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ Supporting Documentation: (2 files)                        â”‚ â”‚
â”‚  â”‚ ğŸ“„ HACCP_Allergen_Plan_2025.pdf [View]                     â”‚ â”‚
â”‚  â”‚ ğŸ“„ Cross_Contamination_Study_Line3.pdf [View]              â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Added: 2025-12-01 by Jane Smith (Manual)                        â”‚
â”‚                                                                  â”‚
â”‚  [View Full Risk Assessment] [Edit] [Change to "Contains"]       â”‚
â”‚  [Remove] [Export Risk Report]                                   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Success State (Add Allergen Modal)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Add Allergen Declaration                                 [X]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Allergen *                                                      â”‚
â”‚  [Select allergen â–¼]                                             â”‚
â”‚    â”€ EU 14 Allergens â”€                                           â”‚
â”‚    ğŸŒ¾ Gluten (Cereals with gluten)                               â”‚
â”‚    ğŸ¦ Crustaceans                                                â”‚
â”‚    ğŸ¥š Eggs                                                       â”‚
â”‚    ğŸŸ Fish                                                       â”‚
â”‚    ğŸ¥œ Peanuts                                                    â”‚
â”‚    ğŸ«˜ Soybeans                                                   â”‚
â”‚    ğŸ¥› Milk                                                       â”‚
â”‚    ğŸŒ° Nuts (Tree nuts)                                           â”‚
â”‚    ğŸŒ¿ Celery                                                     â”‚
â”‚    ğŸŸ¡ Mustard                                                    â”‚
â”‚    ğŸŒ± Sesame                                                     â”‚
â”‚    ğŸ‡ Sulphites                                                  â”‚
â”‚    ğŸ«› Lupin                                                      â”‚
â”‚    ğŸš Molluscs                                                   â”‚
â”‚    â”€ Custom Allergens â”€                                          â”‚
â”‚    ğŸ¯ Honey                                                      â”‚
â”‚                                                                  â”‚
â”‚  Relation Type *                                                 â”‚
â”‚  â—‹ Contains (Present in ingredients)                             â”‚
â”‚  â¦¿ May Contain (Cross-contamination risk)                        â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â„¹ "May Contain" declarations should be based on validated  â”‚ â”‚
â”‚  â”‚   cross-contamination risk assessments (HACCP/allergen     â”‚ â”‚
â”‚  â”‚   audit). Complete the risk assessment form below.         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Reason / Source * (for "May Contain")                           â”‚
â”‚  [Shared production line___________________]                     â”‚
â”‚  [_________________________________________]                     â”‚
â”‚                                                                  â”‚
â”‚  [+ Complete Full Risk Assessment] (Opens detailed form above)   â”‚
â”‚                                                                  â”‚
â”‚  Supporting Evidence (Optional)                                  â”‚
â”‚  [Browse Files] or drag & drop                                   â”‚
â”‚  â€¢ HACCP_Allergen_Assessment_2025.pdf (2.3 MB)                   â”‚
â”‚                                                                  â”‚
â”‚  Review Date (for "May Contain")                                 â”‚
â”‚  [2025-03-11____] (90 days from today)                           â”‚
â”‚                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  [Cancel]                                    [Add Allergen]      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Loading State

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Product: Whole Wheat Bread (PROD-157)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  [Basic Info] [Allergens] [Nutrition] [BOM] [History]           â”‚
â”‚                                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚  ALLERGEN DECLARATIONS                                           â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                  â”‚
â”‚                      [Spinner Animation]                         â”‚
â”‚                                                                  â”‚
â”‚              Analyzing BOM ingredients for allergens...          â”‚
â”‚                                                                  â”‚
â”‚                    Checking 8 ingredients                        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Error State

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Product: Whole Wheat Bread (PROD-157)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  [Basic Info] [Allergens] [Nutrition] [BOM] [History]           â”‚
â”‚                                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚  ALLERGEN DECLARATIONS                                           â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                  â”‚
â”‚  âš  Unable to Auto-Calculate Allergens                           â”‚
â”‚                                                                  â”‚
â”‚  Missing allergen declarations for ingredients:                  â”‚
â”‚  â€¢ Wheat Flour (PROD-001) - No allergens declared               â”‚
â”‚  â€¢ Vegetable Oil (PROD-045) - No allergens declared             â”‚
â”‚  â€¢ Flavor Mix (PROD-123) - No allergens declared                â”‚
â”‚                                                                  â”‚
â”‚  To auto-inherit allergens, all BOM ingredients must have        â”‚
â”‚  their allergens declared first.                                 â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Quick Actions:                                             â”‚ â”‚
â”‚  â”‚ [Add Missing Allergen Data]  [Declare Manually Instead]   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Manual Declarations                          [+ Add Allergen]  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ No manual allergen declarations yet.                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Empty State (No BOM)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Product: Raw Sugar (PROD-089)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  [Basic Info] [Allergens] [Nutrition] [BOM] [History]           â”‚
â”‚                                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚  ALLERGEN DECLARATIONS                                           â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                  â”‚
â”‚                          [ğŸ”¬ Icon]                               â”‚
â”‚                                                                  â”‚
â”‚                   No Allergens Auto-Detected                     â”‚
â”‚                                                                  â”‚
â”‚  This product is a raw material with no BOM. Allergen auto-      â”‚
â”‚  inheritance requires a Bill of Materials.                       â”‚
â”‚                                                                  â”‚
â”‚  If this product contains or may contain allergens, declare      â”‚
â”‚  them manually based on:                                         â”‚
â”‚  â€¢ Supplier specifications                                      â”‚
â”‚  â€¢ Certificate of Analysis (CoA)                                â”‚
â”‚  â€¢ Manufacturing process assessment                             â”‚
â”‚                                                                  â”‚
â”‚                      [+ Declare Allergen]                        â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â„¹ For raw materials, "Allergen-Free" certification may     â”‚ â”‚
â”‚  â”‚   be required from suppliers for certain allergens.        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Components

### 1. Auto-Inheritance Banner
- **Status**: Green banner if auto-calculated, gray if manual only
- **Info**: Last update timestamp, BOM version used, ingredient count
- **Action**: [Recalculate] button to refresh from current BOM
- **Behavior**: Auto-updates when BOM changes (real-time or on page load)

### 2. Contains Section (Direct Allergens)
- **Source**: Auto-inherited from BOM ingredients that declare "contains"
- **Display**: Allergen icon + name + description
- **Details**: Shows which BOM ingredients contribute this allergen
- **Actions**: View Details, Change to "May Contain", Remove (if manual)
- **Badge**: "AUTO" (inherited) or "MANUAL" (user-declared)
- **Icons**: Emoji-based with text alternatives (see specification above)

### 3. May Contain Section (Cross-Contamination)
- **Source**: Manually declared by user based on risk assessment
- **Display**: Allergen icon + name + reason + **RISK LEVEL INDICATOR**
- **Risk Details**: Shows risk source, location, control measures
- **Metadata**: Added by (user), Added date, Review due date, Risk level
- **Actions**: View Details, Change to "Contains", Remove, View Risk Assessment
- **Warning**: Yellow banner if review date approaching (<7 days)
- **Risk Levels**: HIGH (red âš ï¸), MEDIUM (orange âš ï¸), LOW (yellow âš ï¸)

### 4. Free From Section (Allergen-Free Claims)
- **Source**: EU 14 allergens not in "Contains" or "May Contain"
- **Display**: Icon grid of allergen-free badges (icons with strikethrough)
- **Purpose**: Quick visual confirmation for labeling/marketing
- **Action**: [Manage] to explicitly mark allergen-free (optional certification)

### 5. Warnings & Compliance
- **Checklist**: All EU 14 reviewed, Manual declarations need review, Label ready
- **Alerts**: Review overdue, Missing declarations, Conflicting data
- **Color-coded**: Green (OK), Yellow (Warning), Red (Error)

### 6. Add Allergen Modal
- **Allergen Dropdown**: EU 14 + Custom allergens (from Settings) with emoji icons
- **Relation Type**: Radio buttons (Contains / May Contain)
- **Reason Field**: Required for "May Contain", optional for "Contains"
- **Risk Assessment**: Link to complete full risk assessment form
- **Evidence Upload**: PDF/image upload for HACCP docs, CoA, audits
- **Review Date**: Auto-calculated (90 days) for "May Contain", editable

### 7. NEW: Cross-Contamination Risk Assessment Form
- **Risk Source Type**: Radio buttons (Equipment/Line/Warehouse/Transport/Supplier/Other)
- **Location/Equipment**: Text input for specific details
- **Control Measures**: Multi-select checkboxes (Cleaning, ATP testing, Training, etc.)
- **Cleaning Validation**: Dropdown (Visual/Swab/ATP/Other)
- **Frequency**: Dropdown (Every run/Daily/Weekly/Monthly)
- **Assessment Details**: Date, Assessor name/role
- **Documentation Upload**: Multiple PDF/image uploads
- **Risk Level Calculator**: Auto-calculates based on selections (Low/Medium/High)
- **Recommendations**: Shows system-generated risk reduction recommendations

---

## Main Actions

### Primary Actions
- **[Recalculate]**: Re-runs allergen inheritance from current BOM
  - Fetches all BOM ingredients (active BOM version)
  - Retrieves allergen declarations for each ingredient
  - Aggregates "Contains" declarations
  - Preserves manual "May Contain" entries
  - Updates "Free From" list (EU 14 minus declared)
  - Shows toast: "Allergens updated from BOM v{version}"

- **[+ Add Allergen]**: Opens add allergen modal
  - Validates allergen not already declared
  - If "Contains" selected: saves to `product_allergens` with source = 'manual'
  - If "May Contain" selected: requires reason, shows risk assessment option
  - Closes modal, refreshes allergen list
  - Shows toast: "Allergen {name} added as {relation_type}"

- **[Add Allergen]** (in modal): Saves allergen declaration
  - Validates required fields (allergen, relation_type, reason if may_contain)
  - Creates record in `product_allergens` table
  - If risk assessment completed: saves to `allergen_risk_assessments` table
  - Uploads evidence files to storage (if provided)
  - Links evidence files to allergen record
  - Sets audit trail (created_by, created_at)
  - Closes modal, refreshes page

### Secondary Actions
- **[View Details]**: Opens allergen detail panel (side panel)
  - Shows full allergen info (name, description, EU code)
  - Lists all BOM ingredients contributing (for "Contains")
  - Shows reason, evidence, review history (for "May Contain")
  - **NEW: Shows full risk assessment details (for "May Contain")**
  - Displays audit trail (who declared, when, changes)

- **[Change to "May Contain"]** / **[Change to "Contains"]**: Updates relation type
  - Shows confirmation dialog
  - If changing to "May Contain": prompts for reason + risk assessment
  - Updates `product_allergens.relation_type`
  - Logs change in audit trail
  - Shows toast: "Allergen relation changed"

- **[Remove]**: Removes allergen declaration
  - Shows confirmation: "Remove {allergen} declaration?"
  - If auto-inherited: shows warning "Will reappear on next BOM recalculation unless removed from ingredients"
  - If manual: deletes from `product_allergens`
  - Logs removal in audit trail
  - Shows toast: "Allergen {name} removed"

- **[Manage]** (Free From): Opens allergen-free management
  - Shows all EU 14 allergens
  - Checkboxes to explicitly mark "Certified Allergen-Free"
  - Attach certification documents (e.g., supplier CoA)
  - Used for marketing claims ("Gluten-Free Certified")

- **[View Allergen History]**: Opens history panel
  - Timeline of all allergen changes
  - BOM version changes (auto-inheritance updates)
  - Manual additions/removals
  - Relation type changes
  - Review date updates
  - Risk assessment updates

- **[Generate Allergen Label]**: Opens label preview
  - Generates compliant allergen warning label
  - Formats: EU (bold list), FDA (Contains: ...), custom
  - Preview before export/print
  - Links to TEC-012-allergen-warnings

- **[Export PDF]**: Downloads allergen declaration document
  - PDF with product info, allergen list, evidence
  - **NEW: Includes risk assessment summaries**
  - Suitable for customer/regulatory submission

- **[+ Complete Full Risk Assessment]**: Opens detailed risk assessment form
  - Multi-step form for comprehensive risk evaluation
  - Calculates risk level based on controls
  - Saves to `allergen_risk_assessments` table
  - Links to allergen declaration

- **[View Full Risk Assessment]**: Opens saved risk assessment in modal
  - Read-only view with edit option
  - Shows all assessment details, controls, documentation
  - Displays risk level and recommendations

- **[Export Risk Report]**: Downloads risk assessment PDF
  - Comprehensive report with all details
  - Suitable for HACCP audits, regulatory submissions

---

## 4 States (One-Line)

- **Loading**: Spinner + "Analyzing BOM ingredients for allergens..." while GET /api/technical/products/:id/allergens runs
- **Empty**: "No Allergens Auto-Detected" for raw materials (no BOM) + "[+ Declare Allergen]" CTA
- **Error**: Red banner + list of BOM ingredients missing allergen data + quick actions to add data or declare manually
- **Success**: Auto-inherited allergens (Contains) + manual declarations (May Contain with risk levels) + Free From badges + compliance warnings + actions to add/edit/export

---

## Validation Rules

### Add Allergen
| Field | Required | Rules |
|-------|----------|-------|
| Allergen | Yes | Must be from allergen master list (EU 14 + custom) |
| Relation Type | Yes | "contains" or "may_contain" |
| Reason | Yes (if may_contain) | Min 10 chars, max 500 chars |
| Risk Assessment | Recommended (if may_contain) | Not required but strongly recommended |
| Evidence Files | No | PDF/JPG/PNG, max 10MB per file, max 5 files |
| Review Date | Yes (if may_contain) | Default: today + 90 days, must be future date |

**Business Rules**:
- Cannot declare same allergen twice with same relation type
- Can have both "contains" and "may_contain" for same allergen (e.g., direct + cross-contamination)
- Auto-inherited "contains" cannot be removed unless BOM ingredients updated
- Manual "may_contain" requires review every 90 days (system reminder)
- "Free From" automatically calculated (EU 14 minus declared allergens)
- Risk assessment recommended for all "may_contain" declarations (warning if missing)

---

## Accessibility

- **Touch Targets**: All buttons, allergen cards >= 48x48dp
- **Contrast**: Banner colors pass WCAG AA (green: #059669, yellow: #D97706, red: #DC2626)
- **Screen Reader**: Announces "Allergen Declarations for {product_name}", allergen list, relation type, source, risk level
- **Keyboard**: Tab navigation, Enter to expand details, Escape to close modals
- **Focus**: Search/filter input auto-focused on modal open
- **Icons**: All allergen emoji icons have text alternatives (e.g., ğŸŒ¾ = "Wheat icon for Gluten")
- **Color**: Not relying on color alone (badges have text labels + shapes for risk levels)
- **Risk Indicators**: âš ï¸ symbols with text labels (HIGH/MEDIUM/LOW)

---

## Technical Notes

### API Endpoints
- **Get**: `GET /api/technical/products/:id/allergens`
- **Recalculate**: `POST /api/technical/boms/:id/allergens` (inheritance from BOM)
- **Add**: `POST /api/technical/products/:id/allergens`
- **Update**: `PUT /api/technical/products/:id/allergens/:allergenId`
- **Remove**: `DELETE /api/technical/products/:id/allergens/:allergenId`
- **History**: `GET /api/technical/products/:id/allergens/history`
- **NEW: Risk Assessment**: `POST /api/technical/allergens/risk-assessment`
- **NEW: Get Risk Assessment**: `GET /api/technical/allergens/:allergenId/risk-assessment`
- **NEW: Update Risk Assessment**: `PUT /api/technical/allergens/:allergenId/risk-assessment/:assessmentId`

### Allergen Inheritance Algorithm
```typescript
// For finished products with BOM:
1. Get active BOM for product
2. For each BOM item (ingredient):
   - Fetch ingredient's allergen declarations (relation_type = 'contains')
   - Aggregate unique allergens
3. Union with manual "contains" declarations for this product
4. Preserve manual "may_contain" declarations (not auto-inherited)
5. Calculate "free_from" = EU 14 - (contains + may_contain)
```

### Data Structure
```typescript
// product_allergens table
{
  id: string;
  product_id: string;
  allergen_id: string; // FK to allergens table
  relation_type: 'contains' | 'may_contain';
  source: 'auto' | 'manual';
  reason?: string; // for may_contain
  evidence_urls?: string[]; // S3 URLs
  review_date?: Date; // for may_contain
  reviewed_at?: Date;
  reviewed_by?: string;
  risk_assessment_id?: string; // FK to allergen_risk_assessments
  risk_level?: 'low' | 'medium' | 'high'; // calculated from assessment
  created_by: string;
  created_at: Date;
  updated_at: Date;
}

// allergen_risk_assessments table (NEW)
{
  id: string;
  product_allergen_id: string; // FK to product_allergens
  risk_source_type: 'shared_equipment' | 'shared_line' | 'shared_warehouse' | 'shared_transport' | 'supplier' | 'other';
  specific_location: string;
  control_measures: string[]; // array of control IDs
  cleaning_validation_method: string;
  cleaning_frequency: string;
  assessment_date: Date;
  assessor_name: string;
  assessor_role: string;
  documentation_urls: string[]; // S3 URLs
  risk_score: number; // calculated
  risk_level: 'low' | 'medium' | 'high'; // derived from score
  recommendations: string[]; // system-generated
  created_by: string;
  created_at: Date;
  updated_at: Date;
}

// allergens table (from Settings module)
{
  id: string;
  org_id: string;
  code: string; // ALL-01 to ALL-14, CUST-XX
  name: string;
  description: string;
  icon: string; // emoji (ğŸŒ¾, ğŸ¥œ, etc.)
  type: 'eu14' | 'custom';
  is_active: boolean;
}
```

### Real-time Updates
- Subscribe to BOM changes via Supabase Realtime
- Auto-refresh allergen list when BOM updated
- Show notification: "BOM changed. Allergens may have changed. [Recalculate]"

### Compliance
- **EU FIC 1169/2011**: All EU 14 allergens must be declared if present
- **FDA FALCPA**: Major allergens (8 in US: milk, eggs, fish, shellfish, tree nuts, peanuts, wheat, soybeans)
- **Precautionary Labeling**: "May contain" only if validated cross-contamination risk exists
- **Review Frequency**: Manual "may_contain" declarations reviewed every 90 days
- **NEW: Risk Assessment**: Recommended for all "may contain" declarations

---

## Related Screens

- **Product Detail View**: Parent page, [Allergens] tab
- **SET-020-allergen-list**: Allergen master data (Settings)
- **BOM Detail**: Shows ingredient allergens contributing to product
- **TEC-012-allergen-warnings**: Warning label generation
- **Allergen Detail Panel**: Side panel with full allergen info + risk assessment
- **Allergen History Panel**: Timeline of changes
- **Risk Assessment Form**: Modal for detailed cross-contamination risk evaluation

---

## Handoff Notes

### For FRONTEND-DEV:
1. Use page section (not modal) for allergen management
2. Use ShadCN Dialog for "Add Allergen" modal and Risk Assessment form
3. Use ShadCN Sheet (side panel) for allergen details/history
4. Zod schema: `lib/validation/allergen-schema.ts` + `lib/validation/risk-assessment-schema.ts`
5. Service: `lib/services/allergen-service.ts` + `lib/services/risk-assessment-service.ts`
6. Real-time subscription to BOM changes (Supabase Realtime)
7. File upload for evidence: Use Supabase Storage
8. Review date reminders: Check on page load, show warning if <7 days
9. Icon rendering: Emoji with text alternative for accessibility (see specification)
10. Badge components: "AUTO", "MANUAL", "CONTAINS", "MAY CONTAIN"
11. **NEW: Risk level indicators**: Three-level system (LOW/MEDIUM/HIGH) with âš ï¸ icons in different colors
12. **NEW: Risk calculation**: Implement risk score calculator (see algorithm above)

### For BACKEND-DEV:
1. Implement allergen inheritance algorithm (recursive for multi-level BOMs)
2. Validate all BOM ingredients have allergen data before auto-calculation
3. Create audit trail for all allergen changes
4. Set up review date reminders (90-day cycle for "may_contain")
5. Evidence file storage with S3/Supabase Storage
6. Label generation API (formats: EU, FDA, custom)
7. Compliance validation (EU 14 coverage check)
8. Real-time events for BOM changes
9. **NEW: Risk assessment CRUD operations**
10. **NEW: Risk score calculation algorithm** (see specification)
11. **NEW: Risk level auto-update** when assessment changes
12. **NEW: System recommendations** based on risk level

---

## Approval Status

**Mode**: auto_approve
**User Approved**: true (explicit opt-in)
**Screens Approved**: [TEC-010-allergen-management]
**Iterations Used**: 0
**Completion**: 95%+ (Added allergen icon/badge specifications + cross-contamination risk UI clarification with full risk assessment system)
**Ready for Handoff**: Yes

---

**Status**: Approved for FRONTEND-DEV/BACKEND-DEV handoff
