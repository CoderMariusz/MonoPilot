
> monopilot@1.0.0 test
> pnpm test:unit && pnpm test:e2e


> monopilot@1.0.0 test:unit C:\Users\Mariusz K\Documents\Programowanie\MonoPilot
> cd apps/frontend && pnpm test


> monopilot@0.1.0 test C:\Users\Mariusz K\Documents\Programowanie\MonoPilot\apps\frontend
> vitest run


[1m[46m RUN [49m[22m [36mv4.0.12 [39m[90mC:/Users/Mariusz K/Documents/Programowanie/MonoPilot/apps/frontend[39m

[90mstdout[2m | components/settings/onboarding/__tests__/TimezoneSelect.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

[90mstdout[2m | components/settings/onboarding/__tests__/OrganizationProfileStep.TD-001.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | components/settings/onboarding/__tests__/OrganizationProfileStep.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | components/warehouse/asns/__tests__/ReceiveModal.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | components/production/outputs/__tests__/RegisterByProductModal.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | app/api/shipping/sales-orders/__tests__/import.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

[90mstdout[2m | components/warehouse/license-plates/__tests__/MergeLPModal.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

 [31m‚ùØ[39m components/warehouse/license-plates/__tests__/MergeLPModal.test.tsx [2m([22m[2m42 tests[22m[2m | [22m[31m13 failed[39m[2m)[22m[33m 21907[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render modal when open is true [33m 2304[2mms[22m[39m
       [32m‚úì[39m should not render when open is false[32m 26[2mms[22m[39m
[31m       [31m√ó[31m should display selected LPs in table[39m[33m 565[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show Validate button [33m 841[2mms[22m[39m
[31m       [31m√ó[31m should close modal when X button clicked[39m[33m 583[2mms[22m[39m
       [32m‚úì[39m should show loading spinner during validation[32m 112[2mms[22m[39m
[31m       [31m√ó[31m should show green checkmark when validation passes[39m[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should show red X when validation fails[39m[32m 29[2mms[22m[39m
       [32m‚úì[39m should display all validation errors[32m 29[2mms[22m[39m
       [32m‚úì[39m should display product name[32m 72[2mms[22m[39m
       [32m‚úì[39m should display total quantity with UoM[32m 27[2mms[22m[39m
       [32m‚úì[39m should display batch number[32m 57[2mms[22m[39m
       [32m‚úì[39m should display expiry date[32m 67[2mms[22m[39m
       [32m‚úì[39m should display QA status[32m 72[2mms[22m[39m
       [32m‚úì[39m should display LP count[32m 56[2mms[22m[39m
       [32m‚úì[39m should show N/A for null batch number[32m 54[2mms[22m[39m
       [32m‚úì[39m should display all selected LPs[32m 23[2mms[22m[39m
       [32m‚úì[39m should show LP number column[32m 41[2mms[22m[39m
       [32m‚úì[39m should show product column[32m 25[2mms[22m[39m
[31m       [31m√ó[31m should show quantity column[39m[32m 38[2mms[22m[39m
       [32m‚úì[39m should show batch column[32m 46[2mms[22m[39m
       [32m‚úì[39m should show expiry column[32m 52[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render location dropdown [33m 338[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display all locations in dropdown [33m 1841[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onLocationChange when location selected [33m 1837[2mms[22m[39m
       [32m‚úì[39m should show selected location[32m 86[2mms[22m[39m
[31m       [31m√ó[31m should show default option when no location selected[39m[32m 190[2mms[22m[39m
[31m       [31m√ó[31m should render confirmation dialog[39m[33m 1372[2mms[22m[39m
       [32m‚úì[39m should display LP count in confirmation message[32m 200[2mms[22m[39m
       [32m‚úì[39m should show warning about irreversible action[32m 221[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have Cancel button [33m 362[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have Confirm Merge button [33m 427[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onCancel when Cancel clicked [33m 580[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onConfirm when Confirm Merge clicked [33m 476[2mms[22m[39m
[31m       [31m√ó[31m should show success toast after merge[39m[33m 2298[2mms[22m[39m
[31m       [31m√ó[31m should close modal after successful merge[39m[33m 1451[2mms[22m[39m
[31m       [31m√ó[31m should show error toast on merge failure[39m[33m 1420[2mms[22m[39m
       [33m[2m‚úì[22m[39m should keep modal open on error [33m 418[2mms[22m[39m
[31m       [31m√ó[31m should show specific error message for conflict[39m[33m 1270[2mms[22m[39m
[31m       [31m√ó[31m should disable Validate button during validation[39m[33m 992[2mms[22m[39m
       [33m[2m‚úì[22m[39m should disable Merge button during merge operation [33m 560[2mms[22m[39m
[31m       [31m√ó[31m should show loading indicator during merge[39m[33m 417[2mms[22m[39m
[90mstdout[2m | __tests__/components/production/outputs/RegisterOutputModal.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

 [31m‚ùØ[39m components/production/outputs/__tests__/RegisterByProductModal.test.tsx [2m([22m[2m20 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 32512[2mms[22m[39m
       [33m[2m‚úì[22m[39m renders modal with by-product name [33m 2866[2mms[22m[39m
       [33m[2m‚úì[22m[39m displays by-product information [33m 988[2mms[22m[39m
       [33m[2m‚úì[22m[39m AC: displays expected qty from yield percent [33m 663[2mms[22m[39m
       [33m[2m‚úì[22m[39m displays BOM configuration info [33m 679[2mms[22m[39m
       [33m[2m‚úì[22m[39m AC: pre-fills quantity with expected qty [33m 743[2mms[22m[39m
       [33m[2m‚úì[22m[39m AC: auto-generates batch number from main batch [33m 527[2mms[22m[39m
       [33m[2m‚úì[22m[39m defaults QA status to pending [33m 681[2mms[22m[39m
       [33m[2m‚úì[22m[39m allows editing quantity [33m 1964[2mms[22m[39m
       [33m[2m‚úì[22m[39m allows editing batch number [33m 3504[2mms[22m[39m
[31m       [31m√ó[31m allows selecting QA status[39m[33m 3524[2mms[22m[39m
[31m       [31m√ó[31m allows selecting location[39m[33m 3559[2mms[22m[39m
       [33m[2m‚úì[22m[39m displays by-product summary when quantity > 0 [33m 609[2mms[22m[39m
       [33m[2m‚úì[22m[39m displays genealogy info in summary [33m 652[2mms[22m[39m
       [33m[2m‚úì[22m[39m AC: creates LP with entered qty [33m 2732[2mms[22m[39m
       [33m[2m‚úì[22m[39m calls onSuccess after successful registration [33m 1718[2mms[22m[39m
[31m       [31m√ó[31m shows loading state during submission[39m[33m 1648[2mms[22m[39m
       [33m[2m‚úì[22m[39m shows error when registration fails [33m 1453[2mms[22m[39m
       [33m[2m‚úì[22m[39m calls onOpenChange(false) when Cancel clicked [33m 775[2mms[22m[39m
       [33m[2m‚úì[22m[39m has proper form labels [33m 681[2mms[22m[39m
[31m       [31m√ó[31m shows error with role="alert"[39m[33m 2516[2mms[22m[39m
[90mstdout[2m | components/shipping/dashboard/__tests__/ShippingKPIs.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

 [32m‚úì[39m components/shipping/dashboard/__tests__/ShippingKPIs.test.tsx [2m([22m[2m56 tests[22m[2m)[22m[33m 7317[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render 4 KPI cards [33m 612[2mms[22m[39m
       [33m[2m‚úì[22m[39m should be clickable when action provided [33m 1312[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show breakdown tooltip on hover [33m 1034[2mms[22m[39m
     [33m[2m‚úì[22m[39m should show Load More button when onLoadMore provided [33m 356[2mms[22m[39m
     [33m[2m‚úì[22m[39m should show tooltip on disabled buttons [33m 1320[2mms[22m[39m
[90mstdout[2m | components/production/outputs/__tests__/RegisterOutputModal.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

 [31m‚ùØ[39m components/settings/onboarding/__tests__/OrganizationProfileStep.TD-001.test.tsx [2m([22m[2m29 tests[22m[2m | [22m[31m25 failed[39m[2m)[22m[33m 59829[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render all 12 fields (currently only renders 4 - WILL FAIL) [33m 1409[2mms[22m[39m
[31m       [31m√ó[31m should display Address section header (WILL FAIL)[39m[33m 784[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display Contact Information section header (WILL FAIL) [33m 627[2mms[22m[39m
[31m       [31m√ó[31m should show required indicators for country and date_format (WILL FAIL)[39m[33m 728[2mms[22m[39m
[31m       [31m√ó[31m should render CountrySelect component (WILL FAIL)[39m[33m 575[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render DateFormatSelect component (WILL FAIL) [33m 505[2mms[22m[39m
[31m       [31m√ó[31m should validate country field is required (WILL FAIL)[39m[33m 4319[2mms[22m[39m
[31m       [31m√ó[31m should validate date_format field is required (WILL FAIL)[39m[33m 3802[2mms[22m[39m
[31m       [31m√ó[31m should validate country must be 2-character ISO code (WILL FAIL)[39m[33m 2750[2mms[22m[39m
[31m       [31m√ó[31m should validate date_format must be one of allowed values (WILL FAIL)[39m[33m 2839[2mms[22m[39m
[31m       [31m√ó[31m should validate contact_email format if provided (WILL FAIL)[39m[33m 3071[2mms[22m[39m
[31m       [31m√ó[31m should accept valid contact_email format (WILL FAIL)[39m[33m 3057[2mms[22m[39m
[31m       [31m√ó[31m should allow empty address_line1 field (WILL FAIL)[39m[33m 3066[2mms[22m[39m
[31m       [31m√ó[31m should allow empty address_line2 field (WILL FAIL)[39m[33m 2401[2mms[22m[39m
[31m       [31m√ó[31m should allow empty city field (WILL FAIL)[39m[33m 2915[2mms[22m[39m
[31m       [31m√ó[31m should allow empty postal_code field (WILL FAIL)[39m[33m 2894[2mms[22m[39m
[31m       [31m√ó[31m should allow empty contact_phone field (WILL FAIL)[39m[33m 3073[2mms[22m[39m
[31m       [31m√ó[31m should submit all 12 fields in payload (WILL FAIL)[39m[33m 5077[2mms[22m[39m
[31m       [31m√ó[31m should submit with only required fields filled (WILL FAIL)[39m[33m 2567[2mms[22m[39m
[31m       [31m√ó[31m should POST to API with all 12 fields (WILL FAIL)[39m[33m 1090[2mms[22m[39m
[31m       [31m√ó[31m should persist new fields to organizations table (WILL FAIL)[39m[33m 4341[2mms[22m[39m
[31m       [31m√ó[31m should render searchable country dropdown (WILL FAIL)[39m[33m 603[2mms[22m[39m
[31m       [31m√ó[31m should filter countries when typing (WILL FAIL)[39m[33m 519[2mms[22m[39m
[31m       [31m√ó[31m should display country with ISO code (WILL FAIL)[39m[33m 470[2mms[22m[39m
[31m       [31m√ó[31m should select country and store ISO code (WILL FAIL)[39m[33m 1733[2mms[22m[39m
[31m       [31m√ó[31m should show 3 date format options (WILL FAIL)[39m[33m 1012[2mms[22m[39m
[31m       [31m√ó[31m should display examples for each date format (WILL FAIL)[39m[33m 899[2mms[22m[39m
       [33m[2m‚úì[22m[39m should auto-select date format based on country (WILL FAIL) [33m 645[2mms[22m[39m
[31m       [31m√ó[31m should allow overriding auto-selected date format (WILL FAIL)[39m[33m 2049[2mms[22m[39m
 [31m‚ùØ[39m __tests__/components/production/outputs/RegisterOutputModal.test.tsx [2m([22m[2m28 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 32063[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display product name [33m 3332[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display product code [33m 1066[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display WO number [33m 592[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display current progress (output_qty / planned_qty) [33m 851[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display remaining quantity [33m 921[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have quantity input field [33m 811[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have UoM display (read-only from product) [33m 639[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have batch number field pre-filled from WO [33m 643[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have QA status dropdown [33m 649[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have location dropdown pre-selected [33m 711[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have expiry date picker [33m 629[2mms[22m[39m
       [33m[2m‚úì[22m[39m AC: expiry date defaults to today + shelf_life_days [33m 564[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have optional notes textarea [33m 495[2mms[22m[39m
[31m       [31m√ó[31m AC: shows "Quantity must be greater than 0" when qty=0[39m[33m 3177[2mms[22m[39m
[31m       [31m√ó[31m AC: shows "QA status is required" when require_qa_on_output=true and no selection[39m[33m 1942[2mms[22m[39m
       [33m[2m‚úì[22m[39m allows submission without QA when require_qa_on_output=false [33m 880[2mms[22m[39m
       [33m[2m‚úì[22m[39m disables submit button when form invalid [33m 314[2mms[22m[39m
       [33m[2m‚úì[22m[39m AC: has Approved option [33m 1053[2mms[22m[39m
       [33m[2m‚úì[22m[39m AC: has Pending option [33m 1043[2mms[22m[39m
       [33m[2m‚úì[22m[39m AC: has Rejected option [33m 1304[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have "Confirm Registration" button [33m 532[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have "Cancel" button [33m 467[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onCancel when Cancel clicked [33m 498[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onConfirm with form data when Confirm clicked [33m 2492[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show loading state during submission [33m 1877[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show output summary section [33m 1189[2mms[22m[39m
       [33m[2m‚úì[22m[39m should update summary when quantity changes [33m 1592[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show projected progress percentage [33m 1783[2mms[22m[39m
[90mstdout[2m | components/warehouse/license-plates/__tests__/LPLabelPrint.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | components/technical/__tests__/version-history-panel.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

 [31m‚ùØ[39m components/warehouse/asns/__tests__/ReceiveModal.test.tsx [2m([22m[2m26 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[33m 68106[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render loading skeleton while fetching preview [33m 2070[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display ASN header info after loading [33m 1618[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display items table with editable received_qty [33m 1272[2mms[22m[39m
       [33m[2m‚úì[22m[39m should pre-fill received_qty with expected_qty by default [33m 827[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display pre-populated data from ASN [33m 891[2mms[22m[39m
       [33m[2m‚úì[22m[39m should calculate and display variance badge when qty changes [33m 2453[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show green badge for exact match [33m 2441[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show yellow badge for over-receipt [33m 2750[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show variance reason dropdown when variance exists [33m 2088[2mms[22m[39m
[31m       [31m√ó[31m should allow selecting variance reason from dropdown[39m[33m 5306[2mms[22m[39m
[31m       [31m√ó[31m should allow entering variance notes[39m[33m 5365[2mms[22m[39m
[31m       [31m√ó[31m should hide variance reason when variance is zero[39m[33m 3641[2mms[22m[39m
[31m       [31m√ó[31m should submit receive request on confirm[39m[33m 5358[2mms[22m[39m
[31m       [31m√ó[31m should disable submit button when submitting[39m[33m 5509[2mms[22m[39m
       [33m[2m‚úì[22m[39m should validate required fields before submit [33m 1556[2mms[22m[39m
[31m       [31m√ó[31m should display success summary after receive completes[39m[33m 5024[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onSuccess callback after completion [33m 3051[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display error alert on API failure [33m 4891[2mms[22m[39m
[31m       [31m√ó[31m should display error for missing batch when required[39m[33m 5418[2mms[22m[39m
[31m       [31m√ó[31m should handle network errors gracefully[39m[33m 5143[2mms[22m[39m
       [33m[2m‚úì[22m[39m should close modal on cancel [33m 1304[2mms[22m[39m
       [32m‚úì[39m should not render when isOpen is false[32m 14[2mms[22m[39m
     [32m‚úì[39m should display green badge for exact match[32m 31[2mms[22m[39m
     [32m‚úì[39m should display red badge for under-receipt[32m 38[2mms[22m[39m
     [32m‚úì[39m should display yellow badge for over-receipt[32m 11[2mms[22m[39m
     [32m‚úì[39m should format decimal variance correctly[32m 17[2mms[22m[39m
[90mstdout[2m | components/production/consumption/__tests__/OverConsumptionApprovalModal.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

 [31m‚ùØ[39m components/production/outputs/__tests__/RegisterOutputModal.test.tsx [2m([22m[2m23 tests[22m[2m | [22m[31m10 failed[39m[2m)[22m[33m 30733[2mms[22m[39m
[31m       [31m√ó[31m renders modal with title and WO info[39m[33m 1484[2mms[22m[39m
       [33m[2m‚úì[22m[39m displays product information section [33m 543[2mms[22m[39m
       [33m[2m‚úì[22m[39m displays progress information [33m 622[2mms[22m[39m
       [33m[2m‚úì[22m[39m has quantity input field [33m 986[2mms[22m[39m
       [33m[2m‚úì[22m[39m AC: pre-fills batch number from WO [33m 1001[2mms[22m[39m
       [33m[2m‚úì[22m[39m AC: pre-selects default location from line [33m 822[2mms[22m[39m
[31m       [31m√ó[31m AC: auto-calculates expiry date from shelf life[39m[33m 507[2mms[22m[39m
       [33m[2m‚úì[22m[39m has notes textarea [33m 408[2mms[22m[39m
[31m       [31m√ó[31m AC: shows error when quantity is 0[39m[33m 1384[2mms[22m[39m
[31m       [31m√ó[31m AC: shows error when QA status required but not selected[39m[33m 2283[2mms[22m[39m
       [33m[2m‚úì[22m[39m AC: allows submission without QA status when not required [33m 2928[2mms[22m[39m
       [33m[2m‚úì[22m[39m disables submit button when form is invalid [33m 784[2mms[22m[39m
[31m       [31m√ó[31m shows required indicator when QA status is required[39m[33m 628[2mms[22m[39m
[31m       [31m√ó[31m does not show required indicator when QA status is optional[39m[33m 519[2mms[22m[39m
[31m       [31m√ó[31m has QA status options: Approved, Pending, Rejected[39m[33m 3327[2mms[22m[39m
       [33m[2m‚úì[22m[39m shows summary preview when quantity entered [33m 1971[2mms[22m[39m
       [33m[2m‚úì[22m[39m shows projected progress after registration [33m 1317[2mms[22m[39m
       [33m[2m‚úì[22m[39m does not show summary when quantity is empty [33m 668[2mms[22m[39m
[31m       [31m√ó[31m AC: calls onConfirm with correct data[39m[33m 3971[2mms[22m[39m
[31m       [31m√ó[31m shows loading state during submission[39m[33m 1781[2mms[22m[39m
       [33m[2m‚úì[22m[39m calls onCancel when Cancel button clicked [33m 990[2mms[22m[39m
       [33m[2m‚úì[22m[39m has proper form labels [33m 615[2mms[22m[39m
[31m       [31m√ó[31m shows validation errors with role="alert"[39m[33m 1190[2mms[22m[39m
[90mstdout[2m | components/settings/onboarding/__tests__/OrganizationProfileStep.TD-201.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

 [31m‚ùØ[39m components/settings/onboarding/__tests__/OrganizationProfileStep.test.tsx [2m([22m[2m41 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[33m 93286[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render organization profile form [33m 2511[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render all required form fields [33m 833[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display section headers [33m 594[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show required field indicators [33m 549[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have accessible form structure [33m 587[2mms[22m[39m
       [33m[2m‚úì[22m[39m should pre-fill org name when initialData provided [33m 481[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show empty name field when no initialData [33m 570[2mms[22m[39m
       [33m[2m‚úì[22m[39m should allow editing pre-filled name [33m 1382[2mms[22m[39m
       [33m[2m‚úì[22m[39m should auto-detect timezone from browser on mount [33m 649[2mms[22m[39m
[31m       [31m√ó[31m should allow changing auto-detected timezone[39m[33m 5454[2mms[22m[39m
       [33m[2m‚úì[22m[39m should pre-fill timezone from initialData if provided [33m 603[2mms[22m[39m
       [33m[2m‚úì[22m[39m should auto-detect language from browser on mount [33m 618[2mms[22m[39m
       [33m[2m‚úì[22m[39m should allow changing auto-detected language [33m 894[2mms[22m[39m
       [33m[2m‚úì[22m[39m should pre-fill language from initialData if provided [33m 781[2mms[22m[39m
[31m       [31m√ó[31m should show error when name is empty and form submitted[39m[33m 2722[2mms[22m[39m
       [33m[2m‚úì[22m[39m should not submit form when name is empty [33m 1196[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show error when name is 1 character [33m 2082[2mms[22m[39m
       [33m[2m‚úì[22m[39m should accept name with exactly 2 characters [33m 3533[2mms[22m[39m
[31m       [31m√ó[31m should show error when name is 101 characters[39m[33m 5066[2mms[22m[39m
[31m       [31m√ó[31m should accept name with exactly 100 characters[39m[33m 5052[2mms[22m[39m
[31m       [31m√ó[31m should filter timezones when user types "war"[39m[33m 5206[2mms[22m[39m
[31m       [31m√ó[31m should show all timezones when search is empty[39m[33m 9697[2mms[22m[39m
[31m       [31m√ó[31m should show "No timezone found" when search has no matches[39m[33m 5584[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show all 4 supported languages when dropdown opened [33m 1186[2mms[22m[39m
       [33m[2m‚úì[22m[39m should only show 4 language options (MVP limitation) [33m 412[2mms[22m[39m
       [33m[2m‚úì[22m[39m should select language when option clicked [33m 888[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show all 4 supported currencies when dropdown opened [33m 904[2mms[22m[39m
       [33m[2m‚úì[22m[39m should only show 4 currency options (MVP limitation) [33m 788[2mms[22m[39m
       [33m[2m‚úì[22m[39m should select currency when option clicked [33m 1069[2mms[22m[39m
       [33m[2m‚úì[22m[39m should default to EUR when no initialData provided [33m 880[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onComplete with valid data when Next clicked [33m 3535[2mms[22m[39m
[31m       [31m√ó[31m should submit all form fields correctly[39m[33m 5043[2mms[22m[39m
[31m       [31m√ó[31m should clear validation errors when user starts typing[39m[33m 2516[2mms[22m[39m
       [33m[2m‚úì[22m[39m should disable submit button while submitting [33m 2999[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show loading state during submission [33m 2772[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have proper ARIA labels for all form fields [33m 819[2mms[22m[39m
       [33m[2m‚úì[22m[39m should associate error messages with input fields [33m 1147[2mms[22m[39m
       [33m[2m‚úì[22m[39m should support keyboard navigation [33m 1349[2mms[22m[39m
       [33m[2m‚úì[22m[39m should handle special characters in organization name [33m 4029[2mms[22m[39m
       [33m[2m‚úì[22m[39m should trim whitespace from organization name [33m 3570[2mms[22m[39m
       [33m[2m‚úì[22m[39m should handle rapid form submissions [33m 2716[2mms[22m[39m
 [31m‚ùØ[39m components/technical/__tests__/version-history-panel.test.tsx [2m([22m[2m26 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[33m 25542[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render panel when open [33m 2501[2mms[22m[39m
       [32m‚úì[39m should not render panel when closed[32m 31[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have 400px width [33m 799[2mms[22m[39m
[31m       [31m√ó[31m should slide in from right side[39m[33m 1462[2mms[22m[39m
[31m       [31m√ó[31m should have close button[39m[33m 1383[2mms[22m[39m
[31m       [31m√ó[31m should call onClose when close button clicked[39m[33m 1425[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display version history list [33m 410[2mms[22m[39m
[31m       [31m√ó[31m should display user names for each version[39m[33m 1316[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display timestamps for each version [33m 682[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display change summary for each version [33m 436[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display "Initial creation" for version 1 [33m 572[2mms[22m[39m
[31m       [31m√ó[31m should not display changed fields for initial version[39m[33m 1292[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have "View Details" button for each version [33m 1028[2mms[22m[39m
[31m       [31m√ó[31m should expand version details when clicked[39m[33m 2404[2mms[22m[39m
[31m       [31m√ó[31m should display old and new values for changed fields[39m[33m 1875[2mms[22m[39m
       [33m[2m‚úì[22m[39m should collapse details when clicked again [33m 1485[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show loading indicator while fetching history [33m 422[2mms[22m[39m
       [33m[2m‚úì[22m[39m should hide loading indicator after data loads [33m 437[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display empty state when no history exists [33m 350[2mms[22m[39m
[31m       [31m√ó[31m should display error message when fetch fails[39m[33m 1278[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have retry button on error [33m 531[2mms[22m[39m
       [33m[2m‚úì[22m[39m should load more history when "Load More" clicked [33m 854[2mms[22m[39m
       [33m[2m‚úì[22m[39m should not show "Load More" on last page [33m 636[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have proper ARIA labels [33m 824[2mms[22m[39m
       [33m[2m‚úì[22m[39m should trap focus within panel [33m 633[2mms[22m[39m
       [33m[2m‚úì[22m[39m should support keyboard navigation (Escape to close) [33m 470[2mms[22m[39m
 [31m‚ùØ[39m components/warehouse/license-plates/__tests__/LPLabelPrint.test.tsx [2m([22m[2m61 tests[22m[2m | [22m[31m10 failed[39m[2m)[22m[33m 33198[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render print button with printer icon [33m 1723[2mms[22m[39m
       [32m‚úì[39m should render icon-only variant[32m 213[2mms[22m[39m
       [33m[2m‚úì[22m[39m should open print modal when clicked [33m 1552[2mms[22m[39m
       [32m‚úì[39m should be disabled when disabled prop is true[32m 215[2mms[22m[39m
[31m       [31m√ó[31m should call onPrintComplete after successful print[39m[33m 2930[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render modal when isOpen is true [33m 489[2mms[22m[39m
       [32m‚úì[39m should not render when isOpen is false[32m 28[2mms[22m[39m
[31m       [31m√ó[31m should display LP info summary[39m[33m 1454[2mms[22m[39m
[31m       [31m√ó[31m should display batch number[39m[33m 1463[2mms[22m[39m
[31m       [31m√ó[31m should display expiry date[39m[33m 1284[2mms[22m[39m
[31m       [31m√ó[31m should have copies input with default from settings[39m[33m 1352[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display label preview [33m 499[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have Download ZPL button [33m 433[2mms[22m[39m
[31m       [31m√ó[31m should close modal when close button clicked[39m[33m 308[2mms[22m[39m
       [33m[2m‚úì[22m[39m should download ZPL file when Download clicked [33m 1014[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show loading state during download [33m 1421[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show error message on API failure [33m 1093[2mms[22m[39m
[31m       [31m√ó[31m should update copies text when copies changed[39m[33m 1279[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show info message when no printer configured [33m 611[2mms[22m[39m
       [32m‚úì[39m should render label preview container[32m 92[2mms[22m[39m
       [32m‚úì[39m should display LP number with barcode placeholder[32m 80[2mms[22m[39m
       [32m‚úì[39m should display product name[32m 64[2mms[22m[39m
       [32m‚úì[39m should display quantity with UoM[32m 41[2mms[22m[39m
       [32m‚úì[39m should display batch number[32m 56[2mms[22m[39m
       [32m‚úì[39m should display expiry date[32m 50[2mms[22m[39m
       [32m‚úì[39m should display location path[32m 48[2mms[22m[39m
       [32m‚úì[39m should display QR code placeholder[32m 66[2mms[22m[39m
       [32m‚úì[39m should show -- for null batch number[32m 30[2mms[22m[39m
       [32m‚úì[39m should show -- for null expiry date[32m 83[2mms[22m[39m
       [32m‚úì[39m should truncate long product name[32m 62[2mms[22m[39m
       [32m‚úì[39m should have 4:6 aspect ratio styling[32m 58[2mms[22m[39m
       [32m‚úì[39m should render number input[32m 136[2mms[22m[39m
       [32m‚úì[39m should have increment button[32m 207[2mms[22m[39m
       [32m‚úì[39m should have decrement button[32m 194[2mms[22m[39m
       [33m[2m‚úì[22m[39m should increment value when + clicked [33m 364[2mms[22m[39m
       [33m[2m‚úì[22m[39m should decrement value when - clicked [33m 408[2mms[22m[39m
       [32m‚úì[39m should not go below 1[32m 241[2mms[22m[39m
       [32m‚úì[39m should not exceed 100[32m 208[2mms[22m[39m
[31m       [31m√ó[31m should allow typing valid value[39m[33m 397[2mms[22m[39m
       [33m[2m‚úì[22m[39m should reject invalid input (0) [33m 384[2mms[22m[39m
       [33m[2m‚úì[22m[39m should reject invalid input (>100) [33m 402[2mms[22m[39m
       [32m‚úì[39m should show error state for invalid value[32m 32[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render modal when isOpen is true [33m 333[2mms[22m[39m
       [32m‚úì[39m should not render when isOpen is false[32m 25[2mms[22m[39m
       [32m‚úì[39m should display list of selected LPs[32m 272[2mms[22m[39m
[31m       [31m√ó[31m should have copies input that applies to all[39m[33m 369[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have Download All ZPL button [33m 734[2mms[22m[39m
       [33m[2m‚úì[22m[39m should close modal when Cancel clicked [33m 1036[2mms[22m[39m
       [33m[2m‚úì[22m[39m should download ZIP when Download All clicked [33m 1387[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show loading state during bulk download [33m 713[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show error on bulk download failure [33m 702[2mms[22m[39m
       [33m[2m‚úì[22m[39m should reject more than 100 LPs [33m 308[2mms[22m[39m
[31m       [31m√ó[31m should update total copies label[39m[32m 243[2mms[22m[39m
       [33m[2m‚úì[22m[39m should complete single LP print flow [33m 1279[2mms[22m[39m
       [32m‚úì[39m PrintLabelButton should have accessible name[32m 124[2mms[22m[39m
       [33m[2m‚úì[22m[39m PrintLabelModal should trap focus [33m 376[2mms[22m[39m
       [32m‚úì[39m CopiesInput should have label[32m 78[2mms[22m[39m
       [33m[2m‚úì[22m[39m should support keyboard navigation in modal [33m 543[2mms[22m[39m
       [33m[2m‚úì[22m[39m should handle LP with missing optional fields [33m 497[2mms[22m[39m
       [33m[2m‚úì[22m[39m should handle network error gracefully [33m 512[2mms[22m[39m
       [33m[2m‚úì[22m[39m should handle empty bulk selection [33m 569[2mms[22m[39m
[90mstdout[2m | __tests__/components/production/outputs/OutputHistoryTable.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | components/quality/__tests__/StatusTransitionModal.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

[90mstdout[2m | components/scanner/__tests__/ScannerReceiveWizard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

 [31m‚ùØ[39m app/api/shipping/sales-orders/__tests__/import.test.ts [2m([22m[2m26 tests[22m[2m | [22m[31m23 failed[39m[2m)[22m[33m 115434[2mms[22m[39m
       [32m‚úì[39m should return 401 when user not authenticated[32m 53[2mms[22m[39m
       [32m‚úì[39m should return 403 when user lacks shipping.C permission[32m 20[2mms[22m[39m
       [32m‚úì[39m should return 400 when no file uploaded[32m 29[2mms[22m[39m
[31m       [31m√ó[31m should return 400 when file is empty[39m[33m 5054[2mms[22m[39m
[31m       [31m√ó[31m should return 400 when file too large (> 5MB)[39m[33m 5020[2mms[22m[39m
[31m       [31m√ó[31m should return 400 when file is not CSV[39m[33m 5022[2mms[22m[39m
[31m       [31m√ó[31m should return 400 when missing required headers[39m[33m 5022[2mms[22m[39m
[31m       [31m√ó[31m should create 3 SOs from CSV with 3 customers[39m[33m 5011[2mms[22m[39m
[31m       [31m√ó[31m should link each SO to correct customer_id[39m[33m 5023[2mms[22m[39m
[31m       [31m√ó[31m should group lines correctly per SO[39m[33m 5016[2mms[22m[39m
[31m       [31m√ó[31m should number lines sequentially per SO[39m[33m 5009[2mms[22m[39m
[31m       [31m√ó[31m should create SOs for valid rows, skip invalid[39m[33m 5018[2mms[22m[39m
[31m       [31m√ó[31m should include row numbers in error messages[39m[33m 5005[2mms[22m[39m
[31m       [31m√ó[31m should return success summary with counts[39m[33m 5009[2mms[22m[39m
[31m       [31m√ó[31m should include list of created order numbers[39m[33m 5001[2mms[22m[39m
[31m       [31m√ó[31m should return error list with row numbers and messages[39m[33m 5008[2mms[22m[39m
[31m       [31m√ó[31m should not find customer from different org[39m[33m 5016[2mms[22m[39m
[31m       [31m√ó[31m should not find product from different org[39m[33m 5015[2mms[22m[39m
[31m       [31m√ó[31m should set org_id on all created SOs[39m[33m 5012[2mms[22m[39m
[31m       [31m√ó[31m should set allergen_validated=false on all created SOs[39m[33m 5013[2mms[22m[39m
[31m       [31m√ó[31m should set status=draft on created SOs[39m[33m 5008[2mms[22m[39m
[31m       [31m√ó[31m should set order_date to today[39m[33m 5009[2mms[22m[39m
[31m       [31m√ó[31m should use customer_po from CSV if provided[39m[33m 5013[2mms[22m[39m
[31m       [31m√ó[31m should use promised_ship_date from CSV if provided[39m[33m 5013[2mms[22m[39m
[31m       [31m√ó[31m should return 500 on database error[39m[33m 5004[2mms[22m[39m
[31m       [31m√ó[31m should rollback on partial failure[39m[33m 5006[2mms[22m[39m
[90mstdout[2m | components/settings/allergens/__tests__/AllergensDataTable.TD-209.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

 [31m‚ùØ[39m components/production/consumption/__tests__/OverConsumptionApprovalModal.test.tsx [2m([22m[2m50 tests[22m[2m | [22m[31m10 failed[39m[2m)[22m[33m 43577[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render modal when open is true [33m 2252[2mms[22m[39m
       [32m‚úì[39m should not render modal when open is false[32m 19[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display modal title [33m 683[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display warning icon in header [33m 417[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display material code and name [33m 311[2mms[22m[39m
       [32m‚úì[39m should display WO number[32m 277[2mms[22m[39m
[31m       [31m√ó[31m should display BOM requirement[39m[33m 434[2mms[22m[39m
[31m       [31m√ó[31m should display already consumed quantity[39m[33m 370[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display attempting quantity with + prefix [33m 434[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display total after quantity [33m 509[2mms[22m[39m
[31m       [31m√ó[31m should display over-consumption quantity with variance[39m[33m 383[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display LP number [33m 350[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show submit request button for operator without pending request [33m 577[2mms[22m[39m
       [33m[2m‚úì[22m[39m should not show approve/reject buttons for operator [33m 308[2mms[22m[39m
[31m       [31m√ó[31m should show close button for operator[39m[32m 276[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onRequestSubmitted when request submitted [33m 983[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display "Awaiting Manager Approval" status [33m 487[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display clock icon for pending status [33m 624[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display request ID [33m 520[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display requested by name [33m 328[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show cancel request button for pending request [33m 558[2mms[22m[39m
       [33m[2m‚úì[22m[39m should not show submit request button when pending [33m 402[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show approve button for manager [33m 467[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show reject button for manager [33m 377[2mms[22m[39m
[31m       [31m√ó[31m should display requester information for manager[39m[33m 442[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show optional reason input for approval [33m 502[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onApproved when approve clicked without reason [33m 1063[2mms[22m[39m
[31m       [31m√ó[31m should call onApproved with reason when provided[39m[33m 5081[2mms[22m[39m
       [33m[2m‚úì[22m[39m should disable approve button while submitting [33m 1578[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show loading state on approve button when submitting [33m 863[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show rejection reason input when reject clicked [33m 734[2mms[22m[39m
       [33m[2m‚úì[22m[39m should mark rejection reason as required [33m 699[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show validation error when rejecting without reason [33m 1626[2mms[22m[39m
[31m       [31m√ó[31m should call onRejected with reason when provided[39m[33m 5115[2mms[22m[39m
       [33m[2m‚úì[22m[39m should not call onRejected when reason is empty [33m 1402[2mms[22m[39m
       [33m[2m‚úì[22m[39m should allow canceling rejection flow [33m 1134[2mms[22m[39m
       [32m‚úì[39m should display rejection status[32m 224[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display rejection reason [33m 304[2mms[22m[39m
       [32m‚úì[39m should display who rejected[32m 280[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display rejection timestamp [33m 426[2mms[22m[39m
[31m       [31m√ó[31m should show close button only for rejected request[39m[33m 601[2mms[22m[39m
[31m       [31m√ó[31m should call onOpenChange when close button clicked[39m[33m 684[2mms[22m[39m
[31m       [31m√ó[31m should call onOpenChange when clicking outside modal[39m[33m 4100[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onOpenChange when pressing Escape [33m 410[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display error message on API failure [33m 849[2mms[22m[39m
       [33m[2m‚úì[22m[39m should allow retry after error [33m 1092[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have proper dialog role [33m 432[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have aria-labelledby pointing to title [33m 360[2mms[22m[39m
       [33m[2m‚úì[22m[39m should trap focus within modal [33m 559[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have descriptive button labels [33m 641[2mms[22m[39m
 [31m‚ùØ[39m components/settings/onboarding/__tests__/OrganizationProfileStep.TD-201.test.tsx [2m([22m[2m15 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 29833[2mms[22m[39m
       [33m[2m‚úì[22m[39m TC-201.1: should render Skip Step button with correct styling [33m 2294[2mms[22m[39m
       [33m[2m‚úì[22m[39m TC-201.2: should display Skip Step button with info icon [33m 665[2mms[22m[39m
       [33m[2m‚úì[22m[39m TC-201.3: should position Skip Step button to the left of Next button [33m 892[2mms[22m[39m
       [33m[2m‚úì[22m[39m TC-201.4: should bypass validation when Skip Step clicked with empty form [33m 2323[2mms[22m[39m
       [33m[2m‚úì[22m[39m TC-201.5: should use default placeholder data when Skip Step clicked [33m 1224[2mms[22m[39m
       [33m[2m‚úì[22m[39m TC-201.6: should merge partial data with defaults when Skip Step clicked [33m 3534[2mms[22m[39m
       [33m[2m‚úì[22m[39m TC-201.7: should handle Skip Step click with validation errors present [33m 3076[2mms[22m[39m
       [33m[2m‚úì[22m[39m TC-201.8: should enable Skip Step button when form is pristine [33m 894[2mms[22m[39m
[31m       [31m√ó[31m TC-201.9: should keep Skip Step button enabled when form has validation errors[39m[33m 2656[2mms[22m[39m
       [33m[2m‚úì[22m[39m TC-201.10: should disable Skip Step button during form submission [33m 789[2mms[22m[39m
       [33m[2m‚úì[22m[39m TC-201.11: should have proper ARIA label for Skip Step button [33m 733[2mms[22m[39m
[31m       [31m√ó[31m TC-201.12: should support keyboard navigation to Skip Step button[39m[33m 5222[2mms[22m[39m
       [33m[2m‚úì[22m[39m TC-201.13: should announce skip action to screen readers [33m 1873[2mms[22m[39m
       [33m[2m‚úì[22m[39m TC-201.14: should prevent double-click on Skip Step button [33m 2263[2mms[22m[39m
       [33m[2m‚úì[22m[39m TC-201.15: should handle Skip Step when initialData already provided [33m 1346[2mms[22m[39m
[90mstdout[2m | app/(authenticated)/settings/__tests__/page.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | components/scanner/move/__tests__/ScannerMoveWizard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

 [31m‚ùØ[39m components/settings/allergens/__tests__/AllergensDataTable.TD-209.test.tsx [2m([22m[2m14 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[33m 13662[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render Products column header [33m 1224[2mms[22m[39m
       [32m‚úì[39m should not render Products column when showProductsColumn is false[32m 279[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show loading skeleton while fetching counts [33m 310[2mms[22m[39m
[31m       [31m√ó[31m should display product counts for each allergen[39m[33m 1325[2mms[22m[39m
[31m       [31m√ó[31m should show 0 for allergens not in counts response[39m[33m 1293[2mms[22m[39m
[31m       [31m√ó[31m should apply muted style for count of 0[39m[33m 1334[2mms[22m[39m
[31m       [31m√ó[31m should apply bold style for count >= 10[39m[33m 1335[2mms[22m[39m
[31m       [31m√ó[31m should not apply bold style for count < 10[39m[33m 1277[2mms[22m[39m
[31m       [31m√ó[31m should render count as link when count > 0[39m[33m 1299[2mms[22m[39m
[31m       [31m√ó[31m should not render link when count is 0[39m[33m 1312[2mms[22m[39m
[31m       [31m√ó[31m should have correct title attribute on link[39m[33m 1197[2mms[22m[39m
       [32m‚úì[39m should show "--" when fetch fails[32m 240[2mms[22m[39m
[31m       [31m√ó[31m should show product count in tooltip[39m[33m 1194[2mms[22m[39m
       [32m‚úì[39m should use correct colSpan for empty search state[32m 15[2mms[22m[39m
 [31m‚ùØ[39m app/(authenticated)/settings/__tests__/page.test.tsx [2m([22m[2m12 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[33m 11476[2mms[22m[39m
[31m       [31m√ó[31m should render organization summary card with logo, name, and location[39m[33m 1561[2mms[22m[39m
[31m       [31m√ó[31m should display all 6 quick access cards with correct stats[39m[33m 1156[2mms[22m[39m
[31m       [31m√ó[31m should display recent activity feed with last 5 audit entries[39m[33m 328[2mms[22m[39m
[31m       [31m√ó[31m should navigate to correct pages when clicking quick access cards[39m[33m 1119[2mms[22m[39m
       [32m‚úì[39m should show skeleton loaders while data is loading[32m 119[2mms[22m[39m
[31m       [31m√ó[31m should show setup wizard CTA for new organizations[39m[33m 1058[2mms[22m[39m
[31m       [31m√ó[31m should show minimal dashboard when skipping wizard[39m[33m 1145[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show error state with retry button when API fails [33m 1560[2mms[22m[39m
[31m       [31m√ó[31m should filter quick access cards based on user role[39m[33m 1083[2mms[22m[39m
       [32m‚úì[39m should redirect to dashboard if user has no access to any cards[32m 39[2mms[22m[39m
[31m       [31m√ó[31m should stack cards vertically on mobile[39m[33m 1112[2mms[22m[39m
[31m       [31m√ó[31m should have proper semantic HTML and ARIA attributes[39m[33m 1185[2mms[22m[39m
[90mstdout[2m | components/production/outputs/__tests__/OutputHistoryTable.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

 [31m‚ùØ[39m __tests__/components/production/outputs/OutputHistoryTable.test.tsx [2m([22m[2m33 tests[22m[2m | [22m[31m14 failed[39m[2m)[22m[33m 31203[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display all output rows [33m 2018[2mms[22m[39m
       [33m[2m‚úì[22m[39m AC: displays all 5 outputs within 1 second [33m 2212[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have LP Number column [33m 908[2mms[22m[39m
[31m       [31m√ó[31m should have Qty column[39m[33m 1166[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have Batch column [33m 699[2mms[22m[39m
[31m       [31m√ó[31m should have QA Status column[39m[33m 589[2mms[22m[39m
[31m       [31m√ó[31m should have Location column[39m[33m 530[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have Expiry column [33m 595[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have Created At column [33m 621[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have Actions column [33m 604[2mms[22m[39m
[31m       [31m√ó[31m should have QA Status filter dropdown[39m[33m 670[2mms[22m[39m
[31m       [31m√ó[31m should filter by Approved status[39m[33m 567[2mms[22m[39m
[31m       [31m√ó[31m should filter by Pending status[39m[33m 762[2mms[22m[39m
[31m       [31m√ó[31m should have Location filter dropdown[39m[33m 780[2mms[22m[39m
[31m       [31m√ó[31m should filter by Location[39m[33m 793[2mms[22m[39m
       [33m[2m‚úì[22m[39m should sort by LP Number when header clicked [33m 1582[2mms[22m[39m
[31m       [31m√ó[31m should sort by Qty when header clicked[39m[33m 523[2mms[22m[39m
[31m       [31m√ó[31m should toggle sort direction on second click[39m[33m 478[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have Register Output button [33m 1620[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onRegisterOutput when clicked [33m 1600[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have Export CSV button [33m 942[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onExportCSV when clicked [33m 1235[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have View LP action on each row [33m 1712[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onViewLP with LP ID when View clicked [33m 1228[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have Print Label action on each row [33m 1126[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onPrintLabel with LP ID when Label clicked [33m 1969[2mms[22m[39m
[31m       [31m√ó[31m should display total outputs count[39m[33m 937[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display total quantity [33m 826[2mms[22m[39m
[31m       [31m√ó[31m should display approved count and qty[39m[33m 539[2mms[22m[39m
[31m       [31m√ó[31m should display pending count and qty[39m[33m 636[2mms[22m[39m
[31m       [31m√ó[31m should display rejected count and qty[39m[33m 581[2mms[22m[39m
       [32m‚úì[39m should show empty state when no outputs[32m 26[2mms[22m[39m
       [32m‚úì[39m should show "Register First Output" button in empty state[32m 127[2mms[22m[39m
 [31m‚ùØ[39m components/quality/__tests__/StatusTransitionModal.test.tsx [2m([22m[2m24 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 30161[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render modal when open is true [33m 2499[2mms[22m[39m
       [32m‚úì[39m should not render modal when open is false[32m 101[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onOpenChange when Cancel clicked [33m 1652[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show entity display name in description [33m 913[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display current status badge [33m 693[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display PASSED status correctly [33m 409[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display all valid transitions as radio options [33m 2910[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show transition description [33m 557[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show requirement indicators [33m 833[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show message when no transitions available [33m 534[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have reason textarea [33m 726[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show character count [33m 2888[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show helper text about requirement [33m 637[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show loading skeleton when loadingTransitions is true [33m 346[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show error when transitionsError provided [33m 379[2mms[22m[39m
       [33m[2m‚úì[22m[39m should be disabled when no status selected [33m 581[2mms[22m[39m
       [33m[2m‚úì[22m[39m should be disabled when no valid transitions [33m 448[2mms[22m[39m
[31m       [31m√ó[31m should call API on valid form submission[39m[33m 5123[2mms[22m[39m
[31m       [31m√ó[31m should show success state after successful submission[39m[33m 5292[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have dialog title [33m 553[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have radio group for status selection [33m 756[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have required field indicators [33m 513[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have default test ID [33m 371[2mms[22m[39m
       [33m[2m‚úì[22m[39m should accept custom test ID [33m 377[2mms[22m[39m
 [31m‚ùØ[39m components/scanner/__tests__/ScannerReceiveWizard.test.tsx [2m([22m[2m61 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 31077[2mms[22m[39m
[31m       [31m√ó[31m should render with Step 1 by default[39m[32m 291[2mms[22m[39m
[31m       [31m√ó[31m should show step progress indicator[39m[32m 43[2mms[22m[39m
[31m       [31m√ó[31m should show header with title[39m[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should show back button[39m[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should navigate steps correctly[39m[32m 29[2mms[22m[39m
       [32m‚úì[39m should display pending PO list[32m 294[2mms[22m[39m
[31m       [31m√ó[31m should show "Scan PO Barcode" button[39m[33m 1369[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onPOSelected when PO tapped [33m 523[2mms[22m[39m
       [32m‚úì[39m should show empty state when no pending POs[32m 48[2mms[22m[39m
       [32m‚úì[39m should show loading state[32m 44[2mms[22m[39m
[31m       [31m√ó[31m should have touch targets >= 48dp[39m[32m 218[2mms[22m[39m
       [32m‚úì[39m should display PO header info[32m 53[2mms[22m[39m
[31m       [31m√ó[31m should display line items with remaining qty[39m[32m 58[2mms[22m[39m
       [32m‚úì[39m should grey out fully received lines[32m 55[2mms[22m[39m
[31m       [31m√ó[31m should show "Receive All Remaining" button[39m[33m 2935[2mms[22m[39m
       [32m‚úì[39m should call onLineSelected when line tapped[32m 210[2mms[22m[39m
       [32m‚úì[39m should display product info[32m 229[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show number pad [33m 1397[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show quick adjust buttons [33m 1468[2mms[22m[39m
       [32m‚úì[39m should show batch number field when required[32m 124[2mms[22m[39m
       [32m‚úì[39m should show expiry date field when required[32m 97[2mms[22m[39m
[31m       [31m√ó[31m should default quantity to remaining[39m[32m 107[2mms[22m[39m
[31m       [31m√ó[31m should show over-receipt warning when qty exceeds remaining[39m[32m 160[2mms[22m[39m
       [32m‚úì[39m should display summary of all fields[32m 146[2mms[22m[39m
[31m       [31m√ó[31m should show edit buttons for each section[39m[33m 4601[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show large Confirm button [33m 458[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onConfirm when confirm clicked [33m 541[2mms[22m[39m
[31m       [31m√ó[31m should call onEdit with step when edit clicked[39m[33m 4172[2mms[22m[39m
       [32m‚úì[39m should display GRN number[32m 210[2mms[22m[39m
       [32m‚úì[39m should display LP number[32m 85[2mms[22m[39m
       [32m‚úì[39m should show success animation[32m 106[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show "Receive More Items" button [33m 317[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show "New PO" button [33m 316[2mms[22m[39m
[31m       [31m√ó[31m should show "Reprint Label" button[39m[33m 2203[2mms[22m[39m
       [32m‚úì[39m should show "Done" button[32m 147[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render digits 0-9 [33m 2539[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render decimal point button [33m 556[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render backspace button [33m 793[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render clear button [33m 881[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onChange when digit pressed [33m 504[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onChange with cleared value [33m 683[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render quick adjust buttons [33m 900[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onQuickAdjust with delta [33m 460[2mms[22m[39m
[31m       [31m√ó[31m should have keys >= 48dp[39m[33m 481[2mms[22m[39m
       [32m‚úì[39m should have playSuccess method[32m 9[2mms[22m[39m
       [32m‚úì[39m should have playError method[32m 1[2mms[22m[39m
       [32m‚úì[39m should have playConfirm method[32m 0[2mms[22m[39m
       [32m‚úì[39m should have playAlert method[32m 0[2mms[22m[39m
       [32m‚úì[39m should have setEnabled method[32m 0[2mms[22m[39m
       [32m‚úì[39m should have success method[32m 0[2mms[22m[39m
       [32m‚úì[39m should have error method[32m 0[2mms[22m[39m
       [32m‚úì[39m should have confirm method[32m 0[2mms[22m[39m
       [32m‚úì[39m should render when show is true[32m 19[2mms[22m[39m
       [32m‚úì[39m should not render when show is false[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should have minimum size of 64x64[39m[32m 22[2mms[22m[39m
       [32m‚úì[39m should render when show is true[32m 16[2mms[22m[39m
       [32m‚úì[39m should display error message[32m 35[2mms[22m[39m
       [32m‚úì[39m should not render when show is false[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should have all buttons >= 48dp height[39m[32m 9[2mms[22m[39m
[31m       [31m√ó[31m should show loading overlay during API call[39m[32m 9[2mms[22m[39m
[31m       [31m√ó[31m should show error state with retry option[39m[32m 11[2mms[22m[39m
[90mstdout[2m | app/(authenticated)/settings/security/__tests__/page.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | __tests__/integration/api/planning/purchase-orders.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

 [31m‚ùØ[39m components/scanner/move/__tests__/ScannerMoveWizard.test.tsx [2m([22m[2m78 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[33m 16961[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render with Step 1 by default [33m 459[2mms[22m[39m
       [32m‚úì[39m should show step progress indicator[32m 211[2mms[22m[39m
       [32m‚úì[39m should show header with Move LP title[32m 115[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show back button [33m 1346[2mms[22m[39m
       [32m‚úì[39m should manage step navigation[32m 82[2mms[22m[39m
       [32m‚úì[39m should preserve LP data when navigating between steps[32m 76[2mms[22m[39m
       [32m‚úì[39m should display scan LP prompt[32m 40[2mms[22m[39m
       [32m‚úì[39m should show large scan button (80x80dp minimum)[32m 228[2mms[22m[39m
       [32m‚úì[39m should show manual entry link[32m 61[2mms[22m[39m
       [32m‚úì[39m should show recent moves list (optional)[32m 89[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onLPScanned with LP data when valid LP scanned [33m 1670[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onError when LP not found [33m 957[2mms[22m[39m
       [32m‚úì[39m should call onError when LP status is not available[32m 44[2mms[22m[39m
       [32m‚úì[39m should display LP details after successful scan[32m 39[2mms[22m[39m
       [32m‚úì[39m should show status badge for available LP[32m 47[2mms[22m[39m
[31m       [31m√ó[31m should show current location[39m[32m 48[2mms[22m[39m
       [32m‚úì[39m should show batch number if present[32m 20[2mms[22m[39m
       [32m‚úì[39m should show expiry date if present[32m 20[2mms[22m[39m
       [32m‚úì[39m should display error message for LP not found[32m 32[2mms[22m[39m
       [32m‚úì[39m should display error message for consumed LP[32m 32[2mms[22m[39m
       [32m‚úì[39m should display error message for reserved LP[32m 30[2mms[22m[39m
       [32m‚úì[39m should allow retry after error[32m 284[2mms[22m[39m
       [32m‚úì[39m should display LP summary card at top[32m 60[2mms[22m[39m
       [32m‚úì[39m should show scan destination prompt[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should show current location with From label[39m[32m 48[2mms[22m[39m
       [32m‚úì[39m should show manual selection link[32m 31[2mms[22m[39m
[31m       [31m√ó[31m should call onLocationScanned when valid location scanned[39m[33m 1460[2mms[22m[39m
       [32m‚úì[39m should call onError when location not found[32m 56[2mms[22m[39m
       [32m‚úì[39m should show warning when scanning same location as source[32m 58[2mms[22m[39m
       [32m‚úì[39m should display destination details after successful scan[32m 47[2mms[22m[39m
       [32m‚úì[39m should show zone and full path[32m 104[2mms[22m[39m
       [32m‚úì[39m should show capacity percentage if available[32m 110[2mms[22m[39m
       [32m‚úì[39m should show capacity warning when location at 100%[32m 76[2mms[22m[39m
       [33m[2m‚úì[22m[39m should still allow proceed despite capacity warning [33m 388[2mms[22m[39m
       [32m‚úì[39m should display LP info section[32m 95[2mms[22m[39m
[31m       [31m√ó[31m should display from location with full path[39m[32m 250[2mms[22m[39m
[31m       [31m√ó[31m should display to location with full path[39m[32m 209[2mms[22m[39m
       [32m‚úì[39m should show visual direction arrow[32m 148[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have large Confirm Move button at bottom [33m 763[2mms[22m[39m
       [32m‚úì[39m should have Cancel link above confirm button[32m 208[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have Edit button on LP section [33m 894[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have Edit button on destination section [33m 494[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onConfirm when confirm clicked [33m 406[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onEditLP when Edit LP clicked [33m 645[2mms[22m[39m
       [32m‚úì[39m should call onCancel when Cancel clicked[32m 164[2mms[22m[39m
       [32m‚úì[39m should show loading indicator during submit[32m 69[2mms[22m[39m
[31m       [31m√ó[31m should disable confirm button during loading[39m[32m 174[2mms[22m[39m
       [32m‚úì[39m should display success animation[32m 141[2mms[22m[39m
       [32m‚úì[39m should display move number[32m 51[2mms[22m[39m
       [32m‚úì[39m should display LP number[32m 34[2mms[22m[39m
       [32m‚úì[39m should display new location[32m 52[2mms[22m[39m
       [32m‚úì[39m should have Move Another to Same Location button[32m 234[2mms[22m[39m
       [32m‚úì[39m should have New Move button[32m 275[2mms[22m[39m
       [32m‚úì[39m should have Done button[32m 244[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onMoveAnother when Move Another clicked [33m 364[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onNewMove when New Move clicked [33m 352[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onDone when Done clicked [33m 348[2mms[22m[39m
     [32m‚úì[39m should display LP number prominently[32m 42[2mms[22m[39m
     [32m‚úì[39m should display product name[32m 66[2mms[22m[39m
     [32m‚úì[39m should display quantity with UOM[32m 63[2mms[22m[39m
     [32m‚úì[39m should display location[32m 33[2mms[22m[39m
     [32m‚úì[39m should support compact mode[32m 51[2mms[22m[39m
     [32m‚úì[39m should show status badge when showStatus is true[32m 77[2mms[22m[39m
     [32m‚úì[39m should show Edit button when onEdit provided[32m 252[2mms[22m[39m
     [32m‚úì[39m should display location code[32m 42[2mms[22m[39m
     [32m‚úì[39m should display full path[32m 70[2mms[22m[39m
[31m     [31m√ó[31m should display warehouse name[39m[32m 77[2mms[22m[39m
     [32m‚úì[39m should display capacity percentage if available[32m 38[2mms[22m[39m
     [32m‚úì[39m should show Edit button when onEdit provided[32m 196[2mms[22m[39m
     [32m‚úì[39m should render arrow element[32m 25[2mms[22m[39m
[31m     [31m√ó[31m should have minimum size of 24x24[39m[32m 125[2mms[22m[39m
[31m     [31m√ó[31m should have all buttons meeting minimum 48dp touch target[39m[33m 493[2mms[22m[39m
     [32m‚úì[39m should trigger success audio on valid LP scan[32m 38[2mms[22m[39m
     [32m‚úì[39m should trigger error audio on invalid scan[32m 1[2mms[22m[39m
     [32m‚úì[39m should trigger confirm audio on move complete[32m 20[2mms[22m[39m
     [32m‚úì[39m should show green checkmark on valid scan[32m 69[2mms[22m[39m
     [32m‚úì[39m should show red X on error[32m 61[2mms[22m[39m
     [32m‚úì[39m should show yellow warning for capacity[32m 58[2mms[22m[39m
[90mstdout[2m | __tests__/api/quality/settings.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

[90mstdout[2m | __tests__/api/settings/wizard.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

[90mstdout[2m | components/production/outputs/__tests__/ByProductsSection.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

 [31m‚ùØ[39m __tests__/api/settings/wizard.test.ts [2m([22m[2m13 tests[22m[2m | [22m[31m13 failed[39m[2m)[22m[33m 4761[2mms[22m[39m
[31m       [31m√ó[31m should save wizard progress with step and data[39m[33m 479[2mms[22m[39m
[31m       [31m√ó[31m should update wizard progress for next step[39m[32m 209[2mms[22m[39m
[31m       [31m√ó[31m should allow null wizard_progress (reset)[39m[32m 288[2mms[22m[39m
[31m       [31m√ó[31m should retrieve saved wizard progress[39m[32m 243[2mms[22m[39m
[31m       [31m√ó[31m should handle missing wizard_progress (new wizard)[39m[32m 267[2mms[22m[39m
[31m       [31m√ó[31m should mark wizard as completed[39m[32m 85[2mms[22m[39m
[31m       [31m√ó[31m should allow resetting wizard_completed to false[39m[32m 95[2mms[22m[39m
[31m       [31m√ó[31m should support nested JSONB objects[39m[32m 254[2mms[22m[39m
[31m       [31m√ó[31m should support JSONB array operations[39m[32m 179[2mms[22m[39m
[31m       [31m√ó[31m should persist data as user progresses through wizard[39m[33m 454[2mms[22m[39m
[31m       [31m√ó[31m should complete full wizard workflow[39m[33m 831[2mms[22m[39m
[31m       [31m√ó[31m should efficiently query by wizard_completed status[39m[32m 169[2mms[22m[39m
[31m       [31m√ó[31m should have wizard_completed = false by default[39m[32m 176[2mms[22m[39m
 [31m‚ùØ[39m __tests__/integration/api/planning/purchase-orders.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m13 failed[39m[2m)[22m[33m 6810[2mms[22m[39m
[31m       [31m√ó[31m Should create draft PO with all fields[39m[32m 230[2mms[22m[39m
[31m       [31m√ó[31m AC-02-2: Should generate unique PO number per org/year[39m[32m 238[2mms[22m[39m
       [32m‚úì[39m Should retrieve POs with pagination metadata[32m 136[2mms[22m[39m
       [32m‚úì[39m AC-01-4: Should support pagination with page and limit[32m 88[2mms[22m[39m
       [32m‚úì[39m AC-01-2: Should filter by status[32m 262[2mms[22m[39m
[31m       [31m√ó[31m AC-01-2: Should filter by supplier_id[39m[32m 119[2mms[22m[39m
[31m       [31m√ó[31m Should add line to draft PO[39m[32m 241[2mms[22m[39m
[31m       [31m√ó[31m AC-03-6: Should prevent duplicate product in PO[39m[33m 469[2mms[22m[39m
[31m       [31m√ó[31m Should calculate line total correctly[39m[32m 192[2mms[22m[39m
[31m       [31m√ó[31m AC-05-2: Should submit draft PO with lines[39m[33m 335[2mms[22m[39m
[31m       [31m√ó[31m AC-05-3: Should not submit PO without lines[39m[32m 246[2mms[22m[39m
[31m       [31m√ó[31m AC-05-5: Should cancel draft PO[39m[32m 184[2mms[22m[39m
[31m       [31m√ó[31m AC-05-6: Should not cancel PO with receipts[39m[33m 400[2mms[22m[39m
       [32m‚úì[39m Should only return POs for current org[32m 101[2mms[22m[39m
[31m       [31m√ó[31m Should allow planner to create PO[39m[32m 127[2mms[22m[39m
[31m       [31m√ó[31m Should create PO with lines atomically[39m[32m 233[2mms[22m[39m
[31m       [31m√ó[31m Should calculate subtotal from line totals[39m[33m 329[2mms[22m[39m
 [31m‚ùØ[39m __tests__/api/quality/settings.test.ts [2m([22m[2m20 tests[22m[2m | [22m[31m20 failed[39m[2m)[22m[33m 6833[2mms[22m[39m
[31m         [31m√ó[31m should return default values for org without settings record[39m[33m 521[2mms[22m[39m
[31m         [31m√ó[31m should return existing settings for org with settings record[39m[33m 364[2mms[22m[39m
[31m         [31m√ó[31m should return all expected fields[39m[32m 129[2mms[22m[39m
[31m         [31m√ó[31m should only return settings for users own org[39m[32m 299[2mms[22m[39m
[31m         [31m√ó[31m should update inspection settings[39m[32m 274[2mms[22m[39m
[31m         [31m√ó[31m should update NCR settings[39m[32m 247[2mms[22m[39m
[31m         [31m√ó[31m should update CAPA settings[39m[32m 247[2mms[22m[39m
[31m         [31m√ó[31m should update HACCP settings[39m[32m 204[2mms[22m[39m
[31m         [31m√ó[31m should update audit settings[39m[32m 199[2mms[22m[39m
[31m         [31m√ó[31m should update sampling level[39m[32m 233[2mms[22m[39m
[31m         [31m√ó[31m should reject ncr_critical_response_hours equal to 0[39m[32m 193[2mms[22m[39m
[31m         [31m√ó[31m should reject negative ncr_critical_response_hours[39m[32m 231[2mms[22m[39m
[31m         [31m√ó[31m should reject retention_years greater than 50[39m[32m 237[2mms[22m[39m
[31m         [31m√ó[31m should reject retention_years less than 1[39m[32m 268[2mms[22m[39m
[31m         [31m√ó[31m should reject ccp_deviation_escalation_minutes equal to 0[39m[32m 214[2mms[22m[39m
[31m         [31m√ó[31m should reject invalid sampling level[39m[32m 264[2mms[22m[39m
[31m       [31m√ó[31m should auto-create quality_settings on new org creation[39m[32m 246[2mms[22m[39m
[31m       [31m√ó[31m should not fail on duplicate org creation (ON CONFLICT DO NOTHING)[39m[32m 89[2mms[22m[39m
[31m       [31m√ó[31m should allow only one settings record per org[39m[32m 88[2mms[22m[39m
[31m       [31m√ó[31m should auto-update updated_at on update[39m[33m 461[2mms[22m[39m
 [31m‚ùØ[39m components/settings/onboarding/__tests__/TimezoneSelect.test.tsx [2m([22m[2m33 tests[22m[2m | [22m[31m10 failed[39m[2m)[22m[33m 153901[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render timezone select button [33m 1411[2mms[22m[39m
       [32m‚úì[39m should show placeholder when no value selected[32m 197[2mms[22m[39m
       [32m‚úì[39m should display selected timezone value[32m 175[2mms[22m[39m
       [33m[2m‚úì[22m[39m should render chevron icon [33m 390[2mms[22m[39m
       [32m‚úì[39m should load IANA timezones on mount[32m 286[2mms[22m[39m
[31m       [31m√ó[31m should group timezones by region[39m[33m 6031[2mms[22m[39m
[31m       [31m√ó[31m should display multiple timezones in list[39m[33m 14546[2mms[22m[39m
       [33m[2m‚úì[22m[39m should show search input when dropdown opened [33m 4451[2mms[22m[39m
       [33m[2m‚úì[22m[39m should filter timezones when searching for "war" [33m 4371[2mms[22m[39m
[31m       [31m√ó[31m should filter timezones when searching for "new_york"[39m[33m 5126[2mms[22m[39m
[31m       [31m√ó[31m should show "No timezone found" when search has no matches[39m[33m 5033[2mms[22m[39m
[31m       [31m√ó[31m should be case-insensitive in search[39m[33m 5017[2mms[22m[39m
       [33m[2m‚úì[22m[39m should call onValueChange when timezone selected [33m 2095[2mms[22m[39m
       [33m[2m‚úì[22m[39m should close dropdown after selection [33m 2745[2mms[22m[39m
       [33m[2m‚úì[22m[39m should update displayed value after selection [33m 4625[2mms[22m[39m
[31m       [31m√ó[31m should show checkmark icon for selected timezone[39m[33m 18604[2mms[22m[39m
       [33m[2m‚úì[22m[39m should hide checkmark for unselected timezones [33m 3785[2mms[22m[39m
       [32m‚úì[39m should have combobox role[32m 183[2mms[22m[39m
       [32m‚úì[39m should have aria-expanded attribute[32m 217[2mms[22m[39m
       [33m[2m‚úì[22m[39m should update aria-expanded when opened [33m 3472[2mms[22m[39m
       [32m‚úì[39m should have aria-label for accessibility[32m 149[2mms[22m[39m
       [32m‚úì[39m should support keyboard navigation with Tab[32m 201[2mms[22m[39m
       [33m[2m‚úì[22m[39m should open dropdown with Enter key [33m 3973[2mms[22m[39m
[31m       [31m√ó[31m should support keyboard navigation in dropdown[39m[33m 5235[2mms[22m[39m
       [32m‚úì[39m should handle empty value prop[32m 137[2mms[22m[39m
       [32m‚úì[39m should handle fallback timezones in older browsers[32m 64[2mms[22m[39m
       [33m[2m‚úì[22m[39m should display UTC timezone correctly [33m 4492[2mms[22m[39m
[31m       [31m√ó[31m should handle rapid dropdown open/close[39m[33m 8767[2mms[22m[39m
       [33m[2m‚úì[22m[39m should handle timezone with underscores [33m 3757[2mms[22m[39m
[31m       [31m√ó[31m should scroll to selected timezone when dropdown opens[39m[33m 19646[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have loading state (implicit via useMemo) [33m 308[2mms[22m[39m
       [33m[2m‚úì[22m[39m should have empty state when no timezones match search [33m 4501[2mms[22m[39m
[31m       [31m√ó[31m should have success state when timezone selected[39m[33m 19906[2mms[22m[39m
 [31m‚ùØ[39m app/(authenticated)/settings/security/__tests__/page.test.tsx [2m([22m[2m10 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 9072[2mms[22m[39m
     [33m[2m‚úì[22m[39m renders the security page with header [33m 1115[2mms[22m[39m
     [33m[2m‚úì[22m[39m renders active sessions section [33m 501[2mms[22m[39m
[31m     [31m√ó[31m renders change password section[39m[33m 1363[2mms[22m[39m
     [33m[2m‚úì[22m[39m renders security tips section [33m 513[2mms[22m[39m
     [32m‚úì[39m shows loading state initially[32m 225[2mms[22m[39m
[31m     [31m√ó[31m shows sessions list after loading[39m[33m 1275[2mms[22m[39m
     [33m[2m‚úì[22m[39m shows empty state when no sessions [33m 608[2mms[22m[39m
     [33m[2m‚úì[22m[39m shows error state when API fails [33m 828[2mms[22m[39m
[31m     [31m√ó[31m renders password form fields[39m[33m 1327[2mms[22m[39m
[31m     [31m√ó[31m shows password requirements[39m[33m 1271[2mms[22m[39m
 [31m‚ùØ[39m components/production/outputs/__tests__/ByProductsSection.test.tsx [2m([22m[2m24 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 10440[2mms[22m[39m
       [33m[2m‚úì[22m[39m AC: displays all by-products from BOM [33m 774[2mms[22m[39m
       [33m[2m‚úì[22m[39m displays product codes [33m 309[2mms[22m[39m
       [33m[2m‚úì[22m[39m displays By-Products header [33m 318[2mms[22m[39m
[31m       [31m√ó[31m AC: displays expected qty with yield percent[39m[33m 302[2mms[22m[39m
[31m       [31m√ó[31m displays actual registered qty[39m[32m 260[2mms[22m[39m
[31m       [31m√ó[31m displays LP count[39m[32m 215[2mms[22m[39m
       [32m‚úì[39m displays progress bar[32m 139[2mms[22m[39m
       [32m‚úì[39m displays Registered badge for registered by-products[32m 127[2mms[22m[39m
       [32m‚úì[39m displays Not Registered badge for unregistered by-products[32m 177[2mms[22m[39m
       [32m‚úì[39m shows missing warning for unregistered by-products[32m 138[2mms[22m[39m
       [32m‚úì[39m AC: shows auto-create ON banner when enabled[32m 136[2mms[22m[39m
       [32m‚úì[39m does not show banner when auto-create disabled[32m 195[2mms[22m[39m
       [33m[2m‚úì[22m[39m displays Register Now button for unregistered by-products [33m 2522[2mms[22m[39m
       [33m[2m‚úì[22m[39m calls onRegister when Register Now clicked [33m 1084[2mms[22m[39m
       [33m[2m‚úì[22m[39m displays View LPs button for registered by-products [33m 893[2mms[22m[39m
       [33m[2m‚úì[22m[39m calls onViewLPs when View LPs clicked [33m 613[2mms[22m[39m
       [33m[2m‚úì[22m[39m displays Add More button for registered by-products [33m 688[2mms[22m[39m
       [33m[2m‚úì[22m[39m calls onRegister when Add More clicked [33m 422[2mms[22m[39m
       [33m[2m‚úì[22m[39m displays Register All button when unregistered by-products exist [33m 328[2mms[22m[39m
       [33m[2m‚úì[22m[39m calls onRegisterAll when Register All clicked [33m 443[2mms[22m[39m
       [32m‚úì[39m displays loading state[32m 31[2mms[22m[39m
       [32m‚úì[39m has accessible loading label[32m 96[2mms[22m[39m
       [32m‚úì[39m displays message when no by-products[32m 37[2mms[22m[39m
       [32m‚úì[39m displays genealogy info[32m 165[2mms[22m[39m
 [31m‚ùØ[39m components/production/outputs/__tests__/OutputHistoryTable.test.tsx [2m([22m[2m22 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 18518[2mms[22m[39m
       [33m[2m‚úì[22m[39m AC: displays all outputs with individual quantities [33m 1816[2mms[22m[39m
       [33m[2m‚úì[22m[39m AC: displays each output with unique LP number [33m 909[2mms[22m[39m
       [33m[2m‚úì[22m[39m displays quantity with UoM [33m 854[2mms[22m[39m
       [33m[2m‚úì[22m[39m displays batch numbers [33m 505[2mms[22m[39m
       [33m[2m‚úì[22m[39m displays approved badge [33m 442[2mms[22m[39m
       [33m[2m‚úì[22m[39m displays pending badge [33m 562[2mms[22m[39m
       [33m[2m‚úì[22m[39m displays rejected badge [33m 545[2mms[22m[39m
       [33m[2m‚úì[22m[39m displays total outputs count [33m 498[2mms[22m[39m
       [33m[2m‚úì[22m[39m displays total quantity [33m 568[2mms[22m[39m
       [33m[2m‚úì[22m[39m displays approved count and qty [33m 587[2mms[22m[39m
       [32m‚úì[39m displays empty state message when no outputs[32m 29[2mms[22m[39m
       [33m[2m‚úì[22m[39m displays Register First Output button in empty state [33m 1273[2mms[22m[39m
[31m       [31m√ó[31m filters by QA status - Approved[39m[33m 830[2mms[22m[39m
[31m       [31m√ó[31m displays location filter dropdown[39m[33m 620[2mms[22m[39m
       [33m[2m‚úì[22m[39m sorts by LP Number when header clicked [33m 1597[2mms[22m[39m
       [33m[2m‚úì[22m[39m sorts by quantity when header clicked [33m 1739[2mms[22m[39m
       [33m[2m‚úì[22m[39m toggles sort direction on second click [33m 1819[2mms[22m[39m
       [33m[2m‚úì[22m[39m calls onRegisterOutput when Register Output button clicked [33m 1078[2mms[22m[39m
       [33m[2m‚úì[22m[39m calls onExportCSV when Export CSV button clicked [33m 859[2mms[22m[39m
       [33m[2m‚úì[22m[39m calls onViewLP with correct LP ID when View clicked [33m 452[2mms[22m[39m
       [33m[2m‚úì[22m[39m calls onPrintLabel with correct LP ID when Print clicked [33m 551[2mms[22m[39m
       [33m[2m‚úì[22m[39m displays showing count [33m 368[2mms[22m[39m
[90mstdout[2m | __tests__/api/settings/machines.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | app/api/v1/technical/routings/__tests__/operations.route.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | __tests__/api/settings/tax-codes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | components/navigation/__tests__/module-nav-filter.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | __tests__/api/settings/planning.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | __tests__/api/production/settings.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | __tests__/api/settings/modules.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

 [31m‚ùØ[39m app/api/v1/technical/routings/__tests__/operations.route.test.ts [2m([22m[2m44 tests[22m[2m | [22m[31m44 failed[39m[2m)[22m[33m 1796[2mms[22m[39m
[31m       [31m√ó[31m should return 200 with operations list[39m[32m 49[2mms[22m[39m
[31m       [31m√ó[31m should include summary stats in response[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return empty list when no operations[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return 404 when routing not found[39m[32m 8[2mms[22m[39m
[31m       [31m√ó[31m should return 401 when not authenticated[39m[32m 7[2mms[22m[39m
[31m       [31m√ó[31m should enforce RLS - Org A cannot see Org B operations (AC-32)[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return operations with parallel indicator[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 201 when operation created[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should allow duplicate sequence for parallel operations (AC-04)[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for validation error - name too short[39m[32m 9[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for validation error - duration < 1[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for negative setup_time (AC-10)[39m[32m 7[2mms[22m[39m
[31m       [31m√ó[31m should default setup_time and cleanup_time to 0 (AC-09)[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should allow null machine_id (optional)[39m[32m 6[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for instructions > 2000 chars (AC-17)[39m[32m 6[2mms[22m[39m
[31m       [31m√ó[31m should return 404 when routing not found[39m[32m 5[2mms[22m[39m
[31m       [31m√ó[31m should enforce RLS - cannot create in Org B routing (AC-32)[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return 403 when user lacks PRODUCTION_MANAGER role[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 200 when operation updated[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should update machine assignment[39m[32m 4[2mms[22m[39m
[31m       [31m√ó[31m should return 404 when operation not found[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return 404 when routing not found[39m[32m 7[2mms[22m[39m
[31m       [31m√ó[31m should return 200 when operation deleted[39m[32m 6[2mms[22m[39m
[31m       [31m√ó[31m should delete attachments from storage (AC-29)[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 404 when operation not found[39m[32m 5[2mms[22m[39m
[31m       [31m√ó[31m should return 200 when operation moved up (AC-25)[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 200 when operation moved down[39m[32m 6[2mms[22m[39m
[31m       [31m√ó[31m should return 400 when invalid direction[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 400 when cannot move first operation up[39m[32m 5[2mms[22m[39m
[31m       [31m√ó[31m should return 400 when cannot move last operation down[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should handle parallel operations reorder correctly (AC-27)[39m[32m 4[2mms[22m[39m
[31m       [31m√ó[31m should return 201 when attachment uploaded (AC-19)[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return 400 when file too large (AC-20)[39m[33m 1468[2mms[22m[39m
[31m       [31m√ó[31m should return 400 when invalid file type[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return 400 when max attachments reached (AC-21)[39m[32m 5[2mms[22m[39m
[31m       [31m√ó[31m should accept PDF files[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should accept PNG files[39m[32m 7[2mms[22m[39m
[31m       [31m√ó[31m should accept JPG files[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should accept DOCX files[39m[32m 6[2mms[22m[39m
[31m       [31m√ó[31m should return signed URL[39m[32m 124[2mms[22m[39m
[31m       [31m√ó[31m should return 404 when attachment not found[39m[32m 4[2mms[22m[39m
[31m       [31m√ó[31m should return 200 when attachment deleted[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should remove file from storage[39m[32m 4[2mms[22m[39m
[31m       [31m√ó[31m should return 404 when attachment not found[39m[32m 4[2mms[22m[39m
 [31m‚ùØ[39m __tests__/api/settings/tax-codes.test.ts [2m([22m[2m15 tests[22m[2m | [22m[31m14 failed[39m[2m)[22m[33m 3022[2mms[22m[39m
[31m       [31m√ó[31m should seed tax codes for Poland (4 codes)[39m[32m 154[2mms[22m[39m
[31m       [31m√ó[31m should be idempotent (no duplicates on re-run)[39m[32m 111[2mms[22m[39m
[31m       [31m√ó[31m should create a custom tax code[39m[32m 74[2mms[22m[39m
[31m       [31m√ó[31m should enforce unique code per org[39m[32m 97[2mms[22m[39m
[31m       [31m√ó[31m should enforce code format (uppercase alphanumeric + hyphens)[39m[32m 229[2mms[22m[39m
[31m       [31m√ó[31m should enforce rate >= 0[39m[32m 82[2mms[22m[39m
[31m       [31m√ó[31m should enforce rate <= 100[39m[32m 78[2mms[22m[39m
[31m       [31m√ó[31m should list all tax codes for organization[39m[32m 125[2mms[22m[39m
[31m       [31m√ó[31m should filter by search (code or description)[39m[32m 164[2mms[22m[39m
[31m       [31m√ó[31m should sort by rate descending[39m[32m 96[2mms[22m[39m
[31m       [31m√ó[31m should update tax code description[39m[32m 93[2mms[22m[39m
[31m       [31m√ó[31m should update tax code rate[39m[32m 92[2mms[22m[39m
[31m       [31m√ó[31m should delete unused tax code[39m[32m 111[2mms[22m[39m
       [33m[2m‚úì[22m[39m should only see tax codes from own organization [33m 513[2mms[22m[39m
[31m       [31m√ó[31m should seed different codes for UK[39m[32m 181[2mms[22m[39m
 [31m‚ùØ[39m __tests__/api/settings/modules.test.ts [2m([22m[2m11 tests[22m[2m | [22m[31m10 failed[39m[2m)[22m[33m 2523[2mms[22m[39m
[31m       [31m√ó[31m should have 4 default modules enabled on org creation[39m[32m 255[2mms[22m[39m
[31m       [31m√ó[31m should return true for enabled module[39m[32m 107[2mms[22m[39m
[31m       [31m√ó[31m should return false for disabled module[39m[32m 165[2mms[22m[39m
[31m       [31m√ó[31m should enable a disabled module[39m[32m 190[2mms[22m[39m
[31m       [31m√ó[31m should disable an enabled module[39m[33m 362[2mms[22m[39m
[31m       [31m√ó[31m should prevent disabling all modules[39m[32m 116[2mms[22m[39m
[31m       [31m√ó[31m should allow enabling all 8 modules[39m[32m 177[2mms[22m[39m
[31m       [31m√ó[31m should allow disabling all optional modules (keep only defaults)[39m[32m 175[2mms[22m[39m
[31m       [31m√ó[31m should support adding module to array[39m[32m 231[2mms[22m[39m
[31m       [31m√ó[31m should support removing module from array[39m[32m 248[2mms[22m[39m
       [32m‚úì[39m should efficiently query modules_enabled with contains operator[32m 110[2mms[22m[39m
 [31m‚ùØ[39m __tests__/api/settings/planning.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m21 failed[39m[2m)[22m[33m 2885[2mms[22m[39m
[31m       [31m√ó[31m should return existing settings when record exists[39m[33m 349[2mms[22m[39m
[31m       [31m√ó[31m should return all PO approval fields[39m[32m 116[2mms[22m[39m
[31m       [31m√ó[31m should auto-create default settings on first access (404)[39m[32m 92[2mms[22m[39m
[31m       [31m√ó[31m should return created defaults matching AC-02 specification[39m[32m 162[2mms[22m[39m
[31m       [31m√ó[31m should return 401 for unauthenticated request[39m[32m 2[2mms[22m[39m
       [32m‚úì[39m should return 500 on server error[32m 6[2mms[22m[39m
[31m       [31m√ó[31m should include timestamps in response[39m[32m 144[2mms[22m[39m
[31m       [31m√ó[31m should enable PO approval toggle via PUT[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should disable PO approval toggle via PUT[39m[32m 82[2mms[22m[39m
[31m       [31m√ó[31m should update approval threshold[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should accept null threshold[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should update approval roles[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should update multiple fields at once[39m[32m 4[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for negative threshold[39m[32m 5[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for zero threshold[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for empty roles array[39m[32m 6[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for invalid JSON[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 401 for unauthenticated PUT request[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 403 for non-admin user[39m[32m 8[2mms[22m[39m
[31m       [31m√ó[31m should include success flag and message in response[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should update timestamp on save[39m[32m 79[2mms[22m[39m
[31m     [31m√ó[31m should only return current org settings on GET (not other orgs)[39m[32m 1[2mms[22m[39m
     [32m‚úì[39m should prevent cross-org settings modification via RLS[32m 83[2mms[22m[39m
 [31m‚ùØ[39m __tests__/api/settings/machines.test.ts [2m([22m[2m13 tests[22m[2m | [22m[31m12 failed[39m[2m)[22m[33m 3416[2mms[22m[39m
[31m       [31m√ó[31m should create a machine with valid data[39m[32m 271[2mms[22m[39m
[31m       [31m√ó[31m should reject duplicate code in same org[39m[32m 231[2mms[22m[39m
[31m       [31m√ó[31m should enforce code format (uppercase alphanumeric + hyphens)[39m[32m 89[2mms[22m[39m
[31m       [31m√ó[31m should accept valid status values[39m[32m 177[2mms[22m[39m
[31m       [31m√ó[31m should reject invalid status values[39m[32m 84[2mms[22m[39m
[31m       [31m√ó[31m should allow creating machine_line_assignments[39m[32m 87[2mms[22m[39m
[31m       [31m√ó[31m should prevent duplicate assignments (unique constraint)[39m[32m 83[2mms[22m[39m
[31m       [31m√ó[31m should list all machines for org[39m[32m 87[2mms[22m[39m
[31m       [31m√ó[31m should filter machines by status[39m[32m 156[2mms[22m[39m
[31m       [31m√ó[31m should search machines by code[39m[32m 91[2mms[22m[39m
[31m       [31m√ó[31m should delete machine with CASCADE to assignments[39m[32m 76[2mms[22m[39m
[31m       [31m√ó[31m should update machine fields[39m[32m 75[2mms[22m[39m
       [33m[2m‚úì[22m[39m should isolate machines by org_id [33m 500[2mms[22m[39m
[90mstdout[2m | __tests__/api/planning/purchase-orders-approval.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

 [31m‚ùØ[39m __tests__/api/production/settings.test.ts [2m([22m[2m22 tests[22m[2m | [22m[31m14 failed[39m[2m)[22m[33m 4569[2mms[22m[39m
[31m       [31m√ó[31m should return 200 OK with settings for existing org[39m[33m 462[2mms[22m[39m
[31m       [31m√ó[31m should return all 15 settings fields[39m[32m 83[2mms[22m[39m
[31m       [31m√ó[31m should only return settings for authenticated user org (RLS)[39m[32m 183[2mms[22m[39m
[31m       [31m√ó[31m should upsert default settings for new org[39m[32m 218[2mms[22m[39m
[31m       [31m√ó[31m should update single field successfully[39m[32m 189[2mms[22m[39m
[31m       [31m√ó[31m should update multiple fields at once (AC-9)[39m[32m 162[2mms[22m[39m
[31m       [31m√ó[31m should return full settings object after update[39m[32m 90[2mms[22m[39m
[31m       [31m√ó[31m should update updated_at timestamp[39m[32m 273[2mms[22m[39m
[31m       [31m√ó[31m should reject dashboard_refresh_seconds below 5 (AC-15)[39m[32m 80[2mms[22m[39m
[31m       [31m√ó[31m should reject dashboard_refresh_seconds above 300[39m[32m 72[2mms[22m[39m
[31m       [31m√ó[31m should reject target_oee_percent above 100 (AC-16)[39m[32m 76[2mms[22m[39m
[31m       [31m√ó[31m should reject negative target_oee_percent[39m[32m 89[2mms[22m[39m
       [32m‚úì[39m should accept valid dashboard_refresh_seconds (15)[32m 107[2mms[22m[39m
       [32m‚úì[39m should accept valid target_oee_percent (85)[32m 148[2mms[22m[39m
[31m       [31m√ó[31m should return only settings for queried org[39m[32m 285[2mms[22m[39m
       [32m‚úì[39m should not allow updating another org settings[32m 117[2mms[22m[39m
[31m       [31m√ó[31m should enforce UNIQUE constraint on org_id[39m[32m 269[2mms[22m[39m
       [32m‚úì[39m should accept boundary value for dashboard_refresh_seconds (5)[32m 121[2mms[22m[39m
       [32m‚úì[39m should accept boundary value for dashboard_refresh_seconds (300)[32m 137[2mms[22m[39m
       [32m‚úì[39m should accept boundary value for target_oee_percent (0)[32m 126[2mms[22m[39m
       [32m‚úì[39m should accept boundary value for target_oee_percent (100)[32m 121[2mms[22m[39m
       [32m‚úì[39m should accept decimal target_oee_percent (85.50)[32m 134[2mms[22m[39m
[90mstdout[2m | __tests__/01-settings/01.6.use-permissions-hook.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

[90mstdout[2m | __tests__/api/planning/work-orders/schedule.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | __tests__/api/settings/invitations.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | components/technical/__tests__/version-warning-banner.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

 [31m‚ùØ[39m __tests__/api/planning/purchase-orders-approval.test.ts [2m([22m[2m29 tests[22m[2m | [22m[31m22 failed[39m[2m | [22m[33m7 skipped[39m[2m)[22m[33m 3108[2mms[22m[39m
     [2m[90m‚Üì[39m[22m should submit PO below threshold directly to submitted status
     [2m[90m‚Üì[39m[22m should submit PO above threshold to pending_approval status
     [2m[90m‚Üì[39m[22m should create approval history record on submission
     [2m[90m‚Üì[39m[22m should return 400 if PO not in draft status
     [2m[90m‚Üì[39m[22m should return 400 if PO has no lines
     [2m[90m‚Üì[39m[22m should return 404 if PO not found
     [2m[90m‚Üì[39m[22m should complete within 300ms (performance)
[31m     [31m√ó[31m should approve PO successfully with notes[39m[32m 193[2mms[22m[39m
[31m     [31m√ó[31m should approve PO without notes (optional)[39m[32m 101[2mms[22m[39m
[31m     [31m√ó[31m should create approval history record[39m[32m 118[2mms[22m[39m
[31m     [31m√ó[31m should return 403 if user lacks approval permission[39m[32m 145[2mms[22m[39m
[31m     [31m√ó[31m should return 400 if PO not in pending_approval status[39m[32m 104[2mms[22m[39m
[31m     [31m√ó[31m should return 400 if notes exceed 1000 characters[39m[32m 141[2mms[22m[39m
[31m     [31m√ó[31m should handle concurrent approval attempts[39m[32m 90[2mms[22m[39m
[31m     [31m√ó[31m should complete within 500ms (performance)[39m[32m 107[2mms[22m[39m
[31m     [31m√ó[31m should reject PO with reason[39m[32m 150[2mms[22m[39m
[31m     [31m√ó[31m should create approval history record with rejection[39m[32m 95[2mms[22m[39m
[31m     [31m√ó[31m should return 400 if rejection reason missing[39m[32m 86[2mms[22m[39m
[31m     [31m√ó[31m should return 400 if rejection reason less than 10 chars[39m[32m 83[2mms[22m[39m
[31m     [31m√ó[31m should return 400 if rejection reason exceeds 1000 chars[39m[32m 80[2mms[22m[39m
[31m     [31m√ó[31m should return 403 if user lacks approval permission[39m[32m 85[2mms[22m[39m
[31m     [31m√ó[31m should return 400 if PO not in pending_approval status[39m[32m 121[2mms[22m[39m
[31m     [31m√ó[31m should preserve rejection reason exactly as provided[39m[32m 76[2mms[22m[39m
[31m     [31m√ó[31m should return approval history sorted by timestamp desc[39m[32m 172[2mms[22m[39m
[31m     [31m√ó[31m should return empty array if no history[39m[32m 76[2mms[22m[39m
[31m     [31m√ó[31m should support pagination[39m[32m 103[2mms[22m[39m
[31m     [31m√ó[31m should enforce org_id RLS isolation[39m[32m 76[2mms[22m[39m
[31m     [31m√ó[31m should return 404 if PO not found[39m[32m 102[2mms[22m[39m
[31m     [31m√ó[31m should load within 200ms (performance)[39m[32m 86[2mms[22m[39m
[90mstdout[2m | __tests__/integration/api/warehouse/asns.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

 [31m‚ùØ[39m components/technical/__tests__/version-warning-banner.test.tsx [2m([22m[2m16 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 834[2mms[22m[39m
       [32m‚úì[39m should display version increment warning[32m 132[2mms[22m[39m
[31m       [31m√ó[31m should show current version number[39m[32m 54[2mms[22m[39m
       [32m‚úì[39m should show next version number[32m 22[2mms[22m[39m
       [32m‚úì[39m should display BOM/WO impact warning[32m 9[2mms[22m[39m
       [32m‚úì[39m should handle version 1 correctly (v1 -> v2)[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should handle large version numbers[39m[32m 14[2mms[22m[39m
       [32m‚úì[39m should display "View History" link when onViewHistory provided[32m 20[2mms[22m[39m
       [32m‚úì[39m should call onViewHistory when link clicked[32m 26[2mms[22m[39m
       [32m‚úì[39m should not display link when onViewHistory not provided[32m 18[2mms[22m[39m
       [32m‚úì[39m should have warning/alert styling (yellow/amber background)[32m 24[2mms[22m[39m
[31m       [31m√ó[31m should have warning icon[39m[33m 383[2mms[22m[39m
       [32m‚úì[39m should apply custom className[32m 13[2mms[22m[39m
       [32m‚úì[39m should have appropriate ARIA role[32m 56[2mms[22m[39m
       [32m‚úì[39m should be readable by screen readers[32m 21[2mms[22m[39m
[31m       [31m√ó[31m should handle version 0 (edge case)[39m[32m 17[2mms[22m[39m
       [32m‚úì[39m should not render when currentVersion is negative[32m 5[2mms[22m[39m
 [31m‚ùØ[39m components/navigation/__tests__/module-nav-filter.test.tsx [2m([22m[2m14 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[33m 7152[2mms[22m[39m
[31m     [31m√ó[31m should return list of enabled modules for org[39m[33m 1099[2mms[22m[39m
     [32m‚úì[39m should always include settings module in enabled list[32m 77[2mms[22m[39m
     [32m‚úì[39m should return empty loading state initially[32m 13[2mms[22m[39m
[31m     [31m√ó[31m should update when modules are toggled[39m[33m 1050[2mms[22m[39m
[31m     [31m√ó[31m should show only enabled modules in navigation[39m[33m 1186[2mms[22m[39m
     [32m‚úì[39m should always show settings module in navigation[32m 111[2mms[22m[39m
     [32m‚úì[39m should always show non-module items (like Dashboard)[32m 100[2mms[22m[39m
     [32m‚úì[39m should hide disabled modules from navigation[32m 124[2mms[22m[39m
[31m     [31m√ó[31m should show all modules when all are enabled[39m[33m 1082[2mms[22m[39m
[31m     [31m√ó[31m should update navigation when module is enabled[39m[33m 1137[2mms[22m[39m
[31m     [31m√ó[31m should update navigation when module is disabled[39m[33m 1065[2mms[22m[39m
     [32m‚úì[39m should handle case when no modules are enabled except settings[32m 31[2mms[22m[39m
     [32m‚úì[39m should handle database error gracefully[32m 22[2mms[22m[39m
     [32m‚úì[39m should handle missing organization_modules records[32m 49[2mms[22m[39m
 [31m‚ùØ[39m __tests__/api/planning/work-orders/schedule.test.ts [2m([22m[2m16 tests[22m[2m | [22m[33m16 skipped[39m[2m)[22m[33m 1618[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should schedule draft WO with valid times and return 200
       [2m[90m‚Üì[39m[22m should include product relation in response
       [2m[90m‚Üì[39m[22m should return 400 when end time is before start time
       [2m[90m‚Üì[39m[22m should return 400 when trying to schedule completed WO
       [2m[90m‚Üì[39m[22m should return 400 when trying to schedule cancelled WO
       [2m[90m‚Üì[39m[22m should update production line and return line relation
       [2m[90m‚Üì[39m[22m should return 404 when production line does not exist
       [2m[90m‚Üì[39m[22m should clear machine assignment when machine_id is null
       [2m[90m‚Üì[39m[22m should return 404 when trying to schedule WO from different org
       [2m[90m‚Üì[39m[22m should return 403 when user lacks update permission
       [2m[90m‚Üì[39m[22m should return 401 when no auth token provided
       [2m[90m‚Üì[39m[22m should accept valid date range (end >= start)
       [2m[90m‚Üì[39m[22m should return 400 when end date is before start date
       [2m[90m‚Üì[39m[22m should return 404 for non-existent WO
       [2m[90m‚Üì[39m[22m should accept empty body (no changes)
       [2m[90m‚Üì[39m[22m should handle overnight times on multi-day WO
 [31m‚ùØ[39m __tests__/api/settings/invitations.test.ts [2m([22m[2m7 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 1895[2mms[22m[39m
[31m       [31m√ó[31m should create invitation with token and 7-day expiry[39m[32m 141[2mms[22m[39m
[31m       [31m√ó[31m should reject expired token (expires_at in past)[39m[32m 101[2mms[22m[39m
[31m       [31m√ó[31m should have all required fields in invitation record[39m[32m 83[2mms[22m[39m
[31m       [31m√ó[31m should invalidate old token when resending[39m[32m 94[2mms[22m[39m
[31m       [31m√ó[31m should activate user via database trigger after signup[39m[32m 127[2mms[22m[39m
[31m       [31m√ó[31m should support all status transitions[39m[32m 84[2mms[22m[39m
[31m       [31m√ó[31m should delete expired invitations older than 30 days[39m[32m 274[2mms[22m[39m
 [31m‚ùØ[39m __tests__/01-settings/01.6.use-permissions-hook.test.ts [2m([22m[2m24 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 2483[2mms[22m[39m
       [32m‚úì[39m should return true when owner checks any permission[32m 111[2mms[22m[39m
       [32m‚úì[39m should return false when viewer checks write permissions[32m 17[2mms[22m[39m
       [32m‚úì[39m should return true when viewer checks read permissions[32m 15[2mms[22m[39m
[31m       [31m√ó[31m should handle production operator CRU permissions correctly[39m[32m 29[2mms[22m[39m
       [32m‚úì[39m should handle quality inspector CRU permissions[32m 16[2mms[22m[39m
       [32m‚úì[39m should handle admin CRU on settings (no Delete)[32m 7[2mms[22m[39m
       [32m‚úì[39m should return true if user has any permission in module[32m 10[2mms[22m[39m
[31m       [31m√ó[31m should return false if user has no access to module[39m[32m 13[2mms[22m[39m
       [32m‚úì[39m should return true for warehouse operator in warehouse module[32m 8[2mms[22m[39m
       [32m‚úì[39m should return true for viewer in all modules[32m 12[2mms[22m[39m
       [32m‚úì[39m should return false for production manager in production[32m 7[2mms[22m[39m
       [32m‚úì[39m should return false for production operator in production (has Update)[32m 2[2mms[22m[39m
       [32m‚úì[39m should return current user role[32m 5[2mms[22m[39m
       [32m‚úì[39m should return role display name[32m 7[2mms[22m[39m
       [32m‚úì[39m should cache permission lookups[32m 7[2mms[22m[39m
[31m       [31m√ó[31m should invalidate cache when role changes[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should receive permission updates via websocket[39m[33m 1059[2mms[22m[39m
[31m       [31m√ó[31m should show notification when permissions change[39m[33m 1046[2mms[22m[39m
       [32m‚úì[39m should handle undefined user gracefully[32m 13[2mms[22m[39m
       [32m‚úì[39m should handle invalid role gracefully[32m 16[2mms[22m[39m
       [32m‚úì[39m should handle invalid module gracefully[32m 14[2mms[22m[39m
       [32m‚úì[39m should handle invalid action gracefully[32m 15[2mms[22m[39m
       [32m‚úì[39m should accept valid module names[32m 13[2mms[22m[39m
       [32m‚úì[39m should accept valid action types[32m 14[2mms[22m[39m
 [31m‚ùØ[39m __tests__/integration/api/warehouse/asns.test.ts [2m([22m[2m21 tests[22m[2m | [22m[33m21 skipped[39m[2m)[22m[33m 2167[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should return 403 when enable_asn is false
       [2m[90m‚Üì[39m[22m should allow access when enable_asn is true
       [2m[90m‚Üì[39m[22m should return paginated ASN list
       [2m[90m‚Üì[39m[22m should filter by status
       [2m[90m‚Üì[39m[22m should search by ASN number
       [2m[90m‚Üì[39m[22m should sort by expected_date
       [2m[90m‚Üì[39m[22m should create ASN with items
       [2m[90m‚Üì[39m[22m should return 400 when po_id is missing
       [2m[90m‚Üì[39m[22m should return 400 when items array is empty
       [2m[90m‚Üì[39m[22m should create ASN from PO with auto-populated items
       [2m[90m‚Üì[39m[22m should return 400 for fully received PO
       [2m[90m‚Üì[39m[22m should return ASN detail with items
       [2m[90m‚Üì[39m[22m should return 404 for non-existent ASN
       [2m[90m‚Üì[39m[22m should return 404 for cross-tenant access
       [2m[90m‚Üì[39m[22m should update ASN header when status is pending
       [2m[90m‚Üì[39m[22m should return 400 when status is not pending
       [2m[90m‚Üì[39m[22m should delete ASN when status is pending and no receipts
       [2m[90m‚Üì[39m[22m should return 400 when ASN has received items
       [2m[90m‚Üì[39m[22m should cancel ASN when status is pending
       [2m[90m‚Üì[39m[22m should return 400 when status is not pending
       [2m[90m‚Üì[39m[22m should return only ASNs expected today with pending or partial status
[90mstdout[2m | __tests__/api/planning/transfer-orders.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

[90mstdout[2m | __tests__/api/production/scanner-output.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | lib/hooks/__tests__/use-permissions.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | __tests__/api/planning/purchase-orders.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

 [31m‚ùØ[39m __tests__/api/production/scanner-output.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m11 failed[39m[2m)[22m[33m 1460[2mms[22m[39m
[31m       [31m√ó[31m should return WO data within 500ms[39m[33m 773[2mms[22m[39m
       [32m‚úì[39m should return 401 for unauthenticated request[32m 12[2mms[22m[39m
       [32m‚úì[39m should return 404 for non-existent WO[32m 15[2mms[22m[39m
       [32m‚úì[39m should return 409 for completed WO[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should return by_products array from BOM[39m[32m 22[2mms[22m[39m
       [32m‚úì[39m should return 400 for empty barcode[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should create LP and return LP data[39m[32m 165[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for qty = 0[39m[32m 43[2mms[22m[39m
[31m       [31m√ó[31m should update WO output_qty[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should create genealogy records[39m[32m 2[2mms[22m[39m
       [32m‚úì[39m should return by-products list with expected quantities[32m 104[2mms[22m[39m
       [32m‚úì[39m should return empty array when no by-products[32m 2[2mms[22m[39m
       [32m‚úì[39m should return 404 for non-existent WO[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should create by-product LP[39m[32m 129[2mms[22m[39m
[31m       [31m√ó[31m should allow qty = 0 with zero_qty_confirmed[39m[32m 3[2mms[22m[39m
       [32m‚úì[39m should return 400 for qty = 0 without confirmation[32m 11[2mms[22m[39m
[31m       [31m√ó[31m should send ZPL to printer within 2 seconds[39m[32m 40[2mms[22m[39m
       [32m‚úì[39m should return 404 when no printer configured[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return 503 when printer offline[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should return 504 on print timeout[39m[32m 17[2mms[22m[39m
       [32m‚úì[39m should return printer status for location[32m 73[2mms[22m[39m
       [32m‚úì[39m should return configured=false when no printer[32m 13[2mms[22m[39m
       [32m‚úì[39m should only access own org WOs[32m 2[2mms[22m[39m
[90mstdout[2m | lib/services/__tests__/inspection-service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

 [31m‚ùØ[39m __tests__/api/planning/transfer-orders.test.ts [2m([22m[2m26 tests[22m[2m | [22m[33m26 skipped[39m[2m)[22m[33m 2082[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should fail when TO has no lines
       [2m[90m‚Üì[39m[22m should succeed when TO has at least 1 line
       [2m[90m‚Üì[39m[22m should allow cancellation at any status
       [2m[90m‚Üì[39m[22m should create a TO line with valid data
       [2m[90m‚Üì[39m[22m should enforce quantity > 0
       [2m[90m‚Üì[39m[22m should enforce quantity not null
       [2m[90m‚Üì[39m[22m should update TO line quantity
       [2m[90m‚Üì[39m[22m should update TO line notes
       [2m[90m‚Üì[39m[22m should delete TO line when TO is in draft
       [2m[90m‚Üì[39m[22m should calculate summary correctly
       [2m[90m‚Üì[39m[22m should only see transfer orders from own organization
       [2m[90m‚Üì[39m[22m should allow warehouse role to manage TOs
       [2m[90m‚Üì[39m[22m should allow purchasing role to manage TOs
       [2m[90m‚Üì[39m[22m should allow admin role to manage TOs
       [2m[90m‚Üì[39m[22m should enforce from_warehouse != to_warehouse
       [2m[90m‚Üì[39m[22m should enforce planned_receive_date >= planned_ship_date
       [2m[90m‚Üì[39m[22m should allow same-day ship and receive dates
       [2m[90m‚Üì[39m[22m AC-3.6.1: List transfer orders with filters
       [2m[90m‚Üì[39m[22m AC-3.6.2: Create transfer order
       [2m[90m‚Üì[39m[22m AC-3.6.3: Get transfer order details with joins
       [2m[90m‚Üì[39m[22m AC-3.6.4: Update transfer order
       [2m[90m‚Üì[39m[22m AC-3.6.5: Delete transfer order
       [2m[90m‚Üì[39m[22m AC-3.8.1: Ship full transfer order quantity
       [2m[90m‚Üì[39m[22m AC-3.8.2: Ship partial transfer order quantity
       [2m[90m‚Üì[39m[22m AC-3.8.3: Status transitions (draft ‚Üí planned ‚Üí shipped ‚Üí received)
       [2m[90m‚Üì[39m[22m AC-3.9.1-3.9.2: Track audit fields (created_by, updated_by, timestamps)
[90mstdout[2m | __tests__/api/planning/dashboard-routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

 [31m‚ùØ[39m lib/hooks/__tests__/use-permissions.test.tsx [2m([22m[2m20 tests[22m[2m | [22m[31m12 failed[39m[2m)[22m[33m 1915[2mms[22m[39m
[31m     [31m√ó[31m should return can() function that checks permissions correctly for admin[39m[33m 307[2mms[22m[39m
     [32m‚úì[39m should return can() function that denies create actions for viewer[32m 30[2mms[22m[39m
[31m     [31m√ó[31m should return true for viewer read permissions on all modules[39m[32m 46[2mms[22m[39m
[31m     [31m√ó[31m should return correct permissions for production_operator[39m[32m 60[2mms[22m[39m
[31m     [31m√ó[31m should return correct permissions for quality_inspector[39m[32m 41[2mms[22m[39m
     [32m‚úì[39m should return false when user is not loaded[32m 22[2mms[22m[39m
     [32m‚úì[39m should return false for invalid module[32m 12[2mms[22m[39m
     [32m‚úì[39m should return false for invalid action[32m 30[2mms[22m[39m
[31m     [31m√ó[31m should return true when quality_inspector has any access to quality module[39m[32m 73[2mms[22m[39m
     [32m‚úì[39m should return false when quality_inspector has no access to settings[32m 35[2mms[22m[39m
[31m     [31m√ó[31m should return true when production_operator has read-only access to warehouse[39m[32m 5[2mms[22m[39m
[31m     [31m√ó[31m should return true for viewer on any module (has read access)[39m[32m 12[2mms[22m[39m
     [32m‚úì[39m should return false when user has no access to module[32m 11[2mms[22m[39m
[31m     [31m√ó[31m should return current user role code for planner[39m[32m 12[2mms[22m[39m
[31m     [31m√ó[31m should return owner role code[39m[32m 19[2mms[22m[39m
     [32m‚úì[39m should return null when user not loaded[32m 12[2mms[22m[39m
[31m     [31m√ó[31m should update permissions when user role changes from viewer to admin[39m[32m 17[2mms[22m[39m
[31m     [31m√ó[31m should update permissions when user role changes from production_operator to production_manager[39m[33m 1130[2mms[22m[39m
[31m     [31m√ó[31m should return loading true while user is loading[39m[32m 4[2mms[22m[39m
     [32m‚úì[39m should return loading false when user loaded[32m 2[2mms[22m[39m
[90mstdout[2m | __tests__/api/planning/purchase-orders.test.ts[2m > [22m[2mBatch 3A: Purchase Orders
[22m[39mCleaned up test data for org: undefined

 [31m‚ùØ[39m __tests__/api/planning/purchase-orders.test.ts [2m([22m[2m13 tests[22m[2m | [22m[33m13 skipped[39m[2m)[22m[33m 1935[2mms[22m[39m
       [2m[90m‚Üì[39m[22m AC-3.1.1: Create purchase order
       [2m[90m‚Üì[39m[22m AC-3.1.2: List purchase orders
       [2m[90m‚Üì[39m[22m AC-3.1.3: Get PO details
       [2m[90m‚Üì[39m[22m AC-3.1.4: Update PO
       [2m[90m‚Üì[39m[22m AC-3.1.5: Delete PO
       [2m[90m‚Üì[39m[22m AC-3.2.1: Add line to PO
       [2m[90m‚Üì[39m[22m AC-3.2.4: Calculate PO totals
       [2m[90m‚Üì[39m[22m AC-3.3.1: Request approval
       [2m[90m‚Üì[39m[22m AC-3.3.2: Approve PO
       [2m[90m‚Üì[39m[22m AC-3.3.3: Reject PO
       [2m[90m‚Üì[39m[22m AC-3.4.1: Auto-populate currency from supplier
       [2m[90m‚Üì[39m[22m AC-3.4.2: Auto-populate tax_code from supplier
       [2m[90m‚Üì[39m[22m AC-3.5: PO inherits currency and tax code from supplier
 [31m‚ùØ[39m lib/services/__tests__/inspection-service.test.ts [2m([22m[2m131 tests[22m[2m | [22m[31m131 failed[39m[2m)[22m[33m 2629[2mms[22m[39m
[31m       [31m√ó[31m should generate inspection number with incoming type prefix[39m[32m 100[2mms[22m[39m
[31m       [31m√ó[31m should use INC prefix for incoming inspection type[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should use IPR prefix for in_process inspection type[39m[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should use FIN prefix for final inspection type[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should increment sequence number for each new inspection[39m[32m 31[2mms[22m[39m
[31m       [31m√ó[31m should reset sequence on year boundary[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should ensure uniqueness per org[39m[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should create inspection with required fields[39m[32m 30[2mms[22m[39m
[31m       [31m√ó[31m should auto-generate inspection_number[39m[32m 34[2mms[22m[39m
[31m       [31m√ó[31m should set status to scheduled[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should set scheduled_date to today if not provided[39m[32m 9[2mms[22m[39m
[31m       [31m√ó[31m should default priority to normal[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should link specification if active spec exists for product[39m[32m 20[2mms[22m[39m
[31m       [31m√ó[31m should create inspection without spec if none exists[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should reject if no reference provided (LP, GRN, or PO)[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should validate product exists before creating[39m[32m 12[2mms[22m[39m
[31m       [31m√ó[31m should warn if LP has active inspection but allow override[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should set created_by to current user[39m[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should set created_at to current timestamp[39m[32m 11[2mms[22m[39m
[31m       [31m√ó[31m should inherit org_id from user context[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should create inspections when auto-create enabled[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should skip when auto-create disabled[39m[32m 11[2mms[22m[39m
[31m       [31m√ó[31m should create one inspection per LP in GRN[39m[32m 19[2mms[22m[39m
[31m       [31m√ó[31m should set status to scheduled[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should set scheduled_date to today[39m[32m 25[2mms[22m[39m
[31m       [31m√ó[31m should link product from GRN item[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should link LP from GRN item[39m[32m 15[2mms[22m[39m
[31m       [31m√ó[31m should link GRN as reference[39m[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should link PO if available on GRN[39m[32m 18[2mms[22m[39m
[31m       [31m√ó[31m should link active specification if exists[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should handle batch_number from GRN item[39m[32m 24[2mms[22m[39m
[31m       [31m√ó[31m should assign inspector to scheduled inspection[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should set assigned_by to current user[39m[32m 32[2mms[22m[39m
[31m       [31m√ó[31m should set assigned_at to current timestamp[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should allow reassignment of assigned inspection[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should prevent assignment if completed[39m[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should update updated_at and updated_by[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should validate inspector_id is valid UUID[39m[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should send notification to assigned inspector[39m[32m 22[2mms[22m[39m
[31m       [31m√ó[31m should change status from scheduled to in_progress[39m[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should set started_at to current timestamp[39m[32m 44[2mms[22m[39m
[31m       [31m√ó[31m should require inspector assignment before starting[39m[32m 39[2mms[22m[39m
[31m       [31m√ó[31m should allow take_over by different user if QA_MANAGER[39m[32m 22[2mms[22m[39m
[31m       [31m√ó[31m should update inspector_id when taking over[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should prevent start if already in_progress[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should prevent start if already completed[39m[32m 59[2mms[22m[39m
[31m       [31m√ó[31m should update updated_at and updated_by[39m[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should set status to completed[39m[32m 29[2mms[22m[39m
[31m       [31m√ó[31m should set result to provided value (pass/fail/conditional)[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should set completed_at to current timestamp[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should set completed_by to current user[39m[32m 35[2mms[22m[39m
[31m       [31m√ó[31m should accept optional result_notes[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should accept defect counts (major, minor, critical)[39m[32m 18[2mms[22m[39m
[31m       [31m√ó[31m should require conditional_reason for conditional result[39m[32m 27[2mms[22m[39m
[31m       [31m√ó[31m should require conditional_restrictions for conditional result[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should accept conditional_expires_at for conditional result[39m[32m 8[2mms[22m[39m
[31m       [31m√ó[31m should set conditional_approved_by for conditional[39m[32m 36[2mms[22m[39m
[31m       [31m√ó[31m should allow creating NCR on fail if requested[39m[32m 62[2mms[22m[39m
[31m       [31m√ó[31m should prevent complete if status not in_progress[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should update updated_at and updated_by[39m[32m 22[2mms[22m[39m
[31m       [31m√ó[31m should update LP qa_status to passed when result=pass[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should update LP qa_status to failed when result=fail[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should update LP qa_status to conditional when result=conditional[39m[32m 24[2mms[22m[39m
[31m       [31m√ó[31m should not update LP if lp_id is null[39m[32m 24[2mms[22m[39m
[31m       [31m√ó[31m should validate LP exists before updating[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should update LP updated_at timestamp[39m[32m 21[2mms[22m[39m
[31m       [31m√ó[31m should suggest pass when all tests passed[39m[32m 27[2mms[22m[39m
[31m       [31m√ó[31m should suggest fail when any test failed[39m[32m 26[2mms[22m[39m
[31m       [31m√ó[31m should suggest fail when critical_defects > 0[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should include test summary in response[39m[32m 25[2mms[22m[39m
[31m       [31m√ó[31m should return reason for suggestion[39m[32m 26[2mms[22m[39m
[31m       [31m√ó[31m should handle inspections with no tests recorded[39m[32m 24[2mms[22m[39m
[31m       [31m√ó[31m should handle no specification linked[39m[32m 28[2mms[22m[39m
[31m       [31m√ó[31m should check quality_settings.auto_fail_on_critical flag[39m[32m 36[2mms[22m[39m
[31m       [31m√ó[31m should return true when all required tests recorded[39m[32m 15[2mms[22m[39m
[31m       [31m√ó[31m should return false when tests missing[39m[32m 33[2mms[22m[39m
[31m       [31m√ó[31m should list untested critical parameters[39m[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should list missing mandatory tests[39m[32m 90[2mms[22m[39m
[31m       [31m√ó[31m should allow complete when no spec linked[39m[32m 31[2mms[22m[39m
[31m       [31m√ó[31m should cancel scheduled inspection[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should set status to cancelled[39m[32m 15[2mms[22m[39m
[31m       [31m√ó[31m should require cancellation reason[39m[32m 29[2mms[22m[39m
[31m       [31m√ó[31m should prevent cancel if in_progress[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should prevent cancel if completed[39m[32m 34[2mms[22m[39m
[31m       [31m√ó[31m should update updated_at and updated_by[39m[32m 24[2mms[22m[39m
[31m       [31m√ó[31m should return paginated list of inspections[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should filter by inspection_type=incoming[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should filter by status[39m[32m 22[2mms[22m[39m
[31m       [31m√ó[31m should filter by priority[39m[32m 21[2mms[22m[39m
[31m       [31m√ó[31m should filter by inspector_id[39m[32m 29[2mms[22m[39m
[31m       [31m√ó[31m should filter by product_id[39m[32m 28[2mms[22m[39m
[31m       [31m√ó[31m should filter by lp_id[39m[32m 26[2mms[22m[39m
[31m       [31m√ó[31m should filter by grn_id[39m[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should filter by po_id[39m[32m 47[2mms[22m[39m
[31m       [31m√ó[31m should search by inspection_number or lp_number[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should sort by scheduled_date ascending[39m[32m 21[2mms[22m[39m
[31m       [31m√ó[31m should sort by inspection_number[39m[32m 20[2mms[22m[39m
[31m       [31m√ó[31m should sort by created_at[39m[32m 25[2mms[22m[39m
[31m       [31m√ó[31m should sort by priority[39m[32m 20[2mms[22m[39m
[31m       [31m√ó[31m should paginate correctly with limit and offset[39m[32m 34[2mms[22m[39m
[31m       [31m√ó[31m should return pagination metadata[39m[32m 51[2mms[22m[39m
[31m       [31m√ó[31m should enforce org_id filter from user context[39m[32m 27[2mms[22m[39m
[31m       [31m√ó[31m should load <500ms with 1000 inspections[39m[32m 26[2mms[22m[39m
[31m       [31m√ó[31m should return inspection with all fields[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should include linked test results from story 06.6[39m[32m 49[2mms[22m[39m
[31m       [31m√ó[31m should include test result summary[39m[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should return can_complete flag[39m[32m 26[2mms[22m[39m
[31m       [31m√ó[31m should return suggested_result[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return null if inspection not found[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should load <500ms with 50 test results[39m[32m 30[2mms[22m[39m
[31m       [31m√ó[31m should return inspections with status scheduled or in_progress[39m[32m 22[2mms[22m[39m
[31m       [31m√ó[31m should return counts by status[39m[32m 38[2mms[22m[39m
[31m       [31m√ó[31m should filter by type if provided[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should enforce org_id filter[39m[32m 40[2mms[22m[39m
[31m       [31m√ó[31m should return inspections assigned to user[39m[32m 59[2mms[22m[39m
[31m       [31m√ó[31m should include pending and in_progress[39m[32m 19[2mms[22m[39m
[31m       [31m√ó[31m should order by scheduled_date[39m[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should return empty list if no assignments[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return true if LP has pending inspection[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return false if no pending inspection[39m[32m 50[2mms[22m[39m
[31m       [31m√ó[31m should return inspection details if exists[39m[32m 27[2mms[22m[39m
[31m       [31m√ó[31m should check scheduled and in_progress statuses[39m[32m 27[2mms[22m[39m
[31m       [31m√ó[31m should enforce org_id isolation on select[39m[32m 15[2mms[22m[39m
[31m       [31m√ó[31m should enforce org_id isolation on insert[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should enforce org_id isolation on update[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should prevent delete if status != scheduled[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should prevent cross-org access via query[39m[32m 18[2mms[22m[39m
[31m       [31m√ó[31m should list 1000 inspections <500ms[39m[32m 10[2mms[22m[39m
[31m       [31m√ó[31m should get detail with 50 tests <500ms[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should create inspection <300ms[39m[32m 15[2mms[22m[39m
[31m       [31m√ó[31m should complete with LP update <500ms[39m[32m 17[2mms[22m[39m
[90mstdout[2m | lib/services/__tests__/quality-status-service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

 [31m‚ùØ[39m __tests__/api/planning/dashboard-routes.test.ts [2m([22m[2m34 tests[22m[2m | [22m[33m34 skipped[39m[2m)[22m[33m 944[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should return 200 with KPI data structure
       [2m[90m‚Üì[39m[22m should return numeric values for all KPIs
       [2m[90m‚Üì[39m[22m should return 400 for missing org_id query parameter
       [2m[90m‚Üì[39m[22m should return 400 for invalid org_id format (not UUID)
       [2m[90m‚Üì[39m[22m should return 401 for unauthenticated requests
       [2m[90m‚Üì[39m[22m should include cache headers (Cache-Control)
       [2m[90m‚Üì[39m[22m should return zero values for non-existent org
       [2m[90m‚Üì[39m[22m should only return data for specified org_id (RLS enforcement)
       [2m[90m‚Üì[39m[22m should return 200 with alerts array and total
       [2m[90m‚Üì[39m[22m should return alerts with correct structure
       [2m[90m‚Üì[39m[22m should respect limit query parameter (default 10)
       [2m[90m‚Üì[39m[22m should return 400 for limit > 50
       [2m[90m‚Üì[39m[22m should return 400 for invalid limit (non-numeric)
       [2m[90m‚Üì[39m[22m should return 400 for missing org_id
       [2m[90m‚Üì[39m[22m should sort alerts by severity (critical > warning)
       [2m[90m‚Üì[39m[22m should return empty alerts when no issues exist
       [2m[90m‚Üì[39m[22m should include cache headers
       [2m[90m‚Üì[39m[22m should enforce RLS by org_id
       [2m[90m‚Üì[39m[22m should return 200 with activities array and total
       [2m[90m‚Üì[39m[22m should return activities with correct structure
       [2m[90m‚Üì[39m[22m should respect limit query parameter (default 20, max 100)
       [2m[90m‚Üì[39m[22m should return 400 for limit > 100
       [2m[90m‚Üì[39m[22m should return 400 for missing org_id
       [2m[90m‚Üì[39m[22m should sort activities by timestamp DESC (newest first)
       [2m[90m‚Üì[39m[22m should include activities from PO, TO, and WO
       [2m[90m‚Üì[39m[22m should include valid action types
       [2m[90m‚Üì[39m[22m should return empty activities when no data exists
       [2m[90m‚Üì[39m[22m should include cache headers
       [2m[90m‚Üì[39m[22m should enforce RLS by org_id
       [2m[90m‚Üì[39m[22m should handle malformed JSON requests gracefully
       [2m[90m‚Üì[39m[22m should reject unsupported HTTP methods
       [2m[90m‚Üì[39m[22m should handle database connection errors gracefully
       [2m[90m‚Üì[39m[22m should serve cached KPI data on subsequent requests
       [2m[90m‚Üì[39m[22m should invalidate cache when PO is created
[90mstdout[2m | __tests__/services/planning-dashboard-service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

 [31m‚ùØ[39m lib/services/__tests__/quality-status-service.test.ts [2m([22m[2m62 tests[22m[2m | [22m[31m26 failed[39m[2m)[22m[33m 762[2mms[22m[39m
       [32m‚úì[39m should return all 7 quality status types[32m 14[2mms[22m[39m
       [32m‚úì[39m should return PENDING status with correct properties[32m 14[2mms[22m[39m
       [32m‚úì[39m should return PASSED status with correct properties[32m 1[2mms[22m[39m
       [32m‚úì[39m should return FAILED status with correct properties[32m 1[2mms[22m[39m
       [32m‚úì[39m should return HOLD status with correct properties[32m 1[2mms[22m[39m
       [32m‚úì[39m should return RELEASED status with correct properties[32m 1[2mms[22m[39m
       [32m‚úì[39m should return QUARANTINED status with correct properties[32m 1[2mms[22m[39m
       [32m‚úì[39m should return COND_APPROVED status with correct properties[32m 1[2mms[22m[39m
       [32m‚úì[39m should return status types within 200ms[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should return valid transitions from PENDING[39m[32m 75[2mms[22m[39m
[31m       [31m√ó[31m should return valid transitions from PASSED[39m[32m 26[2mms[22m[39m
[31m       [31m√ó[31m should return valid transitions from FAILED[39m[32m 21[2mms[22m[39m
[31m       [31m√ó[31m should return valid transitions from HOLD[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return valid transitions from QUARANTINED[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should return valid transitions from COND_APPROVED[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return valid transitions from RELEASED[39m[32m 12[2mms[22m[39m
       [32m‚úì[39m should only return allowed transitions[32m 1[2mms[22m[39m
       [32m‚úì[39m should return empty array for invalid status[32m 11[2mms[22m[39m
[31m       [31m√ó[31m should validate valid PENDING -> PASSED transition with inspection[39m[32m 15[2mms[22m[39m
       [32m‚úì[39m should block invalid transition FAILED -> RELEASED[32m 12[2mms[22m[39m
[31m       [31m√ó[31m should require reason when requires_reason is true[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should require inspection when requires_inspection is true and no inspection exists[39m[32m 15[2mms[22m[39m
[31m       [31m√ó[31m should require approval when requires_approval is true and user lacks role[39m[32m 1[2mms[22m[39m
       [32m‚úì[39m should block self-transition (same from and to status)[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should validate transition with all requirements met[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return multiple errors when multiple requirements not met[39m[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should validate batch entity type[39m[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should validate inspection entity type[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should change LP status and create history record[39m[32m 15[2mms[22m[39m
       [32m‚úì[39m should throw error for invalid transition[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should record from_status and to_status in history[39m[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should handle initial status (null from_status)[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should throw error when missing required reason[39m[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should throw error when LP not found[39m[32m 12[2mms[22m[39m
[31m       [31m√ó[31m should return status history for LP in descending order[39m[32m 12[2mms[22m[39m
       [32m‚úì[39m should return empty array if no history[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should include user name in history entries[39m[32m 18[2mms[22m[39m
[31m       [31m√ó[31m should handle batch entity type[39m[32m 24[2mms[22m[39m
[31m       [31m√ó[31m should handle inspection entity type[39m[32m 15[2mms[22m[39m
       [32m‚úì[39m should return history within 200ms performance target[32m 25[2mms[22m[39m
       [32m‚úì[39m should return current status for LP[32m 13[2mms[22m[39m
       [32m‚úì[39m should return PENDING as default for new LP[32m 18[2mms[22m[39m
       [32m‚úì[39m should throw error for unknown entity type[32m 15[2mms[22m[39m
       [32m‚úì[39m should return true for QA_MANAGER role[32m 2[2mms[22m[39m
       [32m‚úì[39m should return true for QUALITY_DIRECTOR role[32m 13[2mms[22m[39m
       [32m‚úì[39m should return true for ADMIN role[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should return false for OPERATOR role[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return false for VIEWER role[39m[32m 1[2mms[22m[39m
       [32m‚úì[39m should return true for PASSED status[32m 16[2mms[22m[39m
       [32m‚úì[39m should return true for RELEASED status[32m 3[2mms[22m[39m
       [32m‚úì[39m should return false for PENDING status[32m 21[2mms[22m[39m
       [32m‚úì[39m should return false for FAILED status[32m 20[2mms[22m[39m
       [32m‚úì[39m should return false for HOLD status[32m 1[2mms[22m[39m
       [32m‚úì[39m should return false for QUARANTINED status[32m 23[2mms[22m[39m
       [32m‚úì[39m should return false for COND_APPROVED status[32m 1[2mms[22m[39m
       [32m‚úì[39m should return true for PASSED status[32m 1[2mms[22m[39m
       [32m‚úì[39m should return true for RELEASED status[32m 13[2mms[22m[39m
       [32m‚úì[39m should return true for COND_APPROVED status[32m 1[2mms[22m[39m
       [32m‚úì[39m should return false for PENDING status[32m 23[2mms[22m[39m
       [32m‚úì[39m should return false for FAILED status[32m 2[2mms[22m[39m
       [32m‚úì[39m should return false for HOLD status[32m 12[2mms[22m[39m
       [32m‚úì[39m should return false for QUARANTINED status[32m 14[2mms[22m[39m
[90mstdout[2m | __tests__/api/technical/products.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | app/api/shipping/shipments/[id]/labels/__tests__/route.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

 [31m‚ùØ[39m __tests__/services/planning-dashboard-service.test.ts [2m([22m[2m37 tests[22m[2m | [22m[33m37 skipped[39m[2m)[22m[33m 1193[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should return KPIData object with all 6 metrics
       [2m[90m‚Üì[39m[22m should return numeric values for all KPIs
       [2m[90m‚Üì[39m[22m should return zero values when no orders exist
       [2m[90m‚Üì[39m[22m should count POs pending approval correctly
       [2m[90m‚Üì[39m[22m should count POs created this month correctly
       [2m[90m‚Üì[39m[22m should count TOs in transit correctly
       [2m[90m‚Üì[39m[22m should count WOs scheduled today correctly
       [2m[90m‚Üì[39m[22m should count overdue WOs correctly
       [2m[90m‚Üì[39m[22m should NOT count completed WOs as overdue
       [2m[90m‚Üì[39m[22m should count open POs correctly (exclude closed and cancelled)
       [2m[90m‚Üì[39m[22m should cache KPI results for 2 minutes
       [2m[90m‚Üì[39m[22m should enforce RLS by filtering on org_id
       [2m[90m‚Üì[39m[22m should return AlertsResponse with alerts array and total
       [2m[90m‚Üì[39m[22m should return empty alerts when no issues exist
       [2m[90m‚Üì[39m[22m should detect overdue POs (expected_delivery_date < today)
       [2m[90m‚Üì[39m[22m should mark overdue PO as warning if 1-3 days overdue
       [2m[90m‚Üì[39m[22m should mark overdue PO as critical if 4+ days overdue
       [2m[90m‚Üì[39m[22m should detect POs pending approval for > 2 days
       [2m[90m‚Üì[39m[22m should sort alerts by severity (critical before warning)
       [2m[90m‚Üì[39m[22m should respect limit parameter (default 10, max 50)
       [2m[90m‚Üì[39m[22m should enforce RLS by org_id
       [2m[90m‚Üì[39m[22m should cache alert results for 2 minutes
       [2m[90m‚Üì[39m[22m should include alert structure with required fields
       [2m[90m‚Üì[39m[22m should return ActivityResponse with activities array and total
       [2m[90m‚Üì[39m[22m should return empty activities when no data exists
       [2m[90m‚Üì[39m[22m should return activities sorted by timestamp (newest first)
       [2m[90m‚Üì[39m[22m should respect limit parameter (default 20, max 100)
       [2m[90m‚Üì[39m[22m should include PO activities from status history
       [2m[90m‚Üì[39m[22m should include TO activities
       [2m[90m‚Üì[39m[22m should include WO activities
       [2m[90m‚Üì[39m[22m should map status changes to action types
       [2m[90m‚Üì[39m[22m should include activity structure with required fields
       [2m[90m‚Üì[39m[22m should enforce RLS by org_id
       [2m[90m‚Üì[39m[22m should cache activity results for 2 minutes
       [2m[90m‚Üì[39m[22m should clear all 3 cache keys for an org
       [2m[90m‚Üì[39m[22m should use correct cache key patterns
       [2m[90m‚Üì[39m[22m should be called when PO is created/updated/deleted
[90mstdout[2m | __tests__/api/quality/inspections.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

[90mstdout[2m | app/api/v1/technical/products/[id]/allergens/__tests__/route.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

[90mstdout[2m | __tests__/api/production/output-registration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

[90mstdout[2m | app/api/v1/settings/onboarding/step/1/__tests__/route.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üì° add observability to secrets: https://dotenvx.com/ops

 [31m‚ùØ[39m app/api/shipping/shipments/[id]/labels/__tests__/route.test.ts [2m([22m[2m115 tests[22m[2m | [22m[31m92 failed[39m[2m)[22m[33m 744[2mms[22m[39m
       [32m‚úì[39m should accept empty request body (default options)[32m 71[2mms[22m[39m
       [32m‚úì[39m should accept force_regenerate boolean[32m 1[2mms[22m[39m
       [32m‚úì[39m should default force_regenerate to false[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject invalid force_regenerate type[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should generate SSCC for all boxes without existing SSCC[39m[32m 46[2mms[22m[39m
[31m       [31m√ó[31m should skip boxes that already have SSCC (idempotent)[39m[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should regenerate SSCC when force_regenerate is true[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return boxes array with sscc and sscc_formatted[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should increment organization.next_sscc_sequence atomically[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should generate unique SSCC across all organizations[39m[32m 6[2mms[22m[39m
[31m       [31m√ó[31m should return valid SSCC-18 with correct check digit[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should format SSCC as "00 XXXX XXXX XXXX XXXX XX"[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return GS1_PREFIX_NOT_CONFIGURED when org lacks GS1 prefix[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should return MISSING_BOX_DATA when box lacks weight[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return MISSING_BOX_DATA when box lacks dimensions[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return SHIPMENT_NOT_PACKED when status is not packed[39m[32m 11[2mms[22m[39m
[31m       [31m√ó[31m should return SHIPMENT_NOT_FOUND for non-existent shipment[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 403 FORBIDDEN for unauthorized user[39m[32m 12[2mms[22m[39m
[31m       [31m√ó[31m should filter by org_id from user context[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 404 for cross-tenant access attempt[39m[32m 10[2mms[22m[39m
[31m       [31m√ó[31m should rollback if any SSCC generation fails[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should use SELECT FOR UPDATE to prevent concurrent duplicates[39m[32m 9[2mms[22m[39m
       [32m‚úì[39m should accept empty request body[32m 1[2mms[22m[39m
       [32m‚úì[39m should accept force_regenerate boolean[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept include_product_list boolean[32m 15[2mms[22m[39m
       [32m‚úì[39m should default include_product_list to true[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should generate BOL PDF with bol_number[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should return signed URL to PDF in Supabase Storage[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return generated_at timestamp[39m[32m 12[2mms[22m[39m
[31m       [31m√ó[31m should return file_size_kb[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should use cached BOL if available and force_regenerate=false[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should regenerate BOL when force_regenerate=true[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should include product summary when include_product_list=true[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should exclude product summary when include_product_list=false[39m[32m 19[2mms[22m[39m
[31m       [31m√ó[31m should return NO_CARRIER_ASSIGNED when shipment lacks carrier[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return MISSING_SSCC when any box lacks SSCC[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should return MISSING_BOX_DATA when box lacks weight[39m[32m 18[2mms[22m[39m
[31m       [31m√ó[31m should return MISSING_ADDRESS when customer address missing[39m[32m 28[2mms[22m[39m
[31m       [31m√ó[31m should return SHIPMENT_NOT_READY when status invalid[39m[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should return PDF_GENERATION_TIMEOUT after 30 seconds[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return SHIPMENT_NOT_FOUND for non-existent shipment[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 403 FORBIDDEN for unauthorized user[39m[32m 9[2mms[22m[39m
[31m       [31m√ó[31m should generate BOL number in format BOL-YYYY-XXXXXX[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should increment BOL sequence per organization[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should make BOL number immutable after generation[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should store PDF at /bol/{org_id}/{shipment_id}.pdf[39m[32m 20[2mms[22m[39m
[31m       [31m√ó[31m should cache PDF in Redis with 24h TTL[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should invalidate cache on shipment update[39m[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept valid format and output[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept format 4x6[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept format 4x8[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject invalid format[32m 14[2mms[22m[39m
       [32m‚úì[39m should accept output zpl[32m 1[2mms[22m[39m
       [32m‚úì[39m should accept output pdf[32m 14[2mms[22m[39m
       [32m‚úì[39m should reject invalid output[32m 1[2mms[22m[39m
       [32m‚úì[39m should accept optional box_ids array[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject invalid UUID in box_ids[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should generate ZPL for all boxes when box_ids not provided[39m[32m 15[2mms[22m[39m
[31m       [31m√ó[31m should generate ZPL for specific boxes when box_ids provided[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should include GS1-128 barcode command in ZPL[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should include human-readable SSCC in ZPL[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should include ship-to address in ZPL[39m[32m 15[2mms[22m[39m
[31m       [31m√ó[31m should use 4x6 dimensions (813x1219 dots) for format=4x6[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should use 4x8 dimensions (813x1629 dots) for format=4x8[39m[32m 12[2mms[22m[39m
[31m       [31m√ó[31m should generate PDF labels when output=pdf[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return pdf_url for each box[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should store PDF labels in Supabase Storage[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should return MISSING_SSCC when any box lacks SSCC[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return INVALID_FORMAT for unsupported format[39m[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should return INVALID_OUTPUT for unsupported output[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return SHIPMENT_NOT_FOUND for non-existent shipment[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 403 FORBIDDEN for unauthorized user[39m[32m 1[2mms[22m[39m
       [32m‚úì[39m should accept empty request body[32m 4[2mms[22m[39m
       [32m‚úì[39m should accept force_regenerate boolean[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should generate packing slip PDF[39m[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should return signed URL to PDF[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should return generated_at timestamp[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return file_size_kb[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should include line items with lots and BBD[39m[32m 12[2mms[22m[39m
[31m       [31m√ó[31m should include allergen warnings when applicable[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should include carton summary with SSCC[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return MISSING_SSCC when boxes lack SSCC[39m[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should return MISSING_LOT_NUMBERS when items lack lot info[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return MISSING_ADDRESS when customer address missing[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return PDF_GENERATION_TIMEOUT after 30 seconds[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return SHIPMENT_NOT_FOUND for non-existent shipment[39m[32m 15[2mms[22m[39m
[31m       [31m√ó[31m should return 403 FORBIDDEN for unauthorized user[39m[32m 1[2mms[22m[39m
       [32m‚úì[39m should accept format=4x6[32m 10[2mms[22m[39m
       [32m‚úì[39m should accept format=4x8[32m 0[2mms[22m[39m
       [32m‚úì[39m should default format to 4x6[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject invalid format[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should return sscc (18-digit raw)[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return sscc_formatted with spaces[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should return barcode_image_base64 (PNG)[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should return label_content.ship_to object[39m[32m 11[2mms[22m[39m
[31m       [31m√ó[31m should return order_number[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should return box_number in format "X of Y"[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should return weight with unit (kg)[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should return handling_instructions when present[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should return SHIPMENT_NOT_FOUND for non-existent shipment[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should return BOX_NOT_FOUND for non-existent box[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return NO_SSCC when box lacks SSCC[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 403 FORBIDDEN for unauthorized user[39m[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should filter by org_id from user context[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 404 for cross-tenant access attempt[39m[32m 11[2mms[22m[39m
[31m       [31m√ó[31m should allow Warehouse Manager to generate SSCC[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should allow Shipping Manager to generate SSCC[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should allow Admin to generate SSCC[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should deny Picker from generating SSCC[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should deny Viewer from generating SSCC[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should allow Packer to print labels[39m[32m 11[2mms[22m[39m
[31m       [31m√ó[31m should allow Warehouse Manager to print labels[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should deny Viewer from printing labels[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should allow all authenticated users to preview labels[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should deny unauthenticated access[39m[32m 1[2mms[22m[39m
 [31m‚ùØ[39m __tests__/api/technical/products.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m18 failed[39m[2m)[22m[33m 569[2mms[22m[39m
[31m       [31m√ó[31m should return products list for authenticated user[39m[32m 169[2mms[22m[39m
[31m       [31m√ó[31m should filter products by search query (AC-2.1.2)[39m[32m 34[2mms[22m[39m
[31m       [31m√ó[31m should filter products by type[39m[32m 19[2mms[22m[39m
[31m       [31m√ó[31m should filter products by status[39m[32m 19[2mms[22m[39m
[31m       [31m√ó[31m should support sorting by name descending[39m[32m 30[2mms[22m[39m
[31m       [31m√ó[31m should support pagination[39m[32m 28[2mms[22m[39m
[31m       [31m√ó[31m should return 401 if user is not authenticated[39m[32m 38[2mms[22m[39m
[31m       [31m√ó[31m should return 400 if org_id not in user metadata[39m[32m 22[2mms[22m[39m
[31m       [31m√ó[31m should filter by deleted_at is null (soft delete)[39m[32m 47[2mms[22m[39m
[31m       [31m√ó[31m should create product with valid data[39m[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for duplicate product code (AC-2.1.4)[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for invalid product code format[39m[32m 19[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for missing required fields[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for invalid product type[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should validate max_stock_qty > min_stock_qty[39m[32m 26[2mms[22m[39m
[31m       [31m√ó[31m should return 401 if user is not authenticated[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should filter products by org_id[39m[32m 11[2mms[22m[39m
[31m       [31m√ó[31m should set org_id on create from user metadata[39m[32m 26[2mms[22m[39m
 [31m‚ùØ[39m __tests__/api/quality/inspections.test.ts [2m([22m[2m140 tests[22m[2m | [22m[31m140 failed[39m[2m)[22m[33m 1595[2mms[22m[39m
[31m       [31m√ó[31m should return 200 with paginated list[39m[32m 72[2mms[22m[39m
[31m       [31m√ó[31m should include pagination metadata[39m[32m 18[2mms[22m[39m
[31m       [31m√ó[31m should return default 20 items per page[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should support limit parameter up to 100[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 400 if limit > 100[39m[32m 36[2mms[22m[39m
[31m       [31m√ó[31m should filter by inspection_type=incoming[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should filter by status[39m[32m 19[2mms[22m[39m
[31m       [31m√ó[31m should filter by priority[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should filter by inspector_id[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should filter by product_id[39m[32m 15[2mms[22m[39m
[31m       [31m√ó[31m should filter by date range[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should search by inspection_number[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should sort by various fields[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for invalid filter[39m[32m 12[2mms[22m[39m
[31m       [31m√ó[31m should enforce org_id from auth[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 401 if not authenticated[39m[32m 11[2mms[22m[39m
[31m       [31m√ó[31m should return 403 if VIEWER role[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should respond <500ms for 1000 items[39m[32m 12[2mms[22m[39m
[31m       [31m√ó[31m should return 200 with inspection details[39m[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should include all inspection fields[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should include linked test results from 06.6[39m[32m 10[2mms[22m[39m
[31m       [31m√ó[31m should include test result summary[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should include can_complete flag[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should include suggested_result[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should return 404 if not found[39m[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should return 404 if different org[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 401 if not authenticated[39m[32m 21[2mms[22m[39m
[31m       [31m√ó[31m should return 403 if VIEWER without read permission[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should respond <500ms with 50 test results[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 201 with new inspection[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should generate inspection_number[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should set status to scheduled[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should set scheduled_date to today if not provided[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for missing product_id[39m[32m 9[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for missing reference (LP, GRN, PO)[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for invalid UUIDs[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for invalid priority[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should return 409 if LP has active inspection (warning, allow override)[39m[32m 18[2mms[22m[39m
[31m       [31m√ó[31m should link product[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should link LP if provided[39m[32m 19[2mms[22m[39m
[31m       [31m√ó[31m should link GRN if provided[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should link PO if provided[39m[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should link active specification if exists[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should set created_by from auth user[39m[32m 20[2mms[22m[39m
[31m       [31m√ó[31m should inherit org_id from auth user[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 401 if not authenticated[39m[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should return 403 if insufficient permissions[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should respond <300ms[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should return 200 with updated inspection[39m[32m 12[2mms[22m[39m
[31m       [31m√ó[31m should set inspector_id[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should set assigned_by to current user[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should set assigned_at to now[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should allow reassignment[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for missing inspector_id[39m[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for invalid UUID[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 400 if inspection not found[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 400 if inspection already completed[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 401 if not authenticated[39m[32m 4[2mms[22m[39m
[31m       [31m√ó[31m should return 403 if not QA_MANAGER[39m[32m 7[2mms[22m[39m
[31m       [31m√ó[31m should return 200 with updated inspection[39m[32m 20[2mms[22m[39m
[31m       [31m√ó[31m should set status to in_progress[39m[32m 21[2mms[22m[39m
[31m       [31m√ó[31m should set started_at to now[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 400 if no inspector assigned[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should allow take_over if QA_MANAGER[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should update inspector_id when taking over[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 400 if already in_progress[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 400 if already completed[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return 404 if inspection not found[39m[32m 24[2mms[22m[39m
[31m       [31m√ó[31m should return 401 if not authenticated[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 403 if not QA_INSPECTOR or QA_MANAGER[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should return 200 with completed inspection[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should set status to completed[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should set result to provided value[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should set completed_at to now[39m[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should set completed_by to current user[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should update LP qa_status on pass[39m[32m 19[2mms[22m[39m
[31m       [31m√ó[31m should update LP qa_status on fail[39m[32m 20[2mms[22m[39m
[31m       [31m√ó[31m should update LP qa_status on conditional[39m[32m 18[2mms[22m[39m
[31m       [31m√ó[31m should accept defect counts[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return 400 if missing result[39m[32m 15[2mms[22m[39m
[31m       [31m√ó[31m should return 400 if invalid result value[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 400 if conditional without reason[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 400 if conditional without restrictions[39m[32m 7[2mms[22m[39m
[31m       [31m√ó[31m should create NCR on fail if requested[39m[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should return 400 if status not in_progress[39m[32m 28[2mms[22m[39m
[31m       [31m√ó[31m should return 404 if inspection not found[39m[32m 15[2mms[22m[39m
[31m       [31m√ó[31m should return 401 if not authenticated[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 403 if not QA_INSPECTOR or QA_MANAGER[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should respond <500ms with LP update[39m[32m 22[2mms[22m[39m
[31m       [31m√ó[31m should return 200 with cancelled inspection[39m[32m 25[2mms[22m[39m
[31m       [31m√ó[31m should set status to cancelled[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for missing cancellation_reason[39m[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should return 400 if status not scheduled[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 404 if inspection not found[39m[32m 37[2mms[22m[39m
[31m       [31m√ó[31m should return 401 if not authenticated[39m[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should return 403 if not QA_MANAGER[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 200 with pending inspections[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should include scheduled and in_progress[39m[32m 21[2mms[22m[39m
[31m       [31m√ó[31m should include count by status[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should enforce org_id filter[39m[32m 27[2mms[22m[39m
[31m       [31m√ó[31m should return 401 if not authenticated[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return 200 with incoming inspections[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should filter by inspection_type=incoming[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should support pagination and filters[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should enforce org_id filter[39m[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should return 401 if not authenticated[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m VIEWER cannot create inspection[39m[32m 27[2mms[22m[39m
[31m       [31m√ó[31m VIEWER cannot assign inspector[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m VIEWER cannot start inspection[39m[32m 29[2mms[22m[39m
[31m       [31m√ó[31m VIEWER cannot complete inspection[39m[32m 24[2mms[22m[39m
[31m       [31m√ó[31m QA_INSPECTOR cannot approve conditional[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m QA_INSPECTOR cannot reassign inspection[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m QA_MANAGER has all permissions[39m[32m 37[2mms[22m[39m
[31m       [31m√ó[31m User A cannot access Org B inspections[39m[32m 23[2mms[22m[39m
[31m       [31m√ó[31m Cross-org query returns 404[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m Org_id inherited from auth user[39m[32m 25[2mms[22m[39m
[31m       [31m√ó[31m RLS blocks update of cross-org record[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m RLS blocks delete of cross-org record[39m[32m 33[2mms[22m[39m
[31m       [31m√ó[31m Create action logged with all fields[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m Assign action logged with user[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m Start action logged[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m Complete action logged with result[39m[32m 22[2mms[22m[39m
[31m       [31m√ó[31m Cancel action logged with reason[39m[32m 11[2mms[22m[39m
[31m       [31m√ó[31m Result override logged[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m Audit log includes timestamp[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m Audit log includes user_id[39m[32m 27[2mms[22m[39m
[31m       [31m√ó[31m should return 400 with validation errors[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should include field path in error[39m[32m 59[2mms[22m[39m
[31m       [31m√ó[31m should include error message[39m[32m 24[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for invalid JSON[39m[32m 33[2mms[22m[39m
[31m       [31m√ó[31m GET /inspections responds <500ms for 1000 items[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m GET /inspections/:id responds <500ms with 50 tests[39m[32m 24[2mms[22m[39m
[31m       [31m√ó[31m POST /inspections responds <300ms[39m[32m 33[2mms[22m[39m
[31m       [31m√ó[31m POST /inspections/:id/complete responds <500ms[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should integrate with LP service (Epic 05)[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should integrate with GRN service[39m[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should integrate with Quality Settings (06.0)[39m[32m 28[2mms[22m[39m
[31m       [31m√ó[31m should integrate with Product Specifications (06.3)[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should integrate with Test Results Recording (06.6)[39m[32m 40[2mms[22m[39m
[31m       [31m√ó[31m should accept test results from 06.6 for completion[39m[32m 32[2mms[22m[39m
 [31m‚ùØ[39m __tests__/api/production/output-registration.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m12 failed[39m[2m)[22m[33m 1879[2mms[22m[39m
[31m       [31m√ó[31m should return 401 for unauthenticated request[39m[33m 870[2mms[22m[39m
[31m       [31m√ó[31m should return 401 if user not found in database[39m[32m 29[2mms[22m[39m
[31m       [31m√ó[31m AC-4.12.2: should create output LP successfully[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m AC-4.12.8: should return 400 for invalid quantity[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m AC-4.12.8: should return 404 for non-existent WO[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m AC-4.12.8: should return 400 for WO not in_progress[39m[32m 1[2mms[22m[39m
       [33m[2m‚úì[22m[39m AC-4.12a.1: should return allocation preview [33m 863[2mms[22m[39m
       [32m‚úì[39m should return 400 for invalid qty in preview[32m 44[2mms[22m[39m
[31m       [31m√ó[31m AC-4.12b.9: should reject over-production without parent LP[39m[32m 34[2mms[22m[39m
[31m       [31m√ó[31m AC-4.12b.2: should accept over-production with parent LP[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m AC-4.12a.4: should return 409 for over-consumption[39m[32m 4[2mms[22m[39m
[31m       [31m√ó[31m should return list of outputs for WO[39m[32m 24[2mms[22m[39m
[31m       [31m√ó[31m should return empty array for WO with no outputs[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should not allow access to WO from different org[39m[32m 1[2mms[22m[39m
 [31m‚ùØ[39m app/api/v1/settings/onboarding/step/1/__tests__/route.test.ts [2m([22m[2m25 tests[22m[2m | [22m[31m13 failed[39m[2m)[22m[33m 823[2mms[22m[39m
       [32m‚úì[39m should return 401 when user is not authenticated[32m 145[2mms[22m[39m
       [32m‚úì[39m should return 403 when user is not admin[32m 19[2mms[22m[39m
[31m       [31m√ó[31m should allow super_admin to update organization[39m[32m 136[2mms[22m[39m
[31m       [31m√ó[31m should allow admin to update organization[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should accept valid organization profile data[39m[32m 72[2mms[22m[39m
       [32m‚úì[39m should reject empty organization name[32m 25[2mms[22m[39m
       [32m‚úì[39m should reject name with 1 character[32m 19[2mms[22m[39m
       [32m‚úì[39m should reject name with 101 characters[32m 2[2mms[22m[39m
       [32m‚úì[39m should reject invalid IANA timezone[32m 29[2mms[22m[39m
       [32m‚úì[39m should reject unsupported language[32m 44[2mms[22m[39m
       [32m‚úì[39m should reject unsupported currency[32m 34[2mms[22m[39m
       [32m‚úì[39m should reject missing required fields[32m 3[2mms[22m[39m
       [32m‚úì[39m should reject malformed JSON[32m 23[2mms[22m[39m
       [32m‚úì[39m should reject empty request body[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should update organization with all provided fields[39m[32m 52[2mms[22m[39m
[31m       [31m√ó[31m should set onboarding_step to 2 on success[39m[32m 21[2mms[22m[39m
[31m       [31m√ó[31m should set onboarding_started_at if not already set[39m[32m 27[2mms[22m[39m
[31m       [31m√ó[31m should update updated_at timestamp[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should filter by org_id from context[39m[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should return 500 when database update fails[39m[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should return success response with organization data[39m[32m 2[2mms[22m[39m
       [32m‚úì[39m should return validation errors in structured format[32m 12[2mms[22m[39m
[31m       [31m√ó[31m should handle special characters in organization name[39m[32m 38[2mms[22m[39m
[31m       [31m√ó[31m should handle all supported timezones[39m[32m 8[2mms[22m[39m
[31m       [31m√ó[31m should handle concurrent requests from same organization[39m[32m 24[2mms[22m[39m
 [31m‚ùØ[39m app/api/v1/technical/products/[id]/allergens/__tests__/route.test.ts [2m([22m[2m30 tests[22m[2m | [22m[31m26 failed[39m[2m)[22m[33m 764[2mms[22m[39m
       [32m‚úì[39m should return 401 when user is not authenticated[32m 113[2mms[22m[39m
[31m       [31m√ó[31m should allow any authenticated user to view allergens[39m[32m 116[2mms[22m[39m
[31m       [31m√ó[31m should return allergens with relation type, name, and source (AC-01)[39m[32m 4[2mms[22m[39m
[31m       [31m√ó[31m should show auto-inherited allergens with AUTO badge (AC-02)[39m[32m 46[2mms[22m[39m
[31m       [31m√ó[31m should show manual allergens with MANUAL badge (AC-03)[39m[32m 36[2mms[22m[39m
[31m       [31m√ó[31m should show empty state when no allergens declared (AC-04)[39m[32m 48[2mms[22m[39m
[31m       [31m√ó[31m should include inheritance status in response[39m[32m 26[2mms[22m[39m
[31m       [31m√ó[31m should return 404 for non-existent product[39m[32m 44[2mms[22m[39m
[31m       [31m√ó[31m should enforce RLS (cross-tenant isolation, AC-23)[39m[32m 64[2mms[22m[39m
       [32m‚úì[39m should return 500 on database error[32m 24[2mms[22m[39m
       [32m‚úì[39m should return 401 when user is not authenticated[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return 403 when VIEWER tries to add allergen (AC-22)[39m[32m 19[2mms[22m[39m
[31m       [31m√ó[31m should allow PROD_MANAGER to add allergen[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should add contains allergen with source=manual (AC-06)[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should add may_contain allergen with reason (AC-07)[39m[32m 25[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for may_contain without reason (AC-08)[39m[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for reason too short[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 409 for duplicate allergen (AC-09)[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for invalid allergen_id[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for invalid relation_type[39m[32m 20[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for missing allergen_id[39m[32m 12[2mms[22m[39m
[31m       [31m√ó[31m should return 500 on database error[39m[32m 2[2mms[22m[39m
       [32m‚úì[39m should return 401 when user is not authenticated[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 403 when VIEWER tries to remove allergen (AC-22)[39m[32m 26[2mms[22m[39m
[31m       [31m√ó[31m should allow PROD_MANAGER to remove allergen[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should remove manually added allergen (AC-10)[39m[32m 19[2mms[22m[39m
[31m       [31m√ó[31m should remove auto-inherited allergen[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should support relation_type filter query param[39m[32m 19[2mms[22m[39m
[31m       [31m√ó[31m should return 404 when allergen declaration not found[39m[32m 12[2mms[22m[39m
[31m       [31m√ó[31m should return 500 on database error[39m[32m 30[2mms[22m[39m
[90mstdout[2m | lib/services/__tests__/tax-code-service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | __tests__/services/customer-service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | app/api/v1/technical/products/[id]/versions/__tests__/route.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | lib/services/__tests__/tax-code-service.test.ts[2m > [22m[2mTaxCodeService[2m > [22m[2mcreateTaxCode()[2m > [22m[2mshould create tax code with valid data (AC-02)
[22m[39mEmitted tax_code.updated event: created tc-new

[90mstdout[2m | lib/services/__tests__/tax-code-service.test.ts[2m > [22m[2mTaxCodeService[2m > [22m[2mcreateTaxCode()[2m > [22m[2mshould create tax code with valid data (AC-02)
[22m[39mSuccessfully created tax code: VAT10 (tc-new)

[90mstdout[2m | lib/services/__tests__/tax-code-service.test.ts[2m > [22m[2mTaxCodeService[2m > [22m[2mcreateTaxCode()[2m > [22m[2mshould auto-uppercase code (AC-02)
[22m[39mEmitted tax_code.updated event: created tc-001

[90mstdout[2m | lib/services/__tests__/tax-code-service.test.ts[2m > [22m[2mTaxCodeService[2m > [22m[2mcreateTaxCode()[2m > [22m[2mshould auto-uppercase code (AC-02)
[22m[39mSuccessfully created tax code: VAT10 (tc-001)

[90mstdout[2m | lib/services/__tests__/tax-code-service.test.ts[2m > [22m[2mTaxCodeService[2m > [22m[2mupdateTaxCode()[2m > [22m[2mshould update mutable fields (AC-06)
[22m[39mEmitted tax_code.updated event: updated tc-001

[90mstdout[2m | lib/services/__tests__/tax-code-service.test.ts[2m > [22m[2mTaxCodeService[2m > [22m[2mupdateTaxCode()[2m > [22m[2mshould update mutable fields (AC-06)
[22m[39mSuccessfully updated tax code: VAT23 (tc-001)

[90mstdout[2m | lib/services/__tests__/tax-code-service.test.ts[2m > [22m[2mTaxCodeService[2m > [22m[2mupdateTaxCode()[2m > [22m[2mshould warn on rate change (AC-05)
[22m[39mEmitted tax_code.updated event: updated tc-001

[90mstdout[2m | lib/services/__tests__/tax-code-service.test.ts[2m > [22m[2mTaxCodeService[2m > [22m[2mupdateTaxCode()[2m > [22m[2mshould warn on rate change (AC-05)
[22m[39mSuccessfully updated tax code: VAT23 (tc-001)

 [31m‚ùØ[39m lib/services/__tests__/tax-code-service.test.ts [2m([22m[2m46 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 437[2mms[22m[39m
         [32m‚úì[39m should validate valid tax code input[32m 25[2mms[22m[39m
         [32m‚úì[39m should reject code with lowercase letters[32m 2[2mms[22m[39m
         [32m‚úì[39m should reject code with spaces[32m 10[2mms[22m[39m
         [32m‚úì[39m should reject code with special characters[32m 1[2mms[22m[39m
         [32m‚úì[39m should reject code shorter than 2 characters[32m 9[2mms[22m[39m
         [32m‚úì[39m should reject code longer than 20 characters[32m 1[2mms[22m[39m
         [32m‚úì[39m should accept code with hyphens[32m 0[2mms[22m[39m
         [32m‚úì[39m should validate rate is between 0 and 100 (AC-03)[32m 11[2mms[22m[39m
         [32m‚úì[39m should reject negative rate (AC-03)[32m 1[2mms[22m[39m
         [32m‚úì[39m should allow 0% rate (exempt) (AC-03)[32m 16[2mms[22m[39m
         [32m‚úì[39m should validate rate has at most 2 decimal places[32m 1[2mms[22m[39m
         [32m‚úì[39m should reject country code with lowercase[32m 9[2mms[22m[39m
         [32m‚úì[39m should reject country code with more than 2 characters[32m 1[2mms[22m[39m
         [32m‚úì[39m should validate date format (YYYY-MM-DD)[32m 0[2mms[22m[39m
         [32m‚úì[39m should validate valid_to is after valid_from (AC-04)[32m 0[2mms[22m[39m
         [32m‚úì[39m should allow null valid_to (no expiry)[32m 9[2mms[22m[39m
         [32m‚úì[39m should allow omitted valid_to[32m 0[2mms[22m[39m
         [32m‚úì[39m should allow partial updates[32m 9[2mms[22m[39m
         [32m‚úì[39m should validate rate on partial update[32m 1[2mms[22m[39m
         [32m‚úì[39m should validate date range when both dates provided[32m 9[2mms[22m[39m
[31m       [31m√ó[31m should return org-scoped tax codes (AC-09)[39m[32m 51[2mms[22m[39m
[31m       [31m√ó[31m should filter by search query (code or name) (AC-01)[39m[32m 7[2mms[22m[39m
       [32m‚úì[39m should return error when org_id not found[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should handle database query failure[39m[32m 36[2mms[22m[39m
       [32m‚úì[39m should sort by code ascending by default[32m 52[2mms[22m[39m
       [32m‚úì[39m should create tax code with valid data (AC-02)[32m 13[2mms[22m[39m
       [32m‚úì[39m should auto-uppercase code (AC-02)[32m 5[2mms[22m[39m
       [32m‚úì[39m should reject duplicate code (AC-02)[32m 12[2mms[22m[39m
       [32m‚úì[39m should return error when org_id not found[32m 10[2mms[22m[39m
       [32m‚úì[39m should update mutable fields (AC-06)[32m 11[2mms[22m[39m
       [32m‚úì[39m should return NOT_FOUND for non-existent tax code[32m 2[2mms[22m[39m
       [32m‚úì[39m should warn on rate change (AC-05)[32m 19[2mms[22m[39m
[31m       [31m√ó[31m should delete tax code with no references (AC-07)[39m[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should return IN_USE error for referenced tax code (AC-07)[39m[32m 25[2mms[22m[39m
       [32m‚úì[39m should return error when org_id not found[32m 1[2mms[22m[39m
       [32m‚úì[39m should identify active tax code (valid_from <= today <= valid_to)[32m 5[2mms[22m[39m
       [32m‚úì[39m should identify expired tax code (valid_to < today)[32m 4[2mms[22m[39m
       [32m‚úì[39m should identify scheduled tax code (valid_from > today)[32m 9[2mms[22m[39m
       [32m‚úì[39m should treat null valid_to as indefinitely active[32m 1[2mms[22m[39m
       [32m‚úì[39m should filter by org_id in all queries[32m 8[2mms[22m[39m
       [32m‚úì[39m should handle empty tax codes list[32m 10[2mms[22m[39m
       [32m‚úì[39m should handle database connection failure[32m 10[2mms[22m[39m
     [32m‚úì[39m should accept valid codes[32m 0[2mms[22m[39m
     [32m‚úì[39m should reject invalid codes[32m 0[2mms[22m[39m
     [32m‚úì[39m should accept valid country codes[32m 0[2mms[22m[39m
     [32m‚úì[39m should reject invalid country codes[32m 0[2mms[22m[39m
[90mstdout[2m | lib/validation/__tests__/supplier-schema.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üì° add observability to secrets: https://dotenvx.com/ops

 [31m‚ùØ[39m __tests__/services/customer-service.test.ts [2m([22m[2m46 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 449[2mms[22m[39m
       [32m‚úì[39m should create customer with required fields[32m 22[2mms[22m[39m
       [32m‚úì[39m should normalize customer_code to uppercase[32m 14[2mms[22m[39m
       [32m‚úì[39m should validate customer_code format - reject special chars[32m 16[2mms[22m[39m
       [32m‚úì[39m should reject duplicate customer_code per org[32m 1[2mms[22m[39m
       [32m‚úì[39m should encrypt tax_id field[32m 1[2mms[22m[39m
       [32m‚úì[39m should validate allergen IDs exist[32m 1[2mms[22m[39m
       [32m‚úì[39m should validate payment_terms_days range (1-365)[32m 0[2mms[22m[39m
       [32m‚úì[39m should allow empty allergen_restrictions[32m 8[2mms[22m[39m
       [32m‚úì[39m should validate credit_limit is positive[32m 9[2mms[22m[39m
       [32m‚úì[39m should reject max allergens > 20[32m 1[2mms[22m[39m
       [32m‚úì[39m should update name only[32m 10[2mms[22m[39m
       [32m‚úì[39m should prevent customer_code change[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should update allergen_restrictions with validation[39m[32m 41[2mms[22m[39m
       [32m‚úì[39m should not allow archiving customer with open orders[32m 1[2mms[22m[39m
       [32m‚úì[39m should update updated_at timestamp[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should return 404 for non-existent customer[39m[32m 40[2mms[22m[39m
       [32m‚úì[39m should archive customer (is_active = false)[32m 4[2mms[22m[39m
       [32m‚úì[39m should prevent delete if open orders exist[32m 12[2mms[22m[39m
       [32m‚úì[39m should preserve allergen history after archive[32m 2[2mms[22m[39m
       [32m‚úì[39m should return paginated list[32m 6[2mms[22m[39m
       [32m‚úì[39m should filter by category[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should search by customer_code case-insensitive[39m[32m 20[2mms[22m[39m
       [32m‚úì[39m should filter by is_active[32m 10[2mms[22m[39m
[31m       [31m√ó[31m should return customer with nested contacts and addresses[39m[32m 10[2mms[22m[39m
       [32m‚úì[39m should return null for cross-tenant access[32m 12[2mms[22m[39m
       [32m‚úì[39m should create contact with name only[32m 12[2mms[22m[39m
       [32m‚úì[39m should validate email format if provided[32m 1[2mms[22m[39m
       [32m‚úì[39m should prevent duplicate emails per customer[32m 10[2mms[22m[39m
       [32m‚úì[39m should allow null email[32m 1[2mms[22m[39m
       [32m‚úì[39m should update contact title[32m 14[2mms[22m[39m
       [32m‚úì[39m should set is_primary contact[32m 2[2mms[22m[39m
       [32m‚úì[39m should delete contact (hard delete)[32m 13[2mms[22m[39m
       [32m‚úì[39m should create shipping address[32m 12[2mms[22m[39m
       [32m‚úì[39m should create billing address[32m 2[2mms[22m[39m
       [32m‚úì[39m should validate postal_code not empty[32m 12[2mms[22m[39m
       [32m‚úì[39m should parse dock_hours JSON[32m 17[2mms[22m[39m
       [32m‚úì[39m should set address as default for type[32m 10[2mms[22m[39m
       [32m‚úì[39m should update city[32m 1[2mms[22m[39m
       [32m‚úì[39m should delete address (hard delete)[32m 16[2mms[22m[39m
       [32m‚úì[39m should require at least one address[32m 11[2mms[22m[39m
       [32m‚úì[39m should mark address as default for its type[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should unset other defaults of same type[39m[32m 12[2mms[22m[39m
       [32m‚úì[39m should validate allergen UUIDs against allergens table[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should store allergen array as JSONB[39m[32m 2[2mms[22m[39m
       [32m‚úì[39m should support max 20 allergens per customer[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should allow empty allergen restrictions[39m[32m 2[2mms[22m[39m
[90mstdout[2m | __tests__/components/production/dashboard/ActiveWOsTable.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | __tests__/integration/api/production/dashboard.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

 [31m‚ùØ[39m app/api/v1/technical/products/[id]/versions/__tests__/route.test.ts [2m([22m[2m16 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[33m 337[2mms[22m[39m
       [32m‚úì[39m should return 401 when user is not authenticated[32m 56[2mms[22m[39m
       [32m‚úì[39m should return 401 when auth token is invalid[32m 11[2mms[22m[39m
[31m       [31m√ó[31m should return 404 when product does not exist[39m[32m 87[2mms[22m[39m
[31m       [31m√ó[31m should return 404 when product belongs to different org (RLS) (AC-23)[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return versions in descending order[39m[32m 30[2mms[22m[39m
[31m       [31m√ó[31m should format user names correctly[39m[32m 21[2mms[22m[39m
[31m       [31m√ó[31m should return empty list when product has no versions[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should paginate with default values (page=1, limit=20)[39m[32m 15[2mms[22m[39m
       [32m‚úì[39m should paginate with custom page and limit[32m 13[2mms[22m[39m
       [32m‚úì[39m should return has_more=true when more versions exist[32m 7[2mms[22m[39m
       [32m‚úì[39m should return has_more=false on last page[32m 6[2mms[22m[39m
       [32m‚úì[39m should validate page parameter (min 1)[32m 1[2mms[22m[39m
       [32m‚úì[39m should validate limit parameter (max 100)[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should return correct response structure[39m[32m 22[2mms[22m[39m
[31m       [31m√ó[31m should return 500 when database query fails[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should only return versions for products in user org[39m[32m 20[2mms[22m[39m
 [31m‚ùØ[39m __tests__/components/production/dashboard/ActiveWOsTable.test.tsx [2m([22m[2m40 tests[22m[2m | [22m[31m40 failed[39m[2m)[22m[32m 289[2mms[22m[39m
[31m       [31m√ó[31m should display all column headers[39m[32m 75[2mms[22m[39m
[31m       [31m√ó[31m should display all WO rows[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should display product name[39m[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should display status badge with correct color[39m[32m 21[2mms[22m[39m
[31m       [31m√ó[31m should display planned and actual quantities[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should display progress bar with percentage[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should cap progress bar at 100% for over-production[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should display line name[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should format started_at as "MMM DD, HH:mm"[39m[32m 10[2mms[22m[39m
[31m       [31m√ó[31m should display empty state when no WOs[39m[32m 8[2mms[22m[39m
[31m       [31m√ó[31m should display "Start WO" button in empty state[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should show table headers in empty state[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should display line filter dropdown[39m[32m 10[2mms[22m[39m
[31m       [31m√ó[31m should filter WOs when line selected[39m[32m 8[2mms[22m[39m
[31m       [31m√ó[31m should display filter badge when line selected[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should clear filter when X clicked on filter badge[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should display product filter dropdown[39m[32m 9[2mms[22m[39m
[31m       [31m√ó[31m should filter WOs when product selected[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should support multiple filters simultaneously[39m[32m 12[2mms[22m[39m
[31m       [31m√ó[31m should sort by Started At DESC on first click[39m[32m 6[2mms[22m[39m
[31m       [31m√ó[31m should toggle to ASC on second click[39m[32m 4[2mms[22m[39m
[31m       [31m√ó[31m should display sort indicator arrow[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should be sortable by all columns[39m[32m 19[2mms[22m[39m
[31m       [31m√ó[31m should expand row on click[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should show Materials list in expanded row[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should show Operations status in expanded row[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should show "View Full Details" button in expanded row[39m[32m 15[2mms[22m[39m
[31m       [31m√ó[31m should navigate to execution page on "View Full Details" click[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should collapse row on second click[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should display loading skeleton when loading[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should display multiple skeleton rows[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should display pagination controls[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should call onPageChange when next clicked[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should disable Previous on first page[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should disable Next on last page[39m[32m 15[2mms[22m[39m
[31m       [31m√ó[31m should preserve filters during refresh[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should preserve sort order during refresh[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should preserve expanded row during refresh[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should have accessible table structure[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should have aria-sort attribute on sorted column[39m[32m 1[2mms[22m[39m
 [31m‚ùØ[39m lib/validation/__tests__/supplier-schema.test.ts [2m([22m[2m65 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 415[2mms[22m[39m
       [32m‚úì[39m should accept valid supplier data with all required fields[32m 4[2mms[22m[39m
       [32m‚úì[39m should accept supplier with minimum required fields only (AC-03)[32m 2[2mms[22m[39m
       [32m‚úì[39m should accept supplier with all optional fields[32m 14[2mms[22m[39m
       [32m‚úì[39m should accept supplier with optional fields as empty strings (transforms to null)[32m 12[2mms[22m[39m
       [32m‚úì[39m should accept supplier with is_active=false[32m 22[2mms[22m[39m
       [32m‚úì[39m should default is_active to true when not provided[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept valid code: SUP-001[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept valid code with minimum 2 characters[32m 15[2mms[22m[39m
       [32m‚úì[39m should accept valid code with maximum 20 characters[32m 1[2mms[22m[39m
       [32m‚úì[39m should accept code with numbers[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept code with hyphens[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject empty code[32m 10[2mms[22m[39m
       [32m‚úì[39m should reject code with less than 2 characters[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject code with more than 20 characters[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject code with lowercase letters[32m 16[2mms[22m[39m
       [32m‚úì[39m should reject code with special characters (@, !, #, etc)[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject code with spaces[32m 15[2mms[22m[39m
       [32m‚úì[39m should accept valid name with 2 characters minimum[32m 4[2mms[22m[39m
       [32m‚úì[39m should accept valid name with 100 characters maximum[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept name with special characters and spaces[32m 18[2mms[22m[39m
       [32m‚úì[39m should reject empty name[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject name with less than 2 characters[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject name with more than 100 characters[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept valid email format[32m 28[2mms[22m[39m
       [32m‚úì[39m should accept email with subdomain[32m 1[2mms[22m[39m
       [32m‚úì[39m should accept empty contact_email (optional field)[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject invalid email format[32m 17[2mms[22m[39m
       [32m‚úì[39m should accept all supported currencies (PLN, EUR, USD, GBP)[32m 18[2mms[22m[39m
       [32m‚úì[39m should reject unsupported currency[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject lowercase currency[32m 1[2mms[22m[39m
       [32m‚úì[39m should accept valid UUID for tax_code_id[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject invalid UUID format[32m 17[2mms[22m[39m
       [32m‚úì[39m should reject empty tax_code_id[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept valid payment terms[32m 16[2mms[22m[39m
       [32m‚úì[39m should reject empty payment_terms[32m 1[2mms[22m[39m
       [32m‚úì[39m should accept payment_terms with maximum 100 characters[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject payment_terms with more than 100 characters[32m 24[2mms[22m[39m
       [32m‚úì[39m should accept contact_name with valid length (max 100)[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject contact_name exceeding 100 characters[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept contact_phone with valid format (max 50)[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept address with valid length (max 200)[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept country as ISO 3166-1 alpha-2 code (exactly 2 chars)[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject country code that is not exactly 2 characters[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept notes with valid length (max 1000)[32m 13[2mms[22m[39m
       [32m‚úì[39m should reject notes with more than 1000 characters[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject missing code field[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject missing name field[32m 13[2mms[22m[39m
       [32m‚úì[39m should reject missing currency field[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject missing tax_code_id field[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject missing payment_terms field[32m 0[2mms[22m[39m
       [32m‚úì[39m should allow partial updates[32m 0[2mms[22m[39m
       [32m‚úì[39m should allow updating single field[32m 0[2mms[22m[39m
       [32m‚úì[39m should still validate field constraints on update[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept valid supplier_ids array[32m 1[2mms[22m[39m
       [32m‚úì[39m should accept optional reason[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject empty supplier_ids array[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject invalid UUIDs in array[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept valid supplier_ids array[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject empty array[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept valid export options[32m 0[2mms[22m[39m
       [32m‚úì[39m should default to empty array for supplier_ids[32m 3[2mms[22m[39m
       [32m‚úì[39m should accept valid query params[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should apply defaults[39m[32m 58[2mms[22m[39m
       [32m‚úì[39m should reject invalid status[32m 0[2mms[22m[39m
       [32m‚úì[39m should cap limit at 100[32m 0[2mms[22m[39m
[90mstdout[2m | __tests__/api/technical/routings.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

 [31m‚ùØ[39m __tests__/integration/api/production/dashboard.test.ts [2m([22m[2m37 tests[22m[2m | [22m[31m37 failed[39m[2m)[22m[33m 372[2mms[22m[39m
[31m       [31m√ó[31m should return 401 for unauthenticated request to /kpis[39m[32m 109[2mms[22m[39m
[31m       [31m√ó[31m should return 401 for unauthenticated request to /active-wos[39m[32m 7[2mms[22m[39m
[31m       [31m√ó[31m should return 401 for unauthenticated request to /alerts[39m[32m 8[2mms[22m[39m
[31m       [31m√ó[31m should return 401 for unauthenticated request to /export[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return all 6 KPI values[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m AC-23: should respond within 500ms[39m[32m 7[2mms[22m[39m
[31m       [31m√ó[31m should return JSON content type[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should cache response for 30 seconds[39m[32m 12[2mms[22m[39m
[31m       [31m√ó[31m should return paginated list of active WOs[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should support line filter[39m[32m 7[2mms[22m[39m
[31m       [31m√ó[31m should support product filter[39m[32m 4[2mms[22m[39m
[31m       [31m√ó[31m should support pagination parameters[39m[32m 15[2mms[22m[39m
[31m       [31m√ó[31m should cap limit at 100[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m AC-24: should respond within 1 second[39m[32m 21[2mms[22m[39m
[31m       [31m√ó[31m should return WO fields: id, wo_number, product_name, status, planned_qty, actual_qty, progress_percent, line_name, started_at[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return material shortages and delayed WOs[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should include material shortage details[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should include delayed WO details[39m[32m 18[2mms[22m[39m
[31m       [31m√ó[31m should return empty arrays when no alerts[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return CSV file[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should set correct filename header[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should apply line filter to export[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should apply product filter to export[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should include CSV headers[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should allow production_manager to access dashboard[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should allow operator to access dashboard[39m[32m 18[2mms[22m[39m
[31m       [31m√ó[31m should allow admin to access dashboard[39m[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should filter KPIs by org_id[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should filter active WOs by org_id[39m[32m 20[2mms[22m[39m
[31m       [31m√ó[31m should filter alerts by org_id[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return 500 on service error for /kpis[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 500 on service error for /active-wos[39m[32m 20[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for invalid pagination params[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should validate line filter as UUID[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should validate product filter as UUID[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should validate page as positive integer[39m[32m 18[2mms[22m[39m
[31m       [31m√ó[31m should validate limit as positive integer[39m[32m 1[2mms[22m[39m
 [31m‚ùØ[39m __tests__/api/technical/routings.test.ts [2m([22m[2m21 tests[22m[2m | [22m[31m13 failed[39m[2m)[22m[33m 726[2mms[22m[39m
       [32m‚úì[39m should return routings list for authenticated user[32m 158[2mms[22m[39m
[31m       [31m√ó[31m should filter routings by status (AC-015.3)[39m[32m 213[2mms[22m[39m
[31m       [31m√ó[31m should filter routings by search term (AC-015.3)[39m[32m 29[2mms[22m[39m
[31m       [31m√ó[31m should support sorting by code ascending[39m[32m 26[2mms[22m[39m
[31m       [31m√ó[31m should support sorting by name descending[39m[32m 59[2mms[22m[39m
       [32m‚úì[39m should return 401 if user is not authenticated[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should return 404 if user not found in database[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for invalid filter parameters[39m[32m 2[2mms[22m[39m
       [32m‚úì[39m should return 500 if service fails[32m 1[2mms[22m[39m
       [32m‚úì[39m should allow operator role to view routings (read-only)[32m 20[2mms[22m[39m
[31m       [31m√ó[31m should create routing with valid data[39m[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should create routing with all optional fields[39m[32m 36[2mms[22m[39m
       [32m‚úì[39m should return 403 for non-admin/technical users (AC-015.5)[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should allow technical role to create routing[39m[32m 20[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for invalid request body[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for invalid code format[39m[32m 20[2mms[22m[39m
[31m       [31m√ó[31m should return 409 for duplicate routing code[39m[32m 2[2mms[22m[39m
       [32m‚úì[39m should return 401 if not authenticated[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should transform code to uppercase[39m[32m 24[2mms[22m[39m
       [32m‚úì[39m should document RLS policy enforcement for routings[32m 0[2mms[22m[39m
       [32m‚úì[39m should pass org_id filter to service[32m 17[2mms[22m[39m
[90mstdout[2m | __tests__/api/technical/product-types.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | app/api/v1/technical/boms/[id]/allergens/__tests__/route.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | __tests__/api/technical/boms.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

 [31m‚ùØ[39m __tests__/api/technical/product-types.test.ts [2m([22m[2m15 tests[22m[2m | [22m[31m15 failed[39m[2m)[22m[33m 437[2mms[22m[39m
[31m       [31m√ó[31m should return default types + custom types[39m[32m 146[2mms[22m[39m
[31m       [31m√ó[31m should mark default types as non-editable[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should filter by active status[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should return 401 if not authenticated[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should create custom type with valid data[39m[32m 27[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for duplicate code[39m[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for reserved default codes (AC-2.5.3)[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should enforce uppercase code format[39m[32m 26[2mms[22m[39m
[31m       [31m√ó[31m should enforce code length 2-10 chars[39m[32m 32[2mms[22m[39m
[31m       [31m√ó[31m should update custom type name[39m[32m 25[2mms[22m[39m
[31m       [31m√ó[31m should return 400 when trying to edit default type[39m[32m 25[2mms[22m[39m
[31m       [31m√ó[31m should return 404 if type not found[39m[32m 28[2mms[22m[39m
[31m       [31m√ó[31m should delete custom type with no products[39m[32m 33[2mms[22m[39m
[31m       [31m√ó[31m should return 400 when trying to delete default type[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should return 404 if type not found[39m[32m 18[2mms[22m[39m
 [31m‚ùØ[39m app/api/v1/technical/boms/[id]/allergens/__tests__/route.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m13 failed[39m[2m)[22m[33m 301[2mms[22m[39m
       [32m‚úì[39m should return 401 when user is not authenticated[32m 46[2mms[22m[39m
[31m       [31m√ó[31m should return 403 when VIEWER tries to recalculate (AC-22)[39m[32m 74[2mms[22m[39m
[31m       [31m√ó[31m should allow PROD_MANAGER to recalculate allergens[39m[32m 31[2mms[22m[39m
[31m       [31m√ó[31m should recalculate allergens from BOM ingredients (AC-12)[39m[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should inherit Gluten from Wheat Flour (AC-13)[39m[32m 18[2mms[22m[39m
[31m       [31m√ó[31m should preserve manual allergens during recalculation (AC-14)[39m[32m 8[2mms[22m[39m
[31m       [31m√ó[31m should aggregate same allergen from multiple ingredients[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should remove stale auto-inherited allergens[39m[32m 32[2mms[22m[39m
[31m       [31m√ó[31m should only inherit contains allergens (not may_contain)[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should include BOM version in response[39m[32m 9[2mms[22m[39m
[31m       [31m√ó[31m should return 404 when BOM not found[39m[32m 5[2mms[22m[39m
[31m       [31m√ó[31m should return 422 when BOM ingredients have no allergen data[39m[32m 6[2mms[22m[39m
[31m       [31m√ó[31m should return 500 on database error[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should handle BOM with no ingredients (empty BOM)[39m[32m 1[2mms[22m[39m
[90mstdout[2m | lib/validation/__tests__/organization-profile-step.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

[90mstdout[2m | __tests__/01-settings/01.7.module-toggles.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | lib/validation/__tests__/lp-status-schemas.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

 [31m‚ùØ[39m lib/validation/__tests__/organization-profile-step.test.ts [2m([22m[2m32 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[33m 428[2mms[22m[39m
[31m       [31m√ó[31m should accept valid organization profile data[39m[32m 153[2mms[22m[39m
[31m       [31m√ó[31m should accept all supported languages (pl, en, de, fr)[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should accept all supported currencies (PLN, EUR, USD, GBP)[39m[32m 27[2mms[22m[39m
[31m       [31m√ó[31m should accept valid IANA timezones[39m[32m 20[2mms[22m[39m
[31m       [31m√ó[31m should accept org name with exactly 2 characters (min boundary)[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should accept org name with exactly 100 characters (max boundary)[39m[32m 11[2mms[22m[39m
[31m       [31m√ó[31m should accept org name with special characters and numbers[39m[32m 2[2mms[22m[39m
       [32m‚úì[39m should reject empty organization name[32m 17[2mms[22m[39m
       [32m‚úì[39m should reject org name with 1 character[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject org name with 101 characters[32m 23[2mms[22m[39m
       [32m‚úì[39m should reject missing name field[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject whitespace-only name[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject invalid IANA timezone[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject missing timezone field[32m 11[2mms[22m[39m
       [32m‚úì[39m should reject empty timezone[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject timezone with wrong format (not IANA)[32m 45[2mms[22m[39m
       [32m‚úì[39m should reject unsupported language code[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject missing language field[32m 20[2mms[22m[39m
       [32m‚úì[39m should reject empty language[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject uppercase language codes[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject invalid language format[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject unsupported currency code[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject missing currency field[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject empty currency[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject lowercase currency codes[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject invalid currency codes[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should correctly infer OrganizationProfileStepData type[39m[32m 8[2mms[22m[39m
[31m       [31m√ó[31m should have correct type for all fields[39m[32m 19[2mms[22m[39m
       [32m‚úì[39m should reject null values[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject undefined values[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject numeric values instead of strings[32m 1[2mms[22m[39m
       [32m‚úì[39m should handle completely empty object[32m 1[2mms[22m[39m
 [31m‚ùØ[39m __tests__/api/technical/boms.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 485[2mms[22m[39m
       [32m‚úì[39m should return BOMs list for authenticated user[32m 118[2mms[22m[39m
       [32m‚úì[39m should filter by product_id[32m 41[2mms[22m[39m
       [32m‚úì[39m should filter by status[32m 38[2mms[22m[39m
       [32m‚úì[39m should filter by search term[32m 1[2mms[22m[39m
       [32m‚úì[39m should support pagination with limit and offset[32m 21[2mms[22m[39m
       [32m‚úì[39m should return 401 if not authenticated[32m 15[2mms[22m[39m
       [32m‚úì[39m should return 404 if user not found[32m 59[2mms[22m[39m
[31m       [31m√ó[31m should create BOM with valid data and auto-assign version[39m[32m 96[2mms[22m[39m
       [32m‚úì[39m should return 403 for non-admin/technical users[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for invalid request data[39m[32m 25[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for date overlap error (AC-2.8)[39m[32m 23[2mms[22m[39m
       [32m‚úì[39m should return 401 if not authenticated[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should accept technical role[39m[32m 26[2mms[22m[39m
       [32m‚úì[39m should document RLS policy enforcement for BOMs[32m 0[2mms[22m[39m
 [31m‚ùØ[39m lib/validation/__tests__/lp-status-schemas.test.ts [2m([22m[2m39 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 335[2mms[22m[39m
       [32m‚úì[39m should accept all valid LP status values[32m 32[2mms[22m[39m
       [32m‚úì[39m should reject invalid LP status values[32m 10[2mms[22m[39m
       [32m‚úì[39m should accept all valid QA status values[32m 15[2mms[22m[39m
       [32m‚úì[39m should reject invalid QA status values[32m 20[2mms[22m[39m
       [32m‚úì[39m should accept valid status update[32m 19[2mms[22m[39m
       [32m‚úì[39m should accept all valid status values[32m 1[2mms[22m[39m
       [32m‚úì[39m should accept optional reason[32m 14[2mms[22m[39m
       [32m‚úì[39m should accept reason with status change[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject invalid status value[32m 14[2mms[22m[39m
       [32m‚úì[39m should reject reason too long[32m 1[2mms[22m[39m
       [32m‚úì[39m should require status field[32m 12[2mms[22m[39m
       [32m‚úì[39m should accept valid QA status update with reason[32m 1[2mms[22m[39m
       [32m‚úì[39m should accept all valid QA status values[32m 12[2mms[22m[39m
       [32m‚úì[39m should require reason for failed status[32m 1[2mms[22m[39m
       [32m‚úì[39m should require reason for quarantine status[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept reason for passed status (optional)[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept reason for pending status (optional)[32m 0[2mms[22m[39m
       [32m‚úì[39m should enforce minimum reason length for failed[32m 0[2mms[22m[39m
       [32m‚úì[39m should enforce minimum reason length for quarantine[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject reason too long[32m 0[2mms[22m[39m
       [32m‚úì[39m should require qa_status field[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept valid block reason[32m 18[2mms[22m[39m
       [32m‚úì[39m should require reason field[32m 1[2mms[22m[39m
       [32m‚úì[39m should enforce minimum reason length (10 characters)[32m 1[2mms[22m[39m
       [32m‚úì[39m should accept reason exactly 10 characters[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should accept reason longer than 10 characters[39m[32m 102[2mms[22m[39m
       [32m‚úì[39m should reject reason too long[32m 21[2mms[22m[39m
       [32m‚úì[39m should reject empty string[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject null reason[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept optional reason[32m 16[2mms[22m[39m
       [32m‚úì[39m should accept empty object (no reason)[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept null reason[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject reason too long[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept reason up to 500 characters[32m 17[2mms[22m[39m
       [32m‚úì[39m should accept valid LP ID[32m 0[2mms[22m[39m
       [32m‚úì[39m should require lp_id field[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject invalid UUID format[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject empty string[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject null value[32m 0[2mms[22m[39m
[90mstdout[2m | app/api/warehouse/asns/[id]/receive/__tests__/route.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | app/api/v1/technical/products/[id]/history/__tests__/route.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

 [31m‚ùØ[39m app/api/warehouse/asns/[id]/receive/__tests__/route.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m15 failed[39m[2m)[22m[33m 488[2mms[22m[39m
[31m       [31m√ó[31m should return ASN receive preview for valid ASN[39m[32m 172[2mms[22m[39m
[31m       [31m√ó[31m should return 404 for non-existent ASN[39m[32m 15[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for already received ASN[39m[32m 19[2mms[22m[39m
       [32m‚úì[39m should return 401 for unauthenticated request[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should enforce RLS (cross-tenant access returns 404)[39m[32m 38[2mms[22m[39m
[31m       [31m√ó[31m should return preview in < 300ms[39m[32m 15[2mms[22m[39m
[31m       [31m√ó[31m should create GRN and LPs for full receive[39m[32m 33[2mms[22m[39m
[31m       [31m√ó[31m should handle partial receive and set ASN status to partial[39m[32m 11[2mms[22m[39m
[31m       [31m√ó[31m should track variance with reason and notes[39m[32m 18[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for over-receipt exceeding tolerance[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should return 400 if batch_number missing when required[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should return 400 if expiry_date missing when required[39m[32m 19[2mms[22m[39m
[31m       [31m√ó[31m should validate request body with Zod schema[39m[32m 18[2mms[22m[39m
       [32m‚úì[39m should return 401 for unauthenticated request[32m 15[2mms[22m[39m
[31m       [31m√ó[31m should enforce RLS (cross-tenant access blocked)[39m[32m 25[2mms[22m[39m
[31m       [31m√ó[31m should complete receive in < 500ms for small ASN[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should handle large ASN (50 items) in < 2 seconds[39m[32m 2[2mms[22m[39m
[90mstdout[2m | lib/services/__tests__/org-context-service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

 [31m‚ùØ[39m app/api/v1/technical/products/[id]/history/__tests__/route.test.ts [2m([22m[2m19 tests[22m[2m | [22m[31m17 failed[39m[2m)[22m[33m 517[2mms[22m[39m
       [32m‚úì[39m should return 401 when user is not authenticated[32m 84[2mms[22m[39m
[31m       [31m√ó[31m should return 404 when product does not exist[39m[32m 103[2mms[22m[39m
[31m       [31m√ó[31m should return 404 when product belongs to different org (RLS)[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should return detailed history with changed_fields[39m[32m 41[2mms[22m[39m
[31m       [31m√ó[31m should include user details in changed_by field[39m[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should return history in descending version order[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should mark version 1 with is_initial=true[39m[32m 41[2mms[22m[39m
[31m       [31m√ó[31m should mark subsequent versions with is_initial=false[39m[32m 27[2mms[22m[39m
[31m       [31m√ó[31m should filter by from_date[39m[32m 21[2mms[22m[39m
[31m       [31m√ó[31m should filter by to_date[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should filter by both from_date and to_date[39m[32m 24[2mms[22m[39m
[31m       [31m√ó[31m should validate from_date is before to_date[39m[32m 35[2mms[22m[39m
       [32m‚úì[39m should validate date format[32m 22[2mms[22m[39m
[31m       [31m√ó[31m should paginate with default values (page=1, limit=20)[39m[32m 18[2mms[22m[39m
[31m       [31m√ó[31m should paginate with custom page and limit[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return has_more=true when more history exists[39m[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should return has_more=false on last page[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return correct response structure[39m[32m 38[2mms[22m[39m
[31m       [31m√ó[31m should return 500 when database query fails[39m[32m 1[2mms[22m[39m
[90mstdout[2m | lib/services/__tests__/module-settings-service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

 [31m‚ùØ[39m lib/services/__tests__/module-settings-service.test.ts [2m([22m[2m39 tests[22m[2m | [22m[31m10 failed[39m[2m)[22m[33m 473[2mms[22m[39m
[31m     [31m√ó[31m should return all 7 modules with enabled status[39m[32m 50[2mms[22m[39m
[31m     [31m√ó[31m should include org-specific enabled state for each module[39m[32m 16[2mms[22m[39m
[31m     [31m√ó[31m should compute dependents array for each module[39m[32m 19[2mms[22m[39m
     [32m‚úì[39m should throw error if org_id is invalid[32m 46[2mms[22m[39m
     [32m‚úì[39m should throw error if database query fails[32m 1[2mms[22m[39m
     [32m‚úì[39m should return valid when enabling module with no dependencies[32m 1[2mms[22m[39m
     [32m‚úì[39m should return invalid when enabling planning without technical[32m 21[2mms[22m[39m
     [32m‚úì[39m should return invalid when enabling production without technical and planning[32m 1[2mms[22m[39m
     [32m‚úì[39m should return valid when enabling production with technical and planning enabled[32m 0[2mms[22m[39m
     [32m‚úì[39m should return invalid when disabling technical with planning enabled[32m 12[2mms[22m[39m
     [32m‚úì[39m should return invalid when disabling warehouse with shipping enabled[32m 1[2mms[22m[39m
     [32m‚úì[39m should return valid when disabling module with no active dependents[32m 0[2mms[22m[39m
     [32m‚úì[39m should find all modules that depend on technical[32m 2[2mms[22m[39m
     [32m‚úì[39m should find modules that depend on planning[32m 0[2mms[22m[39m
     [32m‚úì[39m should find modules that depend on production[32m 0[2mms[22m[39m
     [32m‚úì[39m should find modules that depend on warehouse[32m 0[2mms[22m[39m
     [32m‚úì[39m should return empty array for modules with no dependents[32m 0[2mms[22m[39m
     [32m‚úì[39m should return empty array for shipping (no dependents)[32m 0[2mms[22m[39m
     [32m‚úì[39m should enable technical when enabling planning[32m 14[2mms[22m[39m
     [32m‚úì[39m should enable technical and planning when enabling production[32m 1[2mms[22m[39m
     [32m‚úì[39m should enable full dependency chain for quality[32m 1[2mms[22m[39m
     [32m‚úì[39m should enable technical and warehouse when enabling shipping[32m 1[2mms[22m[39m
     [32m‚úì[39m should only enable target module when no dependencies exist[32m 23[2mms[22m[39m
     [32m‚úì[39m should throw error if database upsert fails[32m 1[2mms[22m[39m
     [32m‚úì[39m should disable technical and planning when disabling technical[32m 25[2mms[22m[39m
     [32m‚úì[39m should disable full chain when disabling technical with all dependents enabled[32m 1[2mms[22m[39m
     [32m‚úì[39m should disable production and quality when disabling production[32m 1[2mms[22m[39m
     [32m‚úì[39m should disable warehouse and shipping when disabling warehouse[32m 0[2mms[22m[39m
     [32m‚úì[39m should only disable target module when no dependents are enabled[32m 0[2mms[22m[39m
[31m     [31m√ó[31m should return true when module is enabled[39m[32m 14[2mms[22m[39m
[31m     [31m√ó[31m should return false when module is disabled[39m[32m 19[2mms[22m[39m
[31m     [31m√ó[31m should return false when module record does not exist[39m[32m 1[2mms[22m[39m
[31m     [31m√ó[31m should always return true for settings module[39m[32m 16[2mms[22m[39m
     [32m‚úì[39m should throw error if org_id is invalid[32m 1[2mms[22m[39m
[31m     [31m√ó[31m should enable technical module successfully[39m[32m 1[2mms[22m[39m
[31m     [31m√ó[31m should disable warehouse module successfully[39m[32m 0[2mms[22m[39m
[31m     [31m√ó[31m should throw error when trying to disable settings module[39m[32m 105[2mms[22m[39m
     [32m‚úì[39m should throw error if module_id is invalid[32m 31[2mms[22m[39m
     [32m‚úì[39m should throw error if org_id is invalid[32m 1[2mms[22m[39m
[90mstdout[2m | __tests__/components/production/work-orders/StartWorkOrderButton.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

 [31m‚ùØ[39m lib/services/__tests__/org-context-service.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m16 failed[39m[2m)[22m[33m 431[2mms[22m[39m
[31m       [31m√ó[31m should return org_id and user_id for valid authenticated user[39m[32m 68[2mms[22m[39m
[31m       [31m√ó[31m should return user role information[39m[32m 26[2mms[22m[39m
[31m       [31m√ó[31m should return role permissions as JSONB object[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return organization details[39m[32m 20[2mms[22m[39m
[31m       [31m√ó[31m should include onboarding state in organization details[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should throw 404 error for non-existent user_id[39m[32m 82[2mms[22m[39m
[31m       [31m√ó[31m should throw 404 error (not 403) for invalid user[39m[32m 37[2mms[22m[39m
       [32m‚úì[39m should throw 401 error for undefined user_id[32m 21[2mms[22m[39m
[31m       [31m√ó[31m should throw error for inactive user[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should throw error for inactive organization[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should complete context resolution in under 50ms[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should use single query for context resolution (no N+1)[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should handle user with null last_name gracefully[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should handle organization with null logo_url[39m[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject malformed UUID format[32m 1[2mms[22m[39m
     [32m‚úì[39m should return true for valid org context[32m 24[2mms[22m[39m
     [32m‚úì[39m should return false for missing org_id[32m 0[2mms[22m[39m
     [32m‚úì[39m should return false for missing user_id[32m 0[2mms[22m[39m
     [32m‚úì[39m should return false for missing role_code[32m 0[2mms[22m[39m
     [32m‚úì[39m should return false for empty permissions object[32m 0[2mms[22m[39m
[31m     [31m√ó[31m should extract user_id from Supabase auth session[39m[32m 23[2mms[22m[39m
[31m     [31m√ó[31m should throw 401 for unauthenticated request[39m[32m 31[2mms[22m[39m
[31m     [31m√ó[31m should throw 401 for expired session[39m[32m 35[2mms[22m[39m
[90mstdout[2m | lib/services/__tests__/barcode-generator-service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

 [31m‚ùØ[39m __tests__/01-settings/01.7.module-toggles.test.tsx [2m([22m[2m20 tests[22m[2m | [22m[31m20 failed[39m[2m)[22m[33m 741[2mms[22m[39m
[31m       [31m√ó[31m should_display_all_7_modules_with_toggle_switches[39m[32m 223[2mms[22m[39m
[31m       [31m√ó[31m should_show_module_descriptions_and_dependencies[39m[32m 4[2mms[22m[39m
[31m       [31m√ó[31m should_show_settings_module_as_always_enabled[39m[32m 33[2mms[22m[39m
[31m       [31m√ó[31m should_enable_module_when_toggle_clicked[39m[32m 39[2mms[22m[39m
[31m       [31m√ó[31m should_show_warning_if_dependencies_not_enabled[39m[32m 6[2mms[22m[39m
[31m       [31m√ó[31m should_update_navigation_sidebar_after_enabling_module[39m[32m 38[2mms[22m[39m
[31m       [31m√ó[31m should_show_confirmation_modal_when_disabling_module[39m[32m 67[2mms[22m[39m
[31m       [31m√ó[31m should_prevent_disable_if_dependent_modules_enabled[39m[32m 5[2mms[22m[39m
[31m       [31m√ó[31m should_show_warning_about_dependent_modules_in_modal[39m[32m 80[2mms[22m[39m
[31m       [31m√ó[31m should_disable_module_after_confirmation[39m[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should_cancel_disable_when_cancel_clicked[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should_disable_toggles_for_non_admin_users[39m[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should_show_read_only_badge_for_non_admin[39m[32m 15[2mms[22m[39m
[31m       [31m√ó[31m should_hide_navigation_item_when_module_disabled[39m[32m 31[2mms[22m[39m
[31m       [31m√ó[31m should_show_navigation_item_when_module_enabled[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should_show_loading_skeleton_while_fetching_modules[39m[32m 18[2mms[22m[39m
[31m       [31m√ó[31m should_show_error_message_on_fetch_failure[39m[32m 20[2mms[22m[39m
[31m       [31m√ó[31m should_retry_fetch_when_retry_button_clicked[39m[32m 33[2mms[22m[39m
[31m       [31m√ó[31m should_display_enabled_and_disabled_count[39m[32m 4[2mms[22m[39m
[31m       [31m√ó[31m should_update_count_after_toggle[39m[32m 45[2mms[22m[39m
[90mstdout[2m | lib/services/__tests__/barcode-generator-service.test.ts[2m > [22m[2mgenerateQRCode - QR Code Display (AC-005.6)[2m > [22m[2mshould generate QR code as data URL with correct dimensions
[22m[39mGenerated QR code for barcode: LOC-WH-01-001

[90mstdout[2m | lib/services/__tests__/barcode-generator-service.test.ts[2m > [22m[2mgenerateQRCode - QR Code Display (AC-005.6)[2m > [22m[2mshould use Medium error correction level for display
[22m[39mGenerated QR code for barcode: LOC-WH-01-001

 [31m‚ùØ[39m lib/services/__tests__/barcode-generator-service.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m10 failed[39m[2m)[22m[33m 577[2mms[22m[39m
[31m       [31m√ó[31m should generate barcode with format LOC-{warehouse_code}-{sequence}[39m[32m 164[2mms[22m[39m
[31m       [31m√ó[31m should increment sequence for existing locations[39m[32m 18[2mms[22m[39m
[31m       [31m√ó[31m should pad sequence with leading zeros (3 digits)[39m[32m 4[2mms[22m[39m
[31m       [31m√ó[31m should handle sequences over 999[39m[32m 49[2mms[22m[39m
[31m       [31m√ó[31m should handle warehouse codes with hyphens and numbers[39m[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should handle database query errors[39m[32m 54[2mms[22m[39m
       [32m‚úì[39m should handle invalid warehouse code format[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should generate independent sequences per warehouse[39m[32m 54[2mms[22m[39m
[31m     [31m√ó[31m should return true when barcode is unique[39m[32m 40[2mms[22m[39m
     [32m‚úì[39m should return false when barcode already exists[32m 3[2mms[22m[39m
     [32m‚úì[39m should handle database errors gracefully[32m 38[2mms[22m[39m
     [32m‚úì[39m should generate QR code as data URL with correct dimensions[32m 2[2mms[22m[39m
     [32m‚úì[39m should use Medium error correction level for display[32m 48[2mms[22m[39m
[31m     [31m√ó[31m should handle QR code generation errors[39m[32m 12[2mms[22m[39m
[31m     [31m√ó[31m should generate high-resolution QR code for printing[39m[32m 24[2mms[22m[39m
     [32m‚úì[39m should use High error correction level for printing[32m 2[2mms[22m[39m
     [32m‚úì[39m should handle empty barcode input[32m 1[2mms[22m[39m
 [31m‚ùØ[39m __tests__/components/production/work-orders/StartWorkOrderButton.test.tsx [2m([22m[2m20 tests[22m[2m | [22m[31m20 failed[39m[2m)[22m[33m 380[2mms[22m[39m
[31m       [31m√ó[31m should render Start Production button when WO status is released[39m[32m 98[2mms[22m[39m
[31m       [31m√ó[31m should render enabled button for Released WO[39m[32m 22[2mms[22m[39m
[31m       [31m√ó[31m should have correct aria-label for accessibility[39m[32m 15[2mms[22m[39m
[31m       [31m√ó[31m should render disabled button for Draft WO[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should render disabled button for In Progress WO[39m[32m 6[2mms[22m[39m
[31m       [31m√ó[31m should render disabled button for Completed WO[39m[32m 18[2mms[22m[39m
[31m       [31m√ó[31m should render disabled button for Cancelled WO[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should render disabled button for Paused WO[39m[32m 29[2mms[22m[39m
[31m       [31m√ó[31m should show tooltip "WO must be Released to start" on disabled button hover[39m[32m 26[2mms[22m[39m
[31m       [31m√ó[31m should show button for production_operator role[39m[32m 29[2mms[22m[39m
[31m       [31m√ó[31m should show button for production_manager role[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should show button for admin role[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should hide button for viewer role[39m[32m 8[2mms[22m[39m
[31m       [31m√ó[31m should show loading state while checking permissions[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should call onClick when button clicked[39m[32m 19[2mms[22m[39m
[31m       [31m√ó[31m should NOT call onClick when button is disabled[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should show loading spinner when isLoading=true[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should disable button while loading[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should show "Starting..." text while loading[39m[32m 21[2mms[22m[39m
[31m       [31m√ó[31m should have green/success styling when enabled[39m[32m 22[2mms[22m[39m
[90mstdout[2m | __tests__/01-settings/01.12.allergens-api.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | __tests__/integration/api/production/work-orders-start.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

 [31m‚ùØ[39m __tests__/01-settings/01.12.allergens-api.test.ts [2m([22m[2m29 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 164[2mms[22m[39m
       [32m‚úì[39m should return 401 if not authenticated[32m 11[2mms[22m[39m
       [32m‚úì[39m should allow any authenticated user to view allergens[32m 1[2mms[22m[39m
       [32m‚úì[39m should return all 14 EU allergens (AC-AL-01)[32m 1[2mms[22m[39m
       [32m‚úì[39m should return allergens sorted by display_order (AC-AL-03)[32m 0[2mms[22m[39m
       [32m‚úì[39m should include all language fields (name_en, name_pl, name_de, name_fr)[32m 0[2mms[22m[39m
       [32m‚úì[39m should return allergens within 200ms (AC-AL-01)[32m 19[2mms[22m[39m
       [32m‚úì[39m should NOT filter by org_id (global reference data)[32m 2[2mms[22m[39m
       [32m‚úì[39m should return same 14 allergens for different users[32m 12[2mms[22m[39m
       [32m‚úì[39m should search by allergen code (AC-AS-03)[32m 1[2mms[22m[39m
       [32m‚úì[39m should search by English name (AC-AS-01)[32m 0[2mms[22m[39m
       [32m‚úì[39m should search by Polish name (AC-AS-02)[32m 0[2mms[22m[39m
       [32m‚úì[39m should search across all language fields (AC-AS-03)[32m 0[2mms[22m[39m
       [32m‚úì[39m should handle case-insensitive search[32m 1[2mms[22m[39m
       [32m‚úì[39m should return empty array for no search matches[32m 0[2mms[22m[39m
       [32m‚úì[39m should complete search within 100ms (AC-AS-01)[32m 0[2mms[22m[39m
       [32m‚úì[39m should return 500 if database query fails[32m 0[2mms[22m[39m
       [32m‚úì[39m should return single allergen by ID[32m 0[2mms[22m[39m
       [32m‚úì[39m should return 404 if allergen not found[32m 11[2mms[22m[39m
       [32m‚úì[39m should return allergen with all language fields[32m 1[2mms[22m[39m
       [32m‚úì[39m should return 401 if not authenticated[32m 0[2mms[22m[39m
     [32m‚úì[39m should return 405 Method Not Allowed (AC-RO-02)[32m 12[2mms[22m[39m
     [32m‚úì[39m should return error message explaining read-only mode[32m 0[2mms[22m[39m
     [32m‚úì[39m should return 405 even for SUPER_ADMIN (AC-RO-01)[32m 0[2mms[22m[39m
     [32m‚úì[39m should return 405 Method Not Allowed[32m 1[2mms[22m[39m
     [32m‚úì[39m should return 405 even for SUPER_ADMIN[32m 1[2mms[22m[39m
     [32m‚úì[39m should return 405 Method Not Allowed[32m 9[2mms[22m[39m
     [32m‚úì[39m should return 405 even for SUPER_ADMIN[32m 1[2mms[22m[39m
     [32m‚úì[39m should validate allergen response schema[32m 17[2mms[22m[39m
[31m     [31m√ó[31m should validate code format (A01-A14)[39m[32m 46[2mms[22m[39m
 [31m‚ùØ[39m __tests__/integration/api/production/work-orders-start.test.ts [2m([22m[2m32 tests[22m[2m | [22m[31m32 failed[39m[2m)[22m[32m 262[2mms[22m[39m
[31m       [31m√ó[31m should return 401 for unauthenticated request[39m[32m 61[2mms[22m[39m
[31m       [31m√ó[31m should return 401 if user not found in database[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return 200 for successful start of Released WO[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return WO with status in_progress[39m[32m 7[2mms[22m[39m
[31m       [31m√ó[31m should return WO with started_at timestamp (ISO format)[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return WO with started_by user UUID[39m[32m 11[2mms[22m[39m
[31m       [31m√ó[31m should set started_at within 1 second of current time[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for Draft WO with error message[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for In Progress WO[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for Completed WO[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for Cancelled WO[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for Paused WO[39m[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should include current_status in error response[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 404 for cross-org WO access (not 403)[39m[32m 11[2mms[22m[39m
[31m       [31m√ó[31m should return 404 for non-existent WO[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should return JSON content type[39m[32m 10[2mms[22m[39m
[31m       [31m√ó[31m should return WO ID in response[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should return wo_number in response[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should allow production_operator to start WO[39m[32m 13[2mms[22m[39m
[31m       [31m√ó[31m should allow production_manager to start WO[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should allow admin to start WO[39m[32m 15[2mms[22m[39m
[31m       [31m√ó[31m should deny viewer from starting WO with 403[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should accept empty request body[39m[32m 8[2mms[22m[39m
[31m       [31m√ó[31m should accept valid line_id override[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should accept force=true to bypass line check[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 400 for invalid line_id UUID[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 401 for unauthenticated request[39m[32m 22[2mms[22m[39m
[31m       [31m√ó[31m should return 200 with material availability data[39m[32m 12[2mms[22m[39m
[31m       [31m√ó[31m should return overall_availability_percent[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return materials array with details[39m[32m 5[2mms[22m[39m
[31m       [31m√ó[31m should return 100% in Phase 0 (mock data)[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return 404 for non-existent WO[39m[32m 16[2mms[22m[39m
[90mstdout[2m | lib/services/__tests__/offline-queue-service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | __tests__/lib/validation/routing-schemas.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

 [31m‚ùØ[39m lib/services/__tests__/offline-queue-service.test.ts [2m([22m[2m15 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 186[2mms[22m[39m
       [32m‚úì[39m should store operation in IndexedDB[32m 51[2mms[22m[39m
       [32m‚úì[39m should increment pending count after queue[32m 2[2mms[22m[39m
       [32m‚úì[39m should support register_output operation type[32m 2[2mms[22m[39m
       [32m‚úì[39m should support register_by_product operation type[32m 22[2mms[22m[39m
       [32m‚úì[39m should add timestamp to queued operation[32m 2[2mms[22m[39m
       [32m‚úì[39m should process all pending operations[32m 2[2mms[22m[39m
       [32m‚úì[39m should mark synced items as synced[32m 1[2mms[22m[39m
       [32m‚úì[39m should handle partial failures gracefully[32m 1[2mms[22m[39m
       [32m‚úì[39m should return empty result when queue is empty[32m 18[2mms[22m[39m
       [32m‚úì[39m should increment retry count on failure[32m 1[2mms[22m[39m
       [32m‚úì[39m should return 0 when queue is empty[32m 1[2mms[22m[39m
       [32m‚úì[39m should return correct count after queuing[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should be synchronous for quick UI updates[39m[32m 23[2mms[22m[39m
       [32m‚úì[39m should remove all pending items[32m 19[2mms[22m[39m
[31m       [31m√ó[31m should be idempotent (safe to call multiple times)[39m[32m 15[2mms[22m[39m
 [31m‚ùØ[39m __tests__/lib/validation/routing-schemas.test.ts [2m([22m[2m63 tests[22m[2m | [22m[31m30 failed[39m[2m)[22m[33m 421[2mms[22m[39m
       [32m‚úì[39m should accept valid routing data[32m 26[2mms[22m[39m
       [32m‚úì[39m should accept routing with all optional fields[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should transform code to uppercase[39m[32m 66[2mms[22m[39m
[31m       [31m√ó[31m should reject code shorter than 2 characters[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should reject code longer than 50 characters[39m[32m 24[2mms[22m[39m
[31m       [31m√ó[31m should reject code with invalid characters[39m[32m 2[2mms[22m[39m
       [32m‚úì[39m should accept valid code formats (uppercase, numbers, hyphens)[32m 2[2mms[22m[39m
       [32m‚úì[39m should reject empty name[32m 32[2mms[22m[39m
       [32m‚úì[39m should reject name longer than 100 characters[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject description longer than 1000 characters[32m 18[2mms[22m[39m
[31m       [31m√ó[31m should default status to active[39m[32m 10[2mms[22m[39m
[31m       [31m√ó[31m should default is_reusable to true[39m[32m 12[2mms[22m[39m
       [32m‚úì[39m should accept valid status values[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should reject invalid status value[39m[32m 15[2mms[22m[39m
       [32m‚úì[39m should accept partial update with name only[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept partial update with status only[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept all updatable fields[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept null description[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept empty update (all fields optional)[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept valid filter options[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept empty filters[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept status "all" for showing all routings[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept valid sort_by values[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept valid sort_direction values[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should reject invalid status[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should reject invalid sort_by[39m[32m 6[2mms[22m[39m
[31m       [31m√ó[31m should accept valid operation data[39m[32m 12[2mms[22m[39m
[31m       [31m√ó[31m should accept operation with all fields[39m[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject non-integer sequence[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject negative sequence[32m 10[2mms[22m[39m
       [32m‚úì[39m should reject zero sequence[32m 10[2mms[22m[39m
       [32m‚úì[39m should reject empty operation_name[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject operation_name longer than 100 characters[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject invalid machine_id (not UUID)[32m 6[2mms[22m[39m
       [32m‚úì[39m should reject invalid line_id (not UUID)[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject non-positive expected_duration_minutes[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject expected_yield_percent less than 0.01[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject expected_yield_percent greater than 100[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should default expected_yield_percent to 100[39m[32m 7[2mms[22m[39m
[31m       [31m√ó[31m should default setup_time_minutes to 0[39m[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject negative setup_time_minutes[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject negative labor_cost[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should accept null machine_id[39m[32m 12[2mms[22m[39m
[31m       [31m√ó[31m should accept null line_id[39m[32m 13[2mms[22m[39m
       [32m‚úì[39m should accept partial update[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept all updatable fields[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept empty update[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept null labor_cost[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should accept valid reorder data[39m[32m 5[2mms[22m[39m
[31m       [31m√ó[31m should reject invalid operation ID[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should reject negative sequence[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should reject zero sequence[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should accept empty operations array[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should accept valid product assignment[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should accept assignment with default_product_id[39m[32m 4[2mms[22m[39m
[31m       [31m√ó[31m should accept empty product_ids array[39m[32m 9[2mms[22m[39m
[31m       [31m√ó[31m should reject invalid product_id (not UUID)[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should reject invalid default_product_id[39m[32m 18[2mms[22m[39m
[31m       [31m√ó[31m should accept valid routing assignment[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should accept assignment with default_routing_id[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should accept empty routing_ids array[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should reject invalid routing_id[39m[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should reject invalid default_routing_id[39m[32m 1[2mms[22m[39m
[90mstdout[2m | lib/validation/__tests__/bom-clone.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | __tests__/components/production/dashboard/AlertsPanel.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üì° add observability to secrets: https://dotenvx.com/ops

 [31m‚ùØ[39m lib/validation/__tests__/bom-clone.test.ts [2m([22m[2m35 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 567[2mms[22m[39m
       [32m‚úì[39m should reject when target_product_id is missing[32m 50[2mms[22m[39m
       [32m‚úì[39m should reject when target_product_id is not a UUID[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject when target_product_id is empty string[32m 1[2mms[22m[39m
       [32m‚úì[39m should accept valid UUID for target_product_id[32m 1[2mms[22m[39m
       [32m‚úì[39m should be optional[32m 27[2mms[22m[39m
       [32m‚úì[39m should reject invalid date format[32m 1[2mms[22m[39m
       [32m‚úì[39m should reject date in the past[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept today's date[32m 17[2mms[22m[39m
       [32m‚úì[39m should accept future date[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should handle ISO date format (YYYY-MM-DD)[39m[32m 173[2mms[22m[39m
[31m       [31m√ó[31m should handle ISO datetime format[39m[32m 2[2mms[22m[39m
       [32m‚úì[39m should be optional[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept null[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject invalid date format[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept future date[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject when effective_to is before effective_from[32m 29[2mms[22m[39m
       [32m‚úì[39m should accept when effective_to equals effective_from[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should accept when effective_to is after effective_from[39m[32m 49[2mms[22m[39m
       [32m‚úì[39m should default to draft when not provided[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept draft status[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept active status[32m 0[2mms[22m[39m
       [32m‚úì[39m should reject invalid status[32m 27[2mms[22m[39m
       [32m‚úì[39m should reject empty status[32m 1[2mms[22m[39m
       [32m‚úì[39m should be optional[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept notes up to 2000 characters[32m 26[2mms[22m[39m
       [32m‚úì[39m should reject notes exceeding 2000 characters[32m 1[2mms[22m[39m
       [32m‚úì[39m should accept empty notes string[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept notes with special characters[32m 0[2mms[22m[39m
       [32m‚úì[39m should accept notes with newlines[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should validate complete date range (from and to)[39m[32m 35[2mms[22m[39m
       [32m‚úì[39m should not validate date range if from is missing[32m 1[2mms[22m[39m
       [32m‚úì[39m should not validate date range if to is missing[32m 40[2mms[22m[39m
[31m       [31m√ó[31m should validate valid complete request[39m[32m 23[2mms[22m[39m
       [32m‚úì[39m should validate minimal valid request[32m 0[2mms[22m[39m
       [32m‚úì[39m should provide helpful error messages[32m 0[2mms[22m[39m
[90mstdout[2m | app/api/v1/settings/dashboard/stats/__tests__/route.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

[90mstdout[2m | lib/services/__tests__/purchase-order-service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üì° add observability to secrets: https://dotenvx.com/ops

 [31m‚ùØ[39m __tests__/components/production/dashboard/AlertsPanel.test.tsx [2m([22m[2m43 tests[22m[2m | [22m[31m43 failed[39m[2m)[22m[33m 791[2mms[22m[39m
[31m       [31m√ó[31m should render alerts panel container[39m[32m 181[2mms[22m[39m
[31m       [31m√ó[31m should display panel title[39m[32m 40[2mms[22m[39m
[31m       [31m√ó[31m should display total alert count[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should display material shortage section[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should display HIGH priority badge (red)[39m[32m 22[2mms[22m[39m
[31m       [31m√ó[31m should display shortage alert text with WO number and availability[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should display product name in shortage alert[39m[32m 34[2mms[22m[39m
[31m       [31m√ó[31m should display detected_at timestamp[39m[32m 34[2mms[22m[39m
[31m       [31m√ó[31m should make alert clickable and navigate to WO detail[39m[32m 40[2mms[22m[39m
[31m       [31m√ó[31m should order shortage alerts by availability (lowest first)[39m[32m 22[2mms[22m[39m
[31m       [31m√ó[31m should display delayed WO section[39m[32m 33[2mms[22m[39m
[31m       [31m√ó[31m should display MEDIUM priority badge (yellow)[39m[32m 33[2mms[22m[39m
[31m       [31m√ó[31m should display delayed alert text with WO number and days overdue[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should display product name in delayed alert[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should calculate days overdue correctly[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should make delayed alert clickable[39m[32m 23[2mms[22m[39m
[31m       [31m√ó[31m should order delayed alerts by days overdue (most overdue first)[39m[32m 36[2mms[22m[39m
[31m       [31m√ó[31m should display Quality Issues placeholder[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should display Machine Downtime placeholder[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should style placeholder sections with gray background[39m[32m 33[2mms[22m[39m
[31m       [31m√ó[31m should display info icon for placeholder sections[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should display success message when no alerts[39m[32m 32[2mms[22m[39m
[31m       [31m√ó[31m should display "no alerts at this time" text[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should display green success styling[39m[32m 34[2mms[22m[39m
[31m       [31m√ó[31m should display last check timestamp[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should still show placeholder sections when no active alerts[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should display loading skeleton when loading[39m[32m 26[2mms[22m[39m
[31m       [31m√ó[31m should not display alerts when loading[39m[32m 19[2mms[22m[39m
[31m       [31m√ó[31m should show count badge for material shortages[39m[32m 30[2mms[22m[39m
[31m       [31m√ó[31m should show count badge for delayed WOs[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should not show count badge when section is empty[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should collapse section when header clicked[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should expand section when collapsed header clicked[39m[32m 24[2mms[22m[39m
[31m       [31m√ó[31m should show chevron indicator for collapsible sections[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should style material shortage alerts with red border[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should style delayed WO alerts with yellow border[39m[32m 25[2mms[22m[39m
[31m       [31m√ó[31m should display warning icon for shortage alerts[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should display clock icon for delayed alerts[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should have accessible alert role[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should have aria-live region for dynamic updates[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should have keyboard navigable alerts[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should update alerts when props change[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should preserve collapsed state during refresh[39m[32m 1[2mms[22m[39m
 [31m‚ùØ[39m app/api/v1/settings/dashboard/stats/__tests__/route.test.ts [2m([22m[2m7 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 582[2mms[22m[39m
[31m     [31m√ó[31m should return all dashboard stats for admin user[39m[33m 388[2mms[22m[39m
[31m     [31m√ó[31m should return filtered stats for warehouse_manager role[39m[32m 29[2mms[22m[39m
     [32m‚úì[39m should return 401 when user is not authenticated[32m 21[2mms[22m[39m
     [32m‚úì[39m should return 400 when org context is missing[32m 21[2mms[22m[39m
[31m     [31m√ó[31m should return 500 when database query fails[39m[32m 53[2mms[22m[39m
     [32m‚úì[39m should return empty stats for viewer role[32m 15[2mms[22m[39m
     [32m‚úì[39m should include cache headers in response[32m 24[2mms[22m[39m
 [31m‚ùØ[39m lib/services/__tests__/purchase-order-service.test.ts [2m([22m[2m41 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 134[2mms[22m[39m
       [32m‚úì[39m AC-04-1: Should calculate subtotal correctly for single line[32m 14[2mms[22m[39m
       [32m‚úì[39m AC-04-1: Should calculate subtotal correctly for multiple lines[32m 14[2mms[22m[39m
       [32m‚úì[39m AC-03-4: Should calculate discount amounts correctly[32m 0[2mms[22m[39m
       [32m‚úì[39m AC-03-4: Should calculate line totals with multiple discounts[32m 0[2mms[22m[39m
       [32m‚úì[39m AC-04-2: Should calculate tax amount correctly[32m 0[2mms[22m[39m
       [32m‚úì[39m AC-04-3: Should calculate grand total correctly[32m 1[2mms[22m[39m
       [32m‚úì[39m Should handle edge case: zero quantity line[32m 0[2mms[22m[39m
       [32m‚úì[39m Should handle edge case: 100% discount[32m 0[2mms[22m[39m
       [32m‚úì[39m Should handle edge case: high tax rate[32m 0[2mms[22m[39m
       [32m‚úì[39m Should handle decimal precision correctly[32m 0[2mms[22m[39m
       [32m‚úì[39m AC-05-2: Should allow valid transition draft -> submitted[32m 0[2mms[22m[39m
       [32m‚úì[39m AC-05-2: Should allow valid transition draft -> cancelled[32m 0[2mms[22m[39m
       [32m‚úì[39m AC-05-2: Should allow valid transition submitted -> confirmed[32m 14[2mms[22m[39m
       [32m‚úì[39m AC-05-2: Should allow valid transition confirmed -> receiving[32m 0[2mms[22m[39m
       [32m‚úì[39m AC-05-2: Should allow valid transition receiving -> closed[32m 0[2mms[22m[39m
       [32m‚úì[39m AC-05-2: Should block invalid transition closed -> draft[32m 0[2mms[22m[39m
       [32m‚úì[39m AC-05-2: Should block invalid transition closed -> anything[32m 0[2mms[22m[39m
       [32m‚úì[39m AC-05-2: Should block invalid transition cancelled -> anything[32m 0[2mms[22m[39m
       [32m‚úì[39m Should allow transition submitted -> pending_approval[32m 0[2mms[22m[39m
[31m       [31m√ó[31m Should allow transition pending_approval -> confirmed[39m[32m 39[2mms[22m[39m
       [32m‚úì[39m Should allow transition confirmed -> cancelled[32m 0[2mms[22m[39m
       [32m‚úì[39m Should allow transition receiving -> cancelled[32m 0[2mms[22m[39m
       [32m‚úì[39m AC-05-1: Should allow edit for draft status[32m 0[2mms[22m[39m
       [32m‚úì[39m AC-05-1: Should allow edit for submitted status[32m 0[2mms[22m[39m
       [32m‚úì[39m AC-05-4: Should not allow edit for confirmed status[32m 0[2mms[22m[39m
       [32m‚úì[39m AC-05-4: Should not allow edit for receiving status[32m 0[2mms[22m[39m
       [32m‚úì[39m Should not allow edit for closed status[32m 0[2mms[22m[39m
       [32m‚úì[39m Should not allow edit for cancelled status[32m 6[2mms[22m[39m
       [32m‚úì[39m Should not allow edit for pending_approval status[32m 0[2mms[22m[39m
       [32m‚úì[39m Should allow deletion for draft PO with no receipts[32m 7[2mms[22m[39m
       [32m‚úì[39m Should block deletion for line with receipts[32m 9[2mms[22m[39m
       [32m‚úì[39m AC-02-1: Should return supplier defaults[32m 10[2mms[22m[39m
       [32m‚úì[39m Should handle supplier without tax code[32m 0[2mms[22m[39m
       [32m‚úì[39m AC-03-2: Should return supplier-product price when available[32m 0[2mms[22m[39m
       [32m‚úì[39m AC-03-3: Should fallback to product std_price when no supplier-product price[32m 0[2mms[22m[39m
       [32m‚úì[39m Should return zero price if product not found[32m 0[2mms[22m[39m
       [32m‚úì[39m AC-02-2: Should generate PO number in format PO-YYYY-NNNNN[32m 9[2mms[22m[39m
       [32m‚úì[39m Should increment sequence for multiple POs in same year[32m 1[2mms[22m[39m
       [32m‚úì[39m Should reset sequence for new year[32m 1[2mms[22m[39m
       [32m‚úì[39m Should calculate line total: (quantity * unit_price) - discount_amount[32m 0[2mms[22m[39m
       [32m‚úì[39m Should calculate correct discount_amount[32m 0[2mms[22m[39m
[90mstdout[2m | components/settings/allergens/__tests__/AllergensDataTable.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

[90mstdout[2m | __tests__/api/technical/dashboard.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | lib/services/__tests__/costing-service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

‚ÄâELIFECYCLE‚Äâ Test failed. See above for more details.
‚ÄâELIFECYCLE‚Äâ Command failed with exit code 1.
