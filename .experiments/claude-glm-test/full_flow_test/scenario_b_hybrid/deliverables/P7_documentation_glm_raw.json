{
  "response": "# LabelPrintService API Documentation\n\n## 1. Overview\n\nThe `LabelPrintService` is a TypeScript utility class designed to generate Zebra Programming Language (ZPL) code for printing license plate labels. This service supports multiple label sizes, integrates both QR codes and barcodes, and provides options for bulk printing operations.\n\n### Supported Printers\n- Zebra ZPL II compatible printers (e.g., Zebra ZD420, ZD620)\n\n### Key Features\n- Multi-size label support (4x6, 4x3, 3x2 inches)\n- QR code generation with comprehensive product data\n- Barcode generation for license plate numbers\n- Configurable copy quantities\n- Bulk printing support (up to 100 labels per request)\n- Automatic label layout and positioning\n\n## 2. API Reference\n\n### `generateZPL(lp, options)`\n\nGenerates ZPL code for a single license plate label.\n\n#### Method Signature\n```typescript\nstatic generateZPL(lp: LicensePlate, options: PrintLabelOptions): string\n```\n\n#### Parameters\n| Parameter | Type | Description | Required |\n|-----------|------|-------------|----------|\n| `lp` | `LicensePlate` | License plate object containing all product and location details | Yes |\n| `options` | `PrintLabelOptions` | Configuration options for label printing | Yes |\n\n#### Return Type\n`string` - ZPL code string ready to be sent to a Zebra printer\n\n#### Error Cases\n- Throws `Error` if `options.size` is not one of the supported sizes\n- Throws `Error` if `options.copies` is not between 1 and 100\n\n#### Example\n```typescript\nimport { LabelPrintService } from './LabelPrintService';\nimport type { LicensePlate } from '@/lib/types/license-plate';\n\nconst lp: LicensePlate = {\n  lp_number: 'LP123456',\n  product: {\n    code: 'PROD001',\n    name: 'Premium Widget Assembly'\n  },\n  batch_number: 'B2023-001',\n  expiry_date: '2025-12-31',\n  quantity: 25.5,\n  uom: 'kg',\n  warehouse: {\n    code: 'WH01'\n  },\n  location: {\n    name: 'Aisle B, Bin 12'\n  }\n};\n\nconst zpl = LabelPrintService.generateZPL(lp, {\n  size: '4x6',\n  copies: 2,\n  includeQR: true\n});\n\n// Send zpl to printer\n```\n\n### `generateBulkZPL(lps, options)`\n\nGenerates ZPL code for multiple license plate labels in a single print job.\n\n#### Method Signature\n```typescript\nstatic generateBulkZPL(lps: LicensePlate[], options: PrintLabelOptions): string\n```\n\n#### Parameters\n| Parameter | Type | Description | Required |\n|-----------|------|-------------|----------|\n| `lps` | `LicensePlate[]` | Array of license plate objects | Yes |\n| `options` | `PrintLabelOptions` | Configuration options for label printing | Yes |\n\n#### Return Type\n`string` - ZPL code string with multiple labels ready to be sent to a Zebra printer\n\n#### Error Cases\n- Throws `Error` if `lps` array contains more than 100 items\n- Throws `Error` if any of the validation checks from `validatePrintRequest` fail\n\n#### Example\n```typescript\nimport { LabelPrintService } from './LabelPrintService';\n\nconst licensePlates: LicensePlate[] = [\n  // Multiple license plate objects\n];\n\nconst bulkZpl = LabelPrintService.generateBulkZPL(licensePlates, {\n  size: '4x3',\n  copies: 1\n});\n\n// Send bulkZpl to printer\n```\n\n### `validatePrintRequest(options)`\n\nValidates print request options before generating ZPL code.\n\n#### Method Signature\n```typescript\nstatic validatePrintRequest(options: PrintLabelOptions): void\n```\n\n#### Parameters\n| Parameter | Type | Description | Required |\n|-----------|------|-------------|----------|\n| `options` | `PrintLabelOptions` | Configuration options for label printing | Yes |\n\n#### Return Type\n`void`\n\n#### Error Cases\n- Throws `Error` with message \"Invalid label size\" if `options.size` is not supported\n- Throws `Error` with message \"Copies must be between 1 and 100\" if copies are out of range\n\n#### Example\n```typescript\nimport { LabelPrintService } from './LabelPrintService';\n\ntry {\n  LabelPrintService.validatePrintRequest({\n    size: '4x6',\n    copies: 5\n  });\n  // Proceed with printing\n} catch (error) {\n  console.error('Invalid print options:', error.message);\n}\n```\n\n## 3. Label Specifications\n\n### Supported Label Sizes\n\n| Size (inches) | Width (dots) | Length (dots) | Common Use Case |\n|---------------|--------------|---------------|-----------------|\n| 4x6 | 812 | 1218 | Shipping labels, large product labels |\n| 4x3 | 812 | 609 | Standard product labels, box labels |\n| 3x2 | 609 | 406 | Small item labels, bin labels |\n\n### Label Layout\n- **QR Code**: Top right corner (position varies by size)\n- **Barcode**: Bottom left corner (position varies by size)\n- **Text Fields**: Left side, arranged vertically:\n  - Product name (truncated at 40 characters)\n  - License plate number\n  - Batch number\n  - Expiry date\n  - Manufacture date (if available)\n  - Quantity with UOM\n  - Warehouse code\n  - Location name\n\n### QR Code Data Structure\nThe QR code contains a JSON object with the following structure:\n```json\n{\n  \"lp_number\": \"LP123456\",\n  \"product_code\": \"PROD001\",\n  \"product_name\": \"Premium Widget Assembly\",\n  \"batch\": \"B2023-001\",\n  \"expiry\": \"2025-12-31\",\n  \"quantity\": 25.5,\n  \"uom\": \"kg\",\n  \"warehouse\": \"WH01\",\n  \"location\": \"Aisle B, Bin 12\"\n}\n```\n\n### Barcode Format\n- **Type**: Code 128 (BCN)\n- **Height**: 100 dots\n- **Human Readable**: Yes (Y)\n- **Rotation**: Normal (N)\n- **Wide Bar Ratio**: Normal (N)\n\n## 4. Usage Guide\n\n### Basic Usage Example\n```typescript\nimport { LabelPrintService } from './LabelPrintService';\n\nconst licensePlate = {\n  lp_number: 'LP789012',\n  product: {\n    code: 'PROD002',\n    name: 'Standard Component'\n  },\n  batch_number: 'B2023-002',\n  expiry_date: '2024-06-30',\n  quantity: 100,\n  uom: 'units',\n  warehouse: {\n    code: 'WH02'\n  },\n  location: {\n    name: 'Zone C, Shelf 3'\n  }\n};\n\nconst zplCode = LabelPrintService.generateZPL(licensePlate, {\n  size: '4x6',\n  copies: 1,\n  includeQR: true\n});\n\n// Send ZPL code to printer via network or serial connection\n```\n\n### Bulk Printing Example\n```typescript\nimport { LabelPrintService } from './LabelPrintService';\n\nconst licensePlates = [\n  // Array of license plate objects\n];\n\ntry {\n  const bulkZpl = LabelPrintService.generateBulkZPL(licensePlates, {\n    size: '4x3',\n    copies: 1\n  });\n  \n  // Send bulkZpl to printer\n  console.log('Generated ZPL for', licensePlates.length, 'labels');\n} catch (error) {\n  console.error('Bulk print failed:', error.message);\n}\n```\n\n### Integration with API Endpoint\n```typescript\n// Example Express.js endpoint\napp.post('/api/print-labels', async (req, res) => {\n  try {\n    const { licensePlates, options } = req.body;\n    \n    if (!licensePlates || !Array.isArray(licensePlates)) {\n      return res.status(400).json({ error: 'Invalid license plates data' });\n    }\n    \n    if (licensePlates.length === 1) {\n      const zpl = LabelPrintService.generateZPL(licensePlates[0], options);\n      return res.json({ zpl });\n    } else {\n      const zpl = LabelPrintService.generateBulkZPL(licensePlates, options);\n      return res.json({ zpl });\n    }\n  } catch (error) {\n    console.error('Print label error:', error);\n    res.status(400).json({ error: error.message });\n  }\n});\n```\n\n### Common Patterns\n1. **Pre-validation**: Always validate options before generating ZPL\n   ```typescript\n   LabelPrintService.validatePrintRequest(options);\n   ```\n\n2. **Error Handling**: Wrap print operations in try-catch blocks\n   ```typescript\n   try {\n     const zpl = LabelPrintService.generateZPL(lp, options);\n     // Send to printer\n   } catch (error) {\n     // Handle validation errors\n   }\n   ```\n\n3. **Conditional QR Codes**: Include QR codes only when needed\n   ```typescript\n   const zpl = LabelPrintService.generateZPL(lp, {\n     size: '4x6',\n     copies: 1,\n     includeQR: isHighValueProduct // Dynamic flag\n   });\n   ```\n\n## 5. Testing\n\n### Test Location\nTests are located in the `tests/` directory alongside the service implementation:\n- `tests/LabelPrintService.test.ts`\n\n### How to Run Tests\n```bash\n# Run all tests\nnpm test\n\n# Run tests with coverage\nnpm run test:coverage\n\n# Run specific test file\nnpm test -- --testPathPattern=LabelPrintService\n```\n\n### Test Coverage\nThe test suite covers:\n- ZPL generation for all label sizes\n- Bulk print functionality\n- Validation error cases\n- QR code data structure\n- Barcode positioning\n- Text field formatting\n\n## 6. Technical Notes\n\n### ZPL Version\n- ZPL Version: ZPL II\n- Compatibility: Zebra ZPL II compatible printers\n\n### DPI (Dots Per Inch)\n- Printer resolution: 203 DPI\n- All dimensions are calculated based on this DPI\n\n### Font Specifications\n- **Product Name**: Arial, 24pt\n- **Other Text**: Arial, 18pt\n- **Default Font**: N (Arial)\n\n### Barcode/QR Code Specifications\n- **QR Code**: \n  - Type: BQN (QR Code)\n  - Error Correction: Level 2 (6)\n  - Data Format: JSON string\n- **Barcode**:\n  - Type: Code 128 (BCN)\n  - Height: 100 dots\n  - Human Readable: Yes\n\n### Performance Considerations\n- Bulk generation is optimized with array joining\n- Maximum 100 labels per bulk print to prevent memory issues\n- String templates are used for efficient ZPL construction\n\n### Limitations\n- Maximum 100 copies per label\n- Maximum 100 labels per bulk print\n- Product names are truncated at 40 characters\n- Manufacture date is optional (displayed only if present)",
  "usage": {
    "completion_tokens": 2394,
    "prompt_tokens": 1490,
    "total_tokens": 3884
  },
  "model": "glm-4-plus",
  "finish_reason": "stop"
}